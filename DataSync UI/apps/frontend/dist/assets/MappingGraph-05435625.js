import{r as j,j as t,b as s,e as C}from"./index-75d7470b.js";import{A as G}from"./AsciiPanel-9f053981.js";import{A as J}from"./AsciiButton-446d8430.js";import{f as K}from"./index-c4405eea.js";const ot=({title:c,history:x,loading:F,tableStructure:k,loadingStructure:T,onClose:d,renderMappingGraph:y})=>{const u=j.useMemo(()=>{const i=[],n=new Set,a=24*60*60*1e3;return x.forEach(o=>{if(!n.has(o.id))if(o.status==="IN_PROGRESS"){const l=new Date(o.start_time).getTime(),r=x.find(e=>!n.has(e.id)&&e.id!==o.id&&(e.status==="SUCCESS"||e.status==="ERROR")&&new Date(e.start_time).getTime()>l&&new Date(e.start_time).getTime()-l<=a);if(r){const e=new Date(o.start_time),f=new Date(r.end_time),g=Math.floor((f.getTime()-e.getTime())/1e3),h=new Date(r.start_time),m=Math.floor((h.getTime()-e.getTime())/1e3),S=r.duration_seconds||0;i.push({...r,id:o.id,start_time:e.toISOString(),end_time:f.toISOString(),duration_seconds:g>0?g:r.duration_seconds||0,in_progress:{start_time:o.start_time,end_time:r.start_time,duration_seconds:m>0?m:0},final_status:r.status,status_flow:["IN_PROGRESS",r.status],final_duration:S}),n.add(o.id),n.add(r.id)}else i.push({...o,status_flow:["IN_PROGRESS"],final_status:"IN_PROGRESS"}),n.add(o.id)}else if(o.status==="SUCCESS"||o.status==="ERROR"){const l=new Date(o.start_time).getTime(),r=x.find(e=>!n.has(e.id)&&e.id!==o.id&&e.status==="IN_PROGRESS"&&new Date(e.start_time).getTime()<l&&l-new Date(e.start_time).getTime()<=a);if(r){const e=new Date(r.start_time),f=new Date(o.end_time),g=Math.floor((f.getTime()-e.getTime())/1e3),h=new Date(o.start_time),m=Math.floor((h.getTime()-e.getTime())/1e3),S=o.duration_seconds||0;i.push({...o,start_time:e.toISOString(),end_time:f.toISOString(),duration_seconds:g>0?g:o.duration_seconds||0,in_progress:{start_time:r.start_time,end_time:o.start_time,duration_seconds:m>0?m:0},final_status:o.status,status_flow:["IN_PROGRESS",o.status],final_duration:S}),n.add(o.id),n.add(r.id)}else i.push({...o,status_flow:[o.status],final_status:o.status}),n.add(o.id)}else i.push({...o,status_flow:[o.status],final_status:o.status}),n.add(o.id)}),i.sort((o,l)=>new Date(l.start_time).getTime()-new Date(o.start_time).getTime())},[x]),R=Math.max(...u.map(i=>i.duration_seconds||0),1),_=i=>{if(i<60)return`${i}s`;const n=Math.floor(i/60),a=i%60;return`${n}m ${a}s`},b=i=>K(new Date(i),"PPpp"),L=({height:i,exec:n,tooltipText:a})=>{var B;const[o,l]=j.useState(!1),[r,e]=j.useState({}),[f,g]=j.useState("top"),h=j.useRef(null),m=j.useRef(null),S=s.accentSoft,I=n.final_status==="SUCCESS"?s.accent:n.final_status==="ERROR"?s.foreground:s.muted,D=n.duration_seconds||1,z=((B=n.in_progress)==null?void 0:B.duration_seconds)||0,P=n.final_duration||(n.in_progress?Math.max(0,D-z):D);let w=0,E=100;if(n.in_progress&&D>0){const p=z+P;p>0?(w=z/p*100,E=P/p*100):(w=50,E=50)}const U=()=>{l(!0),setTimeout(()=>{if(h.current&&m.current){const p=h.current.getBoundingClientRect(),M=m.current.getBoundingClientRect(),Y=window.innerHeight,A=window.innerWidth,W=p.top,q=Y-p.bottom,O=M.height||120,$=M.width||220;let N=p.top-O-12,v=p.left+p.width/2,H="top";W<O+20&&q>W&&(N=p.bottom+12,H="bottom"),v+$/2>A-10?v=A-$/2-10:v-$/2<10&&(v=$/2+10),e({position:"fixed",top:`${N}px`,left:`${v}px`,transform:"translateX(-50%)",zIndex:1e4}),g(H)}},0)},X=Math.max(i,2);return t.jsxs("div",{ref:h,style:{flex:1,minWidth:20,height:`${X}%`,minHeight:"4px",position:"relative",cursor:"pointer",transition:"all 0.2s ease",fontFamily:"Consolas",fontSize:11,display:"flex",flexDirection:"column",borderRadius:"2px 2px 0 0",overflow:"hidden"},onMouseEnter:U,onMouseLeave:()=>{l(!1),e({}),g("top")},children:[n.in_progress&&w>0&&t.jsx("div",{style:{height:`${w}%`,backgroundColor:S,border:`2px solid ${S}`,borderBottom:"none",minHeight:w<5?"5%":void 0}}),t.jsx("div",{style:{height:n.in_progress?`${E}%`:"100%",backgroundColor:I,border:`2px solid ${I}`,borderTop:n.in_progress?"none":void 0,borderRadius:n.in_progress?"0":"2px 2px 0 0",minHeight:E<5?"5%":void 0}}),o&&t.jsxs("div",{ref:m,style:{...r,backgroundColor:s.foreground,color:s.background,padding:"8px 12px",borderRadius:2,fontSize:11,fontFamily:"Consolas",whiteSpace:"pre-line",pointerEvents:"none",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",minWidth:220,maxWidth:300,textAlign:"left"},children:[a,t.jsx("div",{style:{position:"absolute",[f==="top"?"top":"bottom"]:"100%",left:"50%",transform:"translateX(-50%)",borderTop:f==="top"?`6px solid ${s.foreground}`:"6px solid transparent",borderBottom:f==="bottom"?`6px solid ${s.foreground}`:"6px solid transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent"}})]})]})};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backdropFilter:"blur(5px)",background:"rgba(0, 0, 0, 0.3)",zIndex:999,animation:"fadeIn 0.2s ease-in"},onClick:d}),t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"fadeIn 0.2s ease-in"},onClick:i=>{i.target===i.currentTarget&&d()},children:t.jsxs("div",{style:{background:s.background,borderRadius:2,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"90%",maxWidth:1200,maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",animation:"slideIn 0.3s ease-out",border:`2px solid ${s.border}`},onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`2px solid ${s.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:s.backgroundSoft},children:[t.jsxs("h2",{style:{margin:0,fontSize:14,fontFamily:"Consolas",fontWeight:600,color:s.foreground,textTransform:"uppercase"},children:[t.jsx("span",{style:{color:s.accent,marginRight:8},children:C.blockFull}),c]}),t.jsx(J,{label:"Close",onClick:d,variant:"ghost"})]}),t.jsx("div",{style:{padding:"20px",overflowY:"auto",flex:1,fontFamily:"Consolas",fontSize:12},children:F?t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:s.muted,fontFamily:"Consolas",fontSize:12},children:[C.blockFull," Loading execution history..."]}):u.length===0?t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:s.muted,fontFamily:"Consolas",fontSize:12},children:[t.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5},children:C.blockFull}),t.jsx("div",{style:{fontSize:13,fontWeight:600,marginBottom:8,color:s.foreground},children:"No execution history available"}),t.jsx("div",{style:{fontSize:12,opacity:.7},children:"No execution history available."})]}):t.jsxs(t.Fragment,{children:[t.jsx(G,{title:"EXECUTION DURATION TIMELINE",children:t.jsxs("div",{style:{position:"relative",paddingLeft:"40px",padding:"8px 0"},children:[t.jsxs("div",{style:{position:"absolute",left:0,top:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"space-between",fontSize:11,color:s.muted,fontFamily:"Consolas",padding:"8px 0",paddingBottom:"28px"},children:[t.jsx("span",{children:_(R)}),t.jsx("span",{children:_(Math.floor(R/2))}),t.jsx("span",{style:{paddingBottom:"8px"},children:"0s"})]}),t.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:8,height:200,padding:"8px 0"},children:u.slice(0,20).reverse().map(i=>{const n=i.duration_seconds||0;let a=0;R>0&&n>0?a=n/R*100:(n>0,a=1),a=Math.max(a,2);let o="";return i.in_progress?(o=`Status Flow: ${i.status_flow?i.status_flow.join(" → "):i.final_status}

`,o+=`IN_PROGRESS:
`,o+=`  Duration: ${_(i.in_progress.duration_seconds||0)}
`,o+=`  Start: ${b(i.in_progress.start_time)}
`,o+=`  End: ${b(i.in_progress.end_time)}

`,o+=`${i.final_status}:
`,o+=`  Duration: ${_(i.final_duration||0)}
`,o+=`  Start: ${b(i.start_time)}
`,o+=`  End: ${b(i.end_time)}

`,o+=`Total Duration: ${_(i.duration_seconds||0)}
`,o+=`Rows Processed: ${i.total_rows_processed||0}`,i.error_message&&(o+=`
Error: ${i.error_message}`)):(o=`Status: ${i.final_status||i.status}
`,o+=`Duration: ${_(i.duration_seconds||0)}
`,o+=`Start: ${b(i.start_time)}
`,o+=`End: ${b(i.end_time)}`,i.total_rows_processed&&(o+=`
Rows Processed: ${i.total_rows_processed}`),i.error_message&&(o+=`
Error: ${i.error_message}`)),t.jsx(L,{height:a,exec:i,tooltipText:o},i.id)})})]})}),t.jsx("div",{style:{marginTop:20},children:y(k,T)})]})})]})}),t.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      `})]})},it=({tableStructure:c,loading:x,sourceTitle:F,sourceType:k,sourceInfo:T})=>t.jsx("div",{style:{marginTop:20},children:t.jsx(G,{title:"DATA FLOW: SOURCE → TARGET",children:x?t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:s.muted,fontFamily:"Consolas",fontSize:12},children:[C.blockFull," Loading table structure..."]}):c?t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:24,justifyContent:"center",minHeight:400,padding:"8px 0"},children:[t.jsxs("div",{style:{flex:"0 0 300px",background:s.background,border:`2px solid ${s.accent}`,borderRadius:2,padding:"16px",fontFamily:"Consolas",fontSize:12},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"8px",borderBottom:`2px solid ${s.border}`,marginBottom:"12px"},children:t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:13,fontWeight:600,margin:0,color:s.accent,fontFamily:"Consolas"},children:F}),t.jsx("div",{style:{fontSize:11,color:s.muted,fontFamily:"Consolas"},children:k})]})}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8,fontSize:12},children:T.map((d,y)=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"6px 0",borderBottom:y<T.length-1?`1px solid ${s.border}`:"none"},children:[t.jsxs("span",{style:{color:s.muted,fontWeight:500,fontFamily:"Consolas"},children:[d.label,":"]}),t.jsx("span",{style:{color:s.foreground,wordBreak:"break-all",textAlign:"right",maxWidth:180,fontFamily:"Consolas"},children:d.value})]},y))})]}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:"0 0 80px",paddingTop:40},children:t.jsx("div",{style:{width:60,height:4,background:s.accent,position:"relative"},children:t.jsx("div",{style:{position:"absolute",right:-8,top:-6,width:0,height:0,borderLeft:`12px solid ${s.accent}`,borderTop:"8px solid transparent",borderBottom:"8px solid transparent"}})})}),t.jsxs("div",{style:{flex:"0 0 350px",background:s.background,border:`2px solid ${s.accent}`,borderRadius:2,padding:"16px",fontFamily:"Consolas",fontSize:12,maxHeight:600,overflowY:"auto"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"8px",borderBottom:`2px solid ${s.border}`,marginBottom:"12px"},children:t.jsxs("div",{children:[t.jsxs("h3",{style:{fontSize:13,fontWeight:600,margin:0,color:s.accent,fontFamily:"Consolas"},children:["Target: ",c.table]}),t.jsxs("div",{style:{fontSize:11,color:s.muted,fontFamily:"Consolas",marginBottom:"8px"},children:[c.schema,".",c.table," (",c.db_engine,")"]})]})}),t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12,fontFamily:"Consolas"},children:[t.jsx("thead",{style:{background:s.backgroundSoft,position:"sticky",top:0,zIndex:10},children:t.jsxs("tr",{style:{borderBottom:`2px solid ${s.border}`},children:[t.jsx("th",{style:{padding:"8px",textAlign:"left",fontWeight:600,color:s.foreground,fontSize:12,fontFamily:"Consolas",width:20}}),t.jsx("th",{style:{padding:"8px",textAlign:"left",fontWeight:600,color:s.foreground,fontSize:12,fontFamily:"Consolas",width:"40%"},children:"Name"}),t.jsx("th",{style:{padding:"8px",textAlign:"left",fontWeight:600,color:s.foreground,fontSize:12,fontFamily:"Consolas"},children:"Data Type"})]})}),t.jsx("tbody",{children:c.columns.map((d,y)=>t.jsxs("tr",{style:{borderBottom:`1px solid ${s.border}`,transition:"background-color 0.2s ease"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor=s.backgroundSoft},onMouseLeave:u=>{u.currentTarget.style.backgroundColor=s.background},children:[t.jsx("td",{style:{padding:"4px 8px",color:s.muted,fontSize:11,fontFamily:"Consolas"},children:y+1}),t.jsx("td",{style:{padding:"4px 8px",fontWeight:500,color:s.accent,fontFamily:"Consolas"},children:d.name}),t.jsx("td",{style:{padding:"4px 8px",color:s.muted,fontFamily:"Consolas",fontSize:11},children:d.type})]},d.name))})]})]})]}):t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:s.muted,fontFamily:"Consolas",fontSize:12},children:[t.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5},children:C.blockFull}),t.jsx("div",{style:{fontSize:13,fontWeight:600,marginBottom:8,color:s.foreground},children:"Table structure not available"}),t.jsx("div",{style:{fontSize:12,opacity:.7},children:"The table may not exist yet or there was an error loading it."})]})})});export{ot as E,it as M};
