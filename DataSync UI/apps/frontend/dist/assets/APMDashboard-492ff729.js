import{r as n,i as h,j as e,t as s,b as t,e as a,k as z}from"./index-f6ac47b8.js";import{A as u}from"./AsciiPanel-5614714e.js";import{A as g}from"./AsciiButton-4907e65e.js";import{e as W}from"./errorHandler-5ea9ae85.js";import{S as M}from"./SkeletonLoader-792007e7.js";const E=()=>{const[m,j]=n.useState([]),[b,v]=n.useState([]),[S,B]=n.useState([]),[P,p]=n.useState(!0),[f,x]=n.useState(null),[d,k]=n.useState("1min"),[w,c]=n.useState(!1),l=n.useCallback(async()=>{try{p(!0),x(null);const[r,i,o]=await Promise.all([h.getAPMMetrics({time_window:d}).catch(()=>({metrics:[]})),h.getAPMBaselines().catch(()=>[]),h.getAPMHealth().catch(()=>[])]);j(r.metrics||r||[]),v(i||[]),B(o||[])}catch(r){x(W(r))}finally{p(!1)}},[d]);n.useEffect(()=>{l();const r=setInterval(l,3e4);return()=>clearInterval(r)},[l]);const A=r=>{switch(r){case"healthy":return t.success;case"degraded":return t.warning;case"unhealthy":return t.error;default:return t.muted}};return P&&m.length===0?e.jsx(M,{}):e.jsx("div",{style:{padding:s.spacing.lg},children:e.jsx(u,{children:e.jsxs("div",{style:{marginBottom:s.spacing.lg},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:t.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:t.accent,marginRight:8},children:a.blockFull}),"APM DASHBOARD"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:s.spacing.lg,flexWrap:"wrap",gap:s.spacing.md},children:[e.jsx("p",{style:{color:t.muted,fontSize:12,margin:0},children:"Application Performance Monitoring with metrics, baselines, and health checks"}),e.jsx(g,{label:"Playbook & How to use",onClick:()=>c(!0),variant:"ghost"})]}),e.jsxs("div",{style:{display:"flex",gap:s.spacing.md,marginBottom:s.spacing.lg,alignItems:"center"},children:[e.jsxs("select",{value:d,onChange:r=>k(r.target.value),style:{padding:`${s.spacing.sm} ${s.spacing.md}`,border:`1px solid ${t.border}`,background:t.background,color:t.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"1min",children:"1 Minute"}),e.jsx("option",{value:"5min",children:"5 Minutes"}),e.jsx("option",{value:"1h",children:"1 Hour"})]}),e.jsx(g,{label:"Refresh",onClick:l})]}),w&&z.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>c(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",minHeight:400,overflowY:"auto",flexShrink:0},onClick:r=>r.stopPropagation(),children:e.jsx(u,{title:"APM DASHBOARD - PLAYBOOK & HOW TO USE",animated:!1,children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"APM (Application Performance Monitoring) shows how your services and operations perform over time. The dashboard combines live metrics (latency, throughput, error rate), stored baselines for comparison, and health checks for key components. Use it to spot regressions, capacity issues, and failing dependencies."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," HOW TO USE"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"1. Choose time window"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:'Select 1 Minute, 5 Minutes, or 1 Hour to see metrics for that period. Data refreshes automatically every 30 seconds; use "Refresh" for an immediate update.'})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"2. Check Health Checks"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"The top section shows component health (e.g. DB, API). Green = healthy, yellow = degraded, red = unhealthy. Use this to see if a dependency is down before digging into metrics."})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"3. Read Performance Metrics"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"The table lists each operation and service with P50/P95/P99 latency, throughput (req/s), and error rate (%). Rows highlighted in red exceed their baseline (latency or error rate > 1.5× baseline)."})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"4. Use baselines"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Baselines are calculated from historical data. When current metrics go far above baseline, the row is highlighted so you can prioritize investigations."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," KEY CONCEPTS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"P50 / P95 / P99"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Latency percentiles in ms: 50% of requests faster than P50, 95% faster than P95, 99% faster than P99. P95 and P99 show tail latency and spikes."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Throughput"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Requests per second (req/s) for that operation; indicates load and capacity."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Error rate"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Percentage of requests that failed; high values point to bugs, timeouts, or dependency failures."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Baseline"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Expected “normal” performance per operation; used to detect regressions when current metrics exceed it by a factor (e.g. 1.5×)."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Health (healthy / degraded / unhealthy)"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Status of monitored components; helps you see at a glance if a dependency is failing before checking detailed metrics."})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.muted,marginBottom:4},children:[a.blockSemi," Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:t.foreground},children:["• Start with Health Checks when something is wrong; then drill into metrics for the affected service or operation.",e.jsx("br",{}),"• Use a shorter time window (1 min) for live debugging and longer (1 h) for trend view.",e.jsx("br",{}),"• Investigate highlighted rows first—they indicate operations that have regressed vs. baseline.",e.jsx("br",{}),"• Recalculate baselines periodically (via backend/API) after traffic or code changes so comparisons stay meaningful."]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(g,{label:"Close",onClick:()=>c(!1),variant:"ghost"})})]})})})}),document.body),f&&e.jsx("div",{style:{padding:s.spacing.md,background:t.error,color:"#ffffff",marginBottom:s.spacing.md,borderRadius:2,fontSize:12},children:f}),e.jsxs("div",{style:{marginBottom:s.spacing.lg},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:600,color:t.foreground,marginBottom:s.spacing.md},children:"Health Checks"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:s.spacing.md},children:S.map((r,i)=>e.jsxs("div",{style:{padding:s.spacing.md,border:`1px solid ${t.border}`,borderRadius:2,background:t.background},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:s.spacing.xs},children:[e.jsx("span",{style:{fontWeight:600,fontSize:12},children:r.check_name}),e.jsx("span",{style:{padding:`${s.spacing.xs} ${s.spacing.sm}`,background:A(r.status),color:"#ffffff",fontSize:10,borderRadius:2,textTransform:"uppercase"},children:r.status})]}),e.jsxs("div",{style:{fontSize:11,color:t.muted},children:[r.component," | ",r.message]})]},i))})]}),e.jsxs("div",{style:{marginBottom:s.spacing.lg},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:600,color:t.foreground,marginBottom:s.spacing.md},children:"Performance Metrics"}),e.jsx("div",{style:{overflowX:"auto",border:`1px solid ${t.border}`,borderRadius:2},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Consolas, monospace",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:t.backgroundSoft},children:[e.jsx("th",{style:{padding:s.spacing.sm,textAlign:"left",borderBottom:`1px solid ${t.border}`},children:"Operation"}),e.jsx("th",{style:{padding:s.spacing.sm,textAlign:"left",borderBottom:`1px solid ${t.border}`},children:"Service"}),e.jsx("th",{style:{padding:s.spacing.sm,textAlign:"right",borderBottom:`1px solid ${t.border}`},children:"P50"}),e.jsx("th",{style:{padding:s.spacing.sm,textAlign:"right",borderBottom:`1px solid ${t.border}`},children:"P95"}),e.jsx("th",{style:{padding:s.spacing.sm,textAlign:"right",borderBottom:`1px solid ${t.border}`},children:"P99"}),e.jsx("th",{style:{padding:s.spacing.sm,textAlign:"right",borderBottom:`1px solid ${t.border}`},children:"Throughput"}),e.jsx("th",{style:{padding:s.spacing.sm,textAlign:"right",borderBottom:`1px solid ${t.border}`},children:"Error Rate"})]})}),e.jsx("tbody",{children:m.map((r,i)=>{const o=b.find(y=>y.operation_name===r.operation_name&&y.service_name===r.service_name),C=o&&(r.latency_p95>o.latency_p95*1.5||r.error_rate>o.error_rate*1.5);return e.jsxs("tr",{style:{borderBottom:`1px solid ${t.border}`,background:C?t.error+"20":"transparent"},children:[e.jsx("td",{style:{padding:s.spacing.sm},children:r.operation_name}),e.jsx("td",{style:{padding:s.spacing.sm},children:r.service_name}),e.jsxs("td",{style:{padding:s.spacing.sm,textAlign:"right"},children:[r.latency_p50.toFixed(2),"ms"]}),e.jsxs("td",{style:{padding:s.spacing.sm,textAlign:"right"},children:[r.latency_p95.toFixed(2),"ms"]}),e.jsxs("td",{style:{padding:s.spacing.sm,textAlign:"right"},children:[r.latency_p99.toFixed(2),"ms"]}),e.jsxs("td",{style:{padding:s.spacing.sm,textAlign:"right"},children:[r.throughput.toFixed(2)," req/s"]}),e.jsxs("td",{style:{padding:s.spacing.sm,textAlign:"right",color:r.error_rate>1?t.error:t.foreground},children:[r.error_rate.toFixed(2),"%"]})]},i)})})]})})]})]})})})};export{E as default};
