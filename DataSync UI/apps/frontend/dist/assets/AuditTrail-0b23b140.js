import{f as S,t as l,b as t,r as i,a6 as z,j as e,a3 as K,a4 as Z,e as F}from"./index-75d7470b.js";import{S as ee}from"./SkeletonLoader-530eacc4.js";import{e as W}from"./errorHandler-5ea9ae85.js";import{A as b}from"./AsciiPanel-9f053981.js";import{A as u}from"./AsciiButton-446d8430.js";const te=S.table`
  width: 100%;
  border-collapse: collapse;
  margin-top: ${l.spacing.lg};
  background: ${l.colors.background.main};
  box-shadow: ${l.shadows.md};
  border-radius: ${l.borderRadius.md};
  overflow: hidden;
`,x=S.th`
  padding: ${l.spacing.sm};
  text-align: left;
  border-bottom: 2px solid ${t.border};
  background: ${t.backgroundSoft};
  font-weight: bold;
  font-family: "Consolas";
  font-size: 13px;
  color: ${t.accent};
  position: sticky;
  top: 0;
  z-index: 10;
`,c=S.td`
  padding: ${l.spacing.sm};
  border-bottom: 1px solid ${t.border};
  font-family: "Consolas";
  font-size: 12px;
  transition: all ${l.transitions.normal};
  word-break: break-word;
  max-width: 300px;
`,oe=S.tr`
  transition: all ${l.transitions.normal};
  
  &:hover {
    background: linear-gradient(90deg, ${l.colors.background.main} 0%, ${l.colors.background.tertiary} 100%);
    transform: scale(1.001);
    box-shadow: ${l.shadows.sm};
    
    ${c} {
      border-bottom-color: rgba(10, 25, 41, 0.1);
    }
  }
`,U=a=>{switch(a.toUpperCase()){case"SELECT":return t.accent;case"INSERT":return t.success;case"UPDATE":return t.warning;case"DELETE":return t.danger;default:return t.muted}},q=a=>a?new Date(a).toLocaleString():"-",le=()=>{var $,D,L,P;const a=i.useRef(!0),[M,T]=i.useState(!0),[w,g]=i.useState(null),[C,O]=i.useState([]),[p,N]=i.useState(null),[n,h]=i.useState({schema_name:"",table_name:"",username:"",action_type:"",start_date:"",end_date:""}),[f,R]=i.useState(1),[y,H]=i.useState(0),j=100,[r,_]=i.useState(null),[G,k]=i.useState(!1),[v,Y]=i.useState("GDPR"),[m,B]=i.useState(null),E=i.useCallback(async()=>{if(!a.current)return;const o=Date.now(),s=300;try{T(!0),g(null);const d={page:f,limit:j};n.schema_name&&(d.schema_name=n.schema_name),n.table_name&&(d.table_name=n.table_name),n.username&&(d.username=n.username),n.action_type&&(d.action_type=n.action_type),n.start_date&&(d.start_date=n.start_date),n.end_date&&(d.end_date=n.end_date);const I=await z.getLogs(d),J=Date.now()-o,X=Math.max(0,s-J);await new Promise(Q=>setTimeout(Q,X)),a.current&&(O(I.logs||[]),H(I.total||0))}catch(d){a.current&&g(W(d))}finally{a.current&&T(!1)}},[f,n]),A=i.useCallback(async()=>{try{const o=await z.getStats(30);N(o)}catch(o){console.error("Error fetching audit stats:",o)}},[]);i.useEffect(()=>(a.current=!0,E(),A(),()=>{a.current=!1}),[E,A]);const V=i.useCallback(async()=>{try{g(null);const o=await z.getComplianceReport(v,n.start_date||void 0,n.end_date||void 0);B(o.report)}catch(o){a.current&&g(W(o))}},[v,n.start_date,n.end_date]);return M&&C.length===0?e.jsx(ee,{variant:"table"}):e.jsxs(K,{children:[w&&e.jsx(Z,{message:w,onClose:()=>g(null)}),p&&e.jsx("div",{style:{marginBottom:20},children:e.jsx(b,{title:"AUDIT STATISTICS (Last 30 Days)",children:e.jsx("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Total Events"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.accent},children:(($=p.summary)==null?void 0:$.total_events)||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Unique Users"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.accent},children:((D=p.summary)==null?void 0:D.unique_users)||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Unique Tables"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.accent},children:((L=p.summary)==null?void 0:L.unique_tables)||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Compliance Events"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.warning},children:((P=p.summary)==null?void 0:P.compliance_events)||0})]})]})})})}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(b,{title:"AUDIT TRAIL",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{display:"flex",gap:12,marginBottom:16,flexWrap:"wrap"},children:e.jsx(u,{label:`${F.blockFull} Compliance Report`,onClick:()=>k(!0),variant:"ghost"})}),e.jsxs("div",{style:{marginBottom:16,display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsx("input",{type:"text",placeholder:"Schema name",value:n.schema_name,onChange:o=>h(s=>({...s,schema_name:o.target.value})),style:{padding:"8px 12px",border:`1px solid ${t.border}`,backgroundColor:t.background,color:t.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}}),e.jsx("input",{type:"text",placeholder:"Table name",value:n.table_name,onChange:o=>h(s=>({...s,table_name:o.target.value})),style:{padding:"8px 12px",border:`1px solid ${t.border}`,backgroundColor:t.background,color:t.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}}),e.jsx("input",{type:"text",placeholder:"Username",value:n.username,onChange:o=>h(s=>({...s,username:o.target.value})),style:{padding:"8px 12px",border:`1px solid ${t.border}`,backgroundColor:t.background,color:t.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}}),e.jsxs("select",{value:n.action_type,onChange:o=>h(s=>({...s,action_type:o.target.value})),style:{padding:"8px 12px",border:`1px solid ${t.border}`,backgroundColor:t.background,color:t.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"SELECT",children:"SELECT"}),e.jsx("option",{value:"INSERT",children:"INSERT"}),e.jsx("option",{value:"UPDATE",children:"UPDATE"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"CREATE",children:"CREATE"}),e.jsx("option",{value:"DROP",children:"DROP"}),e.jsx("option",{value:"ALTER",children:"ALTER"})]}),e.jsx("input",{type:"date",placeholder:"Start Date",value:n.start_date,onChange:o=>h(s=>({...s,start_date:o.target.value})),style:{padding:"8px 12px",border:`1px solid ${t.border}`,backgroundColor:t.background,color:t.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}}),e.jsx("input",{type:"date",placeholder:"End Date",value:n.end_date,onChange:o=>h(s=>({...s,end_date:o.target.value})),style:{padding:"8px 12px",border:`1px solid ${t.border}`,backgroundColor:t.background,color:t.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:12,fontSize:11,color:t.muted},children:["Audit Logs (",y,")"]}),e.jsxs(te,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(x,{children:"Timestamp"}),e.jsx(x,{children:"User"}),e.jsx(x,{children:"Action"}),e.jsx(x,{children:"Schema.Table"}),e.jsx(x,{children:"Rows"}),e.jsx(x,{children:"Compliance"}),e.jsx(x,{children:"Actions"})]})}),e.jsx("tbody",{children:C.length===0?e.jsx("tr",{children:e.jsx(c,{colSpan:7,style:{textAlign:"center",padding:20,color:t.muted},children:"No audit logs found."})}):C.map(o=>e.jsxs(oe,{children:[e.jsx(c,{children:q(o.created_at)}),e.jsx(c,{children:e.jsx("code",{style:{color:t.accent},children:o.username})}),e.jsx(c,{children:e.jsx("span",{style:{color:U(o.action_type),fontWeight:600},children:o.action_type})}),e.jsx(c,{children:o.schema_name&&o.table_name?e.jsxs("code",{style:{color:t.muted,fontSize:11},children:[o.schema_name,".",o.table_name]}):e.jsx("span",{style:{color:t.muted},children:"-"})}),e.jsx(c,{children:o.rows_affected||0}),e.jsx(c,{children:o.compliance_requirement?e.jsx("span",{style:{color:t.warning,fontSize:11},children:o.compliance_requirement}):e.jsx("span",{style:{color:t.muted},children:"-"})}),e.jsx(c,{children:e.jsx(u,{label:"ðŸ‘ï¸",onClick:()=>_(o),variant:"ghost",title:"View Details"})})]},o.log_id))})]}),y>j&&e.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:t.muted},children:["Page ",f," of ",Math.ceil(y/j)]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(u,{label:"â—€ Previous",onClick:()=>R(o=>Math.max(1,o-1)),disabled:f===1,variant:"ghost"}),e.jsx(u,{label:"Next â–¶",onClick:()=>R(o=>Math.min(Math.ceil(y/j),o+1)),disabled:f>=Math.ceil(y/j),variant:"ghost"})]})]})]})})}),r&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:o=>{o.target===o.currentTarget&&_(null)},children:e.jsx("div",{style:{backgroundColor:t.background,border:`2px solid ${t.border}`,borderRadius:2,width:"90%",maxWidth:800,maxHeight:"90vh",overflowY:"auto"},onClick:o=>o.stopPropagation(),children:e.jsx(b,{title:"AUDIT LOG DETAILS",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Log ID"}),e.jsx("div",{style:{color:t.foreground,fontSize:12},children:r.log_id})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Timestamp"}),e.jsx("div",{style:{color:t.foreground,fontSize:12},children:q(r.created_at)})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"User"}),e.jsx("div",{style:{color:t.accent,fontSize:12},children:r.username})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Action Type"}),e.jsx("div",{style:{color:U(r.action_type),fontSize:12,fontWeight:600},children:r.action_type})]}),r.schema_name&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Schema.Table.Column"}),e.jsx("div",{style:{color:t.foreground,fontSize:12},children:e.jsxs("code",{children:[r.schema_name,".",r.table_name,r.column_name&&`.${r.column_name}`]})})]}),r.query_text&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Query Text"}),e.jsx("div",{style:{padding:"8px 12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,fontSize:11,fontFamily:"Consolas",color:t.foreground,wordBreak:"break-word",whiteSpace:"pre-wrap",maxHeight:200,overflowY:"auto"},children:r.query_text})]}),r.old_values&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Old Values"}),e.jsx("div",{style:{padding:"8px 12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,fontSize:11,fontFamily:"Consolas",color:t.foreground,wordBreak:"break-word",whiteSpace:"pre-wrap",maxHeight:200,overflowY:"auto"},children:JSON.stringify(r.old_values,null,2)})]}),r.new_values&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"New Values"}),e.jsx("div",{style:{padding:"8px 12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,fontSize:11,fontFamily:"Consolas",color:t.foreground,wordBreak:"break-word",whiteSpace:"pre-wrap",maxHeight:200,overflowY:"auto"},children:JSON.stringify(r.new_values,null,2)})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Rows Affected"}),e.jsx("div",{style:{color:t.foreground,fontSize:12},children:r.rows_affected||0})]}),r.compliance_requirement&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Compliance Requirement"}),e.jsx("div",{style:{color:t.warning,fontSize:12,fontWeight:600},children:r.compliance_requirement})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:20},children:e.jsx(u,{label:"Close",onClick:()=>_(null),variant:"ghost"})})]})})})}),G&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:o=>{o.target===o.currentTarget&&k(!1)},children:e.jsx("div",{style:{backgroundColor:t.background,border:`2px solid ${t.border}`,borderRadius:2,width:"90%",maxWidth:600,maxHeight:"90vh",overflowY:"auto"},onClick:o=>o.stopPropagation(),children:e.jsx(b,{title:"COMPLIANCE REPORT",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:t.muted,fontSize:11},children:"Compliance Type *"}),e.jsxs("select",{value:v,onChange:o=>Y(o.target.value),style:{width:"100%",padding:"8px 12px",border:`1px solid ${t.border}`,backgroundColor:t.background,color:t.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"GDPR",children:"GDPR"}),e.jsx("option",{value:"HIPAA",children:"HIPAA"}),e.jsx("option",{value:"SOX",children:"SOX"}),e.jsx("option",{value:"PCI-DSS",children:"PCI-DSS"})]})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(u,{label:"Generate Report",onClick:V})}),m&&e.jsxs("div",{style:{marginTop:20,padding:16,backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.accent,marginBottom:12},children:[F.blockFull," COMPLIANCE REPORT: ",v]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Total Events"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.accent},children:m.total_events||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Unique Users"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.accent},children:m.unique_users||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Unique Tables"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.accent},children:m.unique_tables||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Sensitive Access"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.warning},children:m.sensitive_access_count||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Modifications"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.danger},children:m.modification_count||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Access Count"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.accent},children:m.access_count||0})]})]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:20},children:e.jsx(u,{label:"Close",onClick:()=>{k(!1),B(null)},variant:"ghost"})})]})})})})]})};export{le as default};
