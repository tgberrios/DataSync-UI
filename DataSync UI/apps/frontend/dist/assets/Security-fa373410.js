import{r as y,j as e,t as o,b as t,e as f,s as ge,C as me}from"./index-b1fa964d.js";import{e as fe}from"./errorHandler-5ea9ae85.js";import{A as R}from"./AsciiPanel-3399d5be.js";import{A as se}from"./AsciiButton-3fcfdd9b.js";import{S as ue}from"./SkeletonLoader-09c12074.js";const pe=({users:c,onUserToggle:k,expandedUsers:x=new Set})=>{const[u,b]=y.useState(new Set),S=y.useMemo(()=>{const m=new Map;return c.forEach(n=>{let r="Unknown Connection";if(n.connection_string)try{if(n.connection_string.startsWith("postgresql://")||n.connection_string.startsWith("postgres://")){const g=new URL(n.connection_string),l=g.hostname||"localhost",h=g.port||"5432";r=`${l}:${h}`}else if(n.connection_string.startsWith("mysql://")||n.connection_string.startsWith("mariadb://")){const g=new URL(n.connection_string),l=g.hostname||"localhost",h=g.port||"3306";r=`${l}:${h}`}else if(n.connection_string.startsWith("mongodb://")||n.connection_string.startsWith("mongodb+srv://")){const g=new URL(n.connection_string),l=g.hostname||"localhost",h=g.port||"27017";r=`${l}:${h}`}else if(n.connection_string.includes("Server=")){const g=n.connection_string.match(/Server=([^;,]+)/i);if(g){const l=g[1],[h,$]=l.includes(",")?l.split(","):[l,"1433"];r=`${h.trim()}:${$.trim()}`}}else if(n.connection_string.includes("@")){const g=n.connection_string.split("@");if(g.length>1){const l=g[g.length-1].split("/")[0],[h,$]=l.includes(":")?l.split(":"):[l,"1521"];r=`${h.trim()}:${$.trim()}`}}else{const g=n.connection_string.match(/([a-zA-Z0-9.-]+):(\d+)/);g?r=`${g[1]}:${g[2]}`:r=n.connection_string.substring(0,50)}}catch{r=n.connection_string.substring(0,50)}m.has(r)||m.set(r,{connectionName:r,users:[]});const s=m.get(r),p=n.username||"Unknown";let a=s.users.find(g=>g.username===p);a||(a={username:p,role_type:n.role_type||"N/A",connections:[],mostRecentActivity:n.last_activity,statusCounts:{}},s.users.push(a)),a.connections.push({status:n.status,last_activity:n.last_activity,client_addr:n.client_addr,application_name:n.application_name,database:n.database,backend_start:n.backend_start,query_duration:n.query_duration,wait_event_type:n.wait_event_type,wait_event:n.wait_event,query:n.query}),n.last_activity&&(!a.mostRecentActivity||new Date(n.last_activity)>new Date(a.mostRecentActivity))&&(a.mostRecentActivity=n.last_activity),a.statusCounts[n.status]=(a.statusCounts[n.status]||0)+1}),Array.from(m.values()).sort((n,r)=>n.connectionName.localeCompare(r.connectionName))},[c]),U=m=>{b(n=>{const r=new Set(n);return r.has(m)?r.delete(m):r.add(m),r})},D=(m,n)=>{if(m===0)return null;const r=[];for(let s=0;s<m-1;s++)r.push(`${f.v}  `);return n?r.push(`${f.bl}${f.h}${f.h} `):r.push(`${f.tRight}${f.h}${f.h} `),e.jsx("span",{style:{color:t.border,marginRight:6,fontFamily:"Consolas",fontSize:11},children:r.join("")})},E=m=>{switch(m){case"SUPERUSER":return t.accent;case"CREATEDB":return t.accent;case"CREATEROLE":return t.accent;case"LOGIN":return t.accent;case"ACTIVE":return t.accent;case"INACTIVE":return t.muted;case"SELECT":return t.accent;case"INSERT":return t.accent;case"UPDATE":return t.accent;case"DELETE":return t.accent;case"ALL":return t.accent;default:return t.muted}},A=m=>m?new Date(m).toLocaleString():"-";return c.length===0?e.jsx("div",{style:{padding:o.spacing.lg,textAlign:"center",color:t.muted,fontFamily:"Consolas",fontSize:12},children:"No active users found"}):e.jsx("div",{style:{fontFamily:"Consolas",fontSize:12,color:t.foreground},children:S.map((m,n)=>{const r=u.has(m.connectionName);return S.length-1,e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("div",{onClick:()=>U(m.connectionName),style:{display:"flex",alignItems:"center",padding:"10px 8px",cursor:"pointer",borderLeft:`2px solid ${t.accent}`,backgroundColor:r?t.backgroundSoft:t.background,transition:"all 0.15s ease",marginBottom:2},onMouseEnter:s=>{s.currentTarget.style.backgroundColor=t.backgroundSoft},onMouseLeave:s=>{r||(s.currentTarget.style.backgroundColor=t.background)},children:[e.jsx("span",{style:{marginRight:8,color:r?t.accent:t.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:r?"rotate(90deg)":"rotate(0deg)"},children:f.arrowRight}),e.jsx("span",{style:{fontWeight:600,color:t.accent,fontSize:12,flex:1},children:m.connectionName}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${t.border}`,backgroundColor:t.backgroundSoft,color:t.foreground},children:m.users.reduce((s,p)=>s+p.connections.length,0)})]}),r&&e.jsx("div",{style:{paddingLeft:24},children:m.users.map((s,p)=>{const a=x.has(s.username),g=p===m.users.length-1;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>k==null?void 0:k(s.username),style:{display:"flex",alignItems:"center",padding:"8px 8px",marginLeft:8,marginBottom:2,borderLeft:`2px solid ${t.border}`,backgroundColor:a?t.backgroundSoft:"transparent",transition:"all 0.15s ease",cursor:"pointer"},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=t.backgroundSoft,l.currentTarget.style.borderLeftColor=t.accent},onMouseLeave:l=>{a||(l.currentTarget.style.backgroundColor="transparent",l.currentTarget.style.borderLeftColor=t.border)},children:[D(1,g),e.jsx("span",{style:{marginRight:8,color:a?t.accent:t.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:a?"rotate(90deg)":"rotate(0deg)"},children:f.arrowRight}),e.jsx("span",{style:{fontWeight:600,color:t.foreground,fontSize:11,flex:1,fontFamily:"Consolas"},children:s.username}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${E(s.role_type)}`,color:E(s.role_type),backgroundColor:"transparent",marginRight:8},children:s.role_type}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${t.border}`,backgroundColor:"transparent",color:t.muted},children:s.connections.length})]}),a&&e.jsxs("div",{style:{paddingLeft:24},children:[e.jsxs("div",{style:{marginBottom:8,padding:"8px 8px",marginLeft:8,fontSize:10,color:t.muted},children:["Last Activity: ",A(s.mostRecentActivity)]}),e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8,padding:"0 8px",marginLeft:8},children:Object.entries(s.statusCounts).map(([l,h])=>e.jsxs("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontFamily:"Consolas",backgroundColor:t.backgroundSoft,color:E(l),border:`1px solid ${E(l)}`},children:[l,": ",h]},l))}),s.connections.map((l,h)=>{const $=h===s.connections.length-1;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:"8px 8px",marginLeft:8,marginBottom:2,borderLeft:`1px solid ${t.border}`,backgroundColor:"transparent",transition:"all 0.15s ease"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor=t.backgroundSoft,C.currentTarget.style.borderLeftColor=t.accent},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="transparent",C.currentTarget.style.borderLeftColor=t.border},children:[D(2,$),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,flexWrap:"wrap"},children:[e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${E(l.status)}`,color:E(l.status),backgroundColor:"transparent"},children:l.status}),l.client_addr&&e.jsxs("span",{style:{fontSize:10,color:t.muted,fontFamily:"Consolas"},children:["IP: ",l.client_addr]}),l.application_name&&e.jsxs("span",{style:{fontSize:10,color:t.muted,fontFamily:"Consolas"},children:["App: ",l.application_name]}),l.database&&e.jsxs("span",{style:{fontSize:10,color:t.muted,fontFamily:"Consolas"},children:["DB: ",l.database]})]}),e.jsxs("div",{style:{fontSize:10,color:t.muted,fontFamily:"Consolas"},children:["Activity: ",A(l.last_activity)]})]})]},h)})]})]},s.username)})})]},m.connectionName)})})},he=({changes:c})=>{const[k,x]=y.useState(new Set),[u,b]=y.useState(new Set),S=y.useMemo(()=>{const n=new Map;return c.forEach(r=>{const s=r.execution_timestamp?new Date(r.execution_timestamp).toLocaleDateString():"Unknown",p=r.change_type||"Unknown";n.has(s)||n.set(s,{date:s,changeTypes:new Map});const a=n.get(s);a.changeTypes.has(p)||a.changeTypes.set(p,{changeType:p,changes:[]}),a.changeTypes.get(p).changes.push(r)}),Array.from(n.values()).sort((r,s)=>new Date(s.date).getTime()-new Date(r.date).getTime())},[c]),U=n=>{x(r=>{const s=new Set(r);if(s.has(n)){s.delete(n);const p=S.find(a=>a.date===n);p&&p.changeTypes.forEach(a=>{const g=`${n}.${a.changeType}`;b(l=>{const h=new Set(l);return h.delete(g),h})})}else s.add(n);return s})},D=(n,r)=>{const s=`${n}.${r}`;b(p=>{const a=new Set(p);return a.has(s)?a.delete(s):a.add(s),a})},E=(n,r)=>{if(n===0)return null;const s=[];for(let p=0;p<n-1;p++)s.push(`${f.v}  `);return r?s.push(`${f.bl}${f.h}${f.h} `):s.push(`${f.tRight}${f.h}${f.h} `),e.jsx("span",{style:{color:t.border,marginRight:6,fontFamily:"Consolas",fontSize:11},children:s.join("")})},A=n=>{switch(n){case"DROP":return t.foreground;case"ALTER":return t.accent;case"CREATE":return t.accent;default:return t.accent}},m=n=>n?new Date(n).toLocaleString():"-";return c.length===0?e.jsx("div",{style:{padding:o.spacing.lg,textAlign:"center",color:t.muted,fontFamily:"Consolas",fontSize:12},children:"No DDL changes found"}):e.jsx("div",{style:{fontFamily:"Consolas",fontSize:12,color:t.foreground},children:S.map((n,r)=>{const s=k.has(n.date),p=Array.from(n.changeTypes.values());return S.length-1,e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("div",{onClick:()=>U(n.date),style:{display:"flex",alignItems:"center",padding:"10px 8px",cursor:"pointer",borderLeft:`2px solid ${t.accent}`,backgroundColor:s?t.backgroundSoft:t.background,transition:"all 0.15s ease",marginBottom:2},onMouseEnter:a=>{a.currentTarget.style.backgroundColor=t.backgroundSoft},onMouseLeave:a=>{s||(a.currentTarget.style.backgroundColor=t.background)},children:[e.jsx("span",{style:{marginRight:8,color:s?t.accent:t.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:s?"rotate(90deg)":"rotate(0deg)"},children:f.arrowRight}),e.jsx("span",{style:{fontWeight:600,color:t.accent,fontSize:12,flex:1},children:n.date}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${t.border}`,backgroundColor:t.backgroundSoft,color:t.foreground},children:p.reduce((a,g)=>a+g.changes.length,0)})]}),s&&e.jsx("div",{style:{paddingLeft:24},children:p.map((a,g)=>{const l=`${n.date}.${a.changeType}`,h=u.has(l),$=g===p.length-1;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>D(n.date,a.changeType),style:{display:"flex",alignItems:"center",padding:"8px 8px",marginLeft:8,marginBottom:2,borderLeft:`2px solid ${t.border}`,backgroundColor:h?t.backgroundSoft:"transparent",transition:"all 0.15s ease",cursor:"pointer"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor=t.backgroundSoft,C.currentTarget.style.borderLeftColor=t.accent},onMouseLeave:C=>{h||(C.currentTarget.style.backgroundColor="transparent",C.currentTarget.style.borderLeftColor=t.border)},children:[E(1,$),e.jsx("span",{style:{marginRight:8,color:h?t.accent:t.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:h?"rotate(90deg)":"rotate(0deg)"},children:f.arrowRight}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:600,border:`1px solid ${A(a.changeType)}`,color:A(a.changeType),backgroundColor:"transparent"},children:a.changeType}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${t.border}`,backgroundColor:"transparent",color:t.muted,marginLeft:8},children:a.changes.length})]}),h&&e.jsx("div",{style:{paddingLeft:24},children:a.changes.map((C,P)=>{const V=P===a.changes.length-1;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:"8px 8px",marginLeft:8,marginBottom:2,borderLeft:`1px solid ${t.border}`,backgroundColor:"transparent",transition:"all 0.15s ease"},onMouseEnter:F=>{F.currentTarget.style.backgroundColor=t.backgroundSoft,F.currentTarget.style.borderLeftColor=t.accent},onMouseLeave:F=>{F.currentTarget.style.backgroundColor="transparent",F.currentTarget.style.borderLeftColor=t.border},children:[E(2,V),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,flexWrap:"wrap"},children:[e.jsxs("span",{style:{fontWeight:500,color:t.foreground,fontSize:11,fontFamily:"Consolas"},children:[C.schema_name,".",C.object_name]}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${t.border}`,color:t.muted,backgroundColor:"transparent"},children:C.object_type}),e.jsxs("span",{style:{fontSize:10,color:t.muted,fontFamily:"Consolas"},children:["by ",C.executed_by]})]}),e.jsx("div",{style:{fontSize:10,color:t.muted,fontFamily:"Consolas"},children:m(C.execution_timestamp)})]})]},P)})})]},l)})})]},n.date)})})},ye=c=>c?new Date(c).toLocaleString():"-",xe=c=>{if(!c)return{host:"unknown",port:"",displayName:"Unknown Connection"};try{if(c.startsWith("postgresql://")||c.startsWith("postgres://")){const x=new URL(c),u=x.hostname||"localhost",b=x.port||"5432";return{host:u,port:b,displayName:`${u}:${b}`}}if(c.startsWith("mysql://")||c.startsWith("mariadb://")){const x=new URL(c),u=x.hostname||"localhost",b=x.port||"3306";return{host:u,port:b,displayName:`${u}:${b}`}}if(c.startsWith("mongodb://")||c.startsWith("mongodb+srv://")){const x=new URL(c),u=x.hostname||"localhost",b=x.port||"27017";return{host:u,port:b,displayName:`${u}:${b}`}}if(c.includes("Server=")){const x=c.match(/Server=([^;,]+)/i);if(x){const u=x[1],[b,S]=u.includes(",")?u.split(","):[u,"1433"];return{host:b.trim(),port:S.trim(),displayName:`${b.trim()}:${S.trim()}`}}}if(c.includes("@")){const x=c.split("@");if(x.length>1){const u=x[x.length-1].split("/")[0],[b,S]=u.includes(":")?u.split(":"):[u,"1521"];return{host:b.trim(),port:S.trim(),displayName:`${b.trim()}:${S.trim()}`}}}const k=c.match(/([a-zA-Z0-9.-]+):(\d+)/);return k?{host:k[1],port:k[2],displayName:`${k[1]}:${k[2]}`}:{host:"unknown",port:"",displayName:c.substring(0,50)}}catch{return{host:"unknown",port:"",displayName:c.substring(0,50)}}},ke=()=>{const c=y.useRef(!0),[k,x]=y.useState(!0),[u,b]=y.useState(null),[S,U]=y.useState({users:{total:0,active:0,superusers:0,withLogin:0},connections:{current:0,max:0,idle:0,active:0},permissions:{totalGrants:0,schemasWithAccess:0,tablesWithAccess:0}}),[D,E]=y.useState([]),[A,m]=y.useState(new Set),[n,r]=y.useState(!1),[s,p]=y.useState(null),[a,g]=y.useState({}),[l,h]=y.useState({}),[$,C]=y.useState([]),[P,V]=y.useState([]),[F,re]=y.useState([]),[_,G]=y.useState(""),[I,ie]=y.useState([]),ae=y.useCallback(i=>{m(v=>{const L=new Set(v);return L.has(i)?L.delete(i):L.add(i),L})},[]),Y=y.useCallback(async()=>{var L,z,w,M,N;if(!c.current)return;const i=Date.now(),v=300;try{x(!0),b(null);const d=await ge.getSecurityData(),q=Date.now()-i,le=Math.max(0,v-q);if(await new Promise(B=>setTimeout(B,le)),c.current){U(d.summary||((L=d.postgres)==null?void 0:L.summary)||d),E(d.activeUsers||((z=d.postgres)==null?void 0:z.activeUsers)||[]),p(d.postgres||null),g(d.otherDatabases||{}),h(d.availableConnections||{}),C(d.ddlAuditStats||[]),V(d.recentDDLChanges||[]),re(d.securityAlerts||[]);const B=[];if(d.postgres&&B.push({id:"postgres-metadata",tabName:"datalake - PostgreSQL",engine:"PostgreSQL",connectionString:"metadata",connectionStringMasked:"metadata",security:d.postgres,ddlStats:((w=d.ddlAuditStats)==null?void 0:w.find(j=>j.db_engine==="PostgreSQL"))||null,ddlChanges:((M=d.recentDDLChanges)==null?void 0:M.filter(j=>j.db_engine==="PostgreSQL"))||[],alerts:((N=d.securityAlerts)==null?void 0:N.filter(j=>j.db_engine==="PostgreSQL"))||[]}),d.availableConnections&&Object.entries(d.availableConnections).forEach(([j,O])=>{j!=="PostgreSQL"&&O.connections&&O.connections.forEach(W=>{var K,Q,Z,X,J,ee,te,ne,oe;const H=xe(W.connection_string),ce=`${H.host}-${H.port}-${j}`.replace(/[^a-zA-Z0-9-]/g,"-"),de=((Z=(Q=(K=d.otherDatabases)==null?void 0:K[j])==null?void 0:Q.find(T=>T.connection_string===W.connection_string))==null?void 0:Z.security)||null;B.push({id:ce,tabName:`${H.displayName} - ${j}`,engine:j,connectionString:W.connection_string,connectionStringMasked:W.connection_string_masked||W.connection_string,security:de,ddlStats:((X=d.ddlAuditStats)==null?void 0:X.find(T=>T.db_engine===j&&T.connection_string===W.connection_string))||((J=d.ddlAuditStats)==null?void 0:J.find(T=>T.db_engine===j))||null,ddlChanges:((ee=d.recentDDLChanges)==null?void 0:ee.filter(T=>T.db_engine===j&&T.connection_string===W.connection_string))||((te=d.recentDDLChanges)==null?void 0:te.filter(T=>T.db_engine===j))||[],alerts:((ne=d.securityAlerts)==null?void 0:ne.filter(T=>T.db_engine===j&&T.connection_string===W.connection_string))||((oe=d.securityAlerts)==null?void 0:oe.filter(T=>T.db_engine===j))||[]})})}),ie(B),B.length>0&&!_){const j=B.find(O=>O.id==="postgres-metadata");G(j?j.id:B[0].id)}}}catch(d){c.current&&b(fe(d))}finally{c.current&&x(!1)}},[]);return y.useEffect(()=>(c.current=!0,Y(),()=>{c.current=!1}),[Y]),y.useMemo(()=>!S.connections.max||S.connections.max===0?0:(S.connections.current/S.connections.max*100).toFixed(1),[S.connections]),k&&(!S||Object.keys(S).length===0)?e.jsx(ue,{variant:"table"}):e.jsx(me,{children:e.jsxs("div",{style:{padding:o.spacing.lg,fontFamily:"Consolas",fontSize:12,background:t.background,maxWidth:"100%",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:o.spacing.xl,paddingBottom:o.spacing.md,borderBottom:`2px solid ${t.accent}`},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:t.foreground,textTransform:"uppercase",fontFamily:"Consolas",letterSpacing:"0.5px"},children:[e.jsx("span",{style:{color:t.accent,marginRight:o.spacing.sm},children:f.blockFull}),"SECURITY & COMPLIANCE MONITOR"]}),!k&&!u&&I.length>0&&e.jsxs("div",{style:{fontSize:11,color:t.muted,fontFamily:"Consolas",fontWeight:500,padding:`${o.spacing.xs} ${o.spacing.md}`,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[I.length," ",I.length===1?"connection":"connections"," available"]})]}),u&&e.jsx("div",{style:{marginBottom:o.spacing.lg},children:e.jsx(R,{title:"ERROR",children:e.jsx("div",{style:{padding:o.spacing.md,color:t.foreground,fontSize:12,fontFamily:"Consolas",background:t.backgroundSoft,borderRadius:2,border:`2px solid ${t.foreground}`},children:u})})}),!k&&!u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:o.spacing.lg,display:"flex",justifyContent:"flex-end",alignItems:"center"},children:e.jsx(se,{label:"Security Info",onClick:()=>r(!0),variant:"ghost"})}),I.length>0&&_&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"280px 1fr",gap:o.spacing.xl,alignItems:"flex-start"},children:[e.jsx("div",{style:{position:"sticky",top:o.spacing.lg,maxHeight:"calc(100vh - 120px)",overflowY:"auto",overflowX:"hidden"},children:e.jsx(R,{title:"CONNECTIONS",children:e.jsx("div",{style:{marginTop:o.spacing.sm,display:"flex",flexDirection:"column",gap:o.spacing.xs},children:I.map(i=>e.jsxs("button",{onClick:()=>G(i.id),"aria-label":`Select connection ${i.tabName}`,tabIndex:0,onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),G(i.id))},style:{padding:o.spacing.md,fontFamily:"Consolas",fontSize:11,fontWeight:_===i.id?600:400,color:_===i.id?t.foreground:t.muted,background:_===i.id?t.backgroundSoft:"transparent",border:_===i.id?`2px solid ${t.accent}`:`1px solid ${t.border}`,borderRadius:2,cursor:"pointer",transition:"border-color 0.15s ease, background-color 0.15s ease",wordBreak:"break-word",textAlign:"left",width:"100%",outline:"none",outlineOffset:0},onMouseDown:v=>{v.currentTarget.style.outline="none"},onFocus:v=>{_!==i.id?(v.currentTarget.style.outline=`2px solid ${t.accent}`,v.currentTarget.style.outlineOffset="2px"):(v.currentTarget.style.outline="none",v.currentTarget.style.outlineOffset=0)},onBlur:v=>{v.currentTarget.style.outline="none",v.currentTarget.style.outlineOffset=0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:i.ddlStats&&i.ddlStats.drop_operations>0?o.spacing.xs:0},children:[e.jsx("span",{style:{lineHeight:1.4},children:i.tabName}),_===i.id&&e.jsx("span",{style:{color:t.accent,fontSize:12,marginLeft:o.spacing.xs},children:"▶"})]}),i.ddlStats&&i.ddlStats.drop_operations>0&&e.jsxs("div",{style:{fontSize:9,color:t.foreground,fontWeight:600,padding:`${o.spacing.xs} ${o.spacing.sm}`,background:t.backgroundSoft,borderRadius:2,border:`2px solid ${t.foreground}`,marginTop:o.spacing.xs,fontFamily:"Consolas"},children:[f.blockSemi," ",i.ddlStats.drop_operations," DROP ops"]})]},i.id))})})}),e.jsx("div",{style:{minWidth:0,display:"flex",flexDirection:"column",gap:o.spacing.lg},children:(()=>{const i=I.find(d=>d.id===_);if(!i)return null;const v=i.security||{},L=v.users||{},z=v.connections||{},w=v.permissions||{},M=v.activeUsers||D,N=z.max&&z.max>0?(z.current/z.max*100).toFixed(1):"0";return e.jsxs(e.Fragment,{children:[e.jsx(R,{title:`${i.tabName}`,children:e.jsxs("div",{style:{padding:o.spacing.md,fontSize:11,fontFamily:"Consolas"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:`${o.spacing.xs} ${o.spacing.md}`,marginBottom:o.spacing.sm},children:[e.jsx("span",{style:{color:t.muted,fontWeight:500,fontFamily:"Consolas"},children:"Engine:"}),e.jsx("span",{style:{color:t.foreground,fontWeight:600,fontFamily:"Consolas"},children:i.engine}),e.jsx("span",{style:{color:t.muted,fontWeight:500,fontFamily:"Consolas"},children:"Connection:"}),e.jsx("span",{style:{color:t.foreground,wordBreak:"break-all",fontSize:10,fontFamily:"Consolas"},children:i.connectionStringMasked})]}),i.ddlStats&&e.jsxs("div",{style:{marginTop:o.spacing.md,padding:o.spacing.md,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:t.accent,marginBottom:o.spacing.sm,fontFamily:"Consolas",paddingBottom:4,borderBottom:`2px solid ${t.accent}`},children:"DDL Activity (Last 30 days)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:o.spacing.md},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:t.muted,fontFamily:"Consolas",marginBottom:o.spacing.xs},children:"Total Changes"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.foreground,fontFamily:"Consolas"},children:i.ddlStats.total_changes||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:t.muted,fontFamily:"Consolas",marginBottom:o.spacing.xs},children:"DROP Operations"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:t.foreground,fontFamily:"Consolas"},children:i.ddlStats.drop_operations||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:t.muted,fontFamily:"Consolas",marginBottom:o.spacing.xs},children:"Risk Level"}),e.jsx("div",{children:e.jsx("span",{style:{padding:`${o.spacing.xs} ${o.spacing.sm}`,borderRadius:2,fontSize:10,fontFamily:"Consolas",fontWeight:600,backgroundColor:t.backgroundSoft,color:i.ddlStats.risk_level==="HIGH_RISK"?t.foreground:i.ddlStats.risk_level==="MEDIUM_RISK"?t.muted:i.ddlStats.risk_level==="ELEVATED_ACTIVITY"?t.accent:t.accent,border:`2px solid ${i.ddlStats.risk_level==="HIGH_RISK"?t.foreground:i.ddlStats.risk_level==="MEDIUM_RISK"?t.muted:i.ddlStats.risk_level==="ELEVATED_ACTIVITY"?t.accent:t.accent}`},children:i.ddlStats.risk_level||"NORMAL"})})]})]})]})]})}),i.alerts&&i.alerts.length>0&&e.jsx(R,{title:"SECURITY ALERTS",children:e.jsx("div",{style:{marginTop:o.spacing.sm},children:i.alerts.map((d,q)=>e.jsxs("div",{style:{marginBottom:o.spacing.md,padding:o.spacing.md,background:t.backgroundSoft,border:`2px solid ${t.foreground}`,borderRadius:2},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:600,color:t.foreground,marginBottom:o.spacing.sm,fontFamily:"Consolas"},children:[f.blockFull," ",d.severity,": ",d.message]}),e.jsxs("div",{style:{fontSize:11,color:t.foreground,marginLeft:o.spacing.lg,fontFamily:"Consolas"},children:[e.jsxs("div",{children:["Executed by: ",d.executed_by]}),e.jsxs("div",{children:["Time: ",ye(d.execution_timestamp)]})]})]},q))})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:o.spacing.lg},children:[e.jsx(R,{title:"USER MANAGEMENT",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:o.spacing.sm,marginTop:o.spacing.sm},children:[e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Total"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:L.total||0})]}),e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Active"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:L.active||0})]}),e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Superusers"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:L.superusers||0})]}),e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"With Login"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:L.withLogin||0})]})]})}),z.current!==void 0&&e.jsx(R,{title:"CONNECTION STATUS",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:o.spacing.sm,marginTop:o.spacing.sm},children:[e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Current"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:z.current||0}),e.jsxs("div",{style:{fontSize:9,color:t.muted,marginTop:o.spacing.xs,fontFamily:"Consolas"},children:["/ ",z.max||0," max"]})]}),e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Usage"}),e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:[N,"%"]})]}),e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Idle"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.muted},children:z.idle||0})]}),e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`,transition:"border-color 0.15s ease"},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Active"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:z.active||0})]})]})}),w.totalGrants!==void 0&&e.jsx(R,{title:"PERMISSIONS",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:o.spacing.sm,marginTop:o.spacing.sm},children:[e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Total Grants"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:18,fontWeight:600,color:t.foreground},children:w.totalGrants||0})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:o.spacing.sm},children:[e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Schemas"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:16,fontWeight:600,color:t.foreground},children:w.schemasWithAccess||0})]}),e.jsxs("div",{style:{padding:o.spacing.sm,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontSize:9,color:t.muted,marginBottom:o.spacing.xs,fontFamily:"Consolas"},children:"Tables"}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:16,fontWeight:600,color:t.foreground},children:w.tablesWithAccess||0})]})]})]})})]}),M&&M.length>0&&e.jsx(R,{title:"ACTIVE USERS",children:e.jsx(pe,{users:M,onUserToggle:ae,expandedUsers:A})}),i.ddlChanges&&i.ddlChanges.length>0&&e.jsx(R,{title:"RECENT DDL CHANGES (LAST 7 DAYS)",children:e.jsx(he,{changes:i.ddlChanges.slice(0,20)})})]})})()})]}),n&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>r(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:i=>i.stopPropagation(),children:e.jsx(R,{title:"SECURITY & COMPLIANCE PLAYBOOK",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[f.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Security & Compliance Monitor provides real-time visibility into database security posture, user access patterns, connection management, and permission structures. This dashboard helps identify security risks, monitor compliance, and ensure proper access controls."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[f.blockFull," USER MANAGEMENT METRICS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Total Users"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Total number of database roles/users defined in the system. Includes both login and non-login roles."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.accent,marginBottom:4},children:"Active Users"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of distinct users with current active database connections. Monitors who is currently accessing the database."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Superusers"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Users with SUPERUSER privileges. Superusers have unrestricted access to all database objects and can bypass all permission checks. Should be limited to administrative accounts only."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.accent,marginBottom:4},children:"With Login"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of roles that have LOGIN privilege, allowing them to connect to the database. Non-login roles are typically used for group permissions."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[f.blockFull," CONNECTION STATUS METRICS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Current Connections"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of active database connections currently established. Each connection consumes server resources."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Max Allowed"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Maximum number of concurrent connections allowed by the database server configuration. Exceeding this limit will reject new connection attempts."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.muted,marginBottom:4},children:"Idle Connections"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Connections that are established but not currently executing queries. High idle connection counts may indicate connection pool inefficiencies or application issues."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.accent,marginBottom:4},children:"Active Connections"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Connections currently executing queries or transactions. Active connections indicate database workload."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[f.blockFull," PERMISSIONS OVERVIEW"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Total Grants"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Total number of privilege grants (SELECT, INSERT, UPDATE, DELETE, etc.) across all tables and schemas. Represents the complexity of the permission structure."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Schemas With Access"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of distinct database schemas where users have been granted permissions. Helps identify scope of access across the database."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Tables With Access"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of distinct tables where users have been granted permissions. Indicates the breadth of data access across the database."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[f.blockFull," ROLE TYPES"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.foreground,fontWeight:600},children:"SUPERUSER"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Unrestricted access to all database objects, can bypass all permission checks"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"CREATEDB"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Can create new databases"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"CREATEROLE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Can create new roles and manage role memberships"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"LOGIN"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Can connect to the database"})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[f.blockFull," CONNECTION STATUSES"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"ACTIVE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Connection is currently executing a query or transaction"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.muted,fontWeight:600},children:"IDLE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Connection is established but not executing any query"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.foreground,fontWeight:600},children:"INACTIVE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Connection is not active or has been terminated"})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.muted,marginBottom:4},children:[f.blockSemi," Security Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:t.foreground},children:["• Limit SUPERUSER accounts to essential administrative roles only",e.jsx("br",{}),"• Monitor connection usage to prevent resource exhaustion",e.jsx("br",{}),"• Regularly audit permissions to ensure least-privilege access",e.jsx("br",{}),"• Review active connections for suspicious activity",e.jsx("br",{}),"• Use connection pooling to manage database connections efficiently"]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(se,{label:"Close",onClick:()=>r(!1),variant:"ghost"})})]})})})})]})]})})};export{ke as default};
