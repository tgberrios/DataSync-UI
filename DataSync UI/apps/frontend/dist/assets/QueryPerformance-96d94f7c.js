import{j as e,t as l,b as o,f as x,r as a,w as G,i as ae,C as Ie,e as k,E as Le,x as Oe,S as E,I as Be,o as Me,P as Pe,p as ye}from"./index-f6ac47b8.js";import{u as De}from"./usePagination-c6b4a268.js";import{u as Ye}from"./useTableFilters-7bb371e7.js";import{e as be}from"./errorHandler-5ea9ae85.js";import{A as de}from"./AsciiPanel-5614714e.js";import{A as je}from"./AsciiButton-4907e65e.js";const Ue=n=>{switch(n){case"EXCELLENT":return o.accent;case"GOOD":return o.foreground;case"FAIR":return o.muted;case"POOR":return o.foreground;default:return o.muted}},qe=n=>n?n<1e3?`${n.toFixed(0)}ms`:`${(n/1e3).toFixed(2)}s`:"N/A",He=n=>n==null?"N/A":n.toLocaleString(),Ve=({queries:n,onQueryClick:C})=>n.length===0?e.jsx("div",{style:{padding:l.spacing.lg,textAlign:"center",color:o.muted,fontFamily:"Consolas",fontSize:12},children:"No query performance data available. Data will appear here once queries are captured."}):e.jsx("div",{style:{fontFamily:"Consolas",fontSize:12,color:o.foreground,display:"flex",flexDirection:"column",gap:2},children:n.map((c,O)=>{const B=c.performance_tier||"UNKNOWN",j=Ue(B);return e.jsx("div",{onClick:()=>C==null?void 0:C(c),style:{display:"flex",alignItems:"flex-start",padding:"8px 10px",borderLeft:`3px solid ${j}`,backgroundColor:"transparent",transition:"all 0.15s ease",cursor:"pointer"},onMouseEnter:b=>{b.currentTarget.style.backgroundColor=o.backgroundSoft,b.currentTarget.style.borderLeftColor=o.accent},onMouseLeave:b=>{b.currentTarget.style.backgroundColor="transparent",b.currentTarget.style.borderLeftColor=j},children:e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,flexWrap:"wrap"},children:[e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:10,fontWeight:600,border:`1px solid ${j}`,color:j,backgroundColor:"transparent"},children:B}),e.jsx("span",{style:{fontWeight:600,color:o.foreground,fontSize:11},children:c.operation_type||"N/A"}),c.source_type&&e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.border}`,color:o.muted,backgroundColor:"transparent"},children:c.source_type}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.accent}`,color:o.accent,backgroundColor:"transparent"},children:qe(c.mean_time_ms??c.query_duration_ms)}),c.query_efficiency_score!==void 0&&e.jsxs("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.border}`,color:o.muted,backgroundColor:"transparent"},children:[Number(c.query_efficiency_score).toFixed(1),"% eff"]}),c.cache_hit_ratio!==void 0&&e.jsxs("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.border}`,color:o.muted,backgroundColor:"transparent"},children:[Number(c.cache_hit_ratio).toFixed(1),"% cache"]}),c.rows_returned!==void 0&&e.jsxs("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.border}`,color:o.muted,backgroundColor:"transparent"},children:[He(c.rows_returned)," rows"]})]}),c.query_text&&e.jsxs("div",{style:{fontSize:10,color:o.muted,fontFamily:"Consolas",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},title:c.query_text,children:[c.query_text.substring(0,100),c.query_text.length>100?"...":""]})]})},c.id??O)})}),Xe=x.div`
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  width: 100%;
`,K=x.div`
  background: #ffffff;
  padding: 16px;
  border-radius: 6px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
  border: 1px solid #e5e7eb;
`,J=x.div`
  font-size: 12px;
  font-weight: 600;
  color: #374151;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 6px;
`,Z=x.span`
  width: 8px;
  height: 8px;
  background: ${o.accent};
  border-radius: 1px;
  flex-shrink: 0;
`,W=x.div`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 0;
  font-size: 11px;
  color: #374151;
`,R=x.span`
  width: 8px;
  height: 8px;
  background: ${n=>n.$active?o.accent:"#9ca3af"};
  border-radius: 1px;
  flex-shrink: 0;
`,F=x.span`
  font-weight: 600;
  min-width: 72px;
  text-align: right;
  color: ${n=>n.$active?o.accent:"#6b7280"};
`;x.div`
  border: 1px solid #ddd;
  border-radius: 6px;
  overflow: hidden;
  animation: slideUp 0.25s ease-out;
  animation-delay: 0.2s;
  animation-fill-mode: both;
`;x.div`
  display: grid;
  grid-template-columns: 80px 100px 120px 100px 1fr 100px 100px 100px;
  background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
  padding: 12px 15px;
  font-weight: bold;
  font-size: 0.9em;
  border-bottom: 2px solid #ddd;
  gap: 10px;
`;x.div`
  display: grid;
  grid-template-columns: 80px 100px 120px 100px 1fr 100px 100px 100px;
  padding: 12px 15px;
  border-bottom: 1px solid #eee;
  transition: all 0.2s ease;
  cursor: pointer;
  gap: 10px;
  align-items: center;
  
  &:hover {
    background: linear-gradient(90deg, #f0f0f0 0%, #f8f9fa 100%);
    border-left: 3px solid #0d1b2a;
  }
  
  &:last-child {
    border-bottom: none;
  }
`;x.div`
  font-size: 0.9em;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`;x.div`
  font-size: 0.85em;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-family: "Consolas";
  color: #555;
`;x.span`
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 0.8em;
  font-weight: 500;
  display: inline-block;
  transition: all 0.2s ease;
  
  ${n=>{if(n.$tier)switch(n.$tier){case"EXCELLENT":return"background-color: #e8f5e9; color: #2e7d32;";case"GOOD":return"background-color: #e3f2fd; color: #1565c0;";case"FAIR":return"background-color: #fff3e0; color: #ef6c00;";case"POOR":return"background-color: #ffebee; color: #c62828;";default:return"background-color: #f5f5f5; color: #757575;"}return n.$type?"background-color: #f0f0f0; color: #333;":"background-color: #f5f5f5; color: #757575;"}}
  
  &:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }
`;x.div`
  max-height: ${n=>n.$isOpen?"600px":"0"};
  opacity: ${n=>n.$isOpen?"1":"0"};
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  border-top: ${n=>n.$isOpen?"1px solid #eee":"none"};
  background-color: white;
  overflow: hidden;
`;x.div`
  display: grid;
  grid-template-columns: 180px 1fr;
  padding: 15px;
  gap: 10px;
  font-size: 0.9em;
`;x.div`
  color: #666;
  font-weight: 500;
`;x.div`
  color: #333;
`;x.pre`
  margin: 0;
  padding: 15px;
  background-color: #f8f8f8;
  border-radius: 6px;
  overflow-x: auto;
  font-size: 0.85em;
  border: 1px solid #eee;
  transition: all 0.2s ease;
  
  &:hover {
    border-color: rgba(10, 25, 41, 0.2);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }
`;const tt=()=>{const n=a.useRef(!0),C=a.useRef(null),[c,O]=a.useState(520),[B,j]=a.useState(!0),[b,M]=a.useState(null),[P,ve]=a.useState([]),[u,Se]=a.useState({}),[ce,_e]=a.useState([]),[v,we]=a.useState("hour"),[I,ke]=a.useState(15),[Q,Ce]=a.useState(24),[pe,Te]=a.useState([]),[ee,D]=a.useState(null),[Y,xe]=a.useState(null),[S,Ne]=a.useState(null),[ue,U]=a.useState([]),[ge,q]=a.useState([]),[Ae,te]=a.useState(!1),[H,fe]=a.useState(!1),[T,ze]=a.useState({total:0,totalPages:0,currentPage:1,limit:20}),{page:N,setPage:A}=De(1,20),{filters:h,setFilter:V}=Ye({performance_tier:"",operation_type:"",source_type:"",search:""}),oe=a.useCallback(async()=>{if(n.current)try{j(!0),M(null);const[t,r,i,s]=await Promise.all([G.getQueries({page:N,limit:20,performance_tier:h.performance_tier,operation_type:h.operation_type,source_type:h.source_type,search:h.search}),G.getMetrics(),G.getVolumeOverTime({hours:v==="day"?168:24,interval:v}).catch(()=>({data:[]})),G.getTopSlowest(I,Q).catch(()=>({data:[]}))]);n.current&&(ve(t.data||[]),ze(t.pagination||{total:0,totalPages:0,currentPage:1,limit:20}),Se(r||{}),_e(Array.isArray(i==null?void 0:i.data)?i.data:[]),Te(Array.isArray(s==null?void 0:s.data)?s.data:[]))}catch(t){n.current&&M(be(t))}finally{n.current&&j(!1)}},[N,h.performance_tier,h.operation_type,h.source_type,h.search,v,I,Q]);a.useEffect(()=>{n.current=!0,oe();const t=setInterval(oe,3e4);return()=>{n.current=!1,clearInterval(t)}},[oe]),a.useEffect(()=>{const t=C.current;if(!t)return;const r=new ResizeObserver(i=>{var p;const s=i[0];(p=s==null?void 0:s.contentRect)!=null&&p.width&&O(Math.max(320,s.contentRect.width))});return r.observe(t),O(Math.max(320,t.getBoundingClientRect().width)),()=>r.disconnect()},[]);const $e=a.useCallback(t=>{D(r=>r===t?null:t)},[]),_=a.useCallback(t=>{if(!t)return"N/A";const r=Number(t);return isNaN(r)?"N/A":r<1?`${(r*1e3).toFixed(2)}μs`:r<1e3?`${r.toFixed(2)}ms`:`${(r/1e3).toFixed(2)}s`},[]),he=a.useCallback(t=>{if(t==null)return"N/A";const r=Number(t);return isNaN(r)?"N/A":r>=1e6?`${(r/1e6).toFixed(2)}M`:r>=1e3?`${(r/1e3).toFixed(2)}K`:r.toString()},[]),Ee=a.useCallback(t=>{const r=(t||"").toUpperCase();return r==="POOR"||r==="FAIR"?o.muted:r==="EXCELLENT"||r==="GOOD"?o.accent:o.foreground},[]),We={w:520,h:220},m=a.useMemo(()=>ce.filter(t=>t.bucket_ts).map(t=>({ts:new Date(t.bucket_ts).getTime(),volume:t.count})).sort((t,r)=>t.ts-r.ts),[ce]),me=a.useCallback(async t=>{try{fe(!0),M(null),U([]),q([]);const r=await ae.analyzeQuery(t.queryid||t.id,t.query_text);Ne(r),xe(t),te(!0);const i=r==null?void 0:r.query_fingerprint;if(i){try{const s=await ae.getSuggestions({query_fingerprint:i});U(Array.isArray(s)?s:[])}catch{U([])}try{const s=await ae.getRegressions({days:7}),p=(s==null?void 0:s.regressions)??(Array.isArray(s)?s:[]);q(Array.isArray(p)?p.filter(f=>(f==null?void 0:f.query_fingerprint)===i):[])}catch{q([])}}else U([]),q([])}catch(r){M(be(r))}finally{fe(!1)}},[]);return e.jsxs(Ie,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:l.spacing.lg},children:e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:o.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:o.accent,marginRight:8},children:k.blockFull}),"QUERY PERFORMANCE"]})}),b&&e.jsx(Le,{children:b}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(de,{title:"DETAILS",children:e.jsxs(Xe,{children:[e.jsxs(K,{children:[e.jsxs(J,{children:[e.jsx(Z,{}),"DISTRIBUTION BY TIER"]}),["EXCELLENT","GOOD","FAIR","POOR"].map(t=>{const r=`${t.toLowerCase()}_count`,i=Number(u[r]??0)||0,s=Number(u.total_queries)||1,p=s>0?i/s*100:0,f=i>0;return e.jsxs(W,{children:[e.jsx(R,{$active:f}),e.jsx("span",{style:{flex:1},children:t}),e.jsxs(F,{$active:f,children:[i," (",p.toFixed(1),"%)"]})]},t)})]}),e.jsxs(K,{children:[e.jsxs(J,{children:[e.jsx(Z,{}),"BLOCKING VS NON-BLOCKING"]}),[{label:"Blocking",count:Number(u.blocking_count)||0},{label:"Non-Blocking",count:Math.max(0,(Number(u.total_queries)||0)-(Number(u.blocking_count)||0))}].map(({label:t,count:r})=>{const i=Number(u.total_queries)||1,s=i>0?r/i*100:0;return e.jsxs(W,{children:[e.jsx(R,{$active:r>0}),e.jsx("span",{style:{flex:1},children:t}),e.jsxs(F,{$active:r>0,children:[r," (",s.toFixed(1),"%)"]})]},t)})]}),e.jsxs(K,{children:[e.jsxs(J,{children:[e.jsx(Z,{}),"DISTRIBUTION BY STATE"]}),[{label:"Long Running",count:Number(u.long_running_count)||0},{label:"Normal",count:Math.max(0,(Number(u.total_queries)||0)-(Number(u.long_running_count)||0))}].map(({label:t,count:r})=>{const i=Number(u.total_queries)||1,s=i>0?r/i*100:0;return e.jsxs(W,{children:[e.jsx(R,{$active:r>0}),e.jsx("span",{style:{flex:1},children:t}),e.jsxs(F,{$active:r>0,children:[r," (",s.toFixed(1),"%)"]})]},t)})]}),e.jsxs(K,{children:[e.jsxs(J,{children:[e.jsx(Z,{}),"TOTALS"]}),e.jsxs(W,{children:[e.jsx(R,{$active:!0}),e.jsx("span",{style:{flex:1},children:"Total Queries"}),e.jsx(F,{$active:!0,children:he(u.total_queries)})]}),e.jsxs(W,{children:[e.jsx(R,{$active:!0}),e.jsx("span",{style:{flex:1},children:"Avg Efficiency"}),e.jsx(F,{$active:!0,children:u.avg_efficiency!=null?`${Number(u.avg_efficiency).toFixed(1)}%`:"N/A"})]}),e.jsxs(W,{children:[e.jsx(R,{$active:!0}),e.jsx("span",{style:{flex:1},children:"Avg Execution Time"}),e.jsx(F,{$active:!0,children:_(u.avg_mean_time_ms??u.avg_mean_time)})]})]})]})})}),e.jsx("div",{style:{width:"100%",marginBottom:20},children:e.jsxs(Oe,{style:{flexDirection:"column",alignItems:"stretch",gap:12},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:[e.jsxs(E,{value:h.performance_tier,onChange:t=>{V("performance_tier",t.target.value),A(1)},children:[e.jsx("option",{value:"",children:"All Tiers"}),e.jsx("option",{value:"EXCELLENT",children:"Excellent"}),e.jsx("option",{value:"GOOD",children:"Good"}),e.jsx("option",{value:"FAIR",children:"Fair"}),e.jsx("option",{value:"POOR",children:"Poor"})]}),e.jsxs(E,{value:h.operation_type,onChange:t=>{V("operation_type",t.target.value),A(1)},children:[e.jsx("option",{value:"",children:"All Operations"}),e.jsx("option",{value:"SELECT",children:"SELECT"}),e.jsx("option",{value:"INSERT",children:"INSERT"}),e.jsx("option",{value:"UPDATE",children:"UPDATE"}),e.jsx("option",{value:"DELETE",children:"DELETE"})]}),e.jsxs(E,{value:h.source_type,onChange:t=>{V("source_type",t.target.value),A(1)},children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"snapshot",children:"Snapshot"}),e.jsx("option",{value:"activity",children:"Activity"})]})]}),e.jsx(Be,{type:"text",placeholder:"Search query text...",value:h.search,onChange:t=>{V("search",t.target.value),A(1)},style:{width:"100%",maxWidth:480}})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"540px 1fr",gap:20,minHeight:"calc(100vh - 380px)",alignContent:"start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16,overflowY:"auto"},children:[e.jsx(Ve,{queries:P,onQueryClick:t=>{$e(t.id),xe(t)}}),Y&&e.jsx("div",{style:{marginTop:l.spacing.md},children:e.jsx(je,{label:H?"Analyzing...":"Analyze Query",onClick:()=>me(Y),disabled:H})})]}),e.jsxs("div",{ref:C,style:{display:"flex",flexDirection:"column",gap:4,overflowY:"auto",width:"100%",minWidth:0,alignItems:"stretch"},children:[e.jsxs(de,{title:"TOP SLOWEST — Bar chart",children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:12,marginBottom:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:11,color:o.foreground},children:["Mostrar:",e.jsxs(E,{value:I,onChange:t=>ke(Number(t.target.value)),style:{padding:"4px 8px",fontSize:11,minWidth:90},children:[e.jsx("option",{value:5,children:"Top 5"}),e.jsx("option",{value:10,children:"Top 10"}),e.jsx("option",{value:15,children:"Top 15"}),e.jsx("option",{value:20,children:"Top 20"}),e.jsx("option",{value:25,children:"Top 25"}),e.jsx("option",{value:30,children:"Top 30"})]})]}),e.jsx("span",{style:{fontSize:10,color:o.muted},children:"|"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:11,color:o.foreground},children:["Período:",e.jsxs(E,{value:Q,onChange:t=>Ce(Number(t.target.value)),style:{padding:"4px 8px",fontSize:11,minWidth:120},children:[e.jsx("option",{value:1,children:"Última hora"}),e.jsx("option",{value:24,children:"Últimas 24 h"}),e.jsx("option",{value:168,children:"Últimos 7 días"})]})]})]}),e.jsx("div",{style:{overflowX:"auto",width:"100%"},children:pe.length===0?e.jsx("div",{style:{padding:24,textAlign:"center",color:o.muted,fontSize:11},children:"No data"}):(()=>{const t=pe.slice(0,I).map(g=>({...g,_mean:Number(g.mean_time_ms)||0})).filter(g=>g._mean>0);if(t.length===0)return e.jsx("div",{style:{padding:24,textAlign:"center",color:o.muted,fontSize:11},children:"No timing data"});const r=Math.max(1,...t.map(g=>g._mean)),i=18,s=4,p=160,f=Math.max(120,c-p-72),re=t.length*(i+s)-s,ne=Math.max(120,re+24),z=p+f+72;return e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:o.accent,marginBottom:8},children:["Top ",I," slowest (mean time)"]}),e.jsx("svg",{width:z,height:ne,style:{display:"block",border:`1px solid ${o.border}`,borderRadius:2,maxWidth:"100%"},children:t.map((g,L)=>{const w=16+L*(i+s),ie=g._mean/r*f,se=Ee(g.performance_tier||""),X=(g.query_text||"").substring(0,28);return e.jsxs("g",{children:[e.jsxs("text",{x:4,y:w+i-4,fontSize:9,fill:o.muted,children:[X,X.length>=28?"…":""]}),e.jsx("rect",{x:p,y:w,width:f,height:i-2,fill:o.backgroundSoft,stroke:o.border,rx:2}),e.jsx("rect",{x:p,y:w,width:ie,height:i-2,fill:se,rx:2,opacity:.85}),e.jsx("text",{x:p+f+6,y:w+i-4,fontSize:9,fill:o.foreground,children:_(g._mean)})]},`slowest-${L}`)})})]})})()})]}),e.jsxs(de,{title:"QUERY VOLUME OVER TIME — Area / line (picos = más queries)",children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:12,marginBottom:8},children:[e.jsx("span",{style:{fontSize:10,color:o.muted},children:"Source: metadata.query_performance"}),e.jsx("span",{style:{fontSize:10,color:o.muted},children:"|"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:11,color:o.foreground},children:["Agrupar por:",e.jsxs(E,{value:v,onChange:t=>we(t.target.value),style:{padding:"4px 8px",fontSize:11,minWidth:100},children:[e.jsx("option",{value:"minute",children:"Minutos"}),e.jsx("option",{value:"hour",children:"Horas"}),e.jsx("option",{value:"day",children:"Días"})]})]}),e.jsx("span",{style:{fontSize:10,color:o.muted},children:v==="day"?"(últimos 7 días)":"(últimas 24 h)"})]}),e.jsx("div",{style:{overflowX:"auto"},children:m.length===0?e.jsxs("div",{style:{padding:24,textAlign:"center",color:o.muted,fontSize:11},children:["No time-series data. Volume is grouped by ",v==="day"?"day":v==="hour"?"hour":"minute","."]}):(()=>{const t={top:20,right:24,bottom:32,left:44},r=Math.max(320,c),i=We.h,s=r-t.left-t.right,p=i-t.top-t.bottom,f=Math.min(...m.map(d=>d.ts)),re=Math.max(...m.map(d=>d.ts)),ne=Math.max(1,re-f),z=Math.max(1,...m.map(d=>d.volume)),g=d=>t.left+(d-f)/ne*s,L=d=>t.top+p-d/z*p,w=t.top+p,ie=m.map(d=>`${g(d.ts)},${L(d.volume)}`).join(" "),se=`${t.left},${w} ${ie} ${t.left+s},${w}`,X=m.map(d=>`${g(d.ts)},${L(d.volume)}`).join(" "),Re=d=>{const y=new Date(d);return m.length>6?y.toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit"}):y.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})},le=4;return e.jsxs("svg",{width:r,height:i,style:{display:"block",border:`1px solid ${o.border}`,borderRadius:2,backgroundColor:o.background},children:[Array.from({length:le+1}).map((d,y)=>{const $=t.top+p*y/le,Fe=z-z*y/le;return e.jsxs("g",{children:[e.jsx("line",{x1:t.left,y1:$,x2:r-t.right,y2:$,stroke:o.border,strokeWidth:1,strokeDasharray:"2 2",opacity:.7}),e.jsx("text",{x:t.left-6,y:$+4,textAnchor:"end",fontSize:9,fill:o.muted,children:y===0?z:Math.round(Fe)})]},y)}),e.jsx("line",{x1:t.left,y1:t.top,x2:t.left,y2:i-t.bottom,stroke:o.border,strokeWidth:1}),e.jsx("line",{x1:t.left,y1:i-t.bottom,x2:r-t.right,y2:i-t.bottom,stroke:o.border,strokeWidth:1}),m.map((d,y)=>{const $=m.length>10?Math.max(1,Math.floor(m.length/6)):1;return $>1&&y%$!==0&&y!==m.length-1?null:e.jsx("text",{x:g(d.ts),y:i-t.bottom+14,textAnchor:"middle",fontSize:9,fill:o.muted,children:Re(d.ts)},`vol-tick-${y}-${d.ts}`)}),e.jsx("polygon",{points:se,fill:o.backgroundSoft,stroke:"none"}),e.jsx("polyline",{points:X,fill:"none",stroke:o.accent,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})]})})()})]})]})]}),Ae&&S&&Y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",zIndex:999,transition:"opacity 0.15s ease"},onClick:()=>te(!1)}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"85%",maxWidth:720,maxHeight:"85%",overflow:"auto",backgroundColor:o.background,border:`2px solid ${o.border}`,borderRadius:2,zIndex:1e3,display:"flex",flexDirection:"column",fontFamily:"Consolas",fontSize:12,color:o.foreground,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 20px",borderBottom:`2px solid ${o.border}`,backgroundColor:o.backgroundSoft},children:[e.jsxs("h2",{style:{fontSize:14,fontFamily:"Consolas",fontWeight:600,color:o.accent,margin:0},children:[k.blockFull," QUERY ANALYSIS"]}),e.jsxs("button",{onClick:()=>te(!1),style:{background:"transparent",border:`1px solid ${o.border}`,color:o.foreground,padding:"4px 12px",borderRadius:2,cursor:"pointer",fontFamily:"Consolas",fontSize:11,transition:"all 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.border=`2px solid ${o.foreground}`,t.currentTarget.style.backgroundColor=o.backgroundSoft},onMouseLeave:t=>{t.currentTarget.style.border=`1px solid ${o.border}`,t.currentTarget.style.backgroundColor="transparent"},children:[k.blockFull," CLOSE"]})]}),e.jsxs("div",{style:{padding:20,overflowY:"auto"},children:[e.jsx("div",{style:{padding:l.spacing.md,background:o.backgroundSoft,borderRadius:2,marginBottom:l.spacing.md,fontFamily:"Consolas, monospace",fontSize:11},children:e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:Y.query_text})}),S.issues&&S.issues.length>0?e.jsxs("div",{style:{marginBottom:l.spacing.md},children:[e.jsx("h4",{style:{fontSize:12,fontWeight:600,color:o.foreground,marginBottom:l.spacing.sm},children:"Issues Detected:"}),e.jsx("ul",{style:{margin:0,paddingLeft:l.spacing.lg,fontSize:11},children:S.issues.map((t,r)=>e.jsx("li",{style:{marginBottom:l.spacing.xs,color:o.foreground},children:t},r))})]}):e.jsx("div",{style:{marginBottom:l.spacing.md,color:o.muted,fontSize:11},children:"No issues detected."}),S.recommendations&&S.recommendations.length>0?e.jsxs("div",{style:{marginBottom:l.spacing.md},children:[e.jsx("h4",{style:{fontSize:12,fontWeight:600,color:o.foreground,marginBottom:l.spacing.sm},children:"Recommendations:"}),e.jsx("ul",{style:{margin:0,paddingLeft:l.spacing.lg,fontSize:11},children:S.recommendations.map((t,r)=>e.jsx("li",{style:{marginBottom:l.spacing.xs,color:o.foreground},children:t},r))})]}):e.jsx("div",{style:{marginBottom:l.spacing.md,color:o.muted,fontSize:11},children:"No recommendations available."}),e.jsx("h4",{style:{fontSize:12,fontWeight:600,color:o.foreground,marginBottom:l.spacing.sm},children:"Optimization Suggestions"}),ue.length===0?e.jsx("div",{style:{color:o.muted,fontSize:11},children:"No suggestions for this query."}):e.jsx("div",{style:{display:"grid",gap:l.spacing.md},children:ue.map(t=>e.jsxs("div",{style:{padding:l.spacing.md,border:`1px solid ${o.border}`,borderRadius:2},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:l.spacing.sm},children:[e.jsx("span",{style:{fontSize:11,padding:`${l.spacing.xs} ${l.spacing.sm}`,background:o.accent,color:"#ffffff",borderRadius:2,textTransform:"uppercase"},children:t.type}),e.jsx("span",{style:{fontSize:11,color:o.muted},children:t.estimated_improvement!=null?`${Number(t.estimated_improvement).toFixed(1)}% improvement`:""})]}),e.jsx("div",{style:{fontSize:12,marginBottom:l.spacing.xs},children:t.description}),t.sql_suggestion&&e.jsx("div",{style:{padding:l.spacing.sm,background:o.backgroundSoft,borderRadius:2,fontFamily:"Consolas, monospace",fontSize:11,marginTop:l.spacing.sm},children:e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:t.sql_suggestion})})]},t.suggestion_id))}),e.jsx("h4",{style:{fontSize:12,fontWeight:600,color:o.foreground,marginTop:l.spacing.lg,marginBottom:l.spacing.sm},children:"Performance Regressions"}),ge.length===0?e.jsx("div",{style:{color:o.muted,fontSize:11},children:"No regressions for this query."}):e.jsx("div",{style:{display:"grid",gap:l.spacing.md},children:ge.map((t,r)=>e.jsxs("div",{style:{padding:l.spacing.md,border:`1px solid ${o.border}`,borderRadius:2},children:[e.jsxs("div",{style:{fontSize:11,color:o.muted},children:["Previous avg: ",Number(t.previous_avg_time).toFixed(2),"ms → Current avg: ",Number(t.current_avg_time).toFixed(2),"ms"]}),e.jsxs("div",{style:{fontWeight:600,marginTop:l.spacing.xs,fontSize:12},children:["Regression: ",Number(t.regression_percent).toFixed(1),"%"]})]},r))})]})]})]}),B&&P.length===0&&e.jsx(Me,{children:"Loading query performance data..."}),T.totalPages>1&&e.jsxs(Pe,{children:[e.jsx(ye,{onClick:()=>A(Math.max(1,N-1)),disabled:N===1,children:"Previous"}),e.jsxs("span",{children:["Page ",T.currentPage," of ",T.totalPages," (",T.total," total)"]}),e.jsx(ye,{onClick:()=>A(Math.min(T.totalPages,N+1)),disabled:N===T.totalPages,children:"Next"})]}),ee&&P.find(t=>t.id===ee)&&(()=>{const t=P.find(r=>r.id===ee);return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",zIndex:999,transition:"opacity 0.15s ease"},onClick:()=>D(null)}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"85%",height:"85%",backgroundColor:o.background,border:`2px solid ${o.border}`,borderRadius:2,zIndex:1e3,display:"flex",flexDirection:"column",fontFamily:"Consolas",fontSize:12,color:o.foreground,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",transition:"opacity 0.15s ease"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 20px",borderBottom:`2px solid ${o.border}`,backgroundColor:o.backgroundSoft},children:[e.jsxs("h2",{style:{fontSize:14,fontFamily:"Consolas",fontWeight:600,color:o.accent,margin:0},children:[k.blockFull," QUERY DETAILS"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.spacing.sm},children:[e.jsx(je,{label:H?"Analyzing...":"Analyze Query",onClick:r=>{r.stopPropagation(),t&&(me(t),D(null))},disabled:H}),e.jsxs("button",{onClick:()=>D(null),style:{background:"transparent",border:`1px solid ${o.border}`,color:o.foreground,padding:"4px 12px",borderRadius:2,cursor:"pointer",fontFamily:"Consolas",fontSize:11,transition:"all 0.2s ease"},onMouseEnter:r=>{r.currentTarget.style.border=`2px solid ${o.foreground}`,r.currentTarget.style.backgroundColor=o.backgroundSoft},onMouseLeave:r=>{r.currentTarget.style.border=`1px solid ${o.border}`,r.currentTarget.style.backgroundColor="transparent"},children:[k.blockFull," CLOSE"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"4fr 1fr",gap:20,flex:1,padding:20,overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsxs("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:o.accent,margin:0,marginBottom:12,paddingBottom:8,borderBottom:`1px solid ${o.border}`},children:[k.blockFull," QUERY TEXT"]}),e.jsx("pre",{style:{margin:0,padding:16,backgroundColor:o.backgroundSoft,borderRadius:2,overflowX:"auto",overflowY:"auto",fontSize:11,border:`1px solid ${o.border}`,fontFamily:"Consolas",whiteSpace:"pre-wrap",wordWrap:"break-word",color:o.foreground,flex:1},children:(t==null?void 0:t.query_text)||"N/A"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsxs("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:o.accent,margin:0,marginBottom:12,paddingBottom:8,borderBottom:`1px solid ${o.border}`},children:[k.blockFull," DETAILS"]}),e.jsx("div",{style:{overflowY:"auto",flex:1,fontFamily:"Consolas",fontSize:11,transition:"opacity 0.15s ease"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"150px 1fr",gap:12,padding:8},children:[e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Query ID:"}),e.jsx("div",{style:{color:o.foreground},children:(t==null?void 0:t.queryid)||"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Database:"}),e.jsx("div",{style:{color:o.foreground},children:(t==null?void 0:t.dbname)||"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Username:"}),e.jsx("div",{style:{color:o.foreground},children:(t==null?void 0:t.username)||"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Application:"}),e.jsx("div",{style:{color:o.foreground},children:(t==null?void 0:t.application_name)||"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"State:"}),e.jsx("div",{style:{color:o.foreground},children:(t==null?void 0:t.state)||"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Wait Event:"}),e.jsx("div",{style:{color:o.foreground},children:(t==null?void 0:t.wait_event_type)||"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Calls:"}),e.jsx("div",{style:{color:o.foreground},children:he(t==null?void 0:t.calls)}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Total Time:"}),e.jsx("div",{style:{color:o.foreground},children:_(t==null?void 0:t.total_time_ms)}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Mean Time:"}),e.jsx("div",{style:{color:o.foreground},children:_(t==null?void 0:t.mean_time_ms)}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Min Time:"}),e.jsx("div",{style:{color:o.foreground},children:_(t==null?void 0:t.min_time_ms)}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Max Time:"}),e.jsx("div",{style:{color:o.foreground},children:_(t==null?void 0:t.max_time_ms)}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Query Duration:"}),e.jsx("div",{style:{color:o.foreground},children:_(t==null?void 0:t.query_duration_ms)}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Cache Hit Ratio:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.cache_hit_ratio?`${Number(t.cache_hit_ratio).toFixed(2)}%`:"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"IO Efficiency:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.io_efficiency?Number(t.io_efficiency).toFixed(2):"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Query Efficiency Score:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.query_efficiency_score?`${Number(t.query_efficiency_score).toFixed(2)}%`:"N/A"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Long Running:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.is_long_running?"Yes":"No"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Blocking:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.is_blocking?"Yes":"No"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Has Joins:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.has_joins?"Yes":"No"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Has Subqueries:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.has_subqueries?"Yes":"No"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Has CTE:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.has_cte?"Yes":"No"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Has Window Functions:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.has_window_functions?"Yes":"No"}),e.jsx("div",{style:{color:o.muted,fontWeight:500},children:"Captured At:"}),e.jsx("div",{style:{color:o.foreground},children:t!=null&&t.captured_at?new Date(t.captured_at).toLocaleString():"N/A"})]})})]})]})]})]})})(),e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})};export{tt as default};
