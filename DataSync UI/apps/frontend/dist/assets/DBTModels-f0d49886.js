import{r,a6 as b,j as e,b as t,e as m}from"./index-f6ac47b8.js";import{A as U}from"./AsciiPanel-5614714e.js";import{A as u}from"./AsciiButton-4907e65e.js";import{e as I}from"./errorHandler-5ea9ae85.js";import{s as H}from"./validation-24839588.js";import{S as Q}from"./SkeletonLoader-792007e7.js";const V=({model:s,onClose:T})=>{var S,_;const[p,k]=r.useState({model_name:"",model_type:"sql",materialization:"table",schema_name:"",database_name:"",sql_content:"",config:{},description:"",tags:[],depends_on:[],columns:[],tests:[],documentation:"",metadata:{},version:1,active:!0}),[i,y]=r.useState(null),[w,B]=r.useState(!1),[z,E]=r.useState([]),[g,f]=r.useState(null),[D,h]=r.useState(!1);r.useEffect(()=>{s&&(k({model_name:s.model_name||"",model_type:s.model_type||"sql",materialization:s.materialization||"table",schema_name:s.schema_name||"",database_name:s.database_name||"",sql_content:s.sql_content||"",config:s.config||{},description:s.description||"",tags:s.tags||[],depends_on:s.depends_on||[],columns:s.columns||[],tests:s.tests||[],documentation:s.documentation||"",metadata:s.metadata||{},version:s.version||1,active:s.active!==void 0?s.active:!0}),R())},[s]);const R=async()=>{if(s!=null&&s.model_name)try{const n=await b.getTests(s.model_name);E(n)}catch(n){console.error("Error loading tests:",n)}},l=(n,C)=>{k(N=>({...N,[n]:C}))},L=(n,C)=>{const N=C.split(",").map($=>$.trim()).filter($=>$);l(n,N)},j=async()=>{if(!p.model_name||!p.sql_content||!p.schema_name){y("Model name, SQL content, and schema name are required");return}try{B(!0),y(null),await b.createOrUpdateModel(p),T()}catch(n){y(I(n))}finally{B(!1)}},v=async n=>{if(s!=null&&s.model_name)try{g?await b.updateTest(s.model_name,g.test_name,n):await b.createTest(s.model_name,n),await R(),h(!1),f(null)}catch(C){y(I(C))}},A=async n=>{if(!(!(s!=null&&s.model_name)||!confirm(`Delete test "${n}"?`)))try{await b.deleteTest(s.model_name,n),await R()}catch(C){y(I(C))}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},onClick:n=>{n.target===n.currentTarget&&T()},children:e.jsx(U,{style:{width:"90%",maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("h2",{style:{color:t.cyan,margin:0},children:s?"Edit Model":"New Model"}),e.jsx(u,{label:"Close",onClick:T,variant:"ghost"})]}),i&&e.jsx("div",{style:{color:t.red,marginBottom:"15px",padding:"10px",border:`1px solid ${t.red}`},children:i}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Model Name *"}),e.jsx("input",{type:"text",value:p.model_name,onChange:n=>l("model_name",n.target.value),disabled:!!s,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Schema Name *"}),e.jsx("input",{type:"text",value:p.schema_name,onChange:n=>l("schema_name",n.target.value),style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Materialization"}),e.jsxs("select",{value:p.materialization,onChange:n=>l("materialization",n.target.value),style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"},children:[e.jsx("option",{value:"table",children:"Table"}),e.jsx("option",{value:"view",children:"View"}),e.jsx("option",{value:"incremental",children:"Incremental"}),e.jsx("option",{value:"ephemeral",children:"Ephemeral"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Database Name (optional)"}),e.jsx("input",{type:"text",value:p.database_name||"",onChange:n=>l("database_name",n.target.value),style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Description"}),e.jsx("textarea",{value:p.description||"",onChange:n=>l("description",n.target.value),rows:2,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:((S=p.tags)==null?void 0:S.join(", "))||"",onChange:n=>L("tags",n.target.value),placeholder:"tag1, tag2, tag3",style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Depends On (comma-separated model names)"}),e.jsx("input",{type:"text",value:((_=p.depends_on)==null?void 0:_.join(", "))||"",onChange:n=>L("depends_on",n.target.value),placeholder:"model1, model2",style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"SQL Content *"}),e.jsx("textarea",{value:p.sql_content,onChange:n=>l("sql_content",n.target.value),rows:15,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",resize:"vertical"},placeholder:"SELECT * FROM {{ ref('other_model') }}"})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Documentation (Markdown)"}),e.jsx("textarea",{value:p.documentation||"",onChange:n=>l("documentation",n.target.value),rows:5,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",resize:"vertical"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"10px",alignItems:"center"},children:e.jsxs("label",{style:{color:t.text,display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx("input",{type:"checkbox",checked:p.active,onChange:n=>l("active",n.target.checked)}),"Active"]})}),s&&e.jsxs("div",{style:{gridColumn:"1 / -1",marginTop:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("h3",{style:{color:t.cyan,margin:0},children:"Tests"}),e.jsx(u,{label:"Add Test",onClick:()=>{f(null),h(!0)},variant:"ghost"})]}),z.length>0&&e.jsx("div",{style:{marginBottom:"15px"},children:z.map(n=>e.jsxs("div",{style:{padding:"10px",marginBottom:"10px",border:`1px solid ${t.border}`,backgroundColor:t.bg,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:t.text,fontWeight:"bold"},children:n.test_name}),e.jsxs("div",{style:{color:t.muted,fontSize:"12px"},children:["Type: ",n.test_type," | Column: ",n.column_name||"N/A"," | Severity: ",n.severity||"error"]}),n.description&&e.jsx("div",{style:{color:t.text,fontSize:"12px",marginTop:"5px"},children:n.description})]}),e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[e.jsx(u,{label:"Edit",onClick:()=>{f(n),h(!0)},variant:"ghost"}),e.jsx(u,{label:"Delete",onClick:()=>A(n.test_name),variant:"ghost"})]})]},n.id||n.test_name))}),D&&e.jsx(Y,{test:g,onSave:v,onCancel:()=>{h(!1),f(null)},modelName:s==null?void 0:s.model_name})]})]}),e.jsx("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:e.jsx(u,{label:w?m.loading:"Save",onClick:j,disabled:w})})]})})})},Y=({test:s,onSave:T,onCancel:p,modelName:k})=>{const[i,y]=r.useState({test_name:(s==null?void 0:s.test_name)||"",test_type:(s==null?void 0:s.test_type)||"not_null",column_name:(s==null?void 0:s.column_name)||"",test_config:(s==null?void 0:s.test_config)||{},test_sql:(s==null?void 0:s.test_sql)||"",description:(s==null?void 0:s.description)||"",severity:(s==null?void 0:s.severity)||"error",active:(s==null?void 0:s.active)!==void 0?s.active:!0}),[w,B]=r.useState(!1),[z,E]=r.useState(!1),[g,f]=r.useState(null),D=l=>{l.preventDefault(),!(!i.test_name||!i.test_type)&&T(i)},h=()=>["not_null","unique","relationships","accepted_values"].includes(i.test_type),R=async()=>{if(!i.test_sql||!k){f({success:!1,message:"Test SQL and model name are required"});return}try{E(!0),f(null);const l=await b.testQuery(k,{test_sql:i.test_sql,test_type:i.test_type,column_name:i.column_name,test_config:i.test_config});f(l)}catch(l){f({success:!1,message:l.message||"Error testing query",error:l.message})}finally{E(!1)}};return e.jsxs("div",{style:{padding:"15px",border:`1px solid ${t.border}`,backgroundColor:t.bg,marginTop:"10px"},children:[e.jsx("h4",{style:{color:t.cyan,marginTop:0,marginBottom:"15px"},children:s?"Edit Test":"New Test"}),e.jsx("form",{onSubmit:D,children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"10px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px",fontSize:"12px"},children:"Test Name *"}),e.jsx("input",{type:"text",value:i.test_name,onChange:l=>y({...i,test_name:l.target.value}),disabled:!!s,style:{width:"100%",padding:"6px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",fontSize:"12px"}})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsx("label",{style:{color:t.text,display:"block",fontSize:"12px"},children:"Test Type *"}),e.jsx(u,{label:"Test Types Guide",onClick:()=>B(!0),variant:"ghost",style:{fontSize:"10px",padding:"2px 6px"}})]}),e.jsxs("select",{value:i.test_type,onChange:l=>y({...i,test_type:l.target.value}),style:{width:"100%",padding:"6px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",fontSize:"12px"},children:[e.jsx("option",{value:"not_null",children:"Not Null"}),e.jsx("option",{value:"unique",children:"Unique"}),e.jsx("option",{value:"relationships",children:"Relationships"}),e.jsx("option",{value:"accepted_values",children:"Accepted Values"}),e.jsx("option",{value:"custom",children:"Custom"}),e.jsx("option",{value:"expression",children:"Expression"})]})]}),h()&&e.jsxs("div",{children:[e.jsxs("label",{style:{color:t.text,display:"block",marginBottom:"5px",fontSize:"12px"},children:["Column Name ",["not_null","unique","relationships","accepted_values"].includes(i.test_type)?"*":""]}),e.jsx("input",{type:"text",value:i.column_name,onChange:l=>y({...i,column_name:l.target.value}),placeholder:"Required for this test type",style:{width:"100%",padding:"6px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",fontSize:"12px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px",fontSize:"12px"},children:"Severity"}),e.jsxs("select",{value:i.severity,onChange:l=>y({...i,severity:l.target.value}),style:{width:"100%",padding:"6px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",fontSize:"12px"},children:[e.jsx("option",{value:"error",children:"Error"}),e.jsx("option",{value:"warn",children:"Warning"})]})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px",fontSize:"12px"},children:"Description"}),e.jsx("textarea",{value:i.description,onChange:l=>y({...i,description:l.target.value}),rows:2,style:{width:"100%",padding:"6px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",fontSize:"12px",resize:"vertical"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsxs("label",{style:{color:t.text,display:"block",fontSize:"12px"},children:["Test SQL ",i.test_type==="custom"||i.test_type==="expression"?"*":"(optional)"]}),i.test_sql&&k&&e.jsx(u,{label:z?m.loading:"Test Query",onClick:R,disabled:z||!i.test_sql,variant:"ghost",style:{fontSize:"10px",padding:"2px 6px"}})]}),e.jsx("textarea",{value:i.test_sql,onChange:l=>{y({...i,test_sql:l.target.value}),f(null)},rows:3,placeholder:i.test_type==="custom"||i.test_type==="expression"?"SELECT COUNT(*) FROM schema.table_name WHERE condition":"Auto-generated based on test type (optional override)",style:{width:"100%",padding:"6px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",fontSize:"12px",resize:"vertical"}}),g&&e.jsxs("div",{style:{marginTop:"5px",padding:"8px",backgroundColor:g.success&&g.status==="pass"?t.backgroundSoft:t.bg,border:`1px solid ${g.success&&g.status==="pass"?t.success:g.error?t.red:t.warning}`,color:g.success&&g.status==="pass"?t.success:g.error?t.red:t.warning,fontSize:"11px"},children:[g.message,g.failure_count!==void 0&&e.jsxs("div",{style:{marginTop:"5px",fontSize:"10px",color:t.muted},children:["Failure count: ",g.failure_count]})]})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"5px",justifyContent:"flex-end"},children:[e.jsx(u,{label:"Cancel",onClick:p,variant:"ghost"}),e.jsx(u,{label:"Save",onClick:D,disabled:!i.test_name||!i.test_type||h()&&!i.column_name})]})]})}),w&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:()=>B(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:900,maxHeight:"90vh",overflowY:"auto"},onClick:l=>l.stopPropagation(),children:e.jsx(U,{title:"DBT TEST TYPES GUIDE",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[m.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"DBT tests validate data quality by checking that your data meets specified conditions. Tests return a count of failing rows - if the count is 0, the test passes."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[m.blockFull," TEST TYPES"]}),e.jsxs("div",{style:{color:t.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"NOT_NULL"}),e.jsx("div",{style:{fontSize:11,lineHeight:1.5,marginBottom:8},children:"Validates that a column contains no NULL values."}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Required: column_name"}),e.jsx("div",{style:{fontSize:10,fontFamily:"monospace",backgroundColor:t.bg,padding:"6px",borderRadius:2},children:"SELECT COUNT(*) FROM schema.table WHERE column_name IS NULL"}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginTop:6},children:"Pass: Returns 0 (no NULLs found)"})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"UNIQUE"}),e.jsx("div",{style:{fontSize:11,lineHeight:1.5,marginBottom:8},children:"Validates that all values in a column are unique (no duplicates)."}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Required: column_name"}),e.jsx("div",{style:{fontSize:10,fontFamily:"monospace",backgroundColor:t.bg,padding:"6px",borderRadius:2},children:"SELECT COUNT(*) FROM (SELECT column_name, COUNT(*) FROM schema.table GROUP BY column_name HAVING COUNT(*) > 1)"}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginTop:6},children:"Pass: Returns 0 (no duplicates found)"})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"RELATIONSHIPS"}),e.jsx("div",{style:{fontSize:11,lineHeight:1.5,marginBottom:8},children:"Validates foreign key relationships between tables. Checks that values in a column exist in a referenced table."}),e.jsxs("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:["Required: column_name, test_config: ","{",'"to": "schema.ref_table", "field": "ref_column"',"}"]}),e.jsx("div",{style:{fontSize:10,fontFamily:"monospace",backgroundColor:t.bg,padding:"6px",borderRadius:2},children:"SELECT COUNT(*) FROM schema.table t1 LEFT JOIN schema.ref_table t2 ON t1.column_name = t2.ref_column WHERE t2.ref_column IS NULL"}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginTop:6},children:"Pass: Returns 0 (all values have matching references)"})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"ACCEPTED_VALUES"}),e.jsx("div",{style:{fontSize:11,lineHeight:1.5,marginBottom:8},children:"Validates that column values are within a specified list of accepted values."}),e.jsxs("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:["Required: column_name, test_config: ","{",'"values": ["value1", "value2", "value3"]',"}"]}),e.jsx("div",{style:{fontSize:10,fontFamily:"monospace",backgroundColor:t.bg,padding:"6px",borderRadius:2},children:"SELECT COUNT(*) FROM schema.table WHERE column_name NOT IN ('value1', 'value2', 'value3')"}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginTop:6},children:"Pass: Returns 0 (all values are in accepted list)"})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"CUSTOM"}),e.jsx("div",{style:{fontSize:11,lineHeight:1.5,marginBottom:8},children:"Execute a custom SQL query. The query should return a count of failing rows."}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Required: test_sql"}),e.jsx("div",{style:{fontSize:10,fontFamily:"monospace",backgroundColor:t.bg,padding:"6px",borderRadius:2},children:"Your custom SQL query that returns COUNT(*) of failing rows"}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginTop:6},children:"Pass: Returns 0 (no failures)"})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"EXPRESSION"}),e.jsx("div",{style:{fontSize:11,lineHeight:1.5,marginBottom:8},children:"Execute a SQL expression test. Similar to custom but typically used for boolean expressions."}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginBottom:4},children:"Required: test_sql"}),e.jsx("div",{style:{fontSize:10,fontFamily:"monospace",backgroundColor:t.bg,padding:"6px",borderRadius:2},children:"SELECT COUNT(*) FROM schema.table WHERE NOT (your_expression)"}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginTop:6},children:"Pass: Returns 0 (expression is true for all rows)"})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[m.blockFull," SEVERITY"]}),e.jsxs("div",{style:{color:t.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.red},children:m.blockFull})," ",e.jsx("strong",{children:"Error:"})," Test failure stops the build process"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:t.yellow},children:m.blockFull})," ",e.jsx("strong",{children:"Warning:"})," Test failure logs a warning but allows build to continue"]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.muted,marginBottom:4},children:[m.blockSemi," Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:t.foreground,lineHeight:1.6},children:["• Use not_null for critical columns that must always have values",e.jsx("br",{}),"• Use unique for primary keys and business keys",e.jsx("br",{}),"• Use relationships to validate referential integrity",e.jsx("br",{}),"• Use accepted_values for enumerated fields (status, type, etc.)",e.jsx("br",{}),"• Use custom/expression for complex business rules",e.jsx("br",{}),"• Test critical columns with error severity, less critical with warn",e.jsx("br",{}),"• Write descriptive test names that explain what is being validated",e.jsx("br",{}),'• Use the "Test Query" button to validate SQL before saving']})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(u,{label:"Close",onClick:()=>B(!1),variant:"ghost"})})]})})})})]})},G=({selectedModel:s,onModelSelect:T})=>{const[p,k]=r.useState([]),[i,y]=r.useState([]),[w,B]=r.useState([]),[z,E]=r.useState(!0),[g,f]=r.useState(new Set),[D,h]=r.useState(null),[R,l]=r.useState(new Set),[L,j]=r.useState(!1),v=r.useCallback(async()=>{try{E(!0),h(null);const[a,o,x]=await Promise.all([b.getAllTests(),b.getAllTestResults(),b.getModels()]);k(a),y(o),B(x)}catch(a){h(I(a))}finally{E(!1)}},[]);r.useEffect(()=>{v()},[v]);const A=r.useCallback(async a=>{const o=`${a.model_name}-${a.test_name}`;try{l(x=>new Set(x).add(o)),h(null),await b.runTests(a.model_name),setTimeout(()=>{v(),l(x=>{const d=new Set(x);return d.delete(o),d})},2e3)}catch(x){h(I(x)),l(d=>{const W=new Set(d);return W.delete(o),W}),setTimeout(()=>{v()},2e3)}},[v]),S=r.useCallback(async()=>{try{if(j(!0),h(null),s)await b.runTests(s.model_name);else{const a=[...new Set(p.map(o=>o.model_name))];for(const o of a)await b.runTests(o)}setTimeout(()=>{v(),j(!1)},2e3)}catch(a){h(I(a)),j(!1),setTimeout(()=>{v()},2e3)}},[s,p,v]),_=a=>{f(o=>{const x=new Set(o);return x.has(a)?x.delete(a):x.add(a),x})},n=a=>{switch(a.toLowerCase()){case"pass":return t.green;case"fail":return t.red;case"error":return t.red;case"skipped":return t.gray;default:return t.gray}},C=a=>{switch(a.toLowerCase()){case"pass":return m.check;case"fail":return m.cross;case"error":return m.cross;case"skipped":return m.dash;default:return m.dash}},N=a=>i.filter(o=>o.model_name===a.model_name&&o.test_name===a.test_name).sort((o,x)=>new Date(x.created_at||0).getTime()-new Date(o.created_at||0).getTime())[0],$=a=>w.find(o=>o.model_name===a),q=s?p.filter(a=>a.model_name===s.model_name):p,P=q.reduce((a,o)=>(a[o.model_name]||(a[o.model_name]=[]),a[o.model_name].push(o),a),{});return z?e.jsx("div",{style:{color:t.gray,textAlign:"center",padding:"20px"},children:"Loading tests..."}):D?e.jsx("div",{style:{color:t.red,padding:"10px",border:`1px solid ${t.red}`},children:D}):e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:t.bgDark,border:`1px solid ${t.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{children:s?e.jsxs("span",{style:{color:t.cyan,fontWeight:"bold"},children:["Filtered by: ",s.model_name]}):e.jsxs("span",{style:{color:t.text},children:["All Tests (",q.length," total)"]})}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(u,{label:L?"Running...":"Run All Tests",onClick:S,disabled:L}),s&&e.jsx(u,{label:"Clear Filter",onClick:()=>T(null),variant:"ghost"})]})]})}),Object.keys(P).length===0?e.jsx("div",{style:{color:t.gray,textAlign:"center",padding:"20px"},children:"No tests found"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:Object.entries(P).map(([a,o])=>{const x=$(a);return e.jsxs("div",{style:{border:`1px solid ${t.border}`,padding:"15px",backgroundColor:t.bg},children:[e.jsx("div",{style:{marginBottom:"10px",paddingBottom:"10px",borderBottom:`1px solid ${t.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:t.cyan,fontWeight:"bold",fontSize:"14px"},children:a}),x&&e.jsxs("span",{style:{color:t.gray,fontSize:"12px",marginLeft:"10px"},children:["Schema: ",x.schema_name," | Materialization: ",x.materialization]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(u,{label:"Run All Tests",onClick:async()=>{try{j(!0),await b.runTests(a),setTimeout(()=>{v(),j(!1)},2e3)}catch(d){h(I(d)),j(!1),setTimeout(()=>{v()},2e3)}},disabled:L,variant:"ghost"}),e.jsx(u,{label:"View Model",onClick:()=>T(x||null),variant:"ghost"})]})]})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:o.map((d,W)=>{const c=N(d),F=`${d.model_name}-${d.test_name}`,O=g.has(F);return e.jsxs("div",{style:{border:`1px solid ${t.border}`,padding:"12px",backgroundColor:t.bgDark,cursor:"pointer"},onClick:()=>_(F),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"5px",flexWrap:"wrap"},children:[e.jsx("span",{style:{color:t.cyan,fontWeight:"bold"},children:d.test_name}),e.jsxs("span",{style:{color:t.yellow,fontSize:"12px"},children:["[",d.test_type,"]"]}),d.column_name&&e.jsxs("span",{style:{color:t.gray,fontSize:"12px"},children:["Column: ",d.column_name]}),c&&e.jsxs("span",{style:{color:n(c.status),fontSize:"12px",fontWeight:"bold"},children:[C(c.status)," ",c.status.toUpperCase()]}),!d.active&&e.jsx("span",{style:{color:t.gray,fontSize:"12px"},children:"[INACTIVE]"})]}),d.description&&e.jsx("div",{style:{color:t.text,fontSize:"12px",marginBottom:"5px"},children:d.description}),c&&!O&&e.jsxs("div",{style:{color:t.gray,fontSize:"11px"},children:["Last Run: ",c.created_at?new Date(c.created_at).toLocaleString():"N/A",c.execution_time_seconds!==void 0&&c.execution_time_seconds!==null&&` | Duration: ${Number(c.execution_time_seconds).toFixed(3)}s`,c.rows_affected!==void 0&&c.rows_affected!==null&&` | Rows: ${c.rows_affected}`]})]}),e.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[e.jsx(u,{label:R.has(F)?"Running...":"Run Test",onClick:M=>{M.stopPropagation(),A(d)},variant:"ghost",disabled:R.has(F)}),e.jsx("div",{style:{color:t.muted,fontSize:"12px",marginLeft:"5px",cursor:"pointer"},children:O?"▼":"▶"})]})]}),O&&e.jsxs("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:`1px solid ${t.border}`},children:[d.test_sql&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("div",{style:{color:t.gray,fontSize:"11px",marginBottom:"5px",fontWeight:"bold"},children:"Test SQL:"}),e.jsx("pre",{style:{padding:"8px",backgroundColor:t.bg,border:`1px solid ${t.border}`,fontSize:"11px",overflow:"auto",maxHeight:"150px",margin:0},children:d.test_sql})]}),d.test_config&&Object.keys(d.test_config).length>0&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("div",{style:{color:t.gray,fontSize:"11px",marginBottom:"5px",fontWeight:"bold"},children:"Test Config:"}),e.jsx("pre",{style:{padding:"8px",backgroundColor:t.bg,border:`1px solid ${t.border}`,fontSize:"11px",overflow:"auto",maxHeight:"100px",margin:0},children:JSON.stringify(d.test_config,null,2)})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("div",{style:{color:t.gray,fontSize:"11px",marginBottom:"5px",fontWeight:"bold"},children:"Test Details:"}),e.jsxs("div",{style:{fontSize:"11px",lineHeight:"1.6"},children:[e.jsxs("div",{children:["Severity: ",e.jsx("span",{style:{color:t.text},children:d.severity||"error"})]}),e.jsxs("div",{children:["Active: ",e.jsx("span",{style:{color:d.active?t.green:t.gray},children:d.active?"Yes":"No"})]}),d.created_at&&e.jsxs("div",{children:["Created: ",e.jsx("span",{style:{color:t.text},children:new Date(d.created_at).toLocaleString()})]}),d.updated_at&&e.jsxs("div",{children:["Updated: ",e.jsx("span",{style:{color:t.text},children:new Date(d.updated_at).toLocaleString()})]})]})]}),c&&e.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:t.bg,border:`1px solid ${n(c.status)}`},children:[e.jsx("div",{style:{color:t.gray,fontSize:"11px",marginBottom:"5px",fontWeight:"bold"},children:"Latest Test Result:"}),e.jsxs("div",{style:{fontSize:"11px",lineHeight:"1.6",marginBottom:"8px"},children:[e.jsxs("div",{children:["Status: ",e.jsx("span",{style:{color:n(c.status),fontWeight:"bold"},children:c.status.toUpperCase()})]}),e.jsxs("div",{children:["Run ID: ",e.jsx("span",{style:{color:t.text},children:c.run_id||"N/A"})]}),e.jsxs("div",{children:["Executed: ",e.jsx("span",{style:{color:t.text},children:c.created_at?new Date(c.created_at).toLocaleString():"N/A"})]}),e.jsxs("div",{children:["Duration: ",e.jsx("span",{style:{color:t.text},children:c.execution_time_seconds!==void 0&&c.execution_time_seconds!==null?`${Number(c.execution_time_seconds).toFixed(3)}s`:"N/A"})]}),e.jsxs("div",{children:["Rows Affected: ",e.jsx("span",{style:{color:t.text},children:c.rows_affected!==void 0&&c.rows_affected!==null?c.rows_affected:"N/A"})]})]}),c.error_message&&e.jsxs("div",{style:{marginTop:"8px",padding:"8px",backgroundColor:t.bgDark,border:`1px solid ${t.red}`},children:[e.jsx("div",{style:{color:t.red,fontSize:"11px",fontWeight:"bold",marginBottom:"4px"},children:"Error Message:"}),e.jsx("div",{style:{color:t.red,fontSize:"11px",fontFamily:"monospace",whiteSpace:"pre-wrap"},children:c.error_message})]}),c.test_result&&e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx("div",{style:{color:t.gray,fontSize:"11px",marginBottom:"4px",fontWeight:"bold"},children:"Test Result Details:"}),c.test_result.failure_count!==void 0&&e.jsxs("div",{style:{fontSize:"11px",marginBottom:"4px"},children:["Failure Count: ",e.jsx("span",{style:{color:c.test_result.failure_count===0?t.green:t.red},children:c.test_result.failure_count})]}),c.test_result.test_sql&&e.jsxs("div",{style:{marginTop:"4px"},children:[e.jsx("div",{style:{color:t.gray,fontSize:"10px",marginBottom:"4px"},children:"Executed SQL:"}),e.jsx("pre",{style:{padding:"6px",backgroundColor:t.bgDark,border:`1px solid ${t.border}`,fontSize:"10px",overflow:"auto",maxHeight:"100px",margin:0},children:c.test_result.test_sql})]})]})]}),!c&&e.jsx("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:t.bgDark,border:`1px solid ${t.border}`,color:t.gray,fontSize:"11px",fontStyle:"italic"},children:"No test results available yet. Run the test to see results."})]})]},d.id||W)})})]},a)})})]})},se=()=>{const[s,T]=r.useState(""),[p,k]=r.useState(""),[i,y]=r.useState(null),[w,B]=r.useState([]),[z,E]=r.useState(!0),[g,f]=r.useState(!1),[D,h]=r.useState(null),[R,l]=r.useState(null),[L,j]=r.useState("models"),[v,A]=r.useState(!1),S=r.useRef(!0),_=r.useCallback(async()=>{if(!S.current)return;const o=Date.now(),x=300;try{E(!0),y(null);const d=await b.getModels(),W=Date.now()-o,c=Math.max(0,x-W);if(await new Promise(F=>setTimeout(F,c)),S.current){let F=d;if(p){const O=H(p,100).toLowerCase();F=d.filter(M=>M.model_name.toLowerCase().includes(O)||M.description&&M.description.toLowerCase().includes(O)||M.schema_name&&M.schema_name.toLowerCase().includes(O))}B(F)}}catch(d){S.current&&y(I(d))}finally{S.current&&E(!1)}},[p]);r.useEffect(()=>(S.current=!0,_(),()=>{S.current=!1}),[_]);const n=r.useCallback(()=>{k(s)},[s]),C=r.useCallback(o=>{o.key==="Enter"&&n()},[n]),N=r.useCallback(async o=>{if(confirm(`Are you sure you want to delete model "${o}"?`))try{await b.deleteModel(o),_()}catch(x){S.current&&y(I(x))}},[_]),$=r.useCallback(o=>{h(o||null),f(!0)},[]),q=r.useCallback(()=>{f(!1),h(null),_()},[_]);r.useCallback(o=>{l(o),j("tests")},[]);const P=o=>{if(!o)return t.muted;switch(o.toLowerCase()){case"success":return t.accent;case"error":return t.foreground;case"running":return t.muted;default:return t.muted}},a=o=>{switch(o){case"table":return t.accent;case"view":return t.foreground;case"incremental":return t.muted;case"ephemeral":return t.muted;default:return t.foreground}};return z&&w.length===0?e.jsx(Q,{variant:"table"}):e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs(U,{children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("h2",{style:{color:t.accent,margin:0},children:"DBT MODELS"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(u,{label:"DBT Playbook",onClick:()=>A(!0),variant:"ghost"}),e.jsx(u,{label:"Macros",onClick:()=>window.location.href="/dbt-macros",variant:"ghost"}),e.jsx(u,{label:"New Model",onClick:()=>$()})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px"},children:[e.jsx("input",{type:"text",placeholder:"Search models...",value:s,onChange:o=>T(o.target.value),onKeyPress:C,style:{flex:1,padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}}),e.jsx(u,{label:"Search",onClick:n})]}),i&&e.jsx("div",{style:{color:t.foreground,marginBottom:"15px",padding:"10px",border:`2px solid ${t.foreground}`},children:i}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,borderBottom:`1px solid ${t.border}`,paddingBottom:8},children:[e.jsx(u,{label:"Models",onClick:()=>j("models"),variant:L==="models"?"primary":"ghost"}),e.jsx(u,{label:"Tests",onClick:()=>j("tests"),variant:L==="tests"?"primary":"ghost"})]})]}),L==="tests"?e.jsx(G,{selectedModel:R,onModelSelect:o=>{l(o),o&&j("models")}}):z?e.jsx("div",{style:{color:t.gray,textAlign:"center",padding:"20px"},children:"Loading models..."}):w.length===0?e.jsx("div",{style:{color:t.gray,textAlign:"center",padding:"20px"},children:"No models found"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:w.map(o=>e.jsx("div",{style:{border:`1px solid ${t.border}`,padding:"15px",backgroundColor:o.active?t.bg:t.bgDark},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"10px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"5px"},children:[e.jsx("span",{style:{color:t.accent,fontWeight:"bold",fontSize:"16px"},children:o.model_name}),e.jsxs("span",{style:{color:a(o.materialization),fontSize:"12px"},children:["[",o.materialization||"table","]"]}),o.last_run_status&&e.jsxs("span",{style:{color:P(o.last_run_status),fontSize:"12px"},children:["[",o.last_run_status,"]"]}),!o.active&&e.jsx("span",{style:{color:t.gray,fontSize:"12px"},children:"[INACTIVE]"})]}),e.jsxs("div",{style:{color:t.gray,fontSize:"12px",marginBottom:"5px"},children:["Schema: ",o.schema_name,o.database_name&&` | Database: ${o.database_name}`,o.version&&` | Version: ${o.version}`]}),o.description&&e.jsx("div",{style:{color:t.text,fontSize:"13px",marginBottom:"5px"},children:o.description}),o.tags&&o.tags.length>0&&e.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap",marginBottom:"5px"},children:o.tags.map((x,d)=>e.jsxs("span",{style:{color:t.muted,fontSize:"11px"},children:["#",x]},d))}),o.last_run_time&&e.jsxs("div",{style:{color:t.gray,fontSize:"11px"},children:["Last run: ",new Date(o.last_run_time).toLocaleString(),o.last_run_rows!==void 0&&` | Rows: ${o.last_run_rows.toLocaleString()}`]})]}),e.jsxs("div",{style:{display:"flex",gap:"5px",flexDirection:"column"},onClick:x=>x.stopPropagation(),children:[e.jsx(u,{label:"View Tests",onClick:x=>{x.stopPropagation(),l(o),j("tests")},variant:"ghost"}),e.jsx(u,{label:"Edit",onClick:x=>{x.stopPropagation(),$(o)},variant:"ghost"}),e.jsx(u,{label:"Delete",onClick:x=>{x.stopPropagation(),N(o.model_name)},variant:"ghost"})]})]})},o.model_name))})]}),g&&e.jsx(V,{model:D,onClose:q}),v&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>A(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:o=>o.stopPropagation(),children:e.jsx(U,{title:"DBT MODELS PLAYBOOK",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[m.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:'DBT (data build tool) Models are SQL-based transformation models that follow the "analytics engineering" methodology. Models are written as SQL queries that transform raw data into analytics-ready tables, views, or incremental models. The system supports dbt-style materializations, macros, tests, dependencies, and version control integration.'})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[m.blockFull," KEY CONCEPTS"]}),e.jsxs("div",{style:{color:t.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"MATERIALIZATIONS"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:["• ",e.jsx("strong",{children:"Table:"})," Creates a physical table (full refresh on each run)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"View:"})," Creates a database view (no storage, computed on query)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Incremental:"})," Only processes new/changed rows (efficient for large datasets)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Ephemeral:"})," CTE-based model (no database object created, used in other models)"]})]}),e.jsxs("div",{style:{marginBottom:12,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"MODEL DEPENDENCIES"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:["• ",e.jsx("strong",{children:"depends_on:"})," Array of model names that this model depends on",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Dependency Resolution:"})," System automatically builds models in correct order",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Reference Syntax:"})," Use ",e.jsx("code",{style:{color:t.accent},children:"{{ ref('model_name') }}"})," in SQL to reference other models",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Circular Dependencies:"})," Detected and prevented during validation"]})]}),e.jsxs("div",{style:{marginBottom:12,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:6,fontSize:11},children:"TESTS & DATA QUALITY"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:["• ",e.jsx("strong",{children:"Test Types:"})," not_null, unique, relationships, accepted_values, custom, expression",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Column Tests:"})," Validate specific columns meet business rules",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Model Tests:"})," Validate entire model outputs",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Severity:"})," error (fails build) or warn (logs warning)"]})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[m.blockFull," EXECUTION PROCESS"]}),e.jsxs("div",{style:{color:t.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.muted,marginBottom:8,fontSize:11},children:"1. MODEL COMPILATION"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.6,marginLeft:8},children:[e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Resolve ",e.jsx("code",{style:{color:t.accent},children:"{{ ref('model_name') }}"})," references to actual table/view names"]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Expand macro calls ",e.jsx("code",{style:{color:t.accent},children:"{{ macro_name(args) }}"})," to SQL code"]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Replace variables and configuration values"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Generate final compiled SQL query"]})]})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:8,fontSize:11},children:"2. DEPENDENCY RESOLUTION"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.6,marginLeft:8},children:[e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Build dependency graph from ",e.jsx("code",{style:{color:t.accent},children:"depends_on"})," arrays"]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Topological sort to determine execution order"]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Execute upstream models before downstream models"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Parallel execution when dependencies allow"]})]})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:8,fontSize:11},children:"3. MATERIALIZATION"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.6,marginLeft:8},children:[e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," ",e.jsx("strong",{children:"Table:"})," ",e.jsx("code",{style:{color:t.accent},children:"CREATE TABLE AS SELECT"})," or ",e.jsx("code",{style:{color:t.accent},children:"DROP + CREATE"})]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," ",e.jsx("strong",{children:"View:"})," ",e.jsx("code",{style:{color:t.accent},children:"CREATE OR REPLACE VIEW"})]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," ",e.jsx("strong",{children:"Incremental:"})," ",e.jsx("code",{style:{color:t.accent},children:"INSERT"})," new rows or ",e.jsx("code",{style:{color:t.accent},children:"MERGE"})," based on unique key"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," ",e.jsx("strong",{children:"Ephemeral:"})," No database object, SQL inlined into dependent models"]})]})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:t.accent,marginBottom:8,fontSize:11},children:"4. TEST EXECUTION"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.6,marginLeft:8},children:[e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Run all tests defined for the model"]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Column tests: Validate not_null, unique, accepted_values, etc."]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Relationship tests: Validate foreign key relationships"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:t.muted},children:"└─"})," Custom tests: Execute custom SQL test expressions"]})]})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[m.blockFull," KEY FEATURES"]}),e.jsxs("div",{style:{color:t.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent},children:m.blockFull})," ",e.jsx("strong",{children:"SQL-Based:"})," Write transformations in standard SQL (PostgreSQL, Snowflake, BigQuery, Redshift)"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent},children:m.blockFull})," ",e.jsx("strong",{children:"Macro Support:"})," Reusable SQL functions with parameters"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent},children:m.blockFull})," ",e.jsx("strong",{children:"Dependency Management:"})," Automatic build order resolution"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent},children:m.blockFull})," ",e.jsx("strong",{children:"Data Quality Tests:"})," Built-in and custom tests for validation"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent},children:m.blockFull})," ",e.jsx("strong",{children:"Version Control:"})," Git commit hash and branch tracking"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent},children:m.blockFull})," ",e.jsx("strong",{children:"Incremental Models:"})," Efficient processing of large datasets"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent},children:m.blockFull})," ",e.jsx("strong",{children:"Documentation:"})," Model and column-level documentation"]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.muted,marginBottom:4},children:[m.blockSemi," Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:t.foreground,lineHeight:1.6},children:["• Use incremental materialization for large fact tables that grow over time",e.jsx("br",{}),"• Use views for lightweight transformations that don't need materialization",e.jsx("br",{}),"• Define clear dependencies using ",e.jsx("code",{style:{color:t.accent},children:"depends_on"})," array",e.jsx("br",{}),"• Write comprehensive tests to catch data quality issues early",e.jsx("br",{}),"• Use macros to avoid SQL code duplication",e.jsx("br",{}),"• Document models and columns for better maintainability",e.jsx("br",{}),'• Use tags to organize and filter models (e.g., "staging", "marts", "intermediate")',e.jsx("br",{}),"• Keep models focused on single business concepts (one model = one purpose)",e.jsx("br",{}),"• Test models in development before deploying to production",e.jsx("br",{}),"• Monitor model execution times and optimize slow queries"]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(u,{label:"Close",onClick:()=>A(!1),variant:"ghost"})})]})})})})]})};export{se as default};
