import{r as n,i as b,j as e,t as r,b as o,e as p,k as T}from"./index-f6ac47b8.js";import{A as k}from"./AsciiPanel-5614714e.js";import{A as g}from"./AsciiButton-4907e65e.js";import{e as S}from"./errorHandler-5ea9ae85.js";import{S as P}from"./SkeletonLoader-792007e7.js";const D=()=>{const[a,C]=n.useState(null),[f,w]=n.useState([]),[B,j]=n.useState(!0),[v,u]=n.useState(null),[h,z]=n.useState(30),[W,x]=n.useState(!1),[R,y]=n.useState(!1),[s,d]=n.useState({budget_id:"",name:"",scope:"global",amount:0,period:"monthly",alert_on_exceed:!0,alert_threshold:80}),m=n.useCallback(async()=>{try{j(!0),u(null);const[t,i]=await Promise.all([b.getCostSummary({days:h}).catch(()=>null),b.getBudgets().catch(()=>[])]);C(t),w(i||[])}catch(t){u(S(t))}finally{j(!1)}},[h]),$=n.useCallback(async()=>{try{if(!s.budget_id||!s.name||!s.amount){u("Budget ID, name, and amount are required");return}await b.setBudget(s),x(!1),d({budget_id:"",name:"",scope:"global",amount:0,period:"monthly",alert_on_exceed:!0,alert_threshold:80}),m()}catch(t){u(S(t))}},[s,m]);n.useEffect(()=>{m()},[m]);const _=t=>{const i=t==null?void 0:t.amount,l=t==null?void 0:t.current_spend;return i==null||i===0||l==null?0:l/i*100},c=t=>t!=null&&!Number.isNaN(t)?t.toFixed(2):"0.00",L=t=>t!=null&&!Number.isNaN(t)?t.toFixed(1):"0";return B&&!a?e.jsx(P,{}):e.jsx("div",{style:{padding:r.spacing.lg},children:e.jsx(k,{children:e.jsxs("div",{style:{marginBottom:r.spacing.lg},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:o.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:o.accent,marginRight:8},children:p.blockFull}),"COST TRACKING"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:r.spacing.lg,flexWrap:"wrap",gap:r.spacing.md},children:[e.jsx("p",{style:{color:o.muted,fontSize:12,margin:0},children:"Track costs by operation and workflow, manage budgets and alerts"}),e.jsx(g,{label:"Playbook & How to use",onClick:()=>y(!0),variant:"ghost"})]}),e.jsxs("div",{style:{display:"flex",gap:r.spacing.md,marginBottom:r.spacing.lg,alignItems:"center"},children:[e.jsxs("select",{value:h,onChange:t=>z(parseInt(t.target.value)),style:{padding:`${r.spacing.sm} ${r.spacing.md}`,border:`1px solid ${o.border}`,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]}),e.jsx(g,{label:"Create Budget",onClick:()=>x(!0)}),e.jsx(g,{label:"Refresh",onClick:m})]}),v&&e.jsx("div",{style:{padding:r.spacing.md,background:o.error,color:"#ffffff",marginBottom:r.spacing.md,borderRadius:2,fontSize:12},children:v}),R&&T.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>y(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",minHeight:400,overflowY:"auto",flexShrink:0},onClick:t=>t.stopPropagation(),children:e.jsx(k,{title:"COST TRACKING - PLAYBOOK & HOW TO USE",animated:!1,children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[p.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:o.foreground,marginLeft:16},children:"Cost Tracking shows estimated spend for compute, storage, and network over a selected period. You can define budgets (global, per workflow, or per project) and get alerts when spend approaches or exceeds your limits. Use this view to control costs and plan capacity."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[p.blockFull," HOW TO USE"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600},children:"1. View cost summary"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11},children:"Use the period dropdown (7, 30, or 90 days) to see total cost, compute, storage, network, and operation count for that range."})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600},children:"2. Create budgets"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11},children:'Click "Create Budget" to set a budget: choose scope (global, workflow, project), amount, period (daily/weekly/monthly), and alert threshold. You get notified when spend reaches the threshold.'})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600},children:"3. Monitor budgets"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11},children:"Each budget shows current spend vs limit and a usage bar. When usage exceeds the alert threshold, the bar and border highlight so you can act before overspending."})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600},children:"4. Refresh data"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11},children:'Use "Refresh" to reload the cost summary and budget list from the backend.'})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[p.blockFull," KEY CONCEPTS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600},children:"Compute / Storage / Network"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11},children:"Costs are estimated from resource utilization (CPU, memory, I/O, network). Values depend on the DataSync monitoring pipeline and may be approximations."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600},children:"Budget scope"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11},children:"Global applies to all spend; workflow and project let you cap costs for specific workflows or projects."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600},children:"Alert threshold"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11},children:"Percentage of the budget at which you want to be warned (e.g. 80% = alert when spend reaches 80% of the limit)."})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:o.muted,marginBottom:4},children:[p.blockSemi," Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:o.foreground},children:["• Set budgets for critical workflows or projects to avoid cost surprises.",e.jsx("br",{}),"• Use 7-day view to spot recent spikes; use 30/90-day for trends and planning.",e.jsx("br",{}),"• Combine with Resource Tracking and Bottleneck Detection to link cost to utilization and optimize before scaling.",e.jsx("br",{}),"• If costs show as zero, ensure the DataSync binary is running with monitoring and that resource metrics are being collected."]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(g,{label:"Close",onClick:()=>y(!1),variant:"ghost"})})]})})})}),document.body),a&&e.jsxs("div",{style:{marginBottom:r.spacing.lg},children:[e.jsxs("h3",{style:{fontSize:14,fontWeight:600,color:o.foreground,marginBottom:r.spacing.md},children:["Cost Summary (",h," days)"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:r.spacing.md},children:[e.jsxs("div",{style:{padding:r.spacing.md,border:`1px solid ${o.border}`,borderRadius:2},children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:r.spacing.xs},children:"Total Cost"}),e.jsxs("div",{style:{fontSize:20,fontWeight:600,color:o.foreground},children:["$",c(a.total_cost)]})]}),e.jsxs("div",{style:{padding:r.spacing.md,border:`1px solid ${o.border}`,borderRadius:2},children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:r.spacing.xs},children:"Compute"}),e.jsxs("div",{style:{fontSize:16,fontWeight:600,color:o.foreground},children:["$",c(a.compute_cost)]})]}),e.jsxs("div",{style:{padding:r.spacing.md,border:`1px solid ${o.border}`,borderRadius:2},children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:r.spacing.xs},children:"Storage"}),e.jsxs("div",{style:{fontSize:16,fontWeight:600,color:o.foreground},children:["$",c(a.storage_cost)]})]}),e.jsxs("div",{style:{padding:r.spacing.md,border:`1px solid ${o.border}`,borderRadius:2},children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:r.spacing.xs},children:"Network"}),e.jsxs("div",{style:{fontSize:16,fontWeight:600,color:o.foreground},children:["$",c(a.network_cost)]})]}),e.jsxs("div",{style:{padding:r.spacing.md,border:`1px solid ${o.border}`,borderRadius:2},children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:r.spacing.xs},children:"Operations"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:o.foreground},children:a.operation_count!=null?a.operation_count:"—"})]})]})]}),e.jsxs("div",{style:{marginBottom:r.spacing.lg},children:[e.jsxs("h3",{style:{fontSize:14,fontWeight:600,color:o.foreground,marginBottom:r.spacing.md},children:["Budgets (",f.length,")"]}),f.length===0?e.jsx("div",{style:{padding:r.spacing.lg,textAlign:"center",color:o.muted,border:`1px solid ${o.border}`,borderRadius:2},children:"No budgets configured"}):e.jsx("div",{style:{display:"grid",gap:r.spacing.md},children:f.map(t=>{const i=_(t),l=i>=t.alert_threshold;return e.jsxs("div",{style:{padding:r.spacing.md,border:`1px solid ${l?o.error:o.border}`,borderRadius:2,background:l?o.error+"20":o.background},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:r.spacing.sm},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:600,fontSize:14},children:t.name}),e.jsxs("span",{style:{fontSize:11,color:o.muted,marginLeft:r.spacing.sm},children:["(",t.scope," - ",t.period,")"]})]}),e.jsxs("span",{style:{fontSize:14,fontWeight:600,color:l?o.error:o.foreground},children:[L(i),"%"]})]}),e.jsx("div",{style:{height:8,background:o.backgroundSoft,borderRadius:2,marginBottom:r.spacing.xs,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${Math.min(i,100)}%`,background:l?o.error:o.accent,transition:"width 0.15s ease"}})}),e.jsxs("div",{style:{fontSize:11,color:o.muted},children:["$",c(t.current_spend)," / $",c(t.amount)]})]},t.budget_id)})})]}),W&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:o.background,border:`1px solid ${o.border}`,borderRadius:2,padding:r.spacing.lg,maxWidth:500,width:"90%"},children:[e.jsx("h2",{style:{fontSize:16,fontWeight:600,color:o.foreground,marginBottom:r.spacing.md},children:"Create Budget"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:r.spacing.md},children:[e.jsx("input",{type:"text",placeholder:"Budget ID",value:s.budget_id,onChange:t=>d({...s,budget_id:t.target.value}),style:{padding:r.spacing.sm,border:`1px solid ${o.border}`,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2}}),e.jsx("input",{type:"text",placeholder:"Budget Name",value:s.name,onChange:t=>d({...s,name:t.target.value}),style:{padding:r.spacing.sm,border:`1px solid ${o.border}`,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2}}),e.jsxs("select",{value:s.scope,onChange:t=>d({...s,scope:t.target.value}),style:{padding:r.spacing.sm,border:`1px solid ${o.border}`,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"global",children:"Global"}),e.jsx("option",{value:"workflow",children:"Workflow"}),e.jsx("option",{value:"project",children:"Project"})]}),e.jsx("input",{type:"number",placeholder:"Amount",value:s.amount||"",onChange:t=>d({...s,amount:parseFloat(t.target.value)||0}),style:{padding:r.spacing.sm,border:`1px solid ${o.border}`,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2}}),e.jsxs("select",{value:s.period,onChange:t=>d({...s,period:t.target.value}),style:{padding:r.spacing.sm,border:`1px solid ${o.border}`,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsxs("div",{style:{display:"flex",gap:r.spacing.md},children:[e.jsx(g,{label:"Create",onClick:$}),e.jsx(g,{label:"Cancel",onClick:()=>x(!1)})]})]})]})})]})})})};export{D as default};
