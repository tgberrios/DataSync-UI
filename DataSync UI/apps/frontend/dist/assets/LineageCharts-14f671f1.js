import{r as h,j as e,b as n,e as r}from"./index-75d7470b.js";import{e as A}from"./errorHandler-5ea9ae85.js";import{A as f}from"./AsciiPanel-9f053981.js";const W=({engine:E,getMetrics:v,getStats:j})=>{const[I,_]=h.useState(!1),[C,S]=h.useState(null),[o,L]=h.useState({}),[i,w]=h.useState(null),l=h.useRef(null),b=h.useCallback(async()=>{var s,a;l.current&&l.current.abort(),l.current=new AbortController;const c=l.current;_(!0),S(null);try{const[t,p]=await Promise.all([v(),j()]);!c.signal.aborted&&l.current===c&&(L(t||{}),w(p||{}))}catch(t){if(!(t.name==="CanceledError"||t.name==="AbortError"||((s=t.message)==null?void 0:s.includes("canceled"))||((a=t.message)==null?void 0:a.includes("aborted")))&&l.current===c){const u=A(t);S(u),console.error("Error fetching lineage charts data:",t)}}finally{l.current===c&&_(!1)}},[v,j]);h.useEffect(()=>{b();const c=setInterval(b,6e4);return()=>{l.current&&l.current.abort(),clearInterval(c)}},[b]);const d=(c,s,a,t=n.accent)=>{const p=s==null?"N/A":Number(s).toLocaleString();return e.jsxs("div",{style:{padding:"16px",backgroundColor:n.background,border:`1px solid ${n.border}`,borderRadius:4,minWidth:"150px"},children:[e.jsx("div",{style:{fontSize:11,color:n.muted,marginBottom:8,textTransform:"uppercase",letterSpacing:.5},children:c}),e.jsx("div",{style:{fontSize:24,fontWeight:700,color:t,fontFamily:"Consolas",marginBottom:a?4:0},children:p}),a&&e.jsx("div",{style:{fontSize:10,color:n.muted},children:a})]})},m=(c,s,a,t,p=[])=>{if(!s||s.length===0)return e.jsx(f,{children:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:n.muted},children:"No data available"})});const u=s.reduce((x,g)=>x+(Number(g[t])||0),0),T=[n.accent,n.success,n.warning,n.error,n.info,"#9b59b6","#e74c3c","#3498db","#f39c12","#1abc9c","#34495e","#e67e22","#16a085","#c0392b","#8e44ad"];return e.jsxs(f,{children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:n.foreground,marginBottom:8,fontFamily:"Consolas"},children:[r.tl,r.h.repeat(2)," ",c]})}),e.jsxs("div",{style:{padding:"0 16px 16px"},children:[s.map((x,g)=>{const y=Number(x[t])||0,R=u>0?(y/u*100).toFixed(1):"0.0",q=u>0?y/u*100:0,B=p[g]||T[g%T.length];return e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{fontSize:10,color:n.foreground,marginBottom:4,fontFamily:"Consolas",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[r.v," ",x[a]||"Unknown"]}),e.jsxs("span",{style:{color:n.muted},children:[y.toLocaleString()," (",R,"%)"]})]}),e.jsx("div",{style:{width:"100%",height:10,backgroundColor:n.border,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${q}%`,height:"100%",backgroundColor:B,transition:"width 0.3s ease"}})})]},g)}),e.jsxs("div",{style:{marginTop:16,paddingTop:12,borderTop:`1px solid ${n.border}`,fontSize:10,color:n.muted,fontFamily:"Consolas"},children:[r.bl,r.h.repeat(30),e.jsx("br",{}),"Total: ",u.toLocaleString()," relationships"]})]})]})};if(I&&!o.total_relationships)return e.jsx(f,{children:e.jsx("div",{style:{padding:"40px",textAlign:"center",color:n.muted},children:"Loading charts..."})});if(C)return e.jsx(f,{children:e.jsxs("div",{style:{padding:"20px",color:n.error},children:["Error: ",C]})});const N=E.toUpperCase();return e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700,color:n.foreground,marginBottom:16,fontFamily:"Consolas"},children:[r.tl,r.h.repeat(2)," LINEAGE METRICS - ",N]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",marginBottom:"24px"},children:[d("Total Relationships",o.total_relationships),d("Unique Objects",o.unique_objects),d("High Confidence",o.high_confidence,`${((Number(o.high_confidence)||0)/(Number(o.total_relationships)||1)*100).toFixed(1)}% of total`,n.success),d("Low Confidence",o.low_confidence,`${((Number(o.low_confidence)||0)/(Number(o.total_relationships)||1)*100).toFixed(1)}% of total`,n.warning),d("Avg Confidence",o.avg_confidence?Number(o.avg_confidence).toFixed(2):"N/A","Score (0-1)"),d("Unique Servers",o.unique_servers),d("Unique Relationship Types",o.unique_relationship_types),d("Unique Discovery Methods",o.unique_discovery_methods)]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"24px",alignItems:"start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[(i==null?void 0:i.relationship_distribution)&&m("RELATIONSHIP TYPE DISTRIBUTION",i.relationship_distribution,"relationship_type","count",[n.accent,n.success,n.warning,n.error,n.info]),(i==null?void 0:i.object_type_distribution)&&m("OBJECT TYPE DISTRIBUTION",i.object_type_distribution,"object_type","count",[n.success,n.warning,n.error,n.info,"#9b59b6"])]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[(i==null?void 0:i.confidence_distribution)&&m("CONFIDENCE LEVEL DISTRIBUTION",i.confidence_distribution,"confidence_level","count",[n.success,n.warning,n.error,n.muted]),(i==null?void 0:i.discovery_method_distribution)&&m("DISCOVERY METHOD DISTRIBUTION",i.discovery_method_distribution,"discovery_method","count")]})]}),e.jsx(f,{children:e.jsxs("div",{style:{padding:"16px"},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:n.foreground,marginBottom:12,fontFamily:"Consolas"},children:[r.tl,r.h.repeat(2)," LINEAGE SUMMARY - ",N]}),e.jsxs("div",{style:{fontSize:11,color:n.foreground,lineHeight:1.8,fontFamily:"Consolas"},children:[e.jsxs("div",{children:[r.v," Total Relationships: ",e.jsx("span",{style:{color:n.accent,fontWeight:600},children:Number(o.total_relationships||0).toLocaleString()})]}),e.jsxs("div",{children:[r.v," Unique Objects: ",e.jsx("span",{style:{color:n.accent,fontWeight:600},children:Number(o.unique_objects||0).toLocaleString()})]}),e.jsxs("div",{children:[r.v," High Confidence: ",e.jsx("span",{style:{color:n.success,fontWeight:600},children:Number(o.high_confidence||0).toLocaleString()})," (",((Number(o.high_confidence)||0)/(Number(o.total_relationships)||1)*100).toFixed(1),"%)"]}),e.jsxs("div",{children:[r.v," Low Confidence: ",e.jsx("span",{style:{color:n.warning,fontWeight:600},children:Number(o.low_confidence||0).toLocaleString()})," (",((Number(o.low_confidence)||0)/(Number(o.total_relationships)||1)*100).toFixed(1),"%)"]}),o.avg_confidence&&e.jsxs("div",{children:[r.v," Avg Confidence: ",e.jsx("span",{style:{color:n.accent,fontWeight:600},children:Number(o.avg_confidence).toFixed(2)})]}),e.jsxs("div",{children:[r.v," Unique Servers: ",e.jsx("span",{style:{color:n.accent,fontWeight:600},children:Number(o.unique_servers||0).toLocaleString()})]}),e.jsxs("div",{children:[r.v," Unique Relationship Types: ",e.jsx("span",{style:{color:n.accent,fontWeight:600},children:Number(o.unique_relationship_types||0).toLocaleString()})]}),e.jsxs("div",{children:[r.v," Unique Discovery Methods: ",e.jsx("span",{style:{color:n.accent,fontWeight:600},children:Number(o.unique_discovery_methods||0).toLocaleString()})]}),e.jsxs("div",{style:{marginTop:8,paddingTop:8,borderTop:`1px solid ${n.border}`},children:[r.bl,r.h.repeat(40)]})]})]})})]})};export{W as L};
