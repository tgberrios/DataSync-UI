import{r as i,l as r,j as t,t as e,b as s}from"./index-f6ac47b8.js";import{A as S}from"./AsciiPanel-5614714e.js";import{A}from"./AsciiButton-4907e65e.js";import{e as c}from"./errorHandler-5ea9ae85.js";import{S as k}from"./SkeletonLoader-792007e7.js";const w=()=>{const[g,b]=i.useState([]),[p,y]=i.useState([]),[j,h]=i.useState(!0),[f,a]=i.useState(null),[d,m]=i.useState("policies"),x=i.useCallback(async()=>{try{const n=await r.getCleanupPolicies({});b(n.policies||n||[])}catch(n){a(c(n))}},[]),l=i.useCallback(async()=>{try{const n=await r.getCleanupHistory({});y(n.history||n||[])}catch(n){a(c(n))}},[]);i.useEffect(()=>{(async()=>{h(!0),await Promise.all([x(),l()]),h(!1)})()},[x,l]);const C=i.useCallback(async n=>{try{a(null),await r.executeCleanup({policy_id:n}),await l()}catch(o){a(c(o))}},[l]),u=n=>n?new Date(n).toLocaleString():"Never";return t.jsx("div",{style:{padding:e.spacing.lg},children:t.jsx(S,{children:t.jsxs("div",{style:{marginBottom:e.spacing.lg},children:[t.jsx("h1",{style:{fontSize:18,fontWeight:600,color:s.foreground,marginBottom:e.spacing.md},children:"CDC Cleanup Manager"}),t.jsx("p",{style:{color:s.muted,fontSize:12,marginBottom:e.spacing.lg},children:"Manage cleanup policies for CDC changelog tables"}),t.jsxs("div",{style:{display:"flex",gap:e.spacing.sm,marginBottom:e.spacing.lg,borderBottom:`2px solid ${s.border}`,paddingBottom:e.spacing.sm},children:[t.jsx("button",{onClick:()=>m("policies"),style:{padding:`${e.spacing.sm} ${e.spacing.md}`,border:"none",background:d==="policies"?s.accent:"transparent",color:d==="policies"?"#ffffff":s.foreground,borderRadius:"2 2 0 0",cursor:"pointer",fontWeight:d==="policies"?600:500,fontFamily:"Consolas, monospace",fontSize:12},children:"Policies"}),t.jsx("button",{onClick:()=>m("history"),style:{padding:`${e.spacing.sm} ${e.spacing.md}`,border:"none",background:d==="history"?s.accent:"transparent",color:d==="history"?"#ffffff":s.foreground,borderRadius:"2 2 0 0",cursor:"pointer",fontWeight:d==="history"?600:500,fontFamily:"Consolas, monospace",fontSize:12},children:"History"})]}),f&&t.jsxs("div",{style:{padding:e.spacing.md,background:s.error,color:"#ffffff",marginBottom:e.spacing.md,borderRadius:2,fontFamily:"Consolas, monospace",fontSize:12},children:["Error: ",f]}),j?t.jsx(k,{}):d==="policies"?t.jsx("div",{style:{border:`1px solid ${s.border}`,borderRadius:2,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Consolas, monospace",fontSize:12},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:s.backgroundSoft,borderBottom:`2px solid ${s.border}`},children:[t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Connection"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Engine"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Retention Days"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Batch Size"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Status"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Last Cleanup"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Actions"})]})}),t.jsx("tbody",{children:g.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:7,style:{padding:e.spacing.lg,textAlign:"center",color:s.muted},children:"No policies configured"})}):g.map((n,o)=>t.jsxs("tr",{style:{borderBottom:`1px solid ${s.border}`,background:o%2===0?s.background:s.backgroundSoft},children:[t.jsxs("td",{style:{padding:e.spacing.md,fontFamily:"Consolas, monospace",fontSize:11},children:[n.connection_string.substring(0,50),"..."]}),t.jsx("td",{style:{padding:e.spacing.md},children:n.db_engine}),t.jsxs("td",{style:{padding:e.spacing.md},children:[n.retention_days," days"]}),t.jsx("td",{style:{padding:e.spacing.md},children:n.batch_size.toLocaleString()}),t.jsx("td",{style:{padding:e.spacing.md},children:t.jsx("span",{style:{padding:`${e.spacing.xs} ${e.spacing.sm}`,background:n.enabled?s.accent:s.muted,color:"#ffffff",borderRadius:2,fontSize:11},children:n.enabled?"Enabled":"Disabled"})}),t.jsx("td",{style:{padding:e.spacing.md,color:s.muted},children:u(n.last_cleanup_at)}),t.jsx("td",{style:{padding:e.spacing.md},children:t.jsx(A,{onClick:()=>C(n.policy_id),label:"Execute",disabled:!n.enabled})})]},n.policy_id))})]})}):t.jsx("div",{style:{border:`1px solid ${s.border}`,borderRadius:2,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Consolas, monospace",fontSize:12},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:s.backgroundSoft,borderBottom:`2px solid ${s.border}`},children:[t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Started At"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Connection"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Engine"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Rows Deleted"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Tables Cleaned"}),t.jsx("th",{style:{padding:e.spacing.md,textAlign:"left",fontWeight:600},children:"Status"})]})}),t.jsx("tbody",{children:p.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{padding:e.spacing.lg,textAlign:"center",color:s.muted},children:"No cleanup history"})}):p.map((n,o)=>t.jsxs("tr",{style:{borderBottom:`1px solid ${s.border}`,background:o%2===0?s.background:s.backgroundSoft},children:[t.jsx("td",{style:{padding:e.spacing.md},children:u(n.started_at)}),t.jsxs("td",{style:{padding:e.spacing.md,fontFamily:"Consolas, monospace",fontSize:11},children:[n.connection_string.substring(0,50),"..."]}),t.jsx("td",{style:{padding:e.spacing.md},children:n.db_engine}),t.jsx("td",{style:{padding:e.spacing.md},children:n.rows_deleted.toLocaleString()}),t.jsx("td",{style:{padding:e.spacing.md},children:n.tables_cleaned}),t.jsx("td",{style:{padding:e.spacing.md},children:t.jsx("span",{style:{padding:`${e.spacing.xs} ${e.spacing.sm}`,background:n.status==="completed"?s.accent:n.status==="failed"?s.error:s.muted,color:"#ffffff",borderRadius:2,fontSize:11},children:n.status})})]},n.cleanup_id))})]})})]})})})};export{w as default};
