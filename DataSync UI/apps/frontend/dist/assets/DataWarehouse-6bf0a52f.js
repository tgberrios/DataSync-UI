import{r as c,j as e,b as o,e as C,K as ae,M as N}from"./index-75d7470b.js";import{A as M}from"./AsciiPanel-9f053981.js";import{A as b}from"./AsciiButton-446d8430.js";import{u as ie}from"./usePagination-b946ac42.js";import{u as de}from"./useTableFilters-0b8dd77f.js";import{e as G}from"./errorHandler-5ea9ae85.js";import{s as ce}from"./validation-24839588.js";import{S as ue}from"./SkeletonLoader-530eacc4.js";import{C as ge}from"./ConnectionStringSelector-c1083be0.js";const me=({warehouses:B,onWarehouseClick:u,onWarehouseEdit:t,onWarehouseBuild:I,onWarehouseToggleActive:w,onWarehouseDelete:i})=>{const[j,_]=c.useState(new Set),k=c.useMemo(()=>{const y=new Map;return B.forEach(x=>{const d=x.target_schema||"Other";y.has(d)||y.set(d,{name:d,warehouses:[]}),y.get(d).warehouses.push(x)}),Array.from(y.values()).sort((x,d)=>x.name.localeCompare(d.name))},[B]),S=y=>{_(x=>{const d=new Set(x);return d.has(y)?d.delete(y):d.add(y),d})};return B.length===0?e.jsxs("div",{style:{padding:40,textAlign:"center",color:o.muted,fontFamily:"Consolas"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:12,opacity:.4,fontFamily:"Consolas"},children:C.blockFull}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",marginBottom:4},children:"No warehouses found"}),e.jsx("div",{style:{fontSize:11,fontFamily:"Consolas",color:o.muted,opacity:.7},children:"Try adjusting your filters"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:k.map(y=>{const x=j.has(y.name);return e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 14px",cursor:"pointer",backgroundColor:"transparent",borderRadius:2,userSelect:"none",transition:"all 0.2s",border:x?`1px solid ${o.border}`:"1px solid transparent",marginBottom:4},onClick:()=>S(y.name),onMouseEnter:d=>{d.currentTarget.style.backgroundColor=o.backgroundSoft,d.currentTarget.style.borderColor=o.border},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="transparent",d.currentTarget.style.borderColor=x?o.border:"transparent"},children:[e.jsx("span",{style:{marginRight:10,fontSize:12,fontFamily:"Consolas",transition:"transform 0.2s",transform:x?"rotate(90deg)":"rotate(0deg)",color:x?o.accent:o.muted},children:C.arrowRight}),e.jsx("h3",{style:{margin:0,fontSize:13,fontFamily:"Consolas",fontWeight:600,color:x?o.accent:o.foreground,flex:1,transition:"color 0.2s"},children:y.name}),e.jsx("span",{style:{fontSize:11,color:o.muted,fontFamily:"Consolas",padding:"4px 8px",backgroundColor:x?o.accent+"20":"transparent",borderRadius:2,fontWeight:500,transition:"all 0.2s",border:`1px solid ${x?o.accent:o.border}`},children:y.warehouses.length})]}),x&&e.jsx("div",{style:{marginLeft:24,marginTop:6,marginBottom:8,display:"flex",flexDirection:"column",gap:6,paddingLeft:12,borderLeft:`2px solid ${o.border}`},children:y.warehouses.map(d=>e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 12px",cursor:"pointer",borderRadius:2,border:`1px solid ${o.border}`,backgroundColor:"transparent",transition:"all 0.2s",position:"relative"},onMouseEnter:z=>{z.currentTarget.style.backgroundColor=o.backgroundSoft,z.currentTarget.style.borderColor=o.accent,z.currentTarget.style.transform="translateX(4px)",z.currentTarget.style.boxShadow=`0 2px 8px ${o.accent}20`},onMouseLeave:z=>{z.currentTarget.style.backgroundColor="transparent",z.currentTarget.style.borderColor=o.border,z.currentTarget.style.transform="translateX(0)",z.currentTarget.style.boxShadow="none"},onClick:()=>u==null?void 0:u(d),children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",color:o.foreground,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginBottom:4},children:d.warehouse_name}),e.jsxs("div",{style:{fontSize:11,color:o.muted,fontFamily:"Consolas",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:d.schema_type.replace("_"," ")}),e.jsx("span",{style:{color:o.border},children:"•"}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,backgroundColor:d.target_layer==="GOLD"?o.success+"20":d.target_layer==="SILVER"?o.accent+"20":"transparent",color:d.target_layer==="GOLD"?o.success:d.target_layer==="SILVER"?o.accent:o.muted,fontWeight:600,fontSize:10,border:`1px solid ${d.target_layer==="GOLD"?o.success:d.target_layer==="SILVER"?o.accent:o.border}`},children:d.target_layer||"BRONZE"}),e.jsx("span",{style:{color:o.border},children:"•"}),e.jsxs("span",{children:[d.dimensions.length,"D"]}),e.jsx("span",{style:{color:o.border},children:"•"}),e.jsxs("span",{children:[d.facts.length,"F"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginLeft:12,paddingLeft:12,borderLeft:`1px solid ${o.border}`},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",backgroundColor:d.active&&d.enabled?o.success:o.muted,boxShadow:d.active&&d.enabled?`0 0 6px ${o.success}40`:"none",transition:"all 0.2s"},title:d.active&&d.enabled?"Active":"Inactive"}),d.last_build_status==="SUCCESS"&&e.jsx("span",{style:{fontSize:14,color:o.success,fontFamily:"Consolas",lineHeight:1},title:"Last build successful",children:"✓"}),d.last_build_status==="ERROR"&&e.jsx("span",{style:{fontSize:14,color:o.danger,fontFamily:"Consolas",lineHeight:1},title:"Last build failed",children:"✗"})]})]},d.warehouse_name))})]},y.name)})})},Q={MariaDB:"host=localhost;user=myuser;password=mypassword;db=mydatabase;port=3306",MSSQL:"DRIVER={ODBC Driver 17 for SQL Server};SERVER=localhost,1433;DATABASE=mydatabase;UID=myuser;PWD=mypassword",Oracle:"host=localhost;user=myuser;password=mypassword;db=mydatabase;port=1521",PostgreSQL:"postgresql://myuser:mypassword@localhost:5432/mydatabase",MongoDB:"mongodb://myuser:mypassword@localhost:27017/mydatabase",Snowflake:"DRIVER={Snowflake Driver};SERVER=myaccount.snowflakecomputing.com;UID=myuser;PWD=mypassword;WAREHOUSE=mywarehouse;DATABASE=mydatabase;SCHEMA=myschema",BigQuery:JSON.stringify({project_id:"my-project-id",dataset_id:"my_dataset",access_token:"ya29.xxx..."},null,2),Redshift:"postgresql://myuser:mypassword@mycluster.region.redshift.amazonaws.com:5439/mydatabase"},te={PostgreSQL:`Format: postgresql://user:password@host:port/database
Or: host=hostname;user=username;password=password;db=database;port=5432`,MariaDB:"Format: host=hostname;user=username;password=password;db=database;port=3306",MSSQL:"Format: DRIVER={ODBC Driver 17 for SQL Server};SERVER=hostname,port;DATABASE=database;UID=username;PWD=password",Oracle:"Format: host=hostname;user=username;password=password;db=database;port=1521",MongoDB:"Format: mongodb://user:password@host:port/database",Snowflake:`Format: DRIVER={Snowflake Driver};SERVER=account.snowflakecomputing.com;UID=username;PWD=password;WAREHOUSE=warehouse;DATABASE=database;SCHEMA=schema

Note: Requires Snowflake ODBC driver installed on the server.`,BigQuery:`Format: JSON object with project_id, dataset_id, and access_token

Example:
{
  "project_id": "my-project-id",
  "dataset_id": "my_dataset",
  "access_token": "ya29.xxx..."
}

To get access_token:
1. Use gcloud CLI: gcloud auth application-default print-access-token
2. Or use service account JSON key file path in credentials_json field`,Redshift:`Format: postgresql://user:password@cluster.region.redshift.amazonaws.com:5439/database
Or: host=cluster.region.redshift.amazonaws.com;port=5439;user=username;password=password;db=database`},he=({onClose:B,onSave:u,initialData:t})=>{const I=(t==null?void 0:t.source_db_engine)||"PostgreSQL",w=(t==null?void 0:t.target_db_engine)||"PostgreSQL",[i,j]=c.useState({warehouse_name:(t==null?void 0:t.warehouse_name)||"",description:(t==null?void 0:t.description)||"",schema_type:(t==null?void 0:t.schema_type)||"STAR_SCHEMA",target_layer:(t==null?void 0:t.target_layer)||"BRONZE",source_db_engine:I,source_connection_string:(t==null?void 0:t.source_connection_string)||Q[I]||"",target_db_engine:w,target_connection_string:(t==null?void 0:t.target_connection_string)||Q[w]||"",target_schema:(t==null?void 0:t.target_schema)||"",schedule_cron:(t==null?void 0:t.schedule_cron)||"",active:(t==null?void 0:t.active)!==void 0?t.active:!0,enabled:(t==null?void 0:t.enabled)!==void 0?t.enabled:!0,metadata:(t==null?void 0:t.metadata)||{}}),[_,k]=c.useState((t==null?void 0:t.dimensions)||[]),[S,y]=c.useState((t==null?void 0:t.facts)||[]),[x,d]=c.useState(null),[z,D]=c.useState(!1),[h,W]=c.useState("basic"),[l,E]=c.useState(!1),[L,T]=c.useState(null),[H,Z]=c.useState(!1),[$,f]=c.useState(null),[q,K]=c.useState(!1),[p,V]=c.useState(null),[R,O]=c.useState({}),[J,X]=c.useState(!1),ee=c.useCallback(()=>{const s={dimension_name:"",target_schema:i.target_schema||"",target_table:"",scd_type:"TYPE_1",source_query:"",business_keys:[],valid_from_column:"valid_from",valid_to_column:"valid_to",is_current_column:"is_current",index_columns:[],partition_column:""};k([..._,s])},[_,i.target_schema]),A=c.useCallback((s,r,n)=>{k(m=>{const g=[...m];return r==="business_keys"||r==="index_columns"?g[s]={...g[s],[r]:typeof n=="string"?n.split(",").map(v=>v.trim()).filter(v=>v):n}:g[s]={...g[s],[r]:n},g})},[]),oe=c.useCallback(s=>{k(r=>r.filter((n,m)=>m!==s))},[]),a=c.useCallback(()=>{const s={fact_name:"",target_schema:i.target_schema||"",target_table:"",source_query:"",dimension_keys:[],measures:[],index_columns:[],partition_column:""};y([...S,s])},[S,i.target_schema]),F=c.useCallback((s,r,n)=>{y(m=>{const g=[...m];return r==="dimension_keys"||r==="measures"||r==="index_columns"?g[s]={...g[s],[r]:typeof n=="string"?n.split(",").map(v=>v.trim()).filter(v=>v):n}:g[s]={...g[s],[r]:n},g})},[]),U=c.useCallback(s=>{y(r=>r.filter((n,m)=>m!==s))},[]),P=c.useCallback(s=>{const r=Q[s]||"";j(n=>{const m=n.source_connection_string.trim(),g=Q[n.source_db_engine]||"";return{...n,source_db_engine:s,source_connection_string:!m||m===g?r:m}}),T(null)},[]),se=c.useCallback(s=>{const r=Q[s]||"";j(n=>{const m=n.target_connection_string.trim(),g=Q[n.target_db_engine]||"";return{...n,target_db_engine:s,target_connection_string:!m||m===g?r:m}}),f(null)},[]),re=c.useCallback(async()=>{if(!i.source_db_engine){T({success:!1,message:"Please select a source database engine first"});return}if(!i.source_connection_string.trim()){T({success:!1,message:"Please enter a source connection string"});return}E(!0),T(null);try{const s=localStorage.getItem("authToken"),r=await fetch("/api/test-connection",{method:"POST",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},body:JSON.stringify({db_engine:i.source_db_engine,connection_string:i.source_connection_string.trim()})});if(!r.ok){if(r.status===401){T({success:!1,message:"Authentication required. Please log in again."});return}if(r.status===0||r.status>=500){T({success:!1,message:"Server error. Please check if the server is running."});return}}let n;try{n=await r.json()}catch{T({success:!1,message:"Invalid response from server"});return}r.ok&&n.success?T({success:!0,message:"Connection successful!"}):T({success:!1,message:n.error||n.message||"Connection failed"})}catch(s){T({success:!1,message:s.message||"Error testing connection"})}finally{E(!1)}},[i.source_db_engine,i.source_connection_string]),Y=c.useCallback(async(s,r)=>{const n=s==="dimension"?_[r]:S[r];if(!n.source_query.trim()){O(g=>({...g,[`${s}-${r}`]:{success:!1,message:"Please enter a source query"}}));return}if(!i.source_db_engine||!i.source_connection_string.trim()){O(g=>({...g,[`${s}-${r}`]:{success:!1,message:"Please configure source connection first"}}));return}V({type:s,index:r});const m=`${s}-${r}`;O(g=>({...g,[m]:{success:!1,message:"Testing..."}}));try{const g=await ae.previewQuery({db_engine:i.source_db_engine,connection_string:i.source_connection_string.trim(),query_sql:n.source_query.trim(),limit:10});g.success?O(v=>({...v,[m]:{success:!0,message:`Query successful! Found ${g.rowCount||0} rows. Columns: ${(g.columns||[]).join(", ")}`,data:g}})):O(v=>({...v,[m]:{success:!1,message:g.error||"Query failed"}}))}catch(g){O(v=>({...v,[m]:{success:!1,message:g.message||"Error testing query"}}))}finally{V(null)}},[_,S,i.source_db_engine,i.source_connection_string]),ne=c.useCallback(async()=>{if(!i.target_db_engine){f({success:!1,message:"Please select a target database engine first"});return}if(!i.target_connection_string.trim()){f({success:!1,message:"Please enter a target connection string"});return}Z(!0),f(null);try{const s=localStorage.getItem("authToken"),r=await fetch("/api/test-connection",{method:"POST",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},body:JSON.stringify({db_engine:i.target_db_engine,connection_string:i.target_connection_string.trim()})});if(!r.ok){if(r.status===401){f({success:!1,message:"Authentication required. Please log in again."});return}if(r.status===0||r.status>=500){f({success:!1,message:"Server error. Please check if the server is running."});return}}let n;try{n=await r.json()}catch{f({success:!1,message:"Invalid response from server"});return}r.ok&&n.success?f({success:!0,message:"Connection successful!"}):f({success:!1,message:n.error||n.message||"Connection failed"})}catch(s){f({success:!1,message:s.message||"Error testing connection"})}finally{Z(!1)}},[i.target_db_engine,i.target_connection_string]),le=c.useCallback(async()=>{if(d(null),!i.warehouse_name.trim()){d("Warehouse name is required");return}if(!i.target_schema.trim()){d("Target schema is required");return}if(_.length===0&&S.length===0){d("At least one dimension or fact table is required");return}for(const s of _){if(!s.dimension_name.trim()){d("Dimension name is required for all dimensions");return}if(!s.source_query.trim()){d(`Source query is required for dimension: ${s.dimension_name}`);return}if(s.scd_type==="TYPE_2"){if(!s.valid_from_column||!s.valid_to_column||!s.is_current_column){d(`SCD Type 2 requires valid_from, valid_to, and is_current columns for dimension: ${s.dimension_name}`);return}if(s.business_keys.length===0){d(`Business keys are required for SCD Type 2 dimension: ${s.dimension_name}`);return}}}for(const s of S){if(!s.fact_name.trim()){d("Fact name is required for all facts");return}if(!s.source_query.trim()){d(`Source query is required for fact: ${s.fact_name}`);return}}D(!0);try{const s={...i,dimensions:_,facts:S,notes:(t==null?void 0:t.notes)||null};t?await N.updateWarehouse(t.warehouse_name,s):await N.createWarehouse(s),u()}catch(s){d(G(s))}finally{D(!1)}},[i,_,S,t,u]);return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:s=>{s.target===s.currentTarget&&B()},children:e.jsxs("div",{style:{backgroundColor:o.background,border:`2px solid ${o.border}`,borderRadius:4,width:"90%",maxWidth:1200,maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:{padding:"18px 24px",borderBottom:`2px solid ${o.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:o.backgroundSoft},children:[e.jsxs("h2",{style:{margin:0,fontSize:14,fontFamily:"Consolas",color:o.foreground,fontWeight:600,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:t?C.blockFull:"+"}),e.jsx("span",{children:t?"Edit Data Warehouse":"Create Data Warehouse"})]}),e.jsx(b,{label:"×",onClick:B,variant:"ghost"})]}),e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[e.jsxs("div",{style:{width:220,borderRight:`1px solid ${o.border}`,backgroundColor:o.backgroundSoft,padding:"16px 0",display:"flex",flexDirection:"column",gap:4},children:[e.jsxs("div",{style:{padding:"12px 20px",cursor:"pointer",backgroundColor:h==="basic"?o.background:"transparent",borderLeft:h==="basic"?`4px solid ${o.accent}`:"4px solid transparent",fontSize:12,fontFamily:"Consolas",color:h==="basic"?o.accent:o.foreground,fontWeight:h==="basic"?600:400,transition:"all 0.2s",display:"flex",alignItems:"center",gap:8},onClick:()=>W("basic"),onMouseEnter:s=>{h!=="basic"&&(s.currentTarget.style.backgroundColor=o.background)},onMouseLeave:s=>{h!=="basic"&&(s.currentTarget.style.backgroundColor="transparent")},children:[e.jsx("span",{children:C.blockFull}),e.jsx("span",{children:"Basic Info"})]}),e.jsxs("div",{style:{padding:"12px 20px",cursor:"pointer",backgroundColor:h==="dimensions"?o.background:"transparent",borderLeft:h==="dimensions"?`4px solid ${o.accent}`:"4px solid transparent",fontSize:12,fontFamily:"Consolas",color:h==="dimensions"?o.accent:o.foreground,fontWeight:h==="dimensions"?600:400,transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>W("dimensions"),onMouseEnter:s=>{h!=="dimensions"&&(s.currentTarget.style.backgroundColor=o.background)},onMouseLeave:s=>{h!=="dimensions"&&(s.currentTarget.style.backgroundColor="transparent")},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:C.blockFull}),e.jsx("span",{children:"Dimensions"})]}),e.jsx("span",{style:{fontSize:11,padding:"2px 8px",backgroundColor:h==="dimensions"?o.accent+"20":o.background,borderRadius:10,fontWeight:500},children:_.length})]}),e.jsxs("div",{style:{padding:"12px 20px",cursor:"pointer",backgroundColor:h==="facts"?o.background:"transparent",borderLeft:h==="facts"?`4px solid ${o.accent}`:"4px solid transparent",fontSize:12,fontFamily:"Consolas",color:h==="facts"?o.accent:o.foreground,fontWeight:h==="facts"?600:400,transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>W("facts"),onMouseEnter:s=>{h!=="facts"&&(s.currentTarget.style.backgroundColor=o.background)},onMouseLeave:s=>{h!=="facts"&&(s.currentTarget.style.backgroundColor="transparent")},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:C.blockFull}),e.jsx("span",{children:"Facts"})]}),e.jsx("span",{style:{fontSize:11,padding:"2px 8px",backgroundColor:h==="facts"?o.accent+"20":o.background,borderRadius:10,fontWeight:500},children:S.length})]})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:24},children:[x&&e.jsxs("div",{style:{padding:"14px 16px",marginBottom:20,backgroundColor:o.danger+"20",border:`1px solid ${o.danger}`,borderRadius:2,color:o.danger,fontSize:12,fontFamily:"Consolas",display:"flex",alignItems:"center",gap:10},children:[e.jsx("span",{style:{fontSize:16},children:"!"}),e.jsx("span",{children:x})]}),h==="basic"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,marginBottom:8,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Warehouse Name *"}),e.jsx("input",{type:"text",value:i.warehouse_name,onChange:s=>j(r=>({...r,warehouse_name:s.target.value})),placeholder:"my_warehouse",style:{width:"100%",padding:"10px 14px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:s=>{s.currentTarget.style.borderColor=o.accent,s.currentTarget.style.boxShadow=`0 0 0 2px ${o.accent}20`},onBlur:s=>{s.currentTarget.style.borderColor=o.border,s.currentTarget.style.boxShadow="none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:"Description"}),e.jsx("textarea",{value:i.description,onChange:s=>j(r=>({...r,description:s.target.value})),placeholder:"Description of the data warehouse",rows:3,style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,fontFamily:"Consolas",textTransform:"uppercase"},children:"Schema Type *"}),e.jsx(b,{label:q?"Hide Guide":"Show Guide",onClick:()=>K(!q),variant:"ghost"})]}),q&&e.jsxs("div",{style:{marginBottom:16,padding:16,backgroundColor:o.backgroundSoft,border:`1px solid ${o.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas"},children:[e.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:13,color:o.accent,fontFamily:"Consolas"},children:"Data Warehouse Schema Guide"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:13,color:o.foreground,fontFamily:"Consolas",fontWeight:600},children:"What are Dimensions?"}),e.jsxs("p",{style:{margin:"0 0 8px 0",color:o.muted,lineHeight:1.6},children:["Dimensions are descriptive attributes that provide context for analysis. They are things you ",e.jsx("strong",{children:"cannot measure"})," directly, but use to group, filter, and categorize your data."]}),e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:o.background,borderRadius:2,marginTop:8},children:[e.jsx("strong",{style:{color:o.accent},children:"Examples:"})," Customer, Product, Date, Store, Region"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:13,color:o.foreground,fontFamily:"Consolas",fontWeight:600},children:"What are Facts?"}),e.jsxs("p",{style:{margin:"0 0 8px 0",color:o.muted,lineHeight:1.6},children:["Facts are numeric measures and business metrics. They are things you ",e.jsx("strong",{children:"can measure"})," - values that can be summed, averaged, counted, etc."]}),e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:o.background,borderRadius:2,marginTop:8},children:[e.jsx("strong",{style:{color:o.accent},children:"Examples:"})," Sales Amount, Quantity, Profit, Revenue, Cost"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:13,color:o.foreground,fontFamily:"Consolas",fontWeight:600},children:"Star Schema *"}),e.jsxs("div",{style:{padding:12,backgroundColor:o.background,borderRadius:2,fontFamily:"Consolas",fontSize:10,lineHeight:1.8,marginTop:8},children:[e.jsx("div",{style:{color:o.accent,marginBottom:8},children:"Fact_Sales (Center)"}),e.jsxs("div",{style:{marginLeft:20,color:o.foreground},children:["├─ Dim_Customer (customer_id, name, city, country)",e.jsx("br",{}),"├─ Dim_Product (product_id, name, category, brand)",e.jsx("br",{}),"├─ Dim_Date (date_key, date, month, year)",e.jsx("br",{}),"└─ Measures: sales_amount, quantity, profit"]})]}),e.jsxs("p",{style:{margin:"8px 0 0 0",color:o.muted,fontSize:10,lineHeight:1.5},children:[e.jsx("strong",{children:"Characteristics:"})," Simple, flat dimensions. Fast queries. Some data redundancy in dimensions."]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:13,color:o.foreground,fontFamily:"Consolas",fontWeight:600},children:"Snowflake Schema *"}),e.jsxs("div",{style:{padding:12,backgroundColor:o.background,borderRadius:2,fontFamily:"Consolas",fontSize:10,lineHeight:1.8,marginTop:8},children:[e.jsx("div",{style:{color:o.accent,marginBottom:8},children:"Fact_Sales (Center)"}),e.jsxs("div",{style:{marginLeft:20,color:o.foreground},children:["├─ Dim_Customer → Dim_City → Dim_Country",e.jsx("br",{}),"├─ Dim_Product → Dim_Category → Dim_Brand",e.jsx("br",{}),"├─ Dim_Date → Dim_Month → Dim_Quarter → Dim_Year",e.jsx("br",{}),"└─ Measures: sales_amount, quantity, profit"]})]}),e.jsxs("p",{style:{margin:"8px 0 0 0",color:o.muted,fontSize:10,lineHeight:1.5},children:[e.jsx("strong",{children:"Characteristics:"})," Normalized dimensions with hierarchies. Less storage, but more complex queries. Better for large datasets."]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,backgroundColor:o.accentLight,borderRadius:2,border:`1px solid ${o.accent}`},children:[e.jsx("strong",{style:{color:o.accent,display:"block",marginBottom:4},children:"Quick Example:"}),e.jsxs("div",{style:{color:o.foreground,fontSize:10,lineHeight:1.6},children:['"How much did we sell (Fact) by customer (Dimension) in January (Dimension)?"',e.jsx("br",{}),"The ",e.jsx("strong",{children:"Fact"})," contains the numbers (sales amount), the ",e.jsx("strong",{children:"Dimensions"})," provide the context (who, when)."]})]})]}),e.jsxs("select",{value:i.schema_type,onChange:s=>j(r=>({...r,schema_type:s.target.value})),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"STAR_SCHEMA",children:"Star Schema *"}),e.jsx("option",{value:"SNOWFLAKE_SCHEMA",children:"Snowflake Schema *"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:"Medallion Layer *"}),e.jsxs("select",{value:i.target_layer,onChange:s=>j(r=>({...r,target_layer:s.target.value})),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"BRONZE",children:"BRONZE (Raw Data)"}),e.jsx("option",{value:"SILVER",children:"SILVER (Cleaned/Validated)"}),e.jsx("option",{value:"GOLD",children:"GOLD (Business-Ready)"})]}),e.jsx("div",{style:{marginTop:6,fontSize:10,color:o.muted,fontFamily:"Consolas",lineHeight:1.4},children:"BRONZE: Raw data from source | SILVER: Cleaned & validated | GOLD: Business-ready analytics"})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:"Source DB Engine *"}),e.jsxs("select",{value:i.source_db_engine,onChange:s=>P(s.target.value),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"MariaDB",children:"MariaDB"}),e.jsx("option",{value:"MSSQL",children:"MSSQL"}),e.jsx("option",{value:"Oracle",children:"Oracle"}),e.jsx("option",{value:"MongoDB",children:"MongoDB"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,fontFamily:"Consolas",textTransform:"uppercase"},children:"Source Connection String *"}),e.jsx(b,{label:l?"Testing...":"Test Connection",onClick:re,variant:"ghost",disabled:l||!i.source_db_engine||!i.source_connection_string.trim()})]}),L&&e.jsxs("div",{style:{padding:"8px 12px",marginBottom:8,backgroundColor:L.success?o.success+"20":o.danger+"20",border:`1px solid ${L.success?o.success:o.danger}`,borderRadius:2,color:L.success?o.success:o.danger,fontSize:11,fontFamily:"Consolas"},children:[L.success?"[OK] ":"[ERR] ",L.message]}),e.jsx("textarea",{value:i.source_connection_string,onChange:s=>{j(r=>({...r,source_connection_string:s.target.value})),T(null)},rows:2,style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:"Target DB Engine *"}),e.jsxs("select",{value:i.target_db_engine,onChange:s=>se(s.target.value),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"Snowflake",children:"Snowflake"}),e.jsx("option",{value:"BigQuery",children:"BigQuery"}),e.jsx("option",{value:"Redshift",children:"Redshift"})]})]}),e.jsxs("div",{children:[J&&i.target_db_engine&&te[i.target_db_engine]&&e.jsxs("div",{style:{padding:"12px",marginBottom:8,backgroundColor:o.background,border:`1px solid ${o.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",color:o.foreground,whiteSpace:"pre-wrap",maxHeight:"200px",overflowY:"auto"},children:[e.jsxs("div",{style:{fontWeight:600,marginBottom:8,color:o.accent},children:[i.target_db_engine," Connection Format:"]}),te[i.target_db_engine]]}),e.jsx(ge,{value:i.target_connection_string,onChange:s=>{j(r=>({...r,target_connection_string:s})),f(null)},dbEngine:i.target_db_engine,label:"Target Connection String",required:!0,onTestConnection:ne,isTesting:H,testResult:$?{success:$.success,message:$.message}:null})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:"Target Schema *"}),e.jsx("input",{type:"text",value:i.target_schema,onChange:s=>{const r=s.target.value;j(n=>({...n,target_schema:r})),k(n=>n.map(m=>({...m,target_schema:r}))),y(n=>n.map(m=>({...m,target_schema:r})))},placeholder:"warehouse_schema",style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:o.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:"Schedule (Cron)"}),e.jsx("input",{type:"text",value:i.schedule_cron,onChange:s=>j(r=>({...r,schedule_cron:s.target.value})),placeholder:"Leave empty for manual execution, or enter Cron: * * * * *",style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:s=>j(r=>({...r,active:s.target.checked})),style:{width:18,height:18,cursor:"pointer"}}),e.jsx("label",{style:{fontSize:12,fontFamily:"Consolas",color:o.foreground,cursor:"pointer"},children:"Active"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:i.enabled,onChange:s=>j(r=>({...r,enabled:s.target.checked})),style:{width:18,height:18,cursor:"pointer"}}),e.jsx("label",{style:{fontSize:12,fontFamily:"Consolas",color:o.foreground,cursor:"pointer"},children:"Enabled"})]})]})]}),h==="dimensions"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,fontSize:13,fontFamily:"Consolas",color:o.foreground},children:"Dimensions"}),e.jsx(b,{label:"+ Add Dimension",onClick:ee})]}),_.length===0?e.jsxs("div",{style:{padding:40,textAlign:"center",color:o.muted},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8,fontFamily:"Consolas"},children:C.blockFull}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas"},children:"No dimensions defined"}),e.jsx("div",{style:{fontSize:11,marginTop:4},children:'Click "Add Dimension" to create one'})]}):_.map((s,r)=>e.jsxs("div",{style:{border:`1px solid ${o.border}`,borderRadius:2,padding:16,backgroundColor:o.backgroundSoft},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("h3",{style:{margin:0,fontSize:13,fontFamily:"Consolas",color:o.accent},children:["Dimension ",r+1]}),e.jsx(b,{label:"[X] Remove",onClick:()=>oe(r),variant:"ghost"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Dimension Name *"}),e.jsx("input",{type:"text",value:s.dimension_name,onChange:n=>A(r,"dimension_name",n.target.value),placeholder:"dim_customer",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Target Table *"}),e.jsx("input",{type:"text",value:s.target_table,onChange:n=>A(r,"target_table",n.target.value),placeholder:"dim_customer",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"SCD Type *"}),e.jsxs("select",{value:s.scd_type,onChange:n=>A(r,"scd_type",n.target.value),style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"TYPE_1",children:"Type 1 (Overwrite)"}),e.jsx("option",{value:"TYPE_2",children:"Type 2 (Historical)"}),e.jsx("option",{value:"TYPE_3",children:"Type 3 (Previous Value)"})]})]}),s.scd_type==="TYPE_2"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Business Keys (comma-separated) *"}),e.jsx("input",{type:"text",value:s.business_keys.join(", "),onChange:n=>A(r,"business_keys",n.target.value),placeholder:"customer_id, order_id",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Valid From Column"}),e.jsx("input",{type:"text",value:s.valid_from_column,onChange:n=>A(r,"valid_from_column",n.target.value),placeholder:"valid_from",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Valid To Column"}),e.jsx("input",{type:"text",value:s.valid_to_column,onChange:n=>A(r,"valid_to_column",n.target.value),placeholder:"valid_to",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Is Current Column"}),e.jsx("input",{type:"text",value:s.is_current_column,onChange:n=>A(r,"is_current_column",n.target.value),placeholder:"is_current",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,fontFamily:"Consolas"},children:"Source Query (SQL) *"}),e.jsx(b,{label:(p==null?void 0:p.type)==="dimension"&&(p==null?void 0:p.index)===r?"Testing...":"Test Query",onClick:()=>Y("dimension",r),variant:"ghost",disabled:(p==null?void 0:p.type)==="dimension"&&(p==null?void 0:p.index)===r||!s.source_query.trim()||!i.source_db_engine||!i.source_connection_string.trim()})]}),R[`dimension-${r}`]&&e.jsxs("div",{style:{padding:"8px 12px",marginBottom:8,backgroundColor:R[`dimension-${r}`].success?o.success+"20":o.danger+"20",border:`1px solid ${R[`dimension-${r}`].success?o.success:o.danger}`,borderRadius:2,color:R[`dimension-${r}`].success?o.success:o.danger,fontSize:11,fontFamily:"Consolas"},children:[R[`dimension-${r}`].success?"[OK] ":"[ERR] ",R[`dimension-${r}`].message]}),e.jsx("textarea",{value:s.source_query,onChange:n=>{A(r,"source_query",n.target.value);const m=`dimension-${r}`;R[m]&&O(g=>{const v={...g};return delete v[m],v})},placeholder:"SELECT * FROM source_table WHERE ...",rows:6,style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Index Columns (comma-separated, optional)"}),e.jsx("input",{type:"text",value:s.index_columns.join(", "),onChange:n=>A(r,"index_columns",n.target.value),placeholder:"customer_id, order_date",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Partition Column (optional)"}),e.jsx("input",{type:"text",value:s.partition_column,onChange:n=>A(r,"partition_column",n.target.value),placeholder:"created_date",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]})]})]},r))]}),h==="facts"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,fontSize:13,fontFamily:"Consolas",color:o.foreground},children:"Fact Tables"}),e.jsx(b,{label:"+ Add Fact Table",onClick:a})]}),S.length===0?e.jsxs("div",{style:{padding:40,textAlign:"center",color:o.muted},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8,fontFamily:"Consolas"},children:C.blockFull}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas"},children:"No fact tables defined"}),e.jsx("div",{style:{fontSize:11,marginTop:4},children:'Click "Add Fact Table" to create one'})]}):S.map((s,r)=>e.jsxs("div",{style:{border:`1px solid ${o.border}`,borderRadius:2,padding:16,backgroundColor:o.backgroundSoft},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("h3",{style:{margin:0,fontSize:13,fontFamily:"Consolas",color:o.accent},children:["Fact Table ",r+1]}),e.jsx(b,{label:"[X] Remove",onClick:()=>U(r),variant:"ghost"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Fact Name *"}),e.jsx("input",{type:"text",value:s.fact_name,onChange:n=>F(r,"fact_name",n.target.value),placeholder:"fact_sales",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Target Table *"}),e.jsx("input",{type:"text",value:s.target_table,onChange:n=>F(r,"target_table",n.target.value),placeholder:"fact_sales",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,fontFamily:"Consolas"},children:"Source Query (SQL) *"}),e.jsx(b,{label:(p==null?void 0:p.type)==="fact"&&(p==null?void 0:p.index)===r?"Testing...":"Test Query",onClick:()=>Y("fact",r),variant:"ghost",disabled:(p==null?void 0:p.type)==="fact"&&(p==null?void 0:p.index)===r||!s.source_query.trim()||!i.source_db_engine||!i.source_connection_string.trim()})]}),R[`fact-${r}`]&&e.jsxs("div",{style:{padding:"8px 12px",marginBottom:8,backgroundColor:R[`fact-${r}`].success?o.success+"20":o.danger+"20",border:`1px solid ${R[`fact-${r}`].success?o.success:o.danger}`,borderRadius:2,color:R[`fact-${r}`].success?o.success:o.danger,fontSize:11,fontFamily:"Consolas"},children:[R[`fact-${r}`].success?"[OK] ":"[ERR] ",R[`fact-${r}`].message]}),e.jsx("textarea",{value:s.source_query,onChange:n=>{F(r,"source_query",n.target.value);const m=`fact-${r}`;R[m]&&O(g=>{const v={...g};return delete v[m],v})},placeholder:"SELECT d1.dim_key, d2.dim_key, SUM(amount) as total_amount FROM ...",rows:8,style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Dimension Keys (comma-separated, optional)"}),e.jsx("input",{type:"text",value:s.dimension_keys.join(", "),onChange:n=>F(r,"dimension_keys",n.target.value),placeholder:"customer_key, product_key, date_key",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Measures (comma-separated, optional)"}),e.jsx("input",{type:"text",value:s.measures.join(", "),onChange:n=>F(r,"measures",n.target.value),placeholder:"total_amount, quantity, discount",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Index Columns (comma-separated, optional)"}),e.jsx("input",{type:"text",value:s.index_columns.join(", "),onChange:n=>F(r,"index_columns",n.target.value),placeholder:"customer_key, date_key",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:"Partition Column (optional)"}),e.jsx("input",{type:"text",value:s.partition_column,onChange:n=>F(r,"partition_column",n.target.value),placeholder:"sale_date",style:{width:"100%",padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"}})]})]})]},r))]})]})]}),e.jsxs("div",{style:{padding:"18px 24px",borderTop:`2px solid ${o.border}`,display:"flex",justifyContent:"flex-end",gap:12,backgroundColor:o.backgroundSoft},children:[e.jsx(b,{label:"Cancel",onClick:B,variant:"ghost"}),e.jsx(b,{label:z?"Saving...":t?"Update":"Create",onClick:le,disabled:z})]})]})})},pe=({warehouseName:B,currentLayer:u,onClose:t,onCleanup:I})=>{const[w,i]=c.useState(new Set),[j,_]=c.useState(!1),[k,S]=c.useState(null),y=["BRONZE","SILVER","GOLD"].filter(l=>l!==u),x=l=>{i(E=>{const L=new Set(E);return L.has(l)?L.delete(l):L.add(l),L})},d=()=>{i(new Set(y))},z=()=>{i(new Set)},D=async()=>{if(w.size===0){S("Please select at least one layer to clean up");return}const l=Array.from(w).join(", ");if(confirm(`Are you sure you want to delete the following layer schemas for "${B}"?

Layers: ${l}

This will permanently delete all data in those schemas and cannot be undone.`)){_(!0),S(null);try{await I(Array.from(w)),t()}catch(E){S(E instanceof Error?E.message:"Failed to clean up layers")}finally{_(!1)}}},h=l=>{switch(l){case"BRONZE":return"Raw Data";case"SILVER":return"Cleaned & Validated";case"GOLD":return"Business-Ready";default:return""}},W=l=>{switch(l){case"BRONZE":return o.muted;case"SILVER":return o.accent;case"GOLD":return o.success;default:return o.foreground}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:l=>{l.target===l.currentTarget&&t()},children:e.jsx("div",{style:{backgroundColor:o.background,border:`2px solid ${o.border}`,borderRadius:2,width:"90%",maxWidth:600,maxHeight:"90vh",overflowY:"auto"},onClick:l=>l.stopPropagation(),children:e.jsx(M,{title:"CLEANUP PREVIOUS LAYERS",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{fontSize:11,color:o.muted,marginBottom:8,fontFamily:"Consolas"},children:["Warehouse: ",e.jsx("strong",{style:{color:o.foreground},children:B})]}),e.jsxs("div",{style:{fontSize:11,color:o.muted,marginBottom:12,fontFamily:"Consolas"},children:["Current Layer: ",e.jsx("strong",{style:{color:W(u)},children:u})," (",h(u),")"]}),e.jsxs("div",{style:{fontSize:11,color:o.muted,fontFamily:"Consolas",lineHeight:1.5},children:["Select the layer schemas you want to delete. The current layer (",u,") cannot be deleted."]})]}),k&&e.jsxs("div",{style:{marginBottom:16,padding:"10px 12px",backgroundColor:o.danger+"20",border:`1px solid ${o.danger}`,borderRadius:2,color:o.danger,fontSize:11,fontFamily:"Consolas",wordBreak:"break-word",lineHeight:1.4},children:[e.jsx("strong",{children:"Error:"})," ",k]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:o.foreground,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Available Layers"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(b,{label:"Select All",onClick:d,variant:"ghost"}),e.jsx(b,{label:"Deselect All",onClick:z,variant:"ghost"})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:"12px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:y.map(l=>{const E=w.has(l),T=`${B.toLowerCase().replace(/\s+/g,"_")}_${l.toLowerCase()}`;return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 12px",backgroundColor:E?o.accent+"20":"transparent",border:`1px solid ${E?o.accent:o.border}`,borderRadius:2,cursor:"pointer",fontFamily:"Consolas",fontSize:12,transition:"all 0.2s"},onMouseEnter:H=>{E||(H.currentTarget.style.borderColor=o.accent)},onMouseLeave:H=>{E||(H.currentTarget.style.borderColor=o.border)},children:[e.jsx("input",{type:"checkbox",checked:E,onChange:()=>x(l),style:{width:16,height:16,cursor:"pointer",accentColor:o.accent}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontWeight:600,color:W(l),fontSize:12},children:l}),e.jsxs("span",{style:{fontSize:10,color:o.muted},children:["(",h(l),")"]})]}),e.jsxs("div",{style:{fontSize:10,color:o.muted,fontFamily:"Consolas"},children:["Schema: ",e.jsx("code",{style:{color:o.accent,backgroundColor:o.background,padding:"2px 4px",borderRadius:2},children:T})]})]})]},l)})})]}),w.size>0&&e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:o.warning+"20",border:`1px solid ${o.warning}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",color:o.foreground,lineHeight:1.5},children:[e.jsx("strong",{style:{color:o.warning},children:"Warning:"})," This action will permanently delete ",w.size," layer schema",w.size>1?"s":""," and all data within them. This cannot be undone."]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,paddingTop:12,borderTop:`1px solid ${o.border}`},children:[e.jsx(b,{label:"Cancel",onClick:t,variant:"ghost",disabled:j}),e.jsx(b,{label:j?"Cleaning...":`Delete ${w.size>0?`${w.size} `:""}Layer${w.size!==1?"s":""}`,onClick:D,disabled:j||w.size===0})]})]})})})})},ke=()=>{const{setPage:B}=ie(1,20),{filters:u,setFilter:t}=de({schema_type:"",source_db_engine:"",target_db_engine:"",active:"",enabled:""}),[I,w]=c.useState(""),[i,j]=c.useState(""),[_,k]=c.useState(null),[S,y]=c.useState([]),[x,d]=c.useState(!0),[z,D]=c.useState(!1),[h,W]=c.useState(null),[l,E]=c.useState(null),[L,T]=c.useState(!1),[H,Z]=c.useState(!1),$=c.useRef(!0),f=c.useCallback(async()=>{if(!$.current)return;const a=Date.now(),F=300;try{d(!0),k(null);const P={page:1,limit:1e4,search:ce(i,100)};u.schema_type&&(P.schema_type=u.schema_type),u.source_db_engine&&(P.source_db_engine=u.source_db_engine),u.target_db_engine&&(P.target_db_engine=u.target_db_engine),u.active&&(P.active=u.active),u.enabled&&(P.enabled=u.enabled);const se=await N.getWarehouses(P),re=Date.now()-a,Y=Math.max(0,F-re);await new Promise(ne=>setTimeout(ne,Y)),$.current&&y(se.warehouses||[])}catch(U){$.current&&k(G(U))}finally{$.current&&d(!1)}},[i,u]);c.useEffect(()=>($.current=!0,f(),()=>{$.current=!1}),[f]);const q=c.useCallback(()=>{j(I),B(1)},[I,B]),K=c.useCallback(a=>{a.key==="Enter"&&q()},[q]),p=c.useCallback(async a=>{if(confirm(`Are you sure you want to delete warehouse "${a}"?`))try{await N.deleteWarehouse(a),f()}catch(F){$.current&&k(G(F))}},[f]),V=c.useCallback(a=>{W(a||null),D(!0)},[]),R=c.useCallback(()=>{D(!1),W(null)},[]),O=c.useCallback(()=>{f(),R()},[f,R]),J=c.useCallback(async(a,F)=>{try{await N.updateActive(a,!F),f()}catch(U){$.current&&k(G(U))}},[f]),X=c.useCallback(async a=>{try{k(null),await N.buildWarehouse(a),f(),setTimeout(()=>{f()},2e3)}catch(F){$.current&&k(G(F))}},[f]),ee=c.useCallback(async a=>{E(a),k(null)},[]),A=c.useCallback(async a=>{if(l)try{k(null),await N.cleanupLayers(l.warehouse_name,a),f()}catch(F){throw $.current&&k(G(F)),F}},[l,f]),oe=S.filter(a=>!(u.schema_type&&a.schema_type!==u.schema_type||u.source_db_engine&&a.source_db_engine!==u.source_db_engine||u.target_db_engine&&a.target_db_engine!==u.target_db_engine||u.active&&String(a.active)!==u.active||u.enabled&&String(a.enabled)!==u.enabled));return x&&S.length===0?e.jsx(ue,{variant:"table"}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:o.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:o.accent,marginRight:8},children:C.blockFull}),"DATA WAREHOUSE"]}),e.jsx(b,{label:"Medallion Architecture Playbook",onClick:()=>T(!0),variant:"ghost"})]}),_&&e.jsx("div",{style:{marginBottom:20},children:e.jsx(M,{title:"ERROR",children:e.jsx("div",{style:{padding:"12px",color:o.danger,fontSize:12,fontFamily:"Consolas"},children:_})})}),e.jsx(M,{title:"SEARCH",children:e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"8px 0"},children:[e.jsx("input",{type:"text",placeholder:"Search by warehouse name, schema, or target...",value:I,onChange:a=>w(a.target.value),onKeyPress:K,style:{flex:1,padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor=o.accent},onBlur:a=>{a.currentTarget.style.borderColor=o.border}}),e.jsx(b,{label:"Search",onClick:q,variant:"primary"}),i&&e.jsx(b,{label:"Clear",onClick:()=>{w(""),j(""),B(1)},variant:"ghost"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsx(M,{title:"FILTERS",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12,padding:"8px 0"},children:[e.jsx(b,{label:"Add Warehouse",onClick:()=>V(),variant:"primary"}),e.jsxs("select",{value:u.schema_type,onChange:a=>t("schema_type",a.target.value),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor=o.accent},onBlur:a=>{a.currentTarget.style.borderColor=o.border},children:[e.jsx("option",{value:"",children:"All Schemas"}),e.jsx("option",{value:"STAR_SCHEMA",children:"Star Schema"}),e.jsx("option",{value:"SNOWFLAKE_SCHEMA",children:"Snowflake Schema"})]}),e.jsxs("select",{value:u.source_db_engine,onChange:a=>t("source_db_engine",a.target.value),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor=o.accent},onBlur:a=>{a.currentTarget.style.borderColor=o.border},children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"MariaDB",children:"MariaDB"}),e.jsx("option",{value:"MSSQL",children:"MSSQL"}),e.jsx("option",{value:"Oracle",children:"Oracle"}),e.jsx("option",{value:"MongoDB",children:"MongoDB"})]}),e.jsxs("select",{value:u.target_db_engine,onChange:a=>t("target_db_engine",a.target.value),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor=o.accent},onBlur:a=>{a.currentTarget.style.borderColor=o.border},children:[e.jsx("option",{value:"",children:"All Targets"}),e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"Snowflake",children:"Snowflake"}),e.jsx("option",{value:"BigQuery",children:"BigQuery"}),e.jsx("option",{value:"Redshift",children:"Redshift"})]}),e.jsxs("select",{value:u.active,onChange:a=>t("active",a.target.value),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor=o.accent},onBlur:a=>{a.currentTarget.style.borderColor=o.border},children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]}),e.jsxs("select",{value:u.enabled,onChange:a=>t("enabled",a.target.value),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:o.background,color:o.foreground,cursor:"pointer",outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor=o.accent},onBlur:a=>{a.currentTarget.style.borderColor=o.border},children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]})})}),x?e.jsx("div",{style:{marginTop:20},children:e.jsx(M,{title:"LOADING",children:e.jsxs("div",{style:{padding:"40px",textAlign:"center",fontSize:12,fontFamily:"Consolas",color:o.muted},children:[C.blockFull," Loading tree view..."]})})}):e.jsxs("div",{style:{marginTop:20,display:"flex",gap:20,alignItems:"stretch"},children:[e.jsx("div",{style:{flex:"0 0 400px",display:"flex",flexDirection:"column"},children:e.jsx(M,{title:"WAREHOUSE TREE",children:e.jsx("div",{style:{minHeight:300,maxHeight:800,overflowY:"auto",overflowX:"hidden",fontFamily:"Consolas",fontSize:12},children:e.jsx(me,{warehouses:oe,onWarehouseClick:ee,onWarehouseEdit:V,onWarehouseBuild:X,onWarehouseToggleActive:J,onWarehouseDelete:p})})})}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:l?e.jsxs(M,{title:`WAREHOUSE DETAILS: ${l.warehouse_name}`,children:[l.description&&e.jsx("p",{style:{margin:0,marginBottom:16,fontSize:12,color:o.muted,fontFamily:"Consolas",lineHeight:1.5},children:l.description}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16,marginBottom:20,padding:"16px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Schema Type"}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",fontWeight:500},children:l.schema_type.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Source Engine"}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",fontWeight:500},children:l.source_db_engine})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Target Engine"}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",fontWeight:500},children:l.target_db_engine})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Medallion Layer"}),e.jsxs("div",{style:{fontSize:12,fontFamily:"Consolas",fontWeight:600,color:l.target_layer==="GOLD"?o.success:l.target_layer==="SILVER"?o.accent:o.muted},children:[l.target_layer||"BRONZE",l.target_layer==="BRONZE"&&" (Raw Data)",l.target_layer==="SILVER"&&" (Cleaned & Validated)",l.target_layer==="GOLD"&&" (Business-Ready)"]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Target Schema"}),e.jsxs("div",{style:{fontSize:12,fontFamily:"Consolas",fontWeight:500},children:[l.target_schema,l.target_layer&&e.jsxs("span",{style:{fontSize:10,color:o.muted,marginLeft:8},children:["(Layer: ",l.target_layer.toLowerCase(),")"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Build Status"}),e.jsxs("div",{style:{fontSize:12,fontFamily:"Consolas",fontWeight:500,color:l.last_build_status==="SUCCESS"?o.success:l.last_build_status==="ERROR"?o.danger:o.muted,display:"flex",alignItems:"center",gap:6},children:[l.last_build_status==="SUCCESS"&&e.jsx("span",{children:"✓"}),l.last_build_status==="ERROR"&&e.jsx("span",{children:"✗"}),e.jsx("span",{children:l.last_build_status||"Never built"})]}),l.last_build_status==="ERROR"&&l.notes&&e.jsxs("div",{style:{marginTop:8,padding:"10px 12px",backgroundColor:o.danger+"20",border:`1px solid ${o.danger}`,borderRadius:2,color:o.danger,fontSize:11,fontFamily:"Consolas",wordBreak:"break-word",lineHeight:1.4},children:[e.jsx("strong",{children:"Error:"})," ",l.notes]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Last Build"}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",fontWeight:500},children:l.last_build_time?new Date(l.last_build_time).toLocaleString():"N/A"})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,padding:"12px 16px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Dimensions"}),e.jsx("div",{style:{fontSize:18,fontFamily:"Consolas",fontWeight:600,color:o.accent},children:l.dimensions.length})]}),e.jsx("div",{style:{width:1,backgroundColor:o.border}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,color:o.muted,marginBottom:4,fontFamily:"Consolas",textTransform:"uppercase",letterSpacing:.5},children:"Facts"}),e.jsx("div",{style:{fontSize:18,fontFamily:"Consolas",fontWeight:600,color:o.accent},children:l.facts.length})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx(b,{label:"▶ Build Now",onClick:()=>X(l.warehouse_name)}),e.jsx(b,{label:"✎ Edit",onClick:()=>V(l),variant:"ghost"}),(l.target_layer==="SILVER"||l.target_layer==="GOLD")&&e.jsx(b,{label:"🗑️ Cleanup Layers",onClick:()=>Z(!0),variant:"ghost"})]})]}):e.jsx(M,{title:"WAREHOUSE DETAILS",children:e.jsxs("div",{style:{padding:60,textAlign:"center",color:o.muted,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:300,fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5},children:C.blockFull}),e.jsx("div",{style:{fontSize:13,fontFamily:"Consolas",marginBottom:8,color:o.foreground,fontWeight:600},children:"No warehouse selected"}),e.jsx("div",{style:{fontSize:12,color:o.muted,fontFamily:"Consolas",opacity:.7},children:"Click on a warehouse from the list to see its configuration and build history"})]})})})]}),z&&e.jsx(he,{onClose:R,onSave:O,initialData:h}),H&&l&&e.jsx(pe,{warehouseName:l.warehouse_name,currentLayer:l.target_layer||"BRONZE",onClose:()=>Z(!1),onCleanup:A}),L&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>T(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:a=>a.stopPropagation(),children:e.jsx(M,{title:"MEDALLION ARCHITECTURE PLAYBOOK",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[C.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:o.foreground,marginLeft:16},children:"The Medallion Architecture organizes data into three layers (Bronze, Silver, Gold) based on quality and transformation levels. Data flows automatically through these layers, with each layer applying progressively more sophisticated processing and validation."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[C.blockFull," MEDALLION LAYERS"]}),e.jsxs("div",{style:{color:o.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12,padding:"12px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:o.muted,marginBottom:6,fontSize:11},children:"BRONZE (Raw Data)"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:["• ",e.jsx("strong",{children:"Function:"})," Copy data exactly as it appears in the source",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Schema:"})," ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_bronze"}),e.jsx("br",{}),"• ",e.jsx("strong",{children:"Processing:"})," Minimal - direct extraction from source_query",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Example:"})," ",e.jsx("code",{style:{color:o.muted},children:"SELECT * FROM source"})," → ",e.jsx("code",{style:{color:o.muted},children:"INSERT INTO bronze.table"})]})]}),e.jsxs("div",{style:{marginBottom:12,padding:"12px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:o.accent,marginBottom:6,fontSize:11},children:"SILVER (Cleaned & Validated)"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:["• ",e.jsx("strong",{children:"Function:"})," Clean and validate data from Bronze layer",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Schema:"})," ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_silver"}),e.jsx("br",{}),"• ",e.jsx("strong",{children:"Processing:"})," Deduplication, trimming, data quality validation (quality_score ≥ 70)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Example:"})," ",e.jsx("code",{style:{color:o.muted},children:"SELECT cleaned FROM bronze.table"})," → ",e.jsx("code",{style:{color:o.muted},children:"INSERT INTO silver.table"})]})]}),e.jsxs("div",{style:{marginBottom:12,padding:"12px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:o.success,marginBottom:6,fontSize:11},children:"GOLD (Business-Ready)"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:["• ",e.jsx("strong",{children:"Function:"})," Transform data into business-ready analytical models",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Schema:"})," ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_gold"}),e.jsx("br",{}),"• ",e.jsx("strong",{children:"Processing:"})," Star/Snowflake schema construction, SCD Type 1/2/3, dimension and fact tables",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Example:"})," ",e.jsx("code",{style:{color:o.muted},children:"SELECT transformed FROM silver.table"})," → ",e.jsx("code",{style:{color:o.muted},children:"INSERT INTO gold.dim_customer, gold.fact_sales"})]})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[C.blockFull," AUTOMATED PROMOTION FLOW"]}),e.jsxs("div",{style:{color:o.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:o.muted,marginBottom:8,fontSize:11},children:"1. CREATE WAREHOUSE (BRONZE)"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.6,marginLeft:8},children:[e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," User creates warehouse with ",e.jsx("code",{style:{color:o.accent},children:"target_layer = 'BRONZE'"})]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," ",e.jsx("code",{style:{color:o.accent},children:"buildWarehouse()"})," → ",e.jsx("code",{style:{color:o.accent},children:"buildBronzeLayer()"})]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," Data is copied raw from ",e.jsx("code",{style:{color:o.accent},children:"source_query"})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," Saved to schema: ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_bronze"})]})]})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:o.accent,marginBottom:8,fontSize:11},children:"2. AUTOMATIC PROMOTION BRONZE → SILVER (every 60 sec)"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.6,marginLeft:8},children:[e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," ",e.jsx("code",{style:{color:o.accent},children:"warehouseBuilderThread"})," checks warehouses in BRONZE"]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," If ",e.jsx("code",{style:{color:o.accent},children:"last_build_status = 'SUCCESS'"}),":"]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," ",e.jsx("code",{style:{color:o.accent},children:"validateDataQuality()"})," checks quality ≥ 70"]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," If passes: ",e.jsx("code",{style:{color:o.accent},children:"promoteToSilver()"})]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," ",e.jsx("code",{style:{color:o.accent},children:"buildWarehouse()"})," → ",e.jsx("code",{style:{color:o.accent},children:"buildSilverLayer()"})]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," Reads from ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_bronze"})]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," Cleans data (trim, deduplicate)"]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," Validates quality"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," Saves to schema: ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_silver"})]})]})]}),e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsx("div",{style:{fontWeight:600,color:o.success,marginBottom:8,fontSize:11},children:"3. AUTOMATIC PROMOTION SILVER → GOLD (every 60 sec)"}),e.jsxs("div",{style:{fontSize:11,lineHeight:1.6,marginLeft:8},children:[e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," ",e.jsx("code",{style:{color:o.accent},children:"warehouseBuilderThread"})," checks warehouses in SILVER"]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," If ",e.jsx("code",{style:{color:o.accent},children:"last_build_status = 'SUCCESS'"}),":"]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," ",e.jsx("code",{style:{color:o.accent},children:"promoteToGold()"})]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," ",e.jsx("code",{style:{color:o.accent},children:"buildWarehouse()"})," → ",e.jsx("code",{style:{color:o.accent},children:"buildGoldLayer()"})]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," Reads from ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_silver"})]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," Applies transformations (Star/Snowflake Schema)"]}),e.jsxs("div",{style:{marginBottom:4,marginLeft:16},children:[e.jsx("span",{style:{color:o.muted},children:"├─"})," Builds dimensions and facts with SCD"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:o.muted},children:"└─"})," Saves to schema: ",e.jsx("code",{style:{color:o.accent},children:"{warehouse_name}_gold"})]})]})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[C.blockFull," KEY FEATURES"]}),e.jsxs("div",{style:{color:o.foreground,marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.success},children:C.blockFull})," ",e.jsx("strong",{children:"Automatic Promotion:"})," System checks and promotes warehouses every 60 seconds"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.success},children:C.blockFull})," ",e.jsx("strong",{children:"Quality Gates:"})," BRONZE → SILVER requires quality_score ≥ 70"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.success},children:C.blockFull})," ",e.jsx("strong",{children:"Separate Schemas:"})," Each layer has its own schema to prevent conflicts"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.success},children:C.blockFull})," ",e.jsx("strong",{children:"Sequential Flow:"})," Data must flow BRONZE → SILVER → GOLD (cannot skip layers)"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.success},children:C.blockFull})," ",e.jsx("strong",{children:"Historical Preservation:"})," Each layer maintains its own data snapshot"]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:o.muted,marginBottom:4},children:[C.blockSemi," Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:o.foreground,lineHeight:1.6},children:["• Start with BRONZE layer to capture raw data without transformation",e.jsx("br",{}),"• Monitor data quality scores to ensure successful promotion to SILVER",e.jsx("br",{}),"• Use SILVER layer for data cleaning and validation before business transformations",e.jsx("br",{}),"• Design GOLD layer schemas (Star/Snowflake) based on your analytical requirements",e.jsx("br",{}),"• Each layer serves a specific purpose - don't skip layers in the flow",e.jsx("br",{}),"• Monitor promotion status in the warehouse details panel",e.jsx("br",{}),"• Use separate schemas per layer to maintain data lineage and auditability"]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(b,{label:"Close",onClick:()=>T(!1),variant:"ghost"})})]})})})})]})};export{ke as default};
