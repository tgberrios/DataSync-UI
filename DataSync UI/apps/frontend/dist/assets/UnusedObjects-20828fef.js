import{r,l as c,j as e,t as s,b as n}from"./index-f6ac47b8.js";import{A as _}from"./AsciiPanel-5614714e.js";import{A as k}from"./AsciiButton-4907e65e.js";import{e as f}from"./errorHandler-5ea9ae85.js";import{S as v}from"./SkeletonLoader-792007e7.js";const B=()=>{const[R,x]=r.useState([]),[d,g]=r.useState(null),[y,p]=r.useState(!0),[m,o]=r.useState(null),[h,u]=r.useState(!1),[l,b]=r.useState(90),a=r.useCallback(async()=>{try{p(!0),o(null);const t=await c.getUnusedObjectsReports({});x(t.reports||t||[]),t.reports&&t.reports.length>0&&g(t.reports[0])}catch(t){o(f(t))}finally{p(!1)}},[]);r.useEffect(()=>{a()},[a]);const j=r.useCallback(async()=>{try{u(!0),o(null);const t=await c.detectUnusedObjects({days_threshold:l});if(t.success&&(await a(),t.report_id)){const i=await c.getUnusedObjectsReport(t.report_id);g(i.report||i)}}catch(t){o(f(t))}finally{u(!1)}},[l,a]),S=t=>new Date(t).toLocaleString();return e.jsx("div",{style:{padding:s.spacing.lg},children:e.jsx(_,{children:e.jsxs("div",{style:{marginBottom:s.spacing.lg},children:[e.jsx("h1",{style:{fontSize:18,fontWeight:600,color:n.foreground,marginBottom:s.spacing.md},children:"Unused Objects Detector"}),e.jsx("p",{style:{color:n.muted,fontSize:12,marginBottom:s.spacing.lg},children:"Detect and report unused database objects"}),e.jsxs("div",{style:{display:"flex",gap:s.spacing.md,marginBottom:s.spacing.lg,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("label",{style:{color:n.foreground,fontFamily:"Consolas, monospace",fontSize:12},children:["Days Threshold:",e.jsx("input",{type:"number",value:l,onChange:t=>b(parseInt(t.target.value)||90),min:1,style:{marginLeft:s.spacing.sm,padding:`${s.spacing.xs} ${s.spacing.sm}`,border:`1px solid ${n.border}`,background:n.background,color:n.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2,width:80}})]}),e.jsx(k,{onClick:j,label:h?"Detecting...":"Detect Unused Objects",disabled:h})]}),m&&e.jsxs("div",{style:{padding:s.spacing.md,background:n.error,color:"#ffffff",marginBottom:s.spacing.md,borderRadius:2,fontFamily:"Consolas, monospace",fontSize:12},children:["Error: ",m]}),y?e.jsx(v,{}):d?e.jsxs("div",{children:[e.jsx("div",{style:{padding:s.spacing.md,background:n.backgroundSoft,border:`1px solid ${n.border}`,borderRadius:2,marginBottom:s.spacing.md},children:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:600,marginBottom:s.spacing.xs},children:["Report #",d.report_id]}),e.jsxs("div",{style:{fontSize:11,color:n.muted},children:["Generated: ",S(d.generated_at)," | Threshold: ",d.days_threshold," days | Total: ",d.total_unused_count," objects"]})]})})}),e.jsx("div",{style:{border:`1px solid ${n.border}`,borderRadius:2,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Consolas, monospace",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:n.backgroundSoft,borderBottom:`2px solid ${n.border}`},children:[e.jsx("th",{style:{padding:s.spacing.md,textAlign:"left",fontWeight:600},children:"Object"}),e.jsx("th",{style:{padding:s.spacing.md,textAlign:"left",fontWeight:600},children:"Type"}),e.jsx("th",{style:{padding:s.spacing.md,textAlign:"left",fontWeight:600},children:"Days Unused"}),e.jsx("th",{style:{padding:s.spacing.md,textAlign:"left",fontWeight:600},children:"Dependencies"}),e.jsx("th",{style:{padding:s.spacing.md,textAlign:"left",fontWeight:600},children:"Recommendations"})]})}),e.jsx("tbody",{children:d.unused_objects.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{padding:s.spacing.lg,textAlign:"center",color:n.muted},children:"No unused objects found"})}):d.unused_objects.map((t,i)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${n.border}`,background:i%2===0?n.background:n.backgroundSoft},children:[e.jsxs("td",{style:{padding:s.spacing.md},children:[t.schema_name,".",t.object_name]}),e.jsx("td",{style:{padding:s.spacing.md},children:e.jsx("span",{style:{padding:`${s.spacing.xs} ${s.spacing.sm}`,background:n.muted,color:"#ffffff",borderRadius:2,fontSize:11},children:t.object_type})}),e.jsx("td",{style:{padding:s.spacing.md},children:t.days_since_last_access}),e.jsx("td",{style:{padding:s.spacing.md,color:n.muted},children:t.dependencies.length>0?t.dependencies.length:"None"}),e.jsx("td",{style:{padding:s.spacing.md,fontSize:11,color:n.muted},children:t.recommendations.length>0?t.recommendations[0]:"No recommendations"})]},`${t.schema_name}.${t.object_name}`))})]})})]}):e.jsx("div",{style:{padding:s.spacing.lg,textAlign:"center",color:n.muted,border:`1px solid ${n.border}`,borderRadius:2},children:'No reports available. Click "Detect Unused Objects" to generate a new report.'})]})})})};export{B as default};
