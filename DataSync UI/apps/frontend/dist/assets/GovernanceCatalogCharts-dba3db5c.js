import{r as x,j as e,b as t,e as p,W as E,T as I,U as X}from"./index-f6ac47b8.js";import{e as se}from"./errorHandler-5ea9ae85.js";import{A as Y}from"./AsciiPanel-5614714e.js";import{A as oe}from"./AsciiButton-4907e65e.js";const re=({data:u,color:c,height:k=4,width:L=30,labels:j})=>{const[v,_]=x.useState(null),[M,B]=x.useState(null),F=x.useRef(null);if(!u||u.length===0)return e.jsx("span",{style:{color:t.muted},children:p.dot.repeat(L)});const o=u.slice(-L),R=j?j.slice(-L):[],g=Math.min(...o),z=Math.max(...o)-g||1,S=["▁","▂","▃","▄","▅","▆","▇","█"],$=C=>{if(z===0)return S[0];const d=(C-g)/z,y=Math.floor(d*(S.length-1));return S[Math.max(0,Math.min(S.length-1,y))]},T=(C,d)=>{if(F.current){const y=F.current.getBoundingClientRect();B({x:C.clientX-y.left,y:C.clientY-y.top-30}),_(d)}},O=()=>{_(null),B(null)};return e.jsxs("div",{ref:F,style:{position:"relative",display:"inline-block"},onMouseLeave:O,children:[e.jsx("span",{style:{color:c,fontFamily:"Consolas",fontSize:11,letterSpacing:0,lineHeight:1,display:"inline-block"},children:o.map((C,d)=>e.jsx("span",{onMouseMove:y=>T(y,d),style:{cursor:"pointer",transition:"all 0.2s ease",transform:v===d?"scale(1.2)":"scale(1)",display:"inline-block",position:"relative"},children:$(C)},d))}),v!==null&&M&&e.jsxs("div",{style:{position:"absolute",left:`${M.x}px`,top:`${M.y}px`,transform:"translateX(-50%)",backgroundColor:t.background,border:`1px solid ${t.border}`,borderRadius:2,padding:"6px 10px",fontSize:10,fontFamily:"Consolas",color:t.foreground,whiteSpace:"nowrap",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",pointerEvents:"none",animation:"fadeInUp 0.15s ease-out",transition:"opacity 0.15s ease, transform 0.15s ease"},children:[e.jsx("div",{style:{color:t.accent,fontWeight:600,marginBottom:2},children:o[v].toFixed(2)}),R[v]&&e.jsx("div",{style:{color:t.muted,fontSize:9},children:new Date(R[v]).toLocaleTimeString()})]})]})},de=({engine:u,selectedItem:c})=>{const[k,L]=x.useState(30),[j,v]=x.useState(!1),[_,M]=x.useState(null),[B,F]=x.useState([]),[o,R]=x.useState(null),g=x.useRef(null),q=()=>{switch(u){case"oracle":return E.getOracleHistory;case"mongodb":return X.getMongoDBHistory;case"mssql":return I.getMSSQLHistory;case"mariadb":return I.getMariaDBHistory;default:return E.getOracleHistory}},z=()=>{switch(u){case"oracle":return E.getOracleStats;case"mongodb":return X.getMongoDBStats;case"mssql":return I.getMSSQLStats;case"mariadb":return I.getMariaDBStats;default:return E.getOracleStats}},S=x.useCallback(async()=>{var m,i,n,r;g.current&&g.current.abort(),g.current=new AbortController;const s=g.current;v(!0),M(null);try{const a=q(),h=z(),l={days:k,limit:1e4};c&&(c.server_name&&(l.server_name=c.server_name),c.schema_name&&(l.schema_name=c.schema_name),c.table_name&&(l.table_name=c.table_name),c.database_name&&(l.database_name=c.database_name),c.collection_name&&(l.collection_name=c.collection_name));const[w,b]=await Promise.all([a(l,s.signal),h({days:k,server_name:c==null?void 0:c.server_name},s.signal)]);!s.signal.aborted&&g.current===s&&(F(((m=w.data)==null?void 0:m.data)||[]),R(b))}catch(a){const h=a.name==="CanceledError"||a.name==="AbortError"||((i=a.message)==null?void 0:i.includes("canceled"))||((n=a.message)==null?void 0:n.includes("aborted"))||((r=a.message)==null?void 0:r.includes("Request cancelled"));if(!h&&g.current===s){const l=se(a);M(l),console.error("Error fetching governance catalog charts data:",a)}else if(h)return}finally{g.current===s&&v(!1)}},[k,c,u]);x.useEffect(()=>(S(),()=>{g.current&&g.current.abort()}),[k,c,u]);const $=()=>{if(!B.length)return null;const s=[...B].sort((i,n)=>new Date(i.snapshot_date).getTime()-new Date(n.snapshot_date).getTime());let m;if(c)m=s;else{const i=new Map;s.forEach(n=>{const r=new Date(n.snapshot_date).toISOString();i.has(r)||i.set(r,{health_score:0,total_size_mb:0,row_count:0,fragmentation_pct:0,count:0,timestamp:r});const a=i.get(r);a.health_score+=Number(n.health_score)||0,a.total_size_mb+=Number(n.total_size_mb||n.table_size_mb||n.storage_size_mb||0)||0,a.row_count+=Number(n.row_count||n.document_count||0)||0,a.fragmentation_pct+=Number(n.fragmentation_pct||0)||0,a.count+=1}),m=Array.from(i.values()).map(n=>({snapshot_date:n.timestamp,health_score:n.count>0?n.health_score/n.count:0,total_size_mb:n.total_size_mb,row_count:n.row_count,fragmentation_pct:n.count>0?n.fragmentation_pct/n.count:0})).sort((n,r)=>new Date(n.snapshot_date).getTime()-new Date(r.snapshot_date).getTime())}return m},T=(s,m,i,n,r,a,h,l)=>{const w=n.length>0&&Number(n[n.length-1])||0,b=Number(m)||w||0,G=n.length>1,ee=G?Math.min(...n.map(f=>Number(f)||0)):0,V=G?Math.max(...n.map(f=>Number(f)||0)):0,Q=h||(V>0?V:100),te=Q>0?b/Q*100:0,ne=Math.min(100,Math.max(0,te));return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:"12px",backgroundColor:t.background,borderRadius:2,border:`1px solid ${t.border}`,transition:"all 0.2s ease"},onMouseEnter:f=>{f.currentTarget.style.borderColor=r,f.currentTarget.style.backgroundColor=t.backgroundSoft},onMouseLeave:f=>{f.currentTarget.style.borderColor=t.border,f.currentTarget.style.backgroundColor=t.background},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsxs("div",{style:{fontSize:11,color:t.accent,fontWeight:500,display:"flex",alignItems:"center",gap:6,fontFamily:"Consolas"},children:[e.jsx("span",{children:a}),e.jsx("span",{children:s})]}),e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:r,fontFamily:"Consolas"},children:[typeof b=="number"?b.toFixed(1):Number(b||0).toFixed(1),i]})]}),e.jsx("div",{style:{width:"100%",height:6,backgroundColor:t.backgroundSoft,borderRadius:1,overflow:"hidden",border:`1px solid ${t.border}`},children:e.jsx("div",{style:{width:`${ne}%`,height:"100%",backgroundColor:r,transition:"width 0.3s ease",borderRadius:1}})}),e.jsx(re,{data:n,color:r,width:40,labels:l}),G&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:t.muted,marginTop:2,fontFamily:"Consolas"},children:[e.jsxs("span",{children:["Min: ",ee.toFixed(1),i]}),e.jsxs("span",{children:["Max: ",V.toFixed(1),i]})]})]})},O=()=>o!=null&&o.summary?{labels:["HEALTHY","WARNING","CRITICAL"],datasets:[{data:[parseInt(o.summary.healthy_count||0),parseInt(o.summary.warning_count||0),parseInt(o.summary.critical_count||0)],backgroundColor:[t.success+"80",t.warning+"80",t.danger+"80"],borderColor:[t.success,t.warning,t.danger],borderWidth:2}]}:null,C=()=>!(o!=null&&o.byServer)||!o.byServer.length?null:{labels:o.byServer.map(s=>s.server_name||"Unknown"),datasets:[{label:u==="mongodb"?"Collections":"Tables",data:o.byServer.map(s=>parseInt(s.table_count||s.collection_count||s.object_count||0)),backgroundColor:[t.accent+"80",t.success+"80",t.warning+"80",t.danger+"80","#9b59b680"],borderColor:[t.accent,t.success,t.warning,t.danger,"#9b59b6"],borderWidth:2}]},d=$(),y=O(),J=C(),N=d?d.map(s=>Number(s.health_score)||0):[],W=d?d.map(s=>s.snapshot_date):[],D=d?d.map(s=>Number(s.total_size_mb)||0):[],A=d?d.map(s=>Number(s.row_count)||0):[],H=d?d.map(s=>Number(s.fragmentation_pct)||0):[],P=N.length>0&&Number(N[N.length-1])||0,K=D.length>0&&Number(D[D.length-1])||0,Z=A.length>0&&Number(A[A.length-1])||0,U=H.length>0&&Number(H[H.length-1])||0;return e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{color:t.muted,fontSize:11},children:"Time Range:"}),e.jsxs("select",{value:k,onChange:s=>L(Number(s.target.value)),style:{padding:"4px 8px",border:`1px solid ${t.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:11,backgroundColor:t.background,color:t.foreground},children:[e.jsx("option",{value:1,children:"Last 24 hours"}),e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"}),e.jsx("option",{value:180,children:"Last 6 months"}),e.jsx("option",{value:240,children:"Last 8 months"})]})]}),e.jsx(oe,{label:"Refresh",onClick:S,variant:"ghost",disabled:j})]}),_&&e.jsx(Y,{title:"ERROR",children:e.jsx("div",{style:{padding:"12px",color:t.danger,fontSize:11,fontFamily:"Consolas"},children:_})}),j&&e.jsx("div",{style:{padding:20,textAlign:"center",color:t.muted},children:"Loading charts..."}),!j&&!_&&d&&e.jsxs("div",{style:{border:`1px solid ${t.border}`,borderRadius:2,padding:16,backgroundColor:t.backgroundSoft,marginBottom:16},children:[e.jsxs("h2",{style:{fontSize:14,fontFamily:"Consolas",fontWeight:600,color:t.accent,margin:0,marginBottom:16,paddingBottom:8,borderBottom:`1px solid ${t.border}`},children:[p.blockFull," ",u.toUpperCase()," GOVERNANCE METRICS"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[T("Health Score",P,"%",N,P>=90?t.success:P>=70?t.warning:t.danger,p.blockFull,100,W),T(u==="mongodb"?"Storage Size":"Table Size",K," MB",D,t.accent,p.blockSemi,void 0,W),T(u==="mongodb"?"Documents":"Total Rows",Z,"",A,t.success,p.blockLight,void 0,W),T("Fragmentation",U,"%",H,U>30?t.danger:U>10?t.warning:t.success,p.dot,100,W)]})]}),!j&&!_&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[y&&(()=>{const s=y.datasets[0].data.reduce((w,b)=>w+b,0),m=y.datasets[0].data[0]||0,i=y.datasets[0].data[1]||0,n=y.datasets[0].data[2]||0,r=s>0?m/s*100:0,a=s>0?i/s*100:0,h=s>0?n/s*100:0,l=40;return e.jsx(Y,{title:"HEALTH DISTRIBUTION",children:e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:11,padding:"12px",lineHeight:1.8},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"├─ HEALTHY:"}),e.jsxs("span",{style:{color:t.success,fontWeight:600},children:[m," (",r.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.success},children:[p.blockFull.repeat(Math.round(r/100*l)),p.blockLight.repeat(l-Math.round(r/100*l))]})})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"├─ WARNING:"}),e.jsxs("span",{style:{color:t.warning,fontWeight:600},children:[i," (",a.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.warning},children:[p.blockFull.repeat(Math.round(a/100*l)),p.blockLight.repeat(l-Math.round(a/100*l))]})})]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─ CRITICAL:"}),e.jsxs("span",{style:{color:t.danger,fontWeight:600},children:[n," (",h.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.danger},children:[p.blockFull.repeat(Math.round(h/100*l)),p.blockLight.repeat(l-Math.round(h/100*l))]})})]}),e.jsxs("div",{style:{marginTop:16,paddingTop:12,borderTop:`1px solid ${t.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:t.muted,fontSize:10},children:"Total:"}),e.jsxs("span",{style:{color:t.foreground,fontWeight:600,fontSize:10},children:[s," ",u==="mongodb"?"collections":"tables"]})]})]})})})(),J&&(o==null?void 0:o.byServer)&&(()=>{const s=o.byServer,m=s.reduce((n,r)=>n+parseInt(r.table_count||r.collection_count||r.object_count||0),0),i=40;return e.jsx(Y,{title:"SERVER DISTRIBUTION",children:e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:11,padding:"12px",lineHeight:1.8},children:[s.map((n,r)=>{const a=parseInt(n.table_count||n.collection_count||n.object_count||0),h=m>0?a/m*100:0,l=r===s.length-1,w=l?"└─":"├─",b=n.server_name||"Unknown";return e.jsxs("div",{style:{marginBottom:l?4:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsxs("span",{style:{color:t.muted},children:[w," ",b,":"]}),e.jsxs("span",{style:{color:t.accent,fontWeight:600},children:[a," (",h.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.accent},children:[p.blockFull.repeat(Math.round(h/100*i)),p.blockLight.repeat(i-Math.round(h/100*i))]})})]},r)}),e.jsxs("div",{style:{marginTop:16,paddingTop:12,borderTop:`1px solid ${t.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:t.muted,fontSize:10},children:"Total:"}),e.jsxs("span",{style:{color:t.foreground,fontWeight:600,fontSize:10},children:[m," ",u==="mongodb"?"collections":"tables"]})]})]})})})()]}),!j&&!_&&(o==null?void 0:o.summary)&&e.jsxs("div",{style:{border:`1px solid ${t.border}`,borderRadius:2,padding:16,backgroundColor:t.backgroundSoft,marginBottom:16},children:[e.jsxs("h2",{style:{fontSize:14,fontFamily:"Consolas",fontWeight:600,color:t.accent,margin:0,marginBottom:16,paddingBottom:8,borderBottom:`1px solid ${t.border}`},children:[p.blockFull," ",u.toUpperCase()," GOVERNANCE SUMMARY"]}),e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:11,lineHeight:1.8,color:t.foreground},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsxs("span",{style:{color:t.muted},children:["├─ Total ",u==="mongodb"?"Collections":"Tables",":"]}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px"},children:o.summary.total_tables||o.summary.total_collections||o.summary.total_objects||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Healthy:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px",color:t.success},children:o.summary.healthy_count||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Warning:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px",color:t.warning},children:o.summary.warning_count||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Critical:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px",color:t.danger},children:o.summary.critical_count||0})]}),o.summary.avg_health_score&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Avg Health Score:"}),e.jsxs("span",{style:{fontWeight:500,marginLeft:"20px",color:parseFloat(o.summary.avg_health_score||0)>=90?t.success:parseFloat(o.summary.avg_health_score||0)>=70?t.warning:t.danger},children:[parseFloat(o.summary.avg_health_score||0).toFixed(2),"%"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Total Size:"}),e.jsxs("span",{style:{fontWeight:500,marginLeft:"20px"},children:[(parseFloat(o.summary.total_size_mb||0)/1024).toFixed(2)," GB"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Servers:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px"},children:o.summary.server_count||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("span",{style:{color:t.muted},children:["└─ ",u==="mongodb"?"Databases":"Schemas",":"]}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px"},children:o.summary.database_count||o.summary.schema_count||0})]})]})]})]})};export{de as G};
