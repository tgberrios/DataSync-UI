import{m as q,f as j,b as e,r as a,j as o,e as m,D as E,l as co,P as fo,n as X}from"./index-75d7470b.js";import{u as mo}from"./usePagination-b946ac42.js";import{u as go}from"./useTableFilters-0b8dd77f.js";import{e as ho}from"./errorHandler-5ea9ae85.js";import{s as uo}from"./validation-24839588.js";import{A as x}from"./AsciiPanel-9f053981.js";import{A as v}from"./AsciiButton-446d8430.js";import{G as xo}from"./GovernanceCatalogCharts-9ed6ee71.js";import{S as yo}from"./SkeletonLoader-530eacc4.js";const po=q`
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,J=j.div`
  font-family: Consolas;
  font-size: 12px;
  background: ${e.background};
  border: 1px solid ${e.border};
  border-radius: 2px;
  padding: 16px;
  max-height: 800px;
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
  
  &::-webkit-scrollbar {
    width: 8px;
  }
  
  &::-webkit-scrollbar-track {
    background: ${e.backgroundSoft};
    border-radius: 2px;
  }
  
  &::-webkit-scrollbar-thumb {
    background: ${e.border};
    border-radius: 2px;
    transition: background 0.2s ease;
    
    &:hover {
      background: ${e.accent};
    }
  }
`,vo=j.div`
  user-select: none;
  animation: ${po} 0.3s ease-out;
  margin-bottom: 2px;
`,jo=j.span`
  color: ${e.muted};
  margin-right: 6px;
  font-family: Consolas;
  font-size: 12px;
  transition: color 0.2s ease;
`,bo=j.div`
  display: flex;
  align-items: center;
  padding: ${r=>r.$level===0?"8px":"6px 8px"};
  padding-left: ${r=>r.$level*24+8}px;
  cursor: pointer;
  border-radius: 2px;
  transition: all 0.2s ease;
  position: relative;
  margin: 2px 0;
  font-family: Consolas;
  font-size: 12px;
  
  background: transparent;
  
  ${r=>r.$nodeType==="schema"?`
        border: 1px solid transparent;
        border-left: 3px solid ${e.accent};
        font-weight: 600;
        
        &:hover {
          background: ${e.backgroundSoft};
          border-color: ${e.accent};
          transform: translateX(4px);
        }
      `:`
      &:hover {
        background: ${e.backgroundSoft};
        transform: translateX(4px);
      }
    `}
`,Co=j.div`
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
  border-radius: 2px;
  background: ${r=>r.$isExpanded?e.accent:e.backgroundSoft};
  color: ${r=>r.$isExpanded?"#ffffff":e.accent};
  font-size: 10px;
  font-weight: bold;
  font-family: Consolas;
  transition: all 0.2s ease;
  flex-shrink: 0;
  
  &:hover {
    transform: scale(1.1);
  }
`,So=j.span`
  flex: 1;
  font-family: Consolas;
  font-size: ${r=>r.$isSchema?"13px":"12px"};
  color: ${r=>r.$isSchema?e.accent:e.foreground};
  font-weight: ${r=>r.$isSchema?600:500};
  margin-right: 8px;
`,_o=j.span`
  padding: 2px 8px;
  border-radius: 2px;
  font-size: 11px;
  font-weight: 500;
  font-family: Consolas;
  background: ${e.backgroundSoft};
  color: ${e.foreground};
  border: 1px solid ${e.border};
  margin-left: auto;
  transition: all 0.2s ease;
  
  &:hover {
    background: ${e.accentLight};
    border-color: ${e.accent};
    color: ${e.accent};
    transform: translateY(-1px);
  }
`,zo=j.div`
  max-height: ${r=>r.$isExpanded?"10000px":"0"};
  overflow: hidden;
  transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
`,Fo=j.div`
  padding: 8px;
  padding-left: ${r=>(r.$level||0)*24+36}px;
  margin: 2px 0;
  border-radius: 2px;
  background: ${e.background};
  border: 1px solid ${e.border};
  transition: all 0.2s ease;
  cursor: pointer;
  font-family: Consolas;
  font-size: 12px;
  
  &:hover {
    background: ${e.backgroundSoft};
    border-color: ${e.accent};
    transform: translateX(4px);
  }
`,A=r=>{if(!r)return e.muted;switch(r){case"HEALTHY":case"EXCELLENT":return e.success;case"WARNING":return e.warning;case"CRITICAL":return e.danger;case"REAL_TIME":case"HIGH":return e.accent;case"MEDIUM":return e.accentSoft;case"LOW":case"RARE":return e.muted;default:return e.muted}},Bo=({items:r,onItemClick:_})=>{const[b,L]=a.useState(new Set),l=a.useMemo(()=>{const t=new Map;return r.forEach(i=>{const s=i.schema_name||"default";t.has(s)||t.set(s,{name:s,objects:[]}),t.get(s).objects.push(i)}),Array.from(t.values()).sort((i,s)=>i.name.localeCompare(s.name))},[r]),N=t=>{L(i=>{const s=new Set(i);return s.has(t)?s.delete(t):s.add(t),s})},$=(t,i)=>{if(t===0)return null;const s=[];for(let C=0;C<t-1;C++)s.push("│  ");return s.push(i?"└─ ":"├─ "),o.jsx(jo,{$isLast:i,children:s.join("")})},W=t=>{if(t==null)return"N/A";const i=Number(t);return isNaN(i)?"N/A":i.toLocaleString()},T=t=>{if(t==null)return"N/A";const i=Number(t);return isNaN(i)?"N/A":i<1?`${(i*1024).toFixed(2)} KB`:`${i.toFixed(2)} MB`},h=(t,i)=>{const s=b.has(t.name),H=l.findIndex(I=>I.name===t.name)===l.length-1;return o.jsxs(vo,{children:[o.jsxs(bo,{$level:i,$isExpanded:s,$nodeType:"schema",onClick:()=>N(t.name),children:[$(i,H),o.jsx(Co,{$isExpanded:s,children:s?m.arrowDown:m.arrowRight}),o.jsx("span",{style:{marginRight:"8px",color:e.accent,fontFamily:"Consolas"},children:m.blockFull}),o.jsx(So,{$isSchema:!0,children:t.name}),o.jsxs(_o,{children:[t.objects.length," ",t.objects.length===1?"object":"objects"]})]}),o.jsx(zo,{$isExpanded:s,$level:i,children:s&&t.objects.map((I,M)=>D(I,t.name,i+1,M===t.objects.length-1))})]},t.name)},D=(t,i,s,C)=>o.jsxs(Fo,{$level:s,onClick:()=>_==null?void 0:_(t),children:[$(s,C),o.jsx("span",{style:{marginRight:"8px",color:e.muted,fontFamily:"Consolas"},children:m.blockFull}),o.jsx("span",{style:{marginRight:"8px",fontWeight:500,color:e.foreground,fontFamily:"Consolas"},children:t.object_name||"N/A"}),t.object_type&&o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:e.backgroundSoft,color:e.foreground,border:`1px solid ${e.border}`,marginRight:4},children:t.object_type}),t.health_status&&o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:A(t.health_status)+"20",color:A(t.health_status),border:`1px solid ${A(t.health_status)}`,marginRight:4},children:t.health_status}),t.access_frequency&&o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:A(t.access_frequency)+"20",color:A(t.access_frequency),border:`1px solid ${A(t.access_frequency)}`,marginRight:4},children:t.access_frequency}),o.jsxs("span",{style:{marginLeft:"auto",color:e.muted,fontSize:11,fontFamily:"Consolas"},children:[W(t.row_count)," rows ",m.bullet," ",T(t.table_size_mb)]})]},t.id);return l.length===0?o.jsx(J,{children:o.jsxs("div",{style:{padding:"60px 40px",textAlign:"center",color:e.muted,fontFamily:"Consolas"},children:[o.jsx("div",{style:{fontSize:48,marginBottom:16,fontFamily:"Consolas",opacity:.5},children:m.blockFull}),o.jsx("div",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,marginBottom:8,color:e.foreground},children:"No governance data available"}),o.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",opacity:.7,color:e.muted},children:"Data will appear here once collected."})]})}):o.jsx(J,{children:l.map(t=>h(t,0))})};q`
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`;q`
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`;const c=r=>{if(!r)return e.muted;switch(r){case"HEALTHY":case"EXCELLENT":return e.success;case"WARNING":return e.warning;case"CRITICAL":return e.danger;default:return e.muted}},Eo=()=>{const{page:r,limit:_,setPage:b,setLimit:L}=mo(1,20,1e3),{filters:l,setFilter:N,clearFilters:$}=go({server_name:"",database_name:"",health_status:"",access_frequency:"",search:""}),[W,T]=a.useState(null),[h,D]=a.useState(null),[t,i]=a.useState("overview"),[s,C]=a.useState({}),[H,I]=a.useState([]),[M,O]=a.useState([]),[w,Q]=a.useState([]),[F,Z]=a.useState({total:0,totalPages:0,currentPage:1,limit:20}),[K,V]=a.useState(!0),[oo,G]=a.useState(!1),[B,eo]=a.useState("list"),g=a.useRef(!0),Y=a.useCallback(async()=>{if(!g.current)return;const n=Date.now(),d=300;try{V(!0),T(null);const f=uo(l.search,100),R=await E.getMongoDBItems({page:r,limit:_,server_name:l.server_name,database_name:l.database_name,health_status:l.health_status,access_frequency:l.access_frequency,search:f}),S=Date.now()-n,P=Math.max(0,d-S);await new Promise(u=>setTimeout(u,P)),g.current&&(Q(R.data||[]),Z(R.pagination||{total:0,totalPages:0,currentPage:1,limit:20}))}catch(f){g.current&&T(ho(f))}finally{g.current&&V(!1)}},[r,_,l.server_name,l.database_name,l.health_status,l.access_frequency,l.search]);a.useEffect(()=>{g.current=!0,(async()=>{await Y();try{const f=await E.getMongoDBMetrics();g.current&&C(f||{})}catch(f){console.error("MongoDB: Error loading metrics:",f),g.current&&console.error("MongoDB: Error loading metrics:",f)}})();const d=setInterval(()=>{g.current&&(Y(),E.getMongoDBMetrics().then(f=>{g.current&&C(f||{})}).catch(f=>{console.error("MongoDB: Error loading metrics in interval:",f)}))},3e4);return()=>{g.current=!1,clearInterval(d)}},[Y]),a.useEffect(()=>{(async()=>{if(l.server_name&&g.current)try{const d=await E.getMongoDBDatabases(l.server_name);g.current&&O(d||[])}catch(d){g.current&&console.error("Error loading databases:",d)}else O([])})()},[l.server_name]);const no=a.useCallback(n=>{D(d=>(d==null?void 0:d.id)===n.id?null:n),i("overview")},[]),z=a.useCallback(n=>n==null?"N/A":n?"Yes":"No",[]),y=a.useCallback(n=>{if(n==null)return"N/A";const d=Number(n);return isNaN(d)?"N/A":d<1?`${(d*1024).toFixed(2)} KB`:`${d.toFixed(2)} MB`},[]),p=a.useCallback(n=>{if(n==null)return"N/A";const d=Number(n);return isNaN(d)?"N/A":d.toLocaleString()},[]),U=a.useCallback(n=>n?new Date(n).toLocaleString():"N/A",[]),k=a.useCallback((n,d)=>{N(n,d),n==="server_name"&&N("database_name",""),b(1)},[N,b]),to=a.useCallback(n=>o.jsxs("div",{children:[o.jsxs("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:`1px solid ${e.border}`},children:[o.jsx("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:e.foreground,margin:"0 0 12px 0",paddingBottom:4,borderBottom:`2px solid ${e.accent}`},children:"Basic Information"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Server:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.server_name||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Database:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.database_name||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Collection:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.collection_name||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Health Status:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.health_status?o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:c(n.health_status)+"20",color:c(n.health_status),border:`1px solid ${c(n.health_status)}`},children:n.health_status}):"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Access Frequency:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.access_frequency||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Health Score:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.health_score!==null&&n.health_score!==void 0?`${Number(n.health_score).toFixed(2)}`:"N/A"})]})]})]}),o.jsxs("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:`1px solid ${e.border}`},children:[o.jsx("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:e.foreground,margin:"0 0 12px 0",paddingBottom:4,borderBottom:`2px solid ${e.accent}`},children:"Storage"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Document Count:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:p(n.document_count)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Collection Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:y(n.collection_size_mb)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Index Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:y(n.index_size_mb)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Total Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:y(n.total_size_mb)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Storage Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:y(n.storage_size_mb)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Avg Object Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.avg_object_size_bytes?`${(Number(n.avg_object_size_bytes)/1024).toFixed(2)} KB`:"N/A"})]})]})]}),o.jsxs("div",{style:{marginBottom:0},children:[o.jsx("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:e.foreground,margin:"0 0 12px 0",paddingBottom:4,borderBottom:`2px solid ${e.accent}`},children:"MongoDB Configuration"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"MongoDB Version:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.mongodb_version||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Storage Engine:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.storage_engine||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Replica Set:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.replica_set_name||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Is Sharded:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:c(n.is_sharded?"WARNING":"HEALTHY")+"20",color:c(n.is_sharded?"WARNING":"HEALTHY"),border:`1px solid ${c(n.is_sharded?"WARNING":"HEALTHY")}`},children:z(n.is_sharded)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Shard Key:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.shard_key||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Index Count:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:p(n.index_count)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Snapshot Date:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:U(n.snapshot_date)})]})]})]})]}),[y,p,z,U]),ro=a.useCallback(n=>o.jsx("div",{children:o.jsxs("div",{style:{marginBottom:0},children:[o.jsx("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:e.foreground,margin:"0 0 12px 0",paddingBottom:4,borderBottom:`2px solid ${e.accent}`},children:"Index Information"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Index Name:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.index_name||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Index Keys:"}),o.jsx("div",{style:{whiteSpace:"pre-wrap",fontFamily:"Consolas",fontSize:12,color:e.foreground},children:n.index_keys||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Index Type:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.index_type||"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Unique Index:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:c(n.index_unique?"HEALTHY":"WARNING")+"20",color:c(n.index_unique?"HEALTHY":"WARNING"),border:`1px solid ${c(n.index_unique?"HEALTHY":"WARNING")}`},children:z(n.index_unique)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Sparse Index:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:c(n.index_sparse?"WARNING":"HEALTHY")+"20",color:c(n.index_sparse?"WARNING":"HEALTHY"),border:`1px solid ${c(n.index_sparse?"WARNING":"HEALTHY")}`},children:z(n.index_sparse)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Index Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:y(n.index_size_mb)})]})]})]})}),[z,y]),so=a.useCallback(n=>o.jsxs("div",{children:[o.jsxs("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:`1px solid ${e.border}`},children:[o.jsx("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:e.foreground,margin:"0 0 12px 0",paddingBottom:4,borderBottom:`2px solid ${e.accent}`},children:"Performance Metrics"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Health Score:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.health_score!==null&&n.health_score!==void 0?`${Number(n.health_score).toFixed(2)}`:"N/A"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Document Count:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:p(n.document_count)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Total Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:y(n.total_size_mb)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Index Count:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:p(n.index_count)})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Avg Object Size:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:n.avg_object_size_bytes?`${(Number(n.avg_object_size_bytes)/1024).toFixed(2)} KB`:"N/A"})]})]})]}),o.jsxs("div",{style:{marginBottom:0},children:[o.jsx("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:e.foreground,margin:"0 0 12px 0",paddingBottom:4,borderBottom:`2px solid ${e.accent}`},children:"Sharding"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Is Sharded:"}),o.jsx("div",{style:{color:e.foreground,fontSize:12,fontFamily:"Consolas"},children:o.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:c(n.is_sharded?"WARNING":"HEALTHY")+"20",color:c(n.is_sharded?"WARNING":"HEALTHY"),border:`1px solid ${c(n.is_sharded?"WARNING":"HEALTHY")}`},children:z(n.is_sharded)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Shard Key:"}),o.jsx("div",{style:{fontFamily:"Consolas",fontSize:12,color:e.foreground},children:n.shard_key||"N/A"})]})]})]})]}),[y,p,z]),io=a.useCallback(n=>o.jsx("div",{children:o.jsxs("div",{style:{marginBottom:0},children:[o.jsx("h3",{style:{fontSize:13,fontFamily:"Consolas",fontWeight:600,color:e.foreground,margin:"0 0 12px 0",paddingBottom:4,borderBottom:`2px solid ${e.accent}`},children:"Recommendations"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:o.jsxs("div",{children:[o.jsx("div",{style:{color:e.muted,fontWeight:500,fontSize:11,marginBottom:4,fontFamily:"Consolas"},children:"Recommendation Summary:"}),o.jsx("div",{style:{whiteSpace:"pre-wrap",fontFamily:"Consolas",fontSize:12,color:e.foreground},children:n.recommendation_summary||"No recommendations available"})]})})]})}),[]),ao=a.useCallback(()=>{const n=["Server","Database","Collection","Document Count","Size (MB)","Health","Access","Storage Engine"],d=w.map(u=>[u.server_name||"",u.database_name||"",u.collection_name||"",p(u.document_count),u.total_size_mb||0,u.health_status||"",u.access_frequency||"",u.storage_engine||""]),f=[n.join(","),...d.map(u=>u.map(lo=>`"${String(lo).replace(/"/g,'""')}"`).join(","))].join(`
`),R=new Blob([f],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a"),P=URL.createObjectURL(R);S.setAttribute("href",P),S.setAttribute("download",`governance_catalog_mongodb_export_${new Date().toISOString().split("T")[0]}.csv`),S.style.visibility="hidden",document.body.appendChild(S),S.click(),document.body.removeChild(S)},[w,p]);return K&&w.length===0?o.jsx(yo,{variant:"table"}):o.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[o.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:"0 0 20px 0",color:e.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[o.jsx("span",{style:{color:e.accent,marginRight:8},children:m.blockFull}),"GOVERNANCE CATALOG - MONGODB"]}),W&&o.jsx("div",{style:{marginBottom:20},children:o.jsx(x,{title:"ERROR",children:o.jsx("div",{style:{padding:"12px",color:e.danger,fontSize:12,fontFamily:"Consolas"},children:W})})}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12,marginBottom:24},children:[o.jsx(x,{title:"Total Collections",children:o.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:e.foreground},children:s.total_collections||0})}),o.jsx(x,{title:"Total Size",children:o.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:e.foreground},children:y(s.total_size_mb)})}),o.jsx(x,{title:"Total Documents",children:o.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:e.foreground},children:p(s.total_documents)})}),o.jsx(x,{title:"Healthy",children:o.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:e.foreground},children:s.healthy_count||0})}),o.jsx(x,{title:"Warning",children:o.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:e.foreground},children:s.warning_count||0})}),o.jsx(x,{title:"Critical",children:o.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:e.foreground},children:s.critical_count||0})}),o.jsx(x,{title:"Unique Servers",children:o.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:e.foreground},children:s.unique_servers||0})})]}),o.jsx(x,{title:"FILTERS",children:o.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[o.jsxs("select",{value:l.server_name,onChange:n=>k("server_name",n.target.value),style:{padding:"4px 8px",border:`1px solid ${e.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:e.background,color:e.foreground},children:[o.jsx("option",{value:"",children:"All Servers"}),H.map(n=>o.jsx("option",{value:n,children:n},n))]}),o.jsxs("select",{value:l.database_name,onChange:n=>k("database_name",n.target.value),disabled:!l.server_name,style:{padding:"4px 8px",border:`1px solid ${e.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:e.background,color:e.foreground,opacity:l.server_name?1:.5},children:[o.jsx("option",{value:"",children:"All Databases"}),M.map(n=>o.jsx("option",{value:n,children:n},n))]}),o.jsxs("select",{value:l.health_status,onChange:n=>k("health_status",n.target.value),style:{padding:"4px 8px",border:`1px solid ${e.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:e.background,color:e.foreground},children:[o.jsx("option",{value:"",children:"All Health Status"}),o.jsx("option",{value:"EXCELLENT",children:"Excellent"}),o.jsx("option",{value:"HEALTHY",children:"Healthy"}),o.jsx("option",{value:"WARNING",children:"Warning"}),o.jsx("option",{value:"CRITICAL",children:"Critical"})]}),o.jsxs("select",{value:l.access_frequency,onChange:n=>k("access_frequency",n.target.value),style:{padding:"4px 8px",border:`1px solid ${e.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:e.background,color:e.foreground},children:[o.jsx("option",{value:"",children:"All Access Frequency"}),o.jsx("option",{value:"REAL_TIME",children:"Real Time"}),o.jsx("option",{value:"HIGH",children:"High"}),o.jsx("option",{value:"MEDIUM",children:"Medium"}),o.jsx("option",{value:"LOW",children:"Low"}),o.jsx("option",{value:"RARE",children:"Rare"})]}),o.jsx("input",{type:"text",placeholder:"Search collection name...",value:l.search,onChange:n=>k("search",n.target.value),style:{flex:1,minWidth:"200px",padding:"4px 8px",border:`1px solid ${e.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:e.background,color:e.foreground}}),o.jsx(v,{label:"Reset All",onClick:()=>{$(),b(1)},variant:"ghost"})]})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24,marginTop:8,fontFamily:"Consolas",fontSize:12,gap:32},children:[o.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[o.jsx("label",{style:{color:e.muted,fontSize:11,fontFamily:"Consolas"},children:"Items per page:"}),o.jsxs("select",{value:_,onChange:n=>{L(Number(n.target.value)),b(1)},style:{padding:"4px 8px",border:`1px solid ${e.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:e.background,color:e.foreground,cursor:"pointer"},children:[o.jsx("option",{value:10,children:"10"}),o.jsx("option",{value:20,children:"20"}),o.jsx("option",{value:50,children:"50"}),o.jsx("option",{value:100,children:"100"}),o.jsx("option",{value:200,children:"200"})]})]}),o.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[o.jsx(v,{label:B==="list"?"Show Charts":"Show List",onClick:()=>eo(B==="list"?"charts":"list"),variant:B==="charts"?"primary":"ghost"}),o.jsx(v,{label:"Metrics Info",onClick:()=>G(!0),variant:"ghost"}),o.jsx(v,{label:"Export CSV",onClick:ao,variant:"ghost"})]})]}),oo&&o.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>G(!1),children:o.jsx("div",{style:{width:"90%",maxWidth:900,maxHeight:"90vh",overflowY:"auto"},onClick:n=>n.stopPropagation(),children:o.jsx(x,{title:"METRICS PLAYBOOK - MONGODB GOVERNANCE",children:o.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontSize:13,fontWeight:600,color:e.accent,marginBottom:8},children:[m.blockFull," Total Collections"]}),o.jsx("div",{style:{color:e.foreground,marginLeft:16},children:"Total number of collections cataloged across all MongoDB servers and databases in the governance system."})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontSize:13,fontWeight:600,color:e.accent,marginBottom:8},children:[m.blockFull," Total Size"]}),o.jsx("div",{style:{color:e.foreground,marginLeft:16},children:"Combined storage size of all collections across all MongoDB databases. Includes data and index sizes."})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontSize:13,fontWeight:600,color:e.accent,marginBottom:8},children:[m.blockFull," Total Documents"]}),o.jsx("div",{style:{color:e.foreground,marginLeft:16},children:"Total number of documents across all MongoDB collections in the governance catalog."})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontSize:13,fontWeight:600,color:e.success,marginBottom:8},children:[m.blockFull," Healthy"]}),o.jsx("div",{style:{color:e.foreground,marginLeft:16},children:"Collections with HEALTHY status, indicating optimal performance, proper indexing, and good access patterns."})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontSize:13,fontWeight:600,color:e.warning,marginBottom:8},children:[m.blockFull," Warning"]}),o.jsx("div",{style:{color:e.foreground,marginLeft:16},children:"Collections with WARNING status, indicating potential issues such as missing indexes, suboptimal sharding, or performance concerns that should be monitored."})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontSize:13,fontWeight:600,color:e.danger,marginBottom:8},children:[m.blockFull," Critical"]}),o.jsx("div",{style:{color:e.foreground,marginLeft:16},children:"Collections with CRITICAL status, indicating serious issues requiring immediate attention such as missing critical indexes, sharding problems, or severe performance degradation."})]}),o.jsxs("div",{style:{marginTop:16,padding:12,background:e.backgroundSoft,borderRadius:2,border:`1px solid ${e.border}`},children:[o.jsxs("div",{style:{fontSize:11,fontWeight:600,color:e.muted,marginBottom:4},children:[m.blockSemi," Note"]}),o.jsx("div",{style:{fontSize:11,color:e.foreground},children:"These metrics are calculated in real-time from the data_governance_catalog_mongodb table and reflect the current state of your MongoDB governance catalog."})]}),o.jsx("div",{style:{marginTop:16,textAlign:"right"},children:o.jsx(v,{label:"Close",onClick:()=>G(!1),variant:"ghost"})})]})})})}),B==="charts"&&o.jsx(xo,{engine:"mongodb",selectedItem:h?{server_name:h.server_name,database_name:h.database_name,collection_name:h.collection_name}:null}),B==="list"&&K?o.jsx(co,{children:"Loading tree view..."}):B==="list"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"grid",gridTemplateColumns:h?"1fr 500px":"1fr",gap:16,marginTop:16},children:[o.jsx(Bo,{items:w,onItemClick:no}),h&&o.jsx("div",{style:{position:"sticky",top:16,maxHeight:"calc(100vh - 200px)",overflowY:"auto"},children:o.jsxs(x,{title:"DETAILS",children:[o.jsxs("div",{style:{display:"flex",gap:4,marginBottom:16,borderBottom:`1px solid ${e.border}`,paddingBottom:8,flexWrap:"wrap"},children:[o.jsx(v,{label:"Overview",onClick:()=>i("overview"),variant:t==="overview"?"primary":"ghost"}),o.jsx(v,{label:"Indexes",onClick:()=>i("indexes"),variant:t==="indexes"?"primary":"ghost"}),o.jsx(v,{label:"Performance",onClick:()=>i("performance"),variant:t==="performance"?"primary":"ghost"}),o.jsx(v,{label:"Recommendations",onClick:()=>i("recommendations"),variant:t==="recommendations"?"primary":"ghost"})]}),t==="overview"&&to(h),t==="indexes"&&ro(h),t==="performance"&&so(h),t==="recommendations"&&io(h)]})})]}),F.totalPages>1&&o.jsx("div",{style:{marginTop:24},children:o.jsxs(fo,{children:[o.jsx(X,{onClick:()=>b(Math.max(1,r-1)),disabled:r===1,children:"Previous"}),o.jsxs("span",{style:{fontFamily:"Consolas",fontSize:12,color:e.foreground},children:["Page ",F.currentPage," of ",F.totalPages," (",F.total," total)"]}),o.jsx(X,{onClick:()=>b(Math.min(F.totalPages,r+1)),disabled:r===F.totalPages,children:"Next"})]})})]}):null]})};export{Eo as default};
