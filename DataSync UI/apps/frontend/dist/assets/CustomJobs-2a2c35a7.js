import{r as N,j as d,b as f,e as he,f as wg,t as Zr,J as Sg,R as H,K as $t}from"./index-75d7470b.js";import{A as qt}from"./AsciiPanel-9f053981.js";import{A as At}from"./AsciiButton-446d8430.js";import{C as kg}from"./ConnectionStringSelector-c1083be0.js";import{u as Cg}from"./usePagination-b946ac42.js";import{u as Tg}from"./useTableFilters-0b8dd77f.js";import{e as zn}from"./errorHandler-5ea9ae85.js";import{s as Eg}from"./validation-24839588.js";import{S as Ag}from"./SkeletonLoader-530eacc4.js";const _g=({jobs:n,onJobClick:e,onJobEdit:t,onJobExecute:i,onJobToggleActive:o,onJobDelete:s,onJobDuplicate:r,onJobReboot:l})=>{const[a,c]=N.useState(new Set),[h,u]=N.useState(new Set),p=N.useMemo(()=>{const k=new Map;return n.forEach(E=>{const M=E.target_schema||"Other",_=E.target_table||"Other";k.has(M)||k.set(M,{name:M,tables:new Map});const C=k.get(M);C.tables.has(_)||C.tables.set(_,{name:_,jobs:[]}),C.tables.get(_).jobs.push(E)}),Array.from(k.values()).sort((E,M)=>E.name.localeCompare(M.name))},[n]),g=k=>{c(E=>{const M=new Set(E);if(M.has(k)){M.delete(k);const _=p.find(C=>C.name===k);_&&_.tables.forEach(C=>{const P=`${k}.${C.name}`;u(R=>{const $=new Set(R);return $.delete(P),$})})}else M.add(k);return M})},y=(k,E)=>{const M=`${k}.${E}`;u(_=>{const C=new Set(_);return C.has(M)?C.delete(M):C.add(M),C})},m=(k,E)=>{if(k===0)return null;const M=[];for(let _=0;_<k-1;_++)M.push("â”‚  ");return M.push(E?"â””â”€â”€ ":"â”œâ”€â”€ "),d.jsx("span",{style:{color:f.muted,marginRight:6,fontFamily:"Consolas",fontSize:11},children:M.join("")})},b=(k,E,M)=>{const _=a.has(k.name),C=Array.from(k.tables.values()).reduce((P,R)=>P+R.jobs.length,0);return d.jsxs("div",{style:{marginBottom:2,userSelect:"none"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 8px",paddingLeft:`${E*24+8}px`,cursor:"pointer",borderRadius:2,transition:"all 0.2s ease",position:"relative",margin:"2px 0",background:"transparent",borderLeft:`3px solid ${f.accent}`,fontFamily:"Consolas",fontSize:12},onClick:()=>g(k.name),onMouseEnter:P=>{P.currentTarget.style.background=`linear-gradient(135deg, ${f.accentSoft}20 0%, ${f.accent}12 100%)`,P.currentTarget.style.transform="translateX(2px)"},onMouseLeave:P=>{P.currentTarget.style.background="transparent",P.currentTarget.style.transform="translateX(0)"},children:[m(E,M),d.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:16,height:16,marginRight:8,color:f.muted,fontFamily:"Consolas",fontSize:12},children:_?"â–¼":"â–¶"}),d.jsx("span",{style:{marginRight:8,color:f.accent,fontFamily:"Consolas"},children:he.blockFull}),d.jsx("span",{style:{fontWeight:600,color:f.accent,marginRight:8,flex:1,fontFamily:"Consolas",fontSize:12},children:k.name}),d.jsxs("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontWeight:500,backgroundColor:f.backgroundSoft,color:f.muted,fontFamily:"Consolas",border:`1px solid ${f.border}`},children:[C," ",C===1?"job":"jobs"]})]}),_&&d.jsx("div",{style:{overflow:"hidden",paddingLeft:`${(E+1)*24+36}px`},children:Array.from(k.tables.values()).sort((P,R)=>P.name.localeCompare(R.name)).map((P,R,$)=>x(P,k.name,E+1,R===$.length-1))})]},k.name)},x=(k,E,M,_)=>{const C=`${E}.${k.name}`,P=h.has(C);return d.jsxs("div",{style:{marginBottom:2,userSelect:"none"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 8px",paddingLeft:`${M*24+8}px`,cursor:"pointer",borderRadius:2,transition:"all 0.2s ease",position:"relative",margin:"2px 0",background:"transparent",borderLeft:`2px solid ${f.border}`,fontFamily:"Consolas",fontSize:12},onClick:()=>y(E,k.name),onMouseEnter:R=>{R.currentTarget.style.backgroundColor=f.backgroundSoft,R.currentTarget.style.transform="translateX(2px)"},onMouseLeave:R=>{R.currentTarget.style.backgroundColor="transparent",R.currentTarget.style.transform="translateX(0)"},children:[m(M,_),d.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:16,height:16,marginRight:8,color:f.muted,fontFamily:"Consolas",fontSize:12},children:P?"â–¼":"â–¶"}),d.jsx("span",{style:{marginRight:8,color:f.accent,fontFamily:"Consolas"},children:he.blockSemi}),d.jsx("span",{style:{fontWeight:500,color:f.foreground,marginRight:8,flex:1,fontFamily:"Consolas",fontSize:12},children:k.name}),d.jsxs("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontWeight:500,backgroundColor:f.backgroundSoft,color:f.muted,fontFamily:"Consolas",border:`1px solid ${f.border}`},children:[k.jobs.length," ",k.jobs.length===1?"job":"jobs"]})]}),P&&d.jsx("div",{style:{overflow:"hidden",paddingLeft:`${(M+1)*24+36}px`},children:k.jobs.map((R,$)=>T(R,M+1,$===k.jobs.length-1))})]},C)},T=(k,E,M)=>d.jsxs("div",{style:{padding:"12px 8px",paddingLeft:`${E*24+36}px`,margin:"2px 0",borderRadius:2,background:"transparent",border:`1px solid ${f.border}`,transition:"all 0.2s ease",cursor:"pointer",display:"flex",alignItems:"center",gap:12,fontFamily:"Consolas",fontSize:12},onClick:()=>e==null?void 0:e(k),onMouseEnter:_=>{_.currentTarget.style.background=f.backgroundSoft,_.currentTarget.style.borderColor=f.accent,_.currentTarget.style.transform="translateX(4px)"},onMouseLeave:_=>{_.currentTarget.style.background="transparent",_.currentTarget.style.borderColor=f.border,_.currentTarget.style.transform="translateX(0)"},children:[m(E,M),d.jsx("span",{style:{marginRight:8,color:f.accent,fontFamily:"Consolas"},children:he.dot}),d.jsx("span",{style:{marginRight:8,fontWeight:500,color:f.foreground,flex:1,fontFamily:"Consolas",fontSize:12},children:k.job_name}),k.description&&d.jsx("span",{style:{color:f.muted,fontSize:11,flex:1,fontFamily:"Consolas"},children:k.description.length>50?k.description.substring(0,50)+"...":k.description}),d.jsxs("span",{style:{color:f.muted,fontSize:11,fontFamily:"Consolas"},children:[k.source_db_engine," â†’ ",k.target_db_engine]}),k.schedule_cron?d.jsxs("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontWeight:500,backgroundColor:f.accent,color:f.background,fontFamily:"Consolas",border:`1px solid ${f.accent}`},children:["Scheduled: ",k.schedule_cron]}):d.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontWeight:500,backgroundColor:f.backgroundSoft,color:f.muted,fontFamily:"Consolas",border:`1px solid ${f.border}`},children:"Manual"}),d.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontWeight:500,backgroundColor:k.active?f.success:f.danger,color:f.background,fontFamily:"Consolas",border:`1px solid ${k.active?f.success:f.danger}`},children:k.active?"Active":"Inactive"}),d.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontWeight:500,backgroundColor:k.enabled?f.success:f.danger,color:f.background,fontFamily:"Consolas",border:`1px solid ${k.enabled?f.success:f.danger}`},children:k.enabled?"Enabled":"Disabled"}),d.jsxs("div",{style:{display:"flex",gap:4,marginLeft:"auto"},children:[i&&d.jsx("button",{onClick:_=>{_.stopPropagation(),i(k.job_name)},title:`Execute job: ${k.job_name}`,style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:11,fontFamily:"Consolas",fontWeight:600,outline:"none"},onMouseEnter:_=>{_.currentTarget.style.backgroundColor=f.accentSoft},onMouseLeave:_=>{_.currentTarget.style.backgroundColor=f.accent},children:"â–¶"}),r&&d.jsx("div",{onClick:_=>_.stopPropagation(),children:d.jsx(At,{label:"Duplicate",onClick:()=>r(k),variant:"primary"})}),t&&d.jsx("button",{onClick:_=>{_.stopPropagation(),t(k)},style:{padding:"4px 8px",border:`1px solid ${f.border}`,borderRadius:2,background:f.background,color:f.foreground,cursor:"pointer",fontSize:11,fontFamily:"Consolas",fontWeight:600,outline:"none"},onMouseEnter:_=>{_.currentTarget.style.backgroundColor=f.backgroundSoft},onMouseLeave:_=>{_.currentTarget.style.backgroundColor=f.background},children:"Edit"}),o&&d.jsx("button",{onClick:_=>{_.stopPropagation(),o(k.job_name,k.active)},style:{padding:"4px 8px",border:`1px solid ${f.border}`,borderRadius:2,background:f.background,color:f.foreground,cursor:"pointer",fontSize:11,fontFamily:"Consolas",fontWeight:600,outline:"none"},onMouseEnter:_=>{_.currentTarget.style.backgroundColor=f.backgroundSoft},onMouseLeave:_=>{_.currentTarget.style.backgroundColor=f.background},children:k.active?"Deactivate":"Activate"}),s&&d.jsx("button",{onClick:_=>{_.stopPropagation(),s(k.job_name)},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:11,fontFamily:"Consolas",fontWeight:600,outline:"none"},onMouseEnter:_=>{_.currentTarget.style.backgroundColor=f.danger+"CC"},onMouseLeave:_=>{_.currentTarget.style.backgroundColor=f.danger},children:"Delete"}),l&&d.jsx("button",{onClick:_=>{_.stopPropagation(),l(k.job_name)},title:`Reboot table: ${k.target_schema}.${k.target_table}`,style:{padding:"4px 8px",border:`1px solid ${f.warning}`,borderRadius:2,background:f.warning,color:f.background,cursor:"pointer",fontSize:11,fontFamily:"Consolas",fontWeight:600,outline:"none"},onMouseEnter:_=>{_.currentTarget.style.backgroundColor=f.warning+"CC"},onMouseLeave:_=>{_.currentTarget.style.backgroundColor=f.warning},children:"ðŸ”„ Reboot"})]})]},k.id);return p.length===0?d.jsx(qt,{title:"CUSTOM JOBS TREE",children:d.jsxs("div",{style:{padding:"60px 40px",textAlign:"center",color:f.muted,fontFamily:"Consolas",fontSize:12},children:[d.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5,fontFamily:"Consolas"},children:he.blockFull}),d.jsx("div",{style:{fontSize:13,fontWeight:600,marginBottom:8,color:f.foreground,fontFamily:"Consolas"},children:"No custom jobs available"}),d.jsx("div",{style:{fontSize:12,opacity:.7,fontFamily:"Consolas"},children:"Create a new job to get started."})]})}):d.jsx(qt,{title:"CUSTOM JOBS TREE",children:d.jsx("div",{style:{maxHeight:800,overflowY:"auto",overflowX:"hidden",fontFamily:"Consolas",fontSize:12},children:p.map((k,E)=>b(k,0,E===p.length-1))})})},Mg=({tableStructure:n,loading:e,sourceTitle:t,sourceType:i,sourceInfo:o,job:s})=>{var $,F,L,W,w,O,S,z,j,v,D,B,I,V,Q,J,se,le,xe,ge,ue,Ne,Oe,Re,be,de,Fe;const[r,l]=N.useState(""),[a,c]=N.useState("position"),[h,u]=N.useState({summary:!0,source:!0,target:!0}),[p,g]=N.useState(null),y=U=>{u(q=>({...q,[U]:!q[U]}))},m=N.useMemo(()=>{var G,ae;const U=((G=n==null?void 0:n.target)==null?void 0:G.columns)||(n==null?void 0:n.columns)||[];return!U||U.length===0?[]:(((ae=n.source)==null?void 0:ae.columns)||[]).map(ce=>{const oe=U.find(Ee=>Ee.name.toLowerCase()===ce.name.toLowerCase());return{source:ce,target:oe||null,mapped:!!oe,differences:oe?{type:ce.type!==oe.type,nullable:ce.nullable!==oe.nullable,default:ce.default!==oe.default}:null}})},[n]);N.useMemo(()=>{const U=m,q=U.filter(ae=>ae.mapped).length,G=U.length-q;return{total:U.length,mapped:q,unmapped:G}},[m]);const b=U=>{let q=U.filter(G=>G.name.toLowerCase().includes(r.toLowerCase())||G.type.toLowerCase().includes(r.toLowerCase()));return a==="name"?q.sort((G,ae)=>G.name.localeCompare(ae.name)):a==="type"&&q.sort((G,ae)=>G.type.localeCompare(ae.type)),q},x=(U,q)=>{var G,ae,ce,oe;return q?((ae=(G=n==null?void 0:n.source)==null?void 0:G.primaryKeys)==null?void 0:ae.includes(U))||!1:((oe=(ce=n==null?void 0:n.target)==null?void 0:ce.primaryKeys)==null?void 0:oe.includes(U))||!1},T=(U,q)=>{var ae,ce;if(q){const oe=(ae=n==null?void 0:n.source)==null?void 0:ae.foreignKeys;return oe&&oe.some(Ee=>Ee.column===U)}const G=(ce=n==null?void 0:n.target)==null?void 0:ce.foreignKeys;return G&&G.some(oe=>oe.column===U)},k=(U,q)=>{var ae,ce;if(q){const oe=(ae=n==null?void 0:n.source)==null?void 0:ae.indexes;return oe&&oe.some(Ee=>{var je;return(je=Ee.columns)==null?void 0:je.includes(U)})}const G=(ce=n==null?void 0:n.target)==null?void 0:ce.indexes;return G&&G.some(oe=>{var Ee;return(Ee=oe.columns)==null?void 0:Ee.includes(U)})},E=U=>U.mapped?U.differences&&U.differences.type?f.foreground:U.differences&&(U.differences.nullable||U.differences.default)?f.muted:f.accent:f.foreground,M=()=>{const U=m.map(oe=>{var Ee,je,Ae,Se;return{sourceColumn:((Ee=oe.source)==null?void 0:Ee.name)||"N/A",sourceType:((je=oe.source)==null?void 0:je.type)||"N/A",targetColumn:((Ae=oe.target)==null?void 0:Ae.name)||"NOT MAPPED",targetType:((Se=oe.target)==null?void 0:Se.type)||"N/A",mapped:oe.mapped,differences:oe.differences}}),q=[["Source Column","Source Type","Target Column","Target Type","Mapped","Differences"].join(","),...U.map(oe=>[oe.sourceColumn,oe.sourceType,oe.targetColumn,oe.targetType,oe.mapped?"Yes":"No",oe.differences?JSON.stringify(oe.differences):"None"].join(","))].join(`
`),G=new Blob([q],{type:"text/csv"}),ae=URL.createObjectURL(G),ce=document.createElement("a");ce.href=ae,ce.download=`mapping_${(s==null?void 0:s.job_name)||"custom_job"}.csv`,ce.click(),URL.revokeObjectURL(ae)};if(e)return d.jsx(qt,{title:"DATA FLOW: SOURCE â†’ TARGET",children:d.jsxs("div",{style:{textAlign:"center",padding:"40px",color:f.muted,fontFamily:"Consolas",fontSize:12},children:[he.blockFull," Loading table structure..."]})});if(!n)return d.jsx(qt,{title:"DATA FLOW: SOURCE â†’ TARGET",children:d.jsxs("div",{style:{textAlign:"center",padding:"40px",color:f.muted,fontFamily:"Consolas",fontSize:12},children:[d.jsx("div",{style:{fontSize:48,marginBottom:16,opacity:.5},children:he.blockFull}),d.jsx("div",{style:{fontSize:13,fontWeight:600,marginBottom:8,color:f.foreground},children:"Table structure not available"}),d.jsx("div",{style:{fontSize:12,opacity:.7},children:"The table may not exist yet or there was an error loading it."})]})});const _=(($=n.target)==null?void 0:$.columns)||n.columns||[],C=((F=n.source)==null?void 0:F.columns)||[],P=b(_),R=b(C);return d.jsx(qt,{title:"DATA FLOW: SOURCE â†’ TARGET",children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:f.backgroundSoft,borderRadius:2,border:`1px solid ${f.border}`},children:[d.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center"},children:[d.jsx("input",{type:"text",placeholder:"Search columns...",value:r,onChange:U=>l(U.target.value),style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,outline:"none",width:200}}),d.jsxs("select",{value:a,onChange:U=>c(U.target.value),style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},children:[d.jsx("option",{value:"position",children:"Sort by Position"}),d.jsx("option",{value:"name",children:"Sort by Name"}),d.jsx("option",{value:"type",children:"Sort by Type"})]})]}),d.jsx(At,{label:"Export CSV",onClick:M,variant:"ghost"})]}),d.jsxs("div",{style:{padding:"12px",backgroundColor:f.backgroundSoft,borderRadius:2,border:`1px solid ${f.border}`,cursor:"pointer"},onClick:()=>y("summary"),children:[d.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:d.jsxs("div",{style:{fontSize:12,fontWeight:600,color:f.foreground,fontFamily:"Consolas"},children:[he.v," Summary ",h.summary?"â–¼":"â–¶"]})}),h.summary&&d.jsx(d.Fragment,{children:d.jsxs("div",{style:{marginTop:12,padding:"10px",backgroundColor:f.background,borderRadius:2,border:`1px solid ${f.border}`},children:[d.jsxs("div",{style:{fontSize:11,fontWeight:600,color:f.foreground,marginBottom:8,fontFamily:"Consolas"},children:[he.v," Column Flags Legend"]}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:8,fontSize:10,fontFamily:"Consolas"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"PK"}),d.jsx("span",{style:{color:f.muted},children:"Primary Key"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"FK"}),d.jsx("span",{style:{color:f.muted},children:"Foreign Key"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"UQ"}),d.jsx("span",{style:{color:f.muted},children:"Unique"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"AI"}),d.jsx("span",{style:{color:f.muted},children:"Auto Increment"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{fontSize:9,color:f.accent},children:"I"}),d.jsx("span",{style:{color:f.muted},children:"Indexed"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{color:f.accent},children:"âœ“"}),d.jsx("span",{style:{color:f.muted},children:"Nullable"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{color:f.foreground},children:"âœ—"}),d.jsx("span",{style:{color:f.muted},children:"Not Nullable"})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[d.jsx("span",{style:{color:f.muted},children:"D"}),d.jsx("span",{style:{color:f.muted},children:"Has Default"})]})]})]})}),h.summary&&(((L=n.target)==null?void 0:L.stats)||n.stats)&&d.jsx("div",{style:{marginTop:12,padding:"8px",backgroundColor:f.background,borderRadius:2,fontSize:11},children:(((W=n.target)==null?void 0:W.stats)||n.stats)&&d.jsxs(d.Fragment,{children:[(((O=(w=n.target)==null?void 0:w.stats)==null?void 0:O.rowCount)!==void 0||((S=n.stats)==null?void 0:S.rowCount)!==void 0)&&d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[d.jsx("span",{style:{color:f.muted},children:"Target Rows:"}),d.jsx("span",{style:{color:f.foreground},children:(((j=(z=n.target)==null?void 0:z.stats)==null?void 0:j.rowCount)||((v=n.stats)==null?void 0:v.rowCount)||0).toLocaleString()})]}),(((B=(D=n.target)==null?void 0:D.stats)==null?void 0:B.tableSize)||((I=n.stats)==null?void 0:I.tableSize))&&d.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[d.jsx("span",{style:{color:f.muted},children:"Table Size:"}),d.jsx("span",{style:{color:f.foreground},children:((Q=(V=n.target)==null?void 0:V.stats)==null?void 0:Q.tableSize)||((J=n.stats)==null?void 0:J.tableSize)})]})]})})]}),d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:24,justifyContent:"center",minHeight:400},children:[d.jsxs("div",{style:{flex:"0 0 350px",background:f.background,border:`2px solid ${f.accent}`,borderRadius:2,padding:"16px",fontFamily:"Consolas",fontSize:12,maxHeight:600,overflow:"hidden",display:"flex",flexDirection:"column"},children:[d.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"8px",borderBottom:`2px solid ${f.border}`,marginBottom:"12px",cursor:"pointer"},onClick:()=>y("source"),children:d.jsxs("div",{children:[d.jsxs("h3",{style:{fontSize:13,fontWeight:600,margin:0,color:f.accent,fontFamily:"Consolas"},children:[t," ",h.source?"â–¼":"â–¶"]}),d.jsx("div",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",marginTop:4},children:i})]})}),h.source&&d.jsxs("div",{style:{overflowY:"auto",flex:1},children:[d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8,fontSize:12},children:o.map((U,q)=>d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"6px 0",borderBottom:q<o.length-1?`1px solid ${f.border}`:"none"},children:[d.jsxs("span",{style:{color:f.muted,fontWeight:500,fontFamily:"Consolas"},children:[U.label,":"]}),d.jsx("span",{style:{color:f.foreground,wordBreak:"break-all",textAlign:"right",maxWidth:180,fontFamily:"Consolas",fontSize:11},children:U.value})]},q))}),R.length>0&&d.jsxs("div",{style:{marginTop:12},children:[d.jsxs("div",{style:{fontSize:11,fontWeight:600,color:f.foreground,marginBottom:8,fontFamily:"Consolas"},children:["Source Columns (",R.length,")"]}),d.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11,fontFamily:"Consolas"},children:[d.jsx("thead",{style:{background:f.backgroundSoft,position:"sticky",top:0,zIndex:10},children:d.jsxs("tr",{style:{borderBottom:`2px solid ${f.border}`},children:[d.jsx("th",{style:{padding:"6px 4px",textAlign:"left",fontWeight:600,fontSize:10,width:20},children:"#"}),d.jsx("th",{style:{padding:"6px 4px",textAlign:"left",fontWeight:600,fontSize:10,width:"35%"},children:"Name"}),d.jsx("th",{style:{padding:"6px 4px",textAlign:"left",fontWeight:600,fontSize:10},children:"Type"}),d.jsx("th",{style:{padding:"6px 4px",textAlign:"center",fontWeight:600,fontSize:10,width:60},children:"Flags"})]})}),d.jsx("tbody",{children:R.map((U,q)=>{const G=m.find(Ae=>{var Se;return((Se=Ae.source)==null?void 0:Se.name)===U.name}),ae=x(U.name,!0)||U.isPK,ce=T(U.name,!0)||U.isFK,oe=k(U.name,!0),Ee=p===`source-${U.name}`,je=G?E(G):f.accent;return d.jsxs("tr",{style:{borderBottom:`1px solid ${f.border}`,transition:"all 0.2s ease",backgroundColor:Ee?f.backgroundSoft:f.background,borderLeft:Ee?`3px solid ${je}`:"3px solid transparent"},onMouseEnter:()=>{g(`source-${U.name}`),G!=null&&G.target&&g(`target-${G.target.name}`)},onMouseLeave:()=>g(null),children:[d.jsx("td",{style:{padding:"4px",color:f.muted,fontSize:10},children:q+1}),d.jsx("td",{style:{padding:"4px",fontWeight:500,color:f.accent},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[U.name,ae&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"PK"}),ce&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"FK"}),U.isUnique&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"UQ"}),U.isAutoIncrement&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"AI"})]})}),d.jsx("td",{style:{padding:"4px",color:f.muted,fontSize:10},children:U.type}),d.jsx("td",{style:{padding:"4px",textAlign:"center",fontSize:9},children:d.jsxs("div",{style:{display:"flex",gap:4,justifyContent:"center"},children:[U.nullable?d.jsx("span",{style:{color:f.accent},children:"âœ“"}):d.jsx("span",{style:{color:f.foreground},children:"âœ—"}),U.default&&d.jsx("span",{style:{color:f.muted},title:U.default,children:"D"}),oe&&d.jsx("span",{style:{color:f.accent},children:"I"})]})})]},U.name)})})]})]})]})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:"0 0 80px",paddingTop:40,position:"relative"},children:[d.jsx("div",{style:{width:60,height:4,background:f.accent,position:"relative"},children:d.jsx("div",{style:{position:"absolute",right:-8,top:-6,width:0,height:0,borderLeft:`12px solid ${f.accent}`,borderTop:"8px solid transparent",borderBottom:"8px solid transparent"}})}),p&&(()=>{const U=R.find(G=>p===`source-${G.name}`),q=U?m.find(G=>{var ae;return((ae=G.source)==null?void 0:ae.name)===U.name}):null;if(q&&q.target){const G=R.findIndex(ce=>{var oe;return ce.name===((oe=q.source)==null?void 0:oe.name)}),ae=P.findIndex(ce=>ce.name===q.target.name);if(G>=0&&ae>=0){const ce=G*28+100,oe=ae*28+100;return d.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:5},children:d.jsx("line",{x1:"0",y1:ce,x2:"100%",y2:oe,stroke:E(q),strokeWidth:"2",strokeDasharray:q.differences&&(q.differences.type||q.differences.nullable)?"5,5":"0"})})}}return null})()]}),d.jsxs("div",{style:{flex:"0 0 350px",background:f.background,border:`2px solid ${f.accent}`,borderRadius:2,padding:"16px",fontFamily:"Consolas",fontSize:12,maxHeight:600,overflow:"hidden",display:"flex",flexDirection:"column"},children:[d.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"8px",borderBottom:`2px solid ${f.border}`,marginBottom:"12px",cursor:"pointer"},onClick:()=>y("target"),children:d.jsxs("div",{children:[d.jsxs("h3",{style:{fontSize:13,fontWeight:600,margin:0,color:f.accent,fontFamily:"Consolas"},children:["Target: ",((se=n.target)==null?void 0:se.table)||n.table," ",h.target?"â–¼":"â–¶"]}),d.jsxs("div",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",marginTop:4},children:[((le=n.target)==null?void 0:le.schema)||n.schema||"N/A",".",((xe=n.target)==null?void 0:xe.table)||n.table||"N/A"," (",((ge=n.target)==null?void 0:ge.db_engine)||n.db_engine||"N/A",")"]}),(((ue=n.target)==null?void 0:ue.stats)||n.stats)&&d.jsxs("div",{style:{fontSize:10,color:f.muted,marginTop:2},children:[(((Oe=(Ne=n.target)==null?void 0:Ne.stats)==null?void 0:Oe.rowCount)||((Re=n.stats)==null?void 0:Re.rowCount)||0).toLocaleString()," rows â€¢ ",((de=(be=n.target)==null?void 0:be.stats)==null?void 0:de.tableSize)||((Fe=n.stats)==null?void 0:Fe.tableSize)||"N/A"]})]})}),h.target&&_&&_.length>0?d.jsx("div",{style:{overflowY:"auto",flex:1},children:d.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11,fontFamily:"Consolas"},children:[d.jsx("thead",{style:{background:f.backgroundSoft,position:"sticky",top:0,zIndex:10},children:d.jsxs("tr",{style:{borderBottom:`2px solid ${f.border}`},children:[d.jsx("th",{style:{padding:"6px 4px",textAlign:"left",fontWeight:600,fontSize:10,width:20},children:"#"}),d.jsx("th",{style:{padding:"6px 4px",textAlign:"left",fontWeight:600,fontSize:10,width:"35%"},children:"Name"}),d.jsx("th",{style:{padding:"6px 4px",textAlign:"left",fontWeight:600,fontSize:10},children:"Type"}),d.jsx("th",{style:{padding:"6px 4px",textAlign:"center",fontWeight:600,fontSize:10,width:60},children:"Flags"})]})}),d.jsx("tbody",{children:P.map((U,q)=>{const G=m.find(Ae=>{var Se;return((Se=Ae.target)==null?void 0:Se.name)===U.name}),ae=x(U.name,!1)||U.isPK,ce=T(U.name,!1)||U.isFK,oe=k(U.name,!1),Ee=p===`target-${U.name}`,je=G?E(G):f.accent;return d.jsxs("tr",{style:{borderBottom:`1px solid ${f.border}`,transition:"all 0.2s ease",backgroundColor:Ee?f.backgroundSoft:f.background,borderLeft:Ee?`3px solid ${je}`:"3px solid transparent"},onMouseEnter:()=>{g(`target-${U.name}`),G!=null&&G.source&&g(`source-${G.source.name}`)},onMouseLeave:()=>g(null),children:[d.jsx("td",{style:{padding:"4px",color:f.muted,fontSize:10},children:q+1}),d.jsx("td",{style:{padding:"4px",fontWeight:500,color:f.accent},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[U.name,ae&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"PK"}),ce&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"FK"}),U.isUnique&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"UQ"}),U.isAutoIncrement&&d.jsx("span",{style:{fontSize:9,color:f.accent,fontWeight:600},children:"AI"})]})}),d.jsx("td",{style:{padding:"4px",color:f.muted,fontSize:10},children:U.type}),d.jsx("td",{style:{padding:"4px",textAlign:"center",fontSize:9},children:d.jsxs("div",{style:{display:"flex",gap:4,justifyContent:"center"},children:[U.nullable?d.jsx("span",{style:{color:f.accent},children:"âœ“"}):d.jsx("span",{style:{color:f.foreground},children:"âœ—"}),U.default&&d.jsx("span",{style:{color:f.muted},title:U.default,children:"D"}),oe&&d.jsx("span",{style:{color:f.accent},children:"I"})]})})]},U.name)})})]})}):d.jsx("div",{style:{padding:"20px",textAlign:"center",color:f.muted,fontSize:11},children:"Target structure not available"})]})]})]})})};let el=[],yu=[];(()=>{let n="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<n.length;e++)(e%2?yu:el).push(t=t+n[e])})();function Og(n){if(n<768)return!1;for(let e=0,t=el.length;;){let i=e+t>>1;if(n<el[i])t=i;else if(n>=yu[i])e=i+1;else return!0;if(e==t)return!1}}function Za(n){return n>=127462&&n<=127487}const ec=8205;function Ng(n,e,t=!0,i=!0){return(t?xu:Rg)(n,e,i)}function xu(n,e,t){if(e==n.length)return e;e&&bu(n.charCodeAt(e))&&vu(n.charCodeAt(e-1))&&e--;let i=fr(n,e);for(e+=tc(i);e<n.length;){let o=fr(n,e);if(i==ec||o==ec||t&&Og(o))e+=tc(o),i=o;else if(Za(o)){let s=0,r=e-2;for(;r>=0&&Za(fr(n,r));)s++,r-=2;if(s%2==0)break;e+=2}else break}return e}function Rg(n,e,t){for(;e>0;){let i=xu(n,e-2,t);if(i<e)return i;e--}return 0}function fr(n,e){let t=n.charCodeAt(e);if(!vu(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return bu(i)?(t-55296<<10)+(i-56320)+65536:t}function bu(n){return n>=56320&&n<57344}function vu(n){return n>=55296&&n<56320}function tc(n){return n<65536?1:2}class ke{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=ki(this,e,t);let o=[];return this.decompose(0,e,o,2),i.length&&i.decompose(0,i.length,o,3),this.decompose(t,this.length,o,1),Kt.from(o,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=ki(this,e,t);let i=[];return this.decompose(e,t,i,0),Kt.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),o=new Gi(this),s=new Gi(e);for(let r=t,l=t;;){if(o.next(r),s.next(r),r=0,o.lineBreak!=s.lineBreak||o.done!=s.done||o.value!=s.value)return!1;if(l+=o.value.length,o.done||l>=i)return!0}}iter(e=1){return new Gi(this,e)}iterRange(e,t=this.length){return new wu(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let o=this.line(e).from;i=this.iterRange(o,Math.max(o,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Su(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?ke.empty:e.length<=32?new Ie(e):Kt.from(Ie.split(e,[]))}}class Ie extends ke{constructor(e,t=jg(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,o){for(let s=0;;s++){let r=this.text[s],l=o+r.length;if((t?i:l)>=e)return new Dg(o,l,i,r);o=l+1,i++}}decompose(e,t,i,o){let s=e<=0&&t>=this.length?this:new Ie(nc(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(o&1){let r=i.pop(),l=ls(s.text,r.text.slice(),0,s.length);if(l.length<=32)i.push(new Ie(l,r.length+s.length));else{let a=l.length>>1;i.push(new Ie(l.slice(0,a)),new Ie(l.slice(a)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof Ie))return super.replace(e,t,i);[e,t]=ki(this,e,t);let o=ls(this.text,ls(i.text,nc(this.text,0,e)),t),s=this.length+i.length-(t-e);return o.length<=32?new Ie(o,s):Kt.from(Ie.split(o,[]),s)}sliceString(e,t=this.length,i=`
`){[e,t]=ki(this,e,t);let o="";for(let s=0,r=0;s<=t&&r<this.text.length;r++){let l=this.text[r],a=s+l.length;s>e&&r&&(o+=i),e<a&&t>s&&(o+=l.slice(Math.max(0,e-s),t-s)),s=a+1}return o}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],o=-1;for(let s of e)i.push(s),o+=s.length+1,i.length==32&&(t.push(new Ie(i,o)),i=[],o=-1);return o>-1&&t.push(new Ie(i,o)),t}}class Kt extends ke{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,o){for(let s=0;;s++){let r=this.children[s],l=o+r.length,a=i+r.lines-1;if((t?a:l)>=e)return r.lineInner(e,t,i,o);o=l+1,i=a+1}}decompose(e,t,i,o){for(let s=0,r=0;r<=t&&s<this.children.length;s++){let l=this.children[s],a=r+l.length;if(e<=a&&t>=r){let c=o&((r<=e?1:0)|(a>=t?2:0));r>=e&&a<=t&&!c?i.push(l):l.decompose(e-r,t-r,i,c)}r=a+1}}replace(e,t,i){if([e,t]=ki(this,e,t),i.lines<this.lines)for(let o=0,s=0;o<this.children.length;o++){let r=this.children[o],l=s+r.length;if(e>=s&&t<=l){let a=r.replace(e-s,t-s,i),c=this.lines-r.lines+a.lines;if(a.lines<c>>5-1&&a.lines>c>>5+1){let h=this.children.slice();return h[o]=a,new Kt(h,this.length-(t-e)+i.length)}return super.replace(s,l,a)}s=l+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){[e,t]=ki(this,e,t);let o="";for(let s=0,r=0;s<this.children.length&&r<=t;s++){let l=this.children[s],a=r+l.length;r>e&&s&&(o+=i),e<a&&t>r&&(o+=l.sliceString(e-r,t-r,i)),r=a+1}return o}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Kt))return 0;let i=0,[o,s,r,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;o+=t,s+=t){if(o==r||s==l)return i;let a=this.children[o],c=e.children[s];if(a!=c)return i+a.scanIdentical(c,t);i+=a.length+1}}static from(e,t=e.reduce((i,o)=>i+o.length+1,-1)){let i=0;for(let g of e)i+=g.lines;if(i<32){let g=[];for(let y of e)y.flatten(g);return new Ie(g,t)}let o=Math.max(32,i>>5),s=o<<1,r=o>>1,l=[],a=0,c=-1,h=[];function u(g){let y;if(g.lines>s&&g instanceof Kt)for(let m of g.children)u(m);else g.lines>r&&(a>r||!a)?(p(),l.push(g)):g instanceof Ie&&a&&(y=h[h.length-1])instanceof Ie&&g.lines+y.lines<=32?(a+=g.lines,c+=g.length+1,h[h.length-1]=new Ie(y.text.concat(g.text),y.length+1+g.length)):(a+g.lines>o&&p(),a+=g.lines,c+=g.length+1,h.push(g))}function p(){a!=0&&(l.push(h.length==1?h[0]:Kt.from(h,c)),c=-1,a=h.length=0)}for(let g of e)u(g);return p(),l.length==1?l[0]:new Kt(l,t)}}ke.empty=new Ie([""],0);function jg(n){let e=-1;for(let t of n)e+=t.length+1;return e}function ls(n,e,t=0,i=1e9){for(let o=0,s=0,r=!0;s<n.length&&o<=i;s++){let l=n[s],a=o+l.length;a>=t&&(a>i&&(l=l.slice(0,i-o)),o<t&&(l=l.slice(t-o)),r?(e[e.length-1]+=l,r=!1):e.push(l)),o=a+1}return e}function nc(n,e,t){return ls(n,[""],e,t)}class Gi{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Ie?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,o=this.nodes[i],s=this.offsets[i],r=s>>1,l=o instanceof Ie?o.text.length:o.children.length;if(r==(t>0?l:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(o instanceof Ie){let a=o.text[r+(t<0?-1:0)];if(this.offsets[i]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=o.children[r+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof Ie?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class wu{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Gi(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:o}=this.cursor.next(e);return this.pos+=(o.length+e)*t,this.value=o.length<=i?o:t<0?o.slice(o.length-i):o.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class Su{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:o}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=o,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(ke.prototype[Symbol.iterator]=function(){return this.iter()},Gi.prototype[Symbol.iterator]=wu.prototype[Symbol.iterator]=Su.prototype[Symbol.iterator]=function(){return this});class Dg{constructor(e,t,i,o){this.from=e,this.to=t,this.number=i,this.text=o}get length(){return this.to-this.from}}function ki(n,e,t){return e=Math.max(0,Math.min(n.length,e)),[e,Math.max(e,Math.min(n.length,t))]}function yt(n,e,t=!0,i=!0){return Ng(n,e,t,i)}function Bg(n){return n>=56320&&n<57344}function Pg(n){return n>=55296&&n<56320}function xn(n,e){let t=n.charCodeAt(e);if(!Pg(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return Bg(i)?(t-55296<<10)+(i-56320)+65536:t}function ku(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function Vn(n){return n<65536?1:2}const tl=/\r\n?|\n/;var ct=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(ct||(ct={}));class Xt{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,o=0;t<this.sections.length;){let s=this.sections[t++],r=this.sections[t++];r<0?(e(i,o,s),o+=s):o+=r,i+=s}}iterChangedRanges(e,t=!1){nl(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],o=this.sections[t++];o<0?e.push(i,o):e.push(o,i)}return new Xt(e)}composeDesc(e){return this.empty?e:e.empty?this:Cu(this,e)}mapDesc(e,t=!1){return e.empty?this:il(this,e,t)}mapPos(e,t=-1,i=ct.Simple){let o=0,s=0;for(let r=0;r<this.sections.length;){let l=this.sections[r++],a=this.sections[r++],c=o+l;if(a<0){if(c>e)return s+(e-o);s+=l}else{if(i!=ct.Simple&&c>=e&&(i==ct.TrackDel&&o<e&&c>e||i==ct.TrackBefore&&o<e||i==ct.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!l)return e==o||t<0?s:s+a;s+=a}o=c}if(e>o)throw new RangeError(`Position ${e} is out of range for changeset of length ${o}`);return s}touchesRange(e,t=e){for(let i=0,o=0;i<this.sections.length&&o<=t;){let s=this.sections[i++],r=this.sections[i++],l=o+s;if(r>=0&&o<=t&&l>=e)return o<e&&l>t?"cover":!0;o=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],o=this.sections[t++];e+=(e?" ":"")+i+(o>=0?":"+o:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Xt(e)}static create(e){return new Xt(e)}}class $e extends Xt{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return nl(this,(t,i,o,s,r)=>e=e.replace(o,o+(i-t),r),!1),e}mapDesc(e,t=!1){return il(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let o=0,s=0;o<t.length;o+=2){let r=t[o],l=t[o+1];if(l>=0){t[o]=l,t[o+1]=r;let a=o>>1;for(;i.length<a;)i.push(ke.empty);i.push(r?e.slice(s,s+r):ke.empty)}s+=r}return new $e(t,i)}compose(e){return this.empty?e:e.empty?this:Cu(this,e,!0)}map(e,t=!1){return e.empty?this:il(this,e,t,!0)}iterChanges(e,t=!1){nl(this,e,t)}get desc(){return Xt.create(this.sections)}filter(e){let t=[],i=[],o=[],s=new io(this);e:for(let r=0,l=0;;){let a=r==e.length?1e9:e[r++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let h=Math.min(s.len,a-l);Ge(o,h,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;Ge(t,h,u),u>0&&Tn(i,t,s.text),s.forward(h),l+=h}let c=e[r++];for(;l<c;){if(s.done)break e;let h=Math.min(s.len,c-l);Ge(t,h,-1),Ge(o,h,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(h),l+=h}}return{changes:new $e(t,i),filtered:Xt.create(o)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],o=this.sections[t+1];o<0?e.push(i):o==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let o=[],s=[],r=0,l=null;function a(h=!1){if(!h&&!o.length)return;r<t&&Ge(o,t-r,-1);let u=new $e(o,s);l=l?l.compose(u.map(l)):u,o=[],s=[],r=0}function c(h){if(Array.isArray(h))for(let u of h)c(u);else if(h instanceof $e){if(h.length!=t)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${t})`);a(),l=l?l.compose(h.map(l)):h}else{let{from:u,to:p=u,insert:g}=h;if(u>p||u<0||p>t)throw new RangeError(`Invalid change range ${u} to ${p} (in doc of length ${t})`);let y=g?typeof g=="string"?ke.of(g.split(i||tl)):g:ke.empty,m=y.length;if(u==p&&m==0)return;u<r&&a(),u>r&&Ge(o,u-r,-1),Ge(o,p-u,m),Tn(s,o,y),r=p}}return c(e),a(!l),l}static empty(e){return new $e(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let o=0;o<e.length;o++){let s=e[o];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((r,l)=>l&&typeof r!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<o;)i.push(ke.empty);i[o]=ke.of(s.slice(1)),t.push(s[0],i[o].length)}}}return new $e(t,i)}static createSet(e,t){return new $e(e,t)}}function Ge(n,e,t,i=!1){if(e==0&&t<=0)return;let o=n.length-2;o>=0&&t<=0&&t==n[o+1]?n[o]+=e:o>=0&&e==0&&n[o]==0?n[o+1]+=t:i?(n[o]+=e,n[o+1]+=t):n.push(e,t)}function Tn(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(ke.empty);n.push(t)}}function nl(n,e,t){let i=n.inserted;for(let o=0,s=0,r=0;r<n.sections.length;){let l=n.sections[r++],a=n.sections[r++];if(a<0)o+=l,s+=l;else{let c=o,h=s,u=ke.empty;for(;c+=l,h+=a,a&&i&&(u=u.append(i[r-2>>1])),!(t||r==n.sections.length||n.sections[r+1]<0);)l=n.sections[r++],a=n.sections[r++];e(o,c,s,h,u),o=c,s=h}}}function il(n,e,t,i=!1){let o=[],s=i?[]:null,r=new io(n),l=new io(e);for(let a=-1;;){if(r.done&&l.len||l.done&&r.len)throw new Error("Mismatched change set lengths");if(r.ins==-1&&l.ins==-1){let c=Math.min(r.len,l.len);Ge(o,c,-1),r.forward(c),l.forward(c)}else if(l.ins>=0&&(r.ins<0||a==r.i||r.off==0&&(l.len<r.len||l.len==r.len&&!t))){let c=l.len;for(Ge(o,l.ins,-1);c;){let h=Math.min(r.len,c);r.ins>=0&&a<r.i&&r.len<=h&&(Ge(o,0,r.ins),s&&Tn(s,o,r.text),a=r.i),r.forward(h),c-=h}l.next()}else if(r.ins>=0){let c=0,h=r.len;for(;h;)if(l.ins==-1){let u=Math.min(h,l.len);c+=u,h-=u,l.forward(u)}else if(l.ins==0&&l.len<h)h-=l.len,l.next();else break;Ge(o,c,a<r.i?r.ins:0),s&&a<r.i&&Tn(s,o,r.text),a=r.i,r.forward(r.len-h)}else{if(r.done&&l.done)return s?$e.createSet(o,s):Xt.create(o);throw new Error("Mismatched change set lengths")}}}function Cu(n,e,t=!1){let i=[],o=t?[]:null,s=new io(n),r=new io(e);for(let l=!1;;){if(s.done&&r.done)return o?$e.createSet(i,o):Xt.create(i);if(s.ins==0)Ge(i,s.len,0,l),s.next();else if(r.len==0&&!r.done)Ge(i,0,r.ins,l),o&&Tn(o,i,r.text),r.next();else{if(s.done||r.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,r.len),c=i.length;if(s.ins==-1){let h=r.ins==-1?-1:r.off?0:r.ins;Ge(i,a,h,l),o&&h&&Tn(o,i,r.text)}else r.ins==-1?(Ge(i,s.off?0:s.len,a,l),o&&Tn(o,i,s.textBit(a))):(Ge(i,s.off?0:s.len,r.off?0:r.ins,l),o&&!r.off&&Tn(o,i,r.text));l=(s.ins>a||r.ins>=0&&r.len>a)&&(l||i.length>c),s.forward2(a),r.forward(a)}}}}class io{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?ke.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?ke.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class qn{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let i,o;return this.empty?i=o=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),o=e.mapPos(this.to,-1)),i==this.from&&o==this.to?this:new qn(i,o,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return te.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return te.range(this.anchor,i)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return te.range(e.anchor,e.head)}static create(e,t,i){return new qn(e,t,i)}}class te{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:te.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new te([this.main],0)}addRange(e,t=!0){return te.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,te.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new te(e.ranges.map(t=>qn.fromJSON(t)),e.main)}static single(e,t=e){return new te([te.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,o=0;o<e.length;o++){let s=e[o];if(s.empty?s.from<=i:s.from<i)return te.normalized(e.slice(),t);i=s.to}return new te(e,t)}static cursor(e,t=0,i,o){return qn.create(e,e,(t==0?0:t<0?8:16)|(i==null?7:Math.min(6,i))|(o??16777215)<<6)}static range(e,t,i,o){let s=(i??16777215)<<6|(o==null?7:Math.min(6,o));return t<e?qn.create(t,e,48|s):qn.create(e,t,(t>e?8:0)|s)}static normalized(e,t=0){let i=e[t];e.sort((o,s)=>o.from-s.from),t=e.indexOf(i);for(let o=1;o<e.length;o++){let s=e[o],r=e[o-1];if(s.empty?s.from<=r.to:s.from<r.to){let l=r.from,a=Math.max(s.to,r.to);o<=t&&t--,e.splice(--o,2,s.anchor>s.head?te.range(a,l):te.range(l,a))}}return new te(e,t)}}function Tu(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let la=0;class ne{constructor(e,t,i,o,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=o,this.id=la++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(e={}){return new ne(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:aa),!!e.static,e.enables)}of(e){return new as([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new as(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new as(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function aa(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class as{constructor(e,t,i,o){this.dependencies=e,this.facet=t,this.type=i,this.value=o,this.id=la++}dynamicSlot(e){var t;let i=this.value,o=this.facet.compareInput,s=this.id,r=e[s]>>1,l=this.type==2,a=!1,c=!1,h=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?c=!0:((t=e[u.id])!==null&&t!==void 0?t:1)&1||h.push(e[u.id]);return{create(u){return u.values[r]=i(u),1},update(u,p){if(a&&p.docChanged||c&&(p.docChanged||p.selection)||ol(u,h)){let g=i(u);if(l?!ic(g,u.values[r],o):!o(g,u.values[r]))return u.values[r]=g,1}return 0},reconfigure:(u,p)=>{let g,y=p.config.address[s];if(y!=null){let m=bs(p,y);if(this.dependencies.every(b=>b instanceof ne?p.facet(b)===u.facet(b):b instanceof Dt?p.field(b,!1)==u.field(b,!1):!0)||(l?ic(g=i(u),m,o):o(g=i(u),m)))return u.values[r]=m,0}else g=i(u);return u.values[r]=g,1}}}}function ic(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function ol(n,e){let t=!1;for(let i of e)Ji(n,i)&1&&(t=!0);return t}function Ig(n,e,t){let i=t.map(a=>n[a.id]),o=t.map(a=>a.type),s=i.filter(a=>!(a&1)),r=n[e.id]>>1;function l(a){let c=[];for(let h=0;h<i.length;h++){let u=bs(a,i[h]);if(o[h]==2)for(let p of u)c.push(p);else c.push(u)}return e.combine(c)}return{create(a){for(let c of i)Ji(a,c);return a.values[r]=l(a),1},update(a,c){if(!ol(a,s))return 0;let h=l(a);return e.compare(h,a.values[r])?0:(a.values[r]=h,1)},reconfigure(a,c){let h=ol(a,i),u=c.config.facets[e.id],p=c.facet(e);if(u&&!h&&aa(t,u))return a.values[r]=p,0;let g=l(a);return e.compare(g,p)?(a.values[r]=p,0):(a.values[r]=g,1)}}}const jo=ne.define({static:!0});class Dt{constructor(e,t,i,o,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=o,this.spec=s,this.provides=void 0}static define(e){let t=new Dt(la++,e.create,e.update,e.compare||((i,o)=>i===o),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(jo).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,o)=>{let s=i.values[t],r=this.updateF(s,o);return this.compareF(s,r)?0:(i.values[t]=r,1)},reconfigure:(i,o)=>{let s=i.facet(jo),r=o.facet(jo),l;return(l=s.find(a=>a.field==this))&&l!=r.find(a=>a.field==this)?(i.values[t]=l.create(i),1):o.config.address[this.id]!=null?(i.values[t]=o.field(this),0):(i.values[t]=this.create(i),1)}}}init(e){return[this,jo.of({field:this,create:e})]}get extension(){return this}}const Un={lowest:4,low:3,default:2,high:1,highest:0};function Pi(n){return e=>new Eu(e,n)}const ko={highest:Pi(Un.highest),high:Pi(Un.high),default:Pi(Un.default),low:Pi(Un.low),lowest:Pi(Un.lowest)};class Eu{constructor(e,t){this.inner=e,this.prec=t}}class Ys{of(e){return new sl(this,e)}reconfigure(e){return Ys.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class sl{constructor(e,t){this.compartment=e,this.inner=t}}class xs{constructor(e,t,i,o,s,r){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=o,this.staticValues=s,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let o=[],s=Object.create(null),r=new Map;for(let p of zg(e,t,r))p instanceof Dt?o.push(p):(s[p.facet.id]||(s[p.facet.id]=[])).push(p);let l=Object.create(null),a=[],c=[];for(let p of o)l[p.id]=c.length<<1,c.push(g=>p.slot(g));let h=i==null?void 0:i.config.facets;for(let p in s){let g=s[p],y=g[0].facet,m=h&&h[p]||[];if(g.every(b=>b.type==0))if(l[y.id]=a.length<<1|1,aa(m,g))a.push(i.facet(y));else{let b=y.combine(g.map(x=>x.value));a.push(i&&y.compare(b,i.facet(y))?i.facet(y):b)}else{for(let b of g)b.type==0?(l[b.id]=a.length<<1|1,a.push(b.value)):(l[b.id]=c.length<<1,c.push(x=>b.dynamicSlot(x)));l[y.id]=c.length<<1,c.push(b=>Ig(b,y,g))}}let u=c.map(p=>p(l));return new xs(e,r,u,l,a,s)}}function zg(n,e,t){let i=[[],[],[],[],[]],o=new Map;function s(r,l){let a=o.get(r);if(a!=null){if(a<=l)return;let c=i[a].indexOf(r);c>-1&&i[a].splice(c,1),r instanceof sl&&t.delete(r.compartment)}if(o.set(r,l),Array.isArray(r))for(let c of r)s(c,l);else if(r instanceof sl){if(t.has(r.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(r.compartment)||r.inner;t.set(r.compartment,c),s(c,l)}else if(r instanceof Eu)s(r.inner,r.prec);else if(r instanceof Dt)i[l].push(r),r.provides&&s(r.provides,l);else if(r instanceof as)i[l].push(r),r.facet.extensions&&s(r.facet.extensions,Un.default);else{let c=r.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${r}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(c,l)}}return s(n,Un.default),i.reduce((r,l)=>r.concat(l))}function Ji(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let o=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|o}function bs(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const Au=ne.define(),rl=ne.define({combine:n=>n.some(e=>e),static:!0}),_u=ne.define({combine:n=>n.length?n[0]:void 0,static:!0}),Mu=ne.define(),Ou=ne.define(),Nu=ne.define(),Ru=ne.define({combine:n=>n.length?n[0]:!1});class fn{constructor(e,t){this.type=e,this.value=t}static define(){return new Lg}}class Lg{of(e){return new fn(this,e)}}class Fg{constructor(e){this.map=e}of(e){return new Te(this,e)}}class Te{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new Te(this.type,t)}is(e){return this.type==e}static define(e={}){return new Fg(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let o of e){let s=o.map(t);s&&i.push(s)}return i}}Te.reconfigure=Te.define();Te.appendConfig=Te.define();class We{constructor(e,t,i,o,s,r){this.startState=e,this.changes=t,this.selection=i,this.effects=o,this.annotations=s,this.scrollIntoView=r,this._doc=null,this._state=null,i&&Tu(i,t.newLength),s.some(l=>l.type==We.time)||(this.annotations=s.concat(We.time.of(Date.now())))}static create(e,t,i,o,s,r){return new We(e,t,i,o,s,r)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(We.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}We.time=fn.define();We.userEvent=fn.define();We.addToHistory=fn.define();We.remote=fn.define();function $g(n,e){let t=[];for(let i=0,o=0;;){let s,r;if(i<n.length&&(o==e.length||e[o]>=n[i]))s=n[i++],r=n[i++];else if(o<e.length)s=e[o++],r=e[o++];else return t;!t.length||t[t.length-1]<s?t.push(s,r):t[t.length-1]<r&&(t[t.length-1]=r)}}function ju(n,e,t){var i;let o,s,r;return t?(o=e.changes,s=$e.empty(e.changes.length),r=n.changes.compose(e.changes)):(o=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),r=n.changes.compose(o)),{changes:r,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(o),effects:Te.mapEffects(n.effects,o).concat(Te.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function ll(n,e,t){let i=e.selection,o=pi(e.annotations);return e.userEvent&&(o=o.concat(We.userEvent.of(e.userEvent))),{changes:e.changes instanceof $e?e.changes:$e.of(e.changes||[],t,n.facet(_u)),selection:i&&(i instanceof te?i:te.single(i.anchor,i.head)),effects:pi(e.effects),annotations:o,scrollIntoView:!!e.scrollIntoView}}function Du(n,e,t){let i=ll(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let r=!!e[s].sequential;i=ju(i,ll(n,e[s],r?i.changes.newLength:n.doc.length),r)}let o=We.create(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return Hg(t?Wg(o):o)}function Wg(n){let e=n.startState,t=!0;for(let o of e.facet(Mu)){let s=o(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:$g(t,s))}if(t!==!0){let o,s;if(t===!1)s=n.changes.invertedDesc,o=$e.empty(e.doc.length);else{let r=n.changes.filter(t);o=r.changes,s=r.filtered.mapDesc(r.changes).invertedDesc}n=We.create(e,o,n.selection&&n.selection.map(s),Te.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(Ou);for(let o=i.length-1;o>=0;o--){let s=i[o](n);s instanceof We?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof We?n=s[0]:n=Du(e,pi(s),!1)}return n}function Hg(n){let e=n.startState,t=e.facet(Nu),i=n;for(let o=t.length-1;o>=0;o--){let s=t[o](n);s&&Object.keys(s).length&&(i=ju(i,ll(e,s,n.changes.newLength),!0))}return i==n?n:We.create(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const Vg=[];function pi(n){return n==null?Vg:Array.isArray(n)?n:[n]}var ht=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(ht||(ht={}));const Ug=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let al;try{al=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function qg(n){if(al)return al.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"Â€"&&(t.toUpperCase()!=t.toLowerCase()||Ug.test(t)))return!0}return!1}function Kg(n){return e=>{if(!/\S/.test(e))return ht.Space;if(qg(e))return ht.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return ht.Word;return ht.Other}}class we{constructor(e,t,i,o,s,r){this.config=e,this.doc=t,this.selection=i,this.values=o,this.status=e.statusTemplate.slice(),this.computeSlot=s,r&&(r._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Ji(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return Ji(this,i),bs(this,i)}update(...e){return Du(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:o}=t;for(let l of e.effects)l.is(Ys.reconfigure)?(t&&(o=new Map,t.compartments.forEach((a,c)=>o.set(c,a)),t=null),o.set(l.value.compartment,l.value.extension)):l.is(Te.reconfigure)?(t=null,i=l.value):l.is(Te.appendConfig)&&(t=null,i=pi(i).concat(l.value));let s;t?s=e.startState.values.slice():(t=xs.resolve(i,o,this),s=new we(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(a,c)=>c.reconfigure(a,this),null).values);let r=e.startState.facet(rl)?e.newSelection:e.newSelection.asSingle();new we(t,e.newDoc,r,s,(l,a)=>a.update(l,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:te.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),o=this.changes(i.changes),s=[i.range],r=pi(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),c=this.changes(a.changes),h=c.map(o);for(let p=0;p<l;p++)s[p]=s[p].map(h);let u=o.mapDesc(c,!0);s.push(a.range.map(u)),o=o.compose(h),r=Te.mapEffects(r,h).concat(Te.mapEffects(pi(a.effects),u))}return{changes:o,selection:te.create(s,t.mainIndex),effects:r}}changes(e=[]){return e instanceof $e?e:$e.of(e,this.doc.length,this.facet(we.lineSeparator))}toText(e){return ke.of(e.split(this.facet(we.lineSeparator)||tl))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(Ji(this,t),bs(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let o=e[i];o instanceof Dt&&this.config.address[o.id]!=null&&(t[i]=o.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let o=[];if(i){for(let s in i)if(Object.prototype.hasOwnProperty.call(e,s)){let r=i[s],l=e[s];o.push(r.init(a=>r.spec.fromJSON(l,a)))}}return we.create({doc:e.doc,selection:te.fromJSON(e.selection),extensions:t.extensions?o.concat([t.extensions]):o})}static create(e={}){let t=xs.resolve(e.extensions||[],new Map),i=e.doc instanceof ke?e.doc:ke.of((e.doc||"").split(t.staticFacet(we.lineSeparator)||tl)),o=e.selection?e.selection instanceof te?e.selection:te.single(e.selection.anchor,e.selection.head):te.single(0);return Tu(o,i.length),t.staticFacet(rl)||(o=o.asSingle()),new we(t,i,o,t.dynamicSlots.map(()=>null),(s,r)=>r.create(s),null)}get tabSize(){return this.facet(we.tabSize)}get lineBreak(){return this.facet(we.lineSeparator)||`
`}get readOnly(){return this.facet(Ru)}phrase(e,...t){for(let i of this.facet(we.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(i,o)=>{if(o=="$")return"$";let s=+(o||1);return!s||s>t.length?i:t[s-1]})),e}languageDataAt(e,t,i=-1){let o=[];for(let s of this.facet(Au))for(let r of s(this,t,i))Object.prototype.hasOwnProperty.call(r,e)&&o.push(r[e]);return o}charCategorizer(e){let t=this.languageDataAt("wordChars",e);return Kg(t.length?t[0]:"")}wordAt(e){let{text:t,from:i,length:o}=this.doc.lineAt(e),s=this.charCategorizer(e),r=e-i,l=e-i;for(;r>0;){let a=yt(t,r,!1);if(s(t.slice(a,r))!=ht.Word)break;r=a}for(;l<o;){let a=yt(t,l);if(s(t.slice(l,a))!=ht.Word)break;l=a}return r==l?null:te.range(r+i,l+i)}}we.allowMultipleSelections=rl;we.tabSize=ne.define({combine:n=>n.length?n[0]:4});we.lineSeparator=_u;we.readOnly=Ru;we.phrases=ne.define({compare(n,e){let t=Object.keys(n),i=Object.keys(e);return t.length==i.length&&t.every(o=>n[o]==e[o])}});we.languageData=Au;we.changeFilter=Mu;we.transactionFilter=Ou;we.transactionExtender=Nu;Ys.reconfigure=Te.define();function Di(n,e,t={}){let i={};for(let o of n)for(let s of Object.keys(o)){let r=o[s],l=i[s];if(l===void 0)i[s]=r;else if(!(l===r||r===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,r);else throw new Error("Config merge conflict for field "+s)}for(let o in e)i[o]===void 0&&(i[o]=e[o]);return i}class Mn{eq(e){return this==e}range(e,t=e){return cl.create(e,t,this)}}Mn.prototype.startSide=Mn.prototype.endSide=0;Mn.prototype.point=!1;Mn.prototype.mapMode=ct.TrackDel;function ca(n,e){return n==e||n.constructor==e.constructor&&n.eq(e)}let cl=class Bu{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Bu(e,t,i)}};function hl(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class ha{constructor(e,t,i,o){this.from=e,this.to=t,this.value=i,this.maxPoint=o}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,o=0){let s=i?this.to:this.from;for(let r=o,l=s.length;;){if(r==l)return r;let a=r+l>>1,c=s[a]-e||(i?this.value[a].endSide:this.value[a].startSide)-t;if(a==r)return c>=0?r:l;c>=0?l=a:r=a+1}}between(e,t,i,o){for(let s=this.findIndex(t,-1e9,!0),r=this.findIndex(i,1e9,!1,s);s<r;s++)if(o(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let i=[],o=[],s=[],r=-1,l=-1;for(let a=0;a<this.value.length;a++){let c=this.value[a],h=this.from[a]+e,u=this.to[a]+e,p,g;if(h==u){let y=t.mapPos(h,c.startSide,c.mapMode);if(y==null||(p=g=y,c.startSide!=c.endSide&&(g=t.mapPos(h,c.endSide),g<p)))continue}else if(p=t.mapPos(h,c.startSide),g=t.mapPos(u,c.endSide),p>g||p==g&&c.startSide>0&&c.endSide<=0)continue;(g-p||c.endSide-c.startSide)<0||(r<0&&(r=p),c.point&&(l=Math.max(l,g-p)),i.push(c),o.push(p-r),s.push(g-r))}return{mapped:i.length?new ha(o,s,i,l):null,pos:r}}}class ve{constructor(e,t,i,o){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=o}static create(e,t,i,o){return new ve(e,t,i,o)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:o=0,filterTo:s=this.length}=e,r=e.filter;if(t.length==0&&!r)return this;if(i&&(t=t.slice().sort(hl)),this.isEmpty)return t.length?ve.of(t):this;let l=new Pu(this,null,-1).goto(0),a=0,c=[],h=new Ci;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let u=t[a++];h.addInner(u.from,u.to,u.value)||c.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!r||o>this.chunkEnd(l.chunkIndex)||s<this.chunkPos[l.chunkIndex])&&h.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!r||o>l.to||s<l.from||r(l.from,l.to,l.value))&&(h.addInner(l.from,l.to,l.value)||c.push(cl.create(l.from,l.to,l.value))),l.next());return h.finishInner(this.nextLayer.isEmpty&&!c.length?ve.empty:this.nextLayer.update({add:c,filter:r,filterFrom:o,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],o=-1;for(let r=0;r<this.chunk.length;r++){let l=this.chunkPos[r],a=this.chunk[r],c=e.touchesRange(l,l+a.length);if(c===!1)o=Math.max(o,a.maxPoint),t.push(a),i.push(e.mapPos(l));else if(c===!0){let{mapped:h,pos:u}=a.map(l,e);h&&(o=Math.max(o,h.maxPoint),t.push(h),i.push(u))}}let s=this.nextLayer.map(e);return t.length==0?s:new ve(i,t,s||ve.empty,o)}between(e,t,i){if(!this.isEmpty){for(let o=0;o<this.chunk.length;o++){let s=this.chunkPos[o],r=this.chunk[o];if(t>=s&&e<=s+r.length&&r.between(s,e-s,t-s,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return oo.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return oo.from(e).goto(t)}static compare(e,t,i,o,s=-1){let r=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),l=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),a=oc(r,l,i),c=new Ii(r,a,s),h=new Ii(l,a,s);i.iterGaps((u,p,g)=>sc(c,u,h,p,g,o)),i.empty&&i.length==0&&sc(c,0,h,0,0,o)}static eq(e,t,i=0,o){o==null&&(o=1e9-1);let s=e.filter(h=>!h.isEmpty&&t.indexOf(h)<0),r=t.filter(h=>!h.isEmpty&&e.indexOf(h)<0);if(s.length!=r.length)return!1;if(!s.length)return!0;let l=oc(s,r),a=new Ii(s,l,0).goto(i),c=new Ii(r,l,0).goto(i);for(;;){if(a.to!=c.to||!ul(a.active,c.active)||a.point&&(!c.point||!ca(a.point,c.point)))return!1;if(a.to>o)return!0;a.next(),c.next()}}static spans(e,t,i,o,s=-1){let r=new Ii(e,null,s).goto(t),l=t,a=r.openStart;for(;;){let c=Math.min(r.to,i);if(r.point){let h=r.activeForPoint(r.to),u=r.pointFrom<t?h.length+1:r.point.startSide<0?h.length:Math.min(h.length,a);o.point(l,c,r.point,h,u,r.pointRank),a=Math.min(r.openEnd(c),h.length)}else c>l&&(o.span(l,c,r.active,a),a=r.openEnd(c));if(r.to>i)return a+(r.point&&r.to>i?1:0);l=r.to,r.next()}}static of(e,t=!1){let i=new Ci;for(let o of e instanceof cl?[e]:t?Qg(e):e)i.add(o.from,o.to,o.value);return i.finish()}static join(e){if(!e.length)return ve.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let o=e[i];o!=ve.empty;o=o.nextLayer)t=new ve(o.chunkPos,o.chunk,t,Math.max(o.maxPoint,t.maxPoint));return t}}ve.empty=new ve([],[],null,-1);function Qg(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let i=n[t];if(hl(e,i)>0)return n.slice().sort(hl);e=i}return n}ve.empty.nextLayer=ve.empty;class Ci{finishChunk(e){this.chunks.push(new ha(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Ci)).add(e,t,i)}addInner(e,t,i){let o=e-this.lastTo||i.startSide-this.last.endSide;if(o<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return o<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(ve.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=ve.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function oc(n,e,t){let i=new Map;for(let s of n)for(let r=0;r<s.chunk.length;r++)s.chunk[r].maxPoint<=0&&i.set(s.chunk[r],s.chunkPos[r]);let o=new Set;for(let s of e)for(let r=0;r<s.chunk.length;r++){let l=i.get(s.chunk[r]);l!=null&&(t?t.mapPos(l):l)==s.chunkPos[r]&&!(t!=null&&t.touchesRange(l,l+s.chunk[r].length))&&o.add(s.chunk[r])}return o}class Pu{constructor(e,t,i,o=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=o}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let o=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(o)||this.layer.chunkEnd(this.chunkIndex)<e||o.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let o=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<o)&&this.setRangeIndex(o)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class oo{constructor(e){this.heap=e}static from(e,t=null,i=-1){let o=[];for(let s=0;s<e.length;s++)for(let r=e[s];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&o.push(new Pu(r,t,i,s));return o.length==1?o[0]:new oo(o)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)pr(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)pr(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),pr(this.heap,0)}}}function pr(n,e){for(let t=n[e];;){let i=(e<<1)+1;if(i>=n.length)break;let o=n[i];if(i+1<n.length&&o.compare(n[i+1])>=0&&(o=n[i+1],i++),t.compare(o)<0)break;n[i]=t,n[e]=o,e=i}}class Ii{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=oo.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Do(this.active,e),Do(this.activeTo,e),Do(this.activeRank,e),this.minActive=rc(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:o,rank:s}=this.cursor;for(;t<this.activeRank.length&&(s-this.activeRank[t]||o-this.activeTo[t])>0;)t++;Bo(this.active,t,i),Bo(this.activeTo,t,o),Bo(this.activeRank,t,s),e&&Bo(e,t,this.cursor.from),this.minActive=rc(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let o=this.minActive;if(o>-1&&(this.activeTo[o]-this.cursor.from||this.active[o].endSide-this.cursor.startSide)<0){if(this.activeTo[o]>e){this.to=this.activeTo[o],this.endSide=this.active[o].endSide;break}this.removeActive(o),i&&Do(i,o)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let o=i.length-1;o>=0&&i[o]<e;o--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function sc(n,e,t,i,o,s){n.goto(e),t.goto(i);let r=i+o,l=i,a=i-e,c=!!s.boundChange;for(let h=!1;;){let u=n.to+a-t.to,p=u||n.endSide-t.endSide,g=p<0?n.to+a:t.to,y=Math.min(g,r);if(n.point||t.point?(n.point&&t.point&&ca(n.point,t.point)&&ul(n.activeForPoint(n.to),t.activeForPoint(t.to))||s.comparePoint(l,y,n.point,t.point),h=!1):(h&&s.boundChange(l),y>l&&!ul(n.active,t.active)&&s.compareRange(l,y,n.active,t.active),c&&y<r&&(u||n.openEnd(g)!=t.openEnd(g))&&(h=!0)),g>r)break;l=g,p<=0&&n.next(),p>=0&&t.next()}}function ul(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!ca(n[t],e[t]))return!1;return!0}function Do(n,e){for(let t=e,i=n.length-1;t<i;t++)n[t]=n[t+1];n.pop()}function Bo(n,e,t){for(let i=n.length-1;i>=e;i--)n[i+1]=n[i];n[e]=t}function rc(n,e){let t=-1,i=1e9;for(let o=0;o<e.length;o++)(e[o]-i||n[o].endSide-n[t].endSide)<0&&(t=o,i=e[o]);return t}function Yg(n,e,t=n.length){let i=0;for(let o=0;o<t&&o<n.length;)n.charCodeAt(o)==9?(i+=e-i%e,o++):(i++,o=yt(n,o));return i}function Xg(n,e,t,i){for(let o=0,s=0;;){if(s>=e)return o;if(o==n.length)break;s+=n.charCodeAt(o)==9?t-s%t:1,o=yt(n,o)}return i===!0?-1:n.length}const dl="Í¼",lc=typeof Symbol>"u"?"__"+dl:Symbol.for(dl),fl=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),ac=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class On{constructor(e,t){this.rules=[];let{finish:i}=t||{};function o(r){return/^@/.test(r)?[r]:r.split(/,\s*/)}function s(r,l,a,c){let h=[],u=/^@(\w+)\b/.exec(r[0]),p=u&&u[1]=="keyframes";if(u&&l==null)return a.push(r[0]+";");for(let g in l){let y=l[g];if(/&/.test(g))s(g.split(/,\s*/).map(m=>r.map(b=>m.replace(/&/,b))).reduce((m,b)=>m.concat(b)),y,a);else if(y&&typeof y=="object"){if(!u)throw new RangeError("The value of a property ("+g+") should be a primitive value.");s(o(g),y,h,p)}else y!=null&&h.push(g.replace(/_.*/,"").replace(/[A-Z]/g,m=>"-"+m.toLowerCase())+": "+y+";")}(h.length||p)&&a.push((i&&!u&&!c?r.map(i):r).join(", ")+" {"+h.join(" ")+"}")}for(let r in e)s(o(r),e[r],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=ac[lc]||1;return ac[lc]=e+1,dl+e.toString(36)}static mount(e,t,i){let o=e[fl],s=i&&i.nonce;o?s&&o.setNonce(s):o=new Gg(e,s),o.mount(Array.isArray(t)?t:[t],e)}}let cc=new Map;class Gg{constructor(e,t){let i=e.ownerDocument||e,o=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&o.CSSStyleSheet){let s=cc.get(i);if(s)return e[fl]=s;this.sheet=new o.CSSStyleSheet,cc.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[fl]=this}mount(e,t){let i=this.sheet,o=0,s=0;for(let r=0;r<e.length;r++){let l=e[r],a=this.modules.indexOf(l);if(a<s&&a>-1&&(this.modules.splice(a,1),s--,a=-1),a==-1){if(this.modules.splice(s++,0,l),i)for(let c=0;c<l.rules.length;c++)i.insertRule(l.rules[c],o++)}else{for(;s<a;)o+=this.modules[s++].rules.length;o+=l.rules.length,s++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let r="";for(let a=0;a<this.modules.length;a++)r+=this.modules[a].getRules()+`
`;this.styleTag.textContent=r;let l=t.head||t;this.styleTag.parentNode!=l&&l.insertBefore(this.styleTag,l.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Nn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},so={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Jg=typeof navigator<"u"&&/Mac/.test(navigator.platform),Zg=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Qe=0;Qe<10;Qe++)Nn[48+Qe]=Nn[96+Qe]=String(Qe);for(var Qe=1;Qe<=24;Qe++)Nn[Qe+111]="F"+Qe;for(var Qe=65;Qe<=90;Qe++)Nn[Qe]=String.fromCharCode(Qe+32),so[Qe]=String.fromCharCode(Qe);for(var gr in Nn)so.hasOwnProperty(gr)||(so[gr]=Nn[gr]);function em(n){var e=Jg&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||Zg&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?so:Nn)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}let Je=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},pl=typeof document<"u"?document:{documentElement:{style:{}}};const gl=/Edge\/(\d+)/.exec(Je.userAgent),Iu=/MSIE \d/.test(Je.userAgent),ml=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Je.userAgent),Xs=!!(Iu||ml||gl),hc=!Xs&&/gecko\/(\d+)/i.test(Je.userAgent),mr=!Xs&&/Chrome\/(\d+)/.exec(Je.userAgent),uc="webkitFontSmoothing"in pl.documentElement.style,yl=!Xs&&/Apple Computer/.test(Je.vendor),dc=yl&&(/Mobile\/\w+/.test(Je.userAgent)||Je.maxTouchPoints>2);var Z={mac:dc||/Mac/.test(Je.platform),windows:/Win/.test(Je.platform),linux:/Linux|X11/.test(Je.platform),ie:Xs,ie_version:Iu?pl.documentMode||6:ml?+ml[1]:gl?+gl[1]:0,gecko:hc,gecko_version:hc?+(/Firefox\/(\d+)/.exec(Je.userAgent)||[0,0])[1]:0,chrome:!!mr,chrome_version:mr?+mr[1]:0,ios:dc,android:/Android\b/.test(Je.userAgent),webkit:uc,webkit_version:uc?+(/\bAppleWebKit\/(\d+)/.exec(Je.userAgent)||[0,0])[1]:0,safari:yl,safari_version:yl?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Je.userAgent)||[0,0])[1]:0,tabSize:pl.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function ua(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}const vs=Object.create(null);function da(n,e,t){if(n==e)return!0;n||(n=vs),e||(e=vs);let i=Object.keys(n),o=Object.keys(e);if(i.length-(t&&i.indexOf(t)>-1?1:0)!=o.length-(t&&o.indexOf(t)>-1?1:0))return!1;for(let s of i)if(s!=t&&(o.indexOf(s)==-1||n[s]!==e[s]))return!1;return!0}function tm(n,e){for(let t=n.attributes.length-1;t>=0;t--){let i=n.attributes[t].name;e[i]==null&&n.removeAttribute(i)}for(let t in e){let i=e[t];t=="style"?n.style.cssText=i:n.getAttribute(t)!=i&&n.setAttribute(t,i)}}function fc(n,e,t){let i=!1;if(e)for(let o in e)t&&o in t||(i=!0,o=="style"?n.style.cssText="":n.removeAttribute(o));if(t)for(let o in t)e&&e[o]==t[o]||(i=!0,o=="style"?n.style.cssText=t[o]:n.setAttribute(o,t[o]));return i}function nm(n){let e=Object.create(null);for(let t=0;t<n.attributes.length;t++){let i=n.attributes[t];e[i.name]=i.value}return e}class Bi{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var ot=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(ot||(ot={}));class pe extends Mn{constructor(e,t,i,o){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=o}get heightRelevant(){return!1}static mark(e){return new Co(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new ei(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,o;if(e.isBlockGap)i=-5e8,o=4e8;else{let{start:s,end:r}=zu(e,t);i=(s?t?-3e8:-1:5e8)-1,o=(r?t?2e8:1:-6e8)+1}return new ei(e,i,o,t,e.widget||null,!0)}static line(e){return new To(e)}static set(e,t=!1){return ve.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}pe.none=ve.empty;class Co extends pe{constructor(e){let{start:t,end:i}=zu(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.attrs=e.class&&e.attributes?ua(e.attributes,{class:e.class}):e.class?{class:e.class}:e.attributes||vs}eq(e){return this==e||e instanceof Co&&this.tagName==e.tagName&&da(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Co.prototype.point=!1;class To extends pe{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof To&&this.spec.class==e.spec.class&&da(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}To.prototype.mapMode=ct.TrackBefore;To.prototype.point=!0;class ei extends pe{constructor(e,t,i,o,s,r){super(t,i,s,e),this.block=o,this.isReplace=r,this.mapMode=o?t<=0?ct.TrackBefore:ct.TrackAfter:ct.TrackDel}get type(){return this.startSide!=this.endSide?ot.WidgetRange:this.startSide<=0?ot.WidgetBefore:ot.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof ei&&im(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}ei.prototype.point=!0;function zu(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t??e,end:i??e}}function im(n,e){return n==e||!!(n&&e&&n.compare(e))}function gi(n,e,t,i=0){let o=t.length-1;o>=0&&t[o]+i>=n?t[o]=Math.max(t[o],e):t.push(n,e)}class ro extends Mn{constructor(e,t){super(),this.tagName=e,this.attributes=t}eq(e){return e==this||e instanceof ro&&this.tagName==e.tagName&&da(this.attributes,e.attributes)}static create(e){return new ro(e.tagName,e.attributes||vs)}static set(e,t=!1){return ve.of(e,t)}}ro.prototype.startSide=ro.prototype.endSide=-1;function lo(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function xl(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function cs(n,e){if(!e.anchorNode)return!1;try{return xl(n,e.anchorNode)}catch{return!1}}function hs(n){return n.nodeType==3?ao(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function Zi(n,e,t,i){return t?pc(n,e,t,i,-1)||pc(n,e,t,i,1):!1}function Rn(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function ws(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}function pc(n,e,t,i,o){for(;;){if(n==t&&e==i)return!0;if(e==(o<0?0:hn(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=Rn(n)+(o<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(o<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=o<0?hn(n):0}else return!1}}function hn(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Ss(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function om(n){let e=n.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function Lu(n,e){let t=e.width/n.offsetWidth,i=e.height/n.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-n.offsetWidth)<1)&&(t=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(e.height-n.offsetHeight)<1)&&(i=1),{scaleX:t,scaleY:i}}function sm(n,e,t,i,o,s,r,l){let a=n.ownerDocument,c=a.defaultView||window;for(let h=n,u=!1;h&&!u;)if(h.nodeType==1){let p,g=h==a.body,y=1,m=1;if(g)p=om(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(u=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let T=h.getBoundingClientRect();({scaleX:y,scaleY:m}=Lu(h,T)),p={left:T.left,right:T.left+h.clientWidth*y,top:T.top,bottom:T.top+h.clientHeight*m}}let b=0,x=0;if(o=="nearest")e.top<p.top?(x=e.top-(p.top+r),t>0&&e.bottom>p.bottom+x&&(x=e.bottom-p.bottom+r)):e.bottom>p.bottom&&(x=e.bottom-p.bottom+r,t<0&&e.top-x<p.top&&(x=e.top-(p.top+r)));else{let T=e.bottom-e.top,k=p.bottom-p.top;x=(o=="center"&&T<=k?e.top+T/2-k/2:o=="start"||o=="center"&&t<0?e.top-r:e.bottom-k+r)-p.top}if(i=="nearest"?e.left<p.left?(b=e.left-(p.left+s),t>0&&e.right>p.right+b&&(b=e.right-p.right+s)):e.right>p.right&&(b=e.right-p.right+s,t<0&&e.left<p.left+b&&(b=e.left-(p.left+s))):b=(i=="center"?e.left+(e.right-e.left)/2-(p.right-p.left)/2:i=="start"==l?e.left-s:e.right-(p.right-p.left)+s)-p.left,b||x)if(g)c.scrollBy(b,x);else{let T=0,k=0;if(x){let E=h.scrollTop;h.scrollTop+=x/m,k=(h.scrollTop-E)*m}if(b){let E=h.scrollLeft;h.scrollLeft+=b/y,T=(h.scrollLeft-E)*y}e={left:e.left-T,top:e.top-k,right:e.right-T,bottom:e.bottom-k},T&&Math.abs(T-b)<1&&(i="nearest"),k&&Math.abs(k-x)<1&&(o="nearest")}if(g)break;(e.top<p.top||e.bottom>p.bottom||e.left<p.left||e.right>p.right)&&(e={left:Math.max(e.left,p.left),right:Math.min(e.right,p.right),top:Math.max(e.top,p.top),bottom:Math.min(e.bottom,p.bottom)}),h=h.assignedSlot||h.parentNode}else if(h.nodeType==11)h=h.host;else break}function rm(n){let e=n.ownerDocument,t,i;for(let o=n.parentNode;o&&!(o==e.body||t&&i);)if(o.nodeType==1)!i&&o.scrollHeight>o.clientHeight&&(i=o),!t&&o.scrollWidth>o.clientWidth&&(t=o),o=o.assignedSlot||o.parentNode;else if(o.nodeType==11)o=o.host;else break;return{x:t,y:i}}class lm{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?hn(t):0),i,Math.min(e.focusOffset,i?hn(i):0))}set(e,t,i,o){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=o}}let $n=null;Z.safari&&Z.safari_version>=26&&($n=!1);function Fu(n){if(n.setActive)return n.setActive();if($n)return n.focus($n);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus($n==null?{get preventScroll(){return $n={preventScroll:!0},!0}}:void 0),!$n){$n=!1;for(let t=0;t<e.length;){let i=e[t++],o=e[t++],s=e[t++];i.scrollTop!=o&&(i.scrollTop=o),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let gc;function ao(n,e,t=e){let i=gc||(gc=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function mi(n,e,t,i){let o={key:e,code:e,keyCode:t,which:t,cancelable:!0};i&&({altKey:o.altKey,ctrlKey:o.ctrlKey,shiftKey:o.shiftKey,metaKey:o.metaKey}=i);let s=new KeyboardEvent("keydown",o);s.synthetic=!0,n.dispatchEvent(s);let r=new KeyboardEvent("keyup",o);return r.synthetic=!0,n.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function am(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function cm(n,e){let t=e.focusNode,i=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=i)return!1;for(i=Math.min(i,hn(t));;)if(i){if(t.nodeType!=1)return!1;let o=t.childNodes[i-1];o.contentEditable=="false"?i--:(t=o,i=hn(t))}else{if(t==n)return!0;i=Rn(t),t=t.parentNode}}function $u(n){return n.scrollTop>Math.max(1,n.scrollHeight-n.clientHeight-4)}function Wu(n,e){for(let t=n,i=e;;){if(t.nodeType==3&&i>0)return{node:t,offset:i};if(t.nodeType==1&&i>0){if(t.contentEditable=="false")return null;t=t.childNodes[i-1],i=hn(t)}else if(t.parentNode&&!ws(t))i=Rn(t),t=t.parentNode;else return null}}function Hu(n,e){for(let t=n,i=e;;){if(t.nodeType==3&&i<t.nodeValue.length)return{node:t,offset:i};if(t.nodeType==1&&i<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[i],i=0}else if(t.parentNode&&!ws(t))i=Rn(t)+1,t=t.parentNode;else return null}}class Nt{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new Nt(e.parentNode,Rn(e),t)}static after(e,t){return new Nt(e.parentNode,Rn(e)+1,t)}}var Be=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(Be||(Be={}));const ti=Be.LTR,fa=Be.RTL;function Vu(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const hm=Vu("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),um=Vu("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),bl=Object.create(null),Wt=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);bl[e]=t,bl[t]=-e}function Uu(n){return n<=247?hm[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?um[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8204?256:64336<=n&&n<=65023?4:1}const dm=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ln{get dir(){return this.level%2?fa:ti}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,o){let s=-1;for(let r=0;r<e.length;r++){let l=e[r];if(l.from<=t&&l.to>=t){if(l.level==i)return r;(s<0||(o!=0?o<0?l.from<t:l.to>t:e[s].level>l.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}function qu(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++){let i=n[t],o=e[t];if(i.from!=o.from||i.to!=o.to||i.direction!=o.direction||!qu(i.inner,o.inner))return!1}return!0}const Ce=[];function fm(n,e,t,i,o){for(let s=0;s<=i.length;s++){let r=s?i[s-1].to:e,l=s<i.length?i[s].from:t,a=s?256:o;for(let c=r,h=a,u=a;c<l;c++){let p=Uu(n.charCodeAt(c));p==512?p=h:p==8&&u==4&&(p=16),Ce[c]=p==4?2:p,p&7&&(u=p),h=p}for(let c=r,h=a,u=a;c<l;c++){let p=Ce[c];if(p==128)c<l-1&&h==Ce[c+1]&&h&24?p=Ce[c]=h:Ce[c]=256;else if(p==64){let g=c+1;for(;g<l&&Ce[g]==64;)g++;let y=c&&h==8||g<t&&Ce[g]==8?u==1?1:8:256;for(let m=c;m<g;m++)Ce[m]=y;c=g-1}else p==8&&u==1&&(Ce[c]=1);h=p,p&7&&(u=p)}}}function pm(n,e,t,i,o){let s=o==1?2:1;for(let r=0,l=0,a=0;r<=i.length;r++){let c=r?i[r-1].to:e,h=r<i.length?i[r].from:t;for(let u=c,p,g,y;u<h;u++)if(g=bl[p=n.charCodeAt(u)])if(g<0){for(let m=l-3;m>=0;m-=3)if(Wt[m+1]==-g){let b=Wt[m+2],x=b&2?o:b&4?b&1?s:o:0;x&&(Ce[u]=Ce[Wt[m]]=x),l=m;break}}else{if(Wt.length==189)break;Wt[l++]=u,Wt[l++]=p,Wt[l++]=a}else if((y=Ce[u])==2||y==1){let m=y==o;a=m?0:1;for(let b=l-3;b>=0;b-=3){let x=Wt[b+2];if(x&2)break;if(m)Wt[b+2]|=2;else{if(x&4)break;Wt[b+2]|=4}}}}}function gm(n,e,t,i){for(let o=0,s=i;o<=t.length;o++){let r=o?t[o-1].to:n,l=o<t.length?t[o].from:e;for(let a=r;a<l;){let c=Ce[a];if(c==256){let h=a+1;for(;;)if(h==l){if(o==t.length)break;h=t[o++].to,l=o<t.length?t[o].from:e}else if(Ce[h]==256)h++;else break;let u=s==1,p=(h<e?Ce[h]:i)==1,g=u==p?u?1:2:i;for(let y=h,m=o,b=m?t[m-1].to:n;y>a;)y==b&&(y=t[--m].from,b=m?t[m-1].to:n),Ce[--y]=g;a=h}else s=c,a++}}}function vl(n,e,t,i,o,s,r){let l=i%2?2:1;if(i%2==o%2)for(let a=e,c=0;a<t;){let h=!0,u=!1;if(c==s.length||a<s[c].from){let m=Ce[a];m!=l&&(h=!1,u=m==16)}let p=!h&&l==1?[]:null,g=h?i:i+1,y=a;e:for(;;)if(c<s.length&&y==s[c].from){if(u)break e;let m=s[c];if(!h)for(let b=m.to,x=c+1;;){if(b==t)break e;if(x<s.length&&s[x].from==b)b=s[x++].to;else{if(Ce[b]==l)break e;break}}if(c++,p)p.push(m);else{m.from>a&&r.push(new ln(a,m.from,g));let b=m.direction==ti!=!(g%2);wl(n,b?i+1:i,o,m.inner,m.from,m.to,r),a=m.to}y=m.to}else{if(y==t||(h?Ce[y]!=l:Ce[y]==l))break;y++}p?vl(n,a,y,i+1,o,p,r):a<y&&r.push(new ln(a,y,g)),a=y}else for(let a=t,c=s.length;a>e;){let h=!0,u=!1;if(!c||a>s[c-1].to){let m=Ce[a-1];m!=l&&(h=!1,u=m==16)}let p=!h&&l==1?[]:null,g=h?i:i+1,y=a;e:for(;;)if(c&&y==s[c-1].to){if(u)break e;let m=s[--c];if(!h)for(let b=m.from,x=c;;){if(b==e)break e;if(x&&s[x-1].to==b)b=s[--x].from;else{if(Ce[b-1]==l)break e;break}}if(p)p.push(m);else{m.to<a&&r.push(new ln(m.to,a,g));let b=m.direction==ti!=!(g%2);wl(n,b?i+1:i,o,m.inner,m.from,m.to,r),a=m.from}y=m.from}else{if(y==e||(h?Ce[y-1]!=l:Ce[y-1]==l))break;y--}p?vl(n,y,a,i+1,o,p,r):y<a&&r.push(new ln(y,a,g)),a=y}}function wl(n,e,t,i,o,s,r){let l=e%2?2:1;fm(n,o,s,i,l),pm(n,o,s,i,l),gm(o,s,i,l),vl(n,o,s,e,t,i,r)}function mm(n,e,t){if(!n)return[new ln(0,0,e==fa?1:0)];if(e==ti&&!t.length&&!dm.test(n))return Ku(n.length);if(t.length)for(;n.length>Ce.length;)Ce[Ce.length]=256;let i=[],o=e==ti?0:1;return wl(n,o,o,t,0,n.length,i),i}function Ku(n){return[new ln(0,n,0)]}let Qu="";function ym(n,e,t,i,o){var s;let r=i.head-n.from,l=ln.find(e,r,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc),a=e[l],c=a.side(o,t);if(r==c){let p=l+=o?1:-1;if(p<0||p>=e.length)return null;a=e[l=p],r=a.side(!o,t),c=a.side(o,t)}let h=yt(n.text,r,a.forward(o,t));(h<a.from||h>a.to)&&(h=c),Qu=n.text.slice(Math.min(r,h),Math.max(r,h));let u=l==(o?e.length-1:0)?null:e[l+(o?1:-1)];return u&&h==c&&u.level+(o?0:1)<a.level?te.cursor(u.side(!o,t)+n.from,u.forward(o,t)?1:-1,u.level):te.cursor(h+n.from,a.forward(o,t)?-1:1,a.level)}function xm(n,e,t){for(let i=e;i<t;i++){let o=Uu(n.charCodeAt(i));if(o==1)return ti;if(o==2||o==4)return fa}return ti}const Yu=ne.define(),Xu=ne.define(),Gu=ne.define(),Ju=ne.define(),Sl=ne.define(),Zu=ne.define(),ed=ne.define(),pa=ne.define(),ga=ne.define(),td=ne.define({combine:n=>n.some(e=>e)}),bm=ne.define({combine:n=>n.some(e=>e)}),nd=ne.define();class yi{constructor(e,t="nearest",i="nearest",o=5,s=5,r=!1){this.range=e,this.y=t,this.x=i,this.yMargin=o,this.xMargin=s,this.isSnapshot=r}map(e){return e.empty?this:new yi(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new yi(te.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Po=Te.define({map:(n,e)=>n.map(e)}),id=Te.define();function ut(n,e,t){let i=n.facet(Ju);i.length?i[0](e):window.onerror&&window.onerror(String(e),t,void 0,void 0,e)||(t?console.error(t+":",e):console.error(e))}const rn=ne.define({combine:n=>n.length?n[0]:!0});let vm=0;const ci=ne.define({combine(n){return n.filter((e,t)=>{for(let i=0;i<t;i++)if(n[i].plugin==e.plugin)return!1;return!0})}});class Ct{constructor(e,t,i,o,s){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=o,this.baseExtensions=s(this),this.extension=this.baseExtensions.concat(ci.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(ci.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:i,eventObservers:o,provide:s,decorations:r}=t||{};return new Ct(vm++,e,i,o,l=>{let a=[];return r&&a.push(co.of(c=>{let h=c.plugin(l);return h?r(h):pe.none})),s&&a.push(s(l)),a})}static fromClass(e,t){return Ct.define((i,o)=>new e(i,o),t)}}class yr{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(ut(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){ut(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){ut(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const od=ne.define(),ma=ne.define(),co=ne.define(),sd=ne.define(),rd=ne.define(),Eo=ne.define(),ld=ne.define();function mc(n,e){let t=n.state.facet(ld);if(!t.length)return t;let i=t.map(s=>s instanceof Function?s(n):s),o=[];return ve.spans(i,e.from,e.to,{point(){},span(s,r,l,a){let c=s-e.from,h=r-e.from,u=o;for(let p=l.length-1;p>=0;p--,a--){let g=l[p].spec.bidiIsolate,y;if(g==null&&(g=xm(e.text,c,h)),a>0&&u.length&&(y=u[u.length-1]).to==c&&y.direction==g)y.to=h,u=y.inner;else{let m={from:c,to:h,direction:g,inner:[]};u.push(m),u=m.inner}}}}),o}const ad=ne.define();function ya(n){let e=0,t=0,i=0,o=0;for(let s of n.state.facet(ad)){let r=s(n);r&&(r.left!=null&&(e=Math.max(e,r.left)),r.right!=null&&(t=Math.max(t,r.right)),r.top!=null&&(i=Math.max(i,r.top)),r.bottom!=null&&(o=Math.max(o,r.bottom)))}return{left:e,right:t,top:i,bottom:o}}const Ui=ne.define();class xt{constructor(e,t,i,o){this.fromA=e,this.toA=t,this.fromB=i,this.toB=o}join(e){return new xt(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let o=e[t-1];if(!(o.fromA>i.toA)){if(o.toA<i.fromA)break;i=i.join(o),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let o=0,s=0,r=0;;){let l=o<e.length?e[o].fromB:1e9,a=s<t.length?t[s]:1e9,c=Math.min(l,a);if(c==1e9)break;let h=c+r,u=c,p=h;for(;;)if(s<t.length&&t[s]<=u){let g=t[s+1];s+=2,u=Math.max(u,g);for(let y=o;y<e.length&&e[y].fromB<=u;y++)r=e[y].toA-e[y].toB;p=Math.max(p,g+r)}else if(o<e.length&&e[o].fromB<=u){let g=e[o++];u=Math.max(u,g.toB),p=Math.max(p,g.toA),r=g.toA-g.toB}else break;i.push(new xt(h,p,c,u))}return i}}class ks{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=$e.empty(this.startState.doc.length);for(let s of i)this.changes=this.changes.compose(s.changes);let o=[];this.changes.iterChangedRanges((s,r,l,a)=>o.push(new xt(s,r,l,a))),this.changedRanges=o}static create(e,t,i){return new ks(e,t,i)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}const wm=[];class Le{constructor(e,t,i=0){this.dom=e,this.length=t,this.flags=i,this.parent=null,e.cmTile=this}get breakAfter(){return this.flags&1}get children(){return wm}isWidget(){return!1}get isHidden(){return!1}isComposite(){return!1}isLine(){return!1}isText(){return!1}isBlock(){return!1}get domAttrs(){return null}sync(e){if(this.flags|=2,this.flags&4){this.flags&=-5;let t=this.domAttrs;t&&tm(this.dom,t)}}toString(){return this.constructor.name+(this.children.length?`(${this.children})`:"")+(this.breakAfter?"#":"")}destroy(){this.parent=null}setDOM(e){this.dom=e,e.cmTile=this}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e,t=this.posAtStart){let i=t;for(let o of this.children){if(o==e)return i;i+=o.length+o.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}covers(e){return!0}coordsIn(e,t){return null}domPosFor(e,t){let i=Rn(this.dom),o=this.length?e>0:t>0;return new Nt(this.parent.dom,i+(o?1:0),e==0||e==this.length)}markDirty(e){this.flags&=-3,e&&(this.flags|=4),this.parent&&this.parent.flags&2&&this.parent.markDirty(!1)}get overrideDOMText(){return null}get root(){for(let e=this;e;e=e.parent)if(e instanceof Js)return e;return null}static get(e){return e.cmTile}}class Gs extends Le{constructor(e){super(e,0),this._children=[]}isComposite(){return!0}get children(){return this._children}get lastChild(){return this.children.length?this.children[this.children.length-1]:null}append(e){this.children.push(e),e.parent=this}sync(e){if(this.flags&2)return;super.sync(e);let t=this.dom,i=null,o,s=(e==null?void 0:e.node)==t?e:null,r=0;for(let l of this.children){if(l.sync(e),r+=l.length+l.breakAfter,o=i?i.nextSibling:t.firstChild,s&&o!=l.dom&&(s.written=!0),l.dom.parentNode==t)for(;o&&o!=l.dom;)o=yc(o);else t.insertBefore(l.dom,o);i=l.dom}for(o=i?i.nextSibling:t.firstChild,s&&o&&(s.written=!0);o;)o=yc(o);this.length=r}}function yc(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class Js extends Gs{constructor(e,t){super(t),this.view=e}owns(e){for(;e;e=e.parent)if(e==this)return!0;return!1}isBlock(){return!0}nearest(e){for(;;){if(!e)return null;let t=Le.get(e);if(t&&this.owns(t))return t;e=e.parentNode}}blockTiles(e){for(let t=[],i=this,o=0,s=0;;)if(o==i.children.length){if(!t.length)return;i=i.parent,i.breakAfter&&s++,o=t.pop()}else{let r=i.children[o++];if(r instanceof An)t.push(o),i=r,o=0;else{let l=s+r.length,a=e(r,s);if(a!==void 0)return a;s=l+r.breakAfter}}}resolveBlock(e,t){let i,o=-1,s,r=-1;if(this.blockTiles((l,a)=>{let c=a+l.length;if(e>=a&&e<=c){if(l.isWidget()&&t>=-1&&t<=1){if(l.flags&32)return!0;l.flags&16&&(i=void 0)}(a<e||e==c&&(t<-1?l.length:l.covers(1)))&&(!i||!l.isWidget()&&i.isWidget())&&(i=l,o=e-a),(c>e||e==a&&(t>1?l.length:l.covers(-1)))&&(!s||!l.isWidget()&&s.isWidget())&&(s=l,r=e-a)}}),!i&&!s)throw new Error("No tile at position "+e);return i&&t<0||!s?{tile:i,offset:o}:{tile:s,offset:r}}}class An extends Gs{constructor(e,t){super(e),this.wrapper=t}isBlock(){return!0}covers(e){return this.children.length?e<0?this.children[0].covers(-1):this.lastChild.covers(1):!1}get domAttrs(){return this.wrapper.attributes}static of(e,t){let i=new An(t||document.createElement(e.tagName),e);return t||(i.flags|=4),i}}class Ti extends Gs{constructor(e,t){super(e),this.attrs=t}isLine(){return!0}static start(e,t,i){let o=new Ti(t||document.createElement("div"),e);return(!t||!i)&&(o.flags|=4),o}get domAttrs(){return this.attrs}resolveInline(e,t,i){let o=null,s=-1,r=null,l=-1;function a(h,u){for(let p=0,g=0;p<h.children.length&&g<=u;p++){let y=h.children[p],m=g+y.length;m>=u&&(y.isComposite()?a(y,u-g):(!r||r.isHidden&&(t>0||i&&km(r,y)))&&(m>u||y.flags&32)?(r=y,l=u-g):(g<u||y.flags&16&&!y.isHidden)&&(o=y,s=u-g)),g=m}}a(this,e);let c=(t<0?o:r)||o||r;return c?{tile:c,offset:c==o?s:l}:null}coordsIn(e,t){let i=this.resolveInline(e,t,!0);return i?i.tile.coordsIn(Math.max(0,i.offset),t):Sm(this)}domIn(e,t){let i=this.resolveInline(e,t);if(i){let{tile:o,offset:s}=i;if(this.dom.contains(o.dom))return o.isText()?new Nt(o.dom,Math.min(o.dom.nodeValue.length,s)):o.domPosFor(s,o.flags&16?1:o.flags&32?-1:t);let r=i.tile.parent,l=!1;for(let a of r.children){if(l)return new Nt(a.dom,0);a==i.tile&&(l=!0)}}return new Nt(this.dom,0)}}function Sm(n){let e=n.dom.lastChild;if(!e)return n.dom.getBoundingClientRect();let t=hs(e);return t[t.length-1]||null}function km(n,e){let t=n.coordsIn(0,1),i=e.coordsIn(0,1);return t&&i&&i.top<t.bottom}class tt extends Gs{constructor(e,t){super(e),this.mark=t}get domAttrs(){return this.mark.attrs}static of(e,t){let i=new tt(t||document.createElement(e.tagName),e);return t||(i.flags|=4),i}}class Kn extends Le{constructor(e,t){super(e,t.length),this.text=t}sync(e){this.flags&2||(super.sync(e),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text))}isText(){return!0}toString(){return JSON.stringify(this.text)}coordsIn(e,t){let i=this.dom.nodeValue.length;e>i&&(e=i);let o=e,s=e,r=0;e==0&&t<0||e==i&&t>=0?Z.chrome||Z.gecko||(e?(o--,r=1):s<i&&(s++,r=-1)):t<0?o--:s<i&&s++;let l=ao(this.dom,o,s).getClientRects();if(!l.length)return null;let a=l[(r?r<0:t>=0)?0:l.length-1];return Z.safari&&!r&&a.width==0&&(a=Array.prototype.find.call(l,c=>c.width)||a),r?Ss(a,r<0):a||null}static of(e,t){let i=new Kn(t||document.createTextNode(e),e);return t||(i.flags|=2),i}}class Ei extends Le{constructor(e,t,i,o){super(e,t,o),this.widget=i}isWidget(){return!0}get isHidden(){return this.widget.isHidden}covers(e){return this.flags&48?!1:(this.flags&(e<0?64:128))>0}coordsIn(e,t){return this.coordsInWidget(e,t,!1)}coordsInWidget(e,t,i){let o=this.widget.coordsAt(this.dom,e,t);if(o)return o;if(i)return Ss(this.dom.getBoundingClientRect(),this.length?e==0:t<=0);{let s=this.dom.getClientRects(),r=null;if(!s.length)return null;let l=this.flags&16?!0:this.flags&32?!1:e>0;for(let a=l?s.length-1:0;r=s[a],!(e>0?a==0:a==s.length-1||r.top<r.bottom);a+=l?-1:1);return Ss(r,!l)}}get overrideDOMText(){if(!this.length)return ke.empty;let{root:e}=this;if(!e)return ke.empty;let t=this.posAtStart;return e.view.state.doc.slice(t,t+this.length)}destroy(){super.destroy(),this.widget.destroy(this.dom)}static of(e,t,i,o,s){return s||(s=e.toDOM(t),e.editable||(s.contentEditable="false")),new Ei(s,i,e,o)}}class Cs extends Le{constructor(e){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),super(t,0,e)}get isHidden(){return!1}get overrideDOMText(){return ke.empty}coordsIn(e){return this.dom.getBoundingClientRect()}}class Cm{constructor(e){this.index=0,this.beforeBreak=!1,this.parents=[],this.tile=e}advance(e,t,i){let{tile:o,index:s,beforeBreak:r,parents:l}=this;for(;e||t>0;)if(o.isComposite())if(r){if(!e)break;i&&i.break(),e--,r=!1}else if(s==o.children.length){if(!e&&!l.length)break;i&&i.leave(o),r=!!o.breakAfter,{tile:o,index:s}=l.pop(),s++}else{let a=o.children[s],c=a.breakAfter;(t>0?a.length<=e:a.length<e)&&(!i||i.skip(a,0,a.length)!==!1||!a.isComposite)?(r=!!c,s++,e-=a.length):(l.push({tile:o,index:s}),o=a,s=0,i&&a.isComposite()&&i.enter(a))}else if(s==o.length)r=!!o.breakAfter,{tile:o,index:s}=l.pop(),s++;else if(e){let a=Math.min(e,o.length-s);i&&i.skip(o,s,s+a),e-=a,s+=a}else break;return this.tile=o,this.index=s,this.beforeBreak=r,this}get root(){return this.parents.length?this.parents[0].tile:this.tile}}class Tm{constructor(e,t,i,o){this.from=e,this.to=t,this.wrapper=i,this.rank=o}}class Em{constructor(e,t,i){this.cache=e,this.root=t,this.blockWrappers=i,this.curLine=null,this.lastBlock=null,this.afterWidget=null,this.pos=0,this.wrappers=[],this.wrapperPos=0}addText(e,t,i,o){var s;this.flushBuffer();let r=this.ensureMarks(t,i),l=r.lastChild;if(l&&l.isText()&&!(l.flags&8)){this.cache.reused.set(l,2);let a=r.children[r.children.length-1]=new Kn(l.dom,l.text+e);a.parent=r}else r.append(o||Kn.of(e,(s=this.cache.find(Kn))===null||s===void 0?void 0:s.dom));this.pos+=e.length,this.afterWidget=null}addComposition(e,t){let i=this.curLine;i.dom!=t.line.dom&&(i.setDOM(this.cache.reused.has(t.line)?xr(t.line.dom):t.line.dom),this.cache.reused.set(t.line,2));let o=i;for(let l=t.marks.length-1;l>=0;l--){let a=t.marks[l],c=o.lastChild;if(c instanceof tt&&c.mark.eq(a.mark))c.dom!=a.dom&&c.setDOM(xr(a.dom)),o=c;else{if(this.cache.reused.get(a)){let u=Le.get(a.dom);u&&u.setDOM(xr(a.dom))}let h=tt.of(a.mark,a.dom);o.append(h),o=h}this.cache.reused.set(a,2)}let s=Le.get(e.text);s&&this.cache.reused.set(s,2);let r=new Kn(e.text,e.text.nodeValue);r.flags|=8,o.append(r)}addInlineWidget(e,t,i){let o=this.afterWidget&&e.flags&48&&(this.afterWidget.flags&48)==(e.flags&48);o||this.flushBuffer();let s=this.ensureMarks(t,i);!o&&!(e.flags&16)&&s.append(this.getBuffer(1)),s.append(e),this.pos+=e.length,this.afterWidget=e}addMark(e,t,i){this.flushBuffer(),this.ensureMarks(t,i).append(e),this.pos+=e.length,this.afterWidget=null}addBlockWidget(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}continueWidget(e){let t=this.afterWidget||this.lastBlock;t.length+=e,this.pos+=e}addLineStart(e,t){var i;e||(e=cd);let o=Ti.start(e,t||((i=this.cache.find(Ti))===null||i===void 0?void 0:i.dom),!!t);this.getBlockPos().append(this.lastBlock=this.curLine=o)}addLine(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}addBreak(){this.lastBlock.flags|=1,this.endLine(),this.pos++}addLineStartIfNotCovered(e){this.blockPosCovered()||this.addLineStart(e)}ensureLine(e){this.curLine||this.addLineStart(e)}ensureMarks(e,t){var i;let o=this.curLine;for(let s=e.length-1;s>=0;s--){let r=e[s],l;if(t>0&&(l=o.lastChild)&&l instanceof tt&&l.mark.eq(r))o=l,t--;else{let a=tt.of(r,(i=this.cache.find(tt,c=>c.mark.eq(r)))===null||i===void 0?void 0:i.dom);o.append(a),o=a,t=0}}return o}endLine(){if(this.curLine){this.flushBuffer();let e=this.curLine.lastChild;(!e||!xc(this.curLine,!1)||e.dom.nodeName!="BR"&&e.isWidget()&&!(Z.ios&&xc(this.curLine,!0)))&&this.curLine.append(this.cache.findWidget(br,0,32)||new Ei(br.toDOM(),0,br,32)),this.curLine=this.afterWidget=null}}updateBlockWrappers(){this.wrapperPos>this.pos+1e4&&(this.blockWrappers.goto(this.pos),this.wrappers.length=0);for(let e=this.wrappers.length-1;e>=0;e--)this.wrappers[e].to<this.pos&&this.wrappers.splice(e,1);for(let e=this.blockWrappers;e.value&&e.from<=this.pos;e.next())if(e.to>=this.pos){let t=new Tm(e.from,e.to,e.value,e.rank),i=this.wrappers.length;for(;i>0&&(this.wrappers[i-1].rank-t.rank||this.wrappers[i-1].to-t.to)<0;)i--;this.wrappers.splice(i,0,t)}this.wrapperPos=this.pos}getBlockPos(){var e;this.updateBlockWrappers();let t=this.root;for(let i of this.wrappers){let o=t.lastChild;if(i.from<this.pos&&o instanceof An&&o.wrapper.eq(i.wrapper))t=o;else{let s=An.of(i.wrapper,(e=this.cache.find(An,r=>r.wrapper.eq(i.wrapper)))===null||e===void 0?void 0:e.dom);t.append(s),t=s}}return t}blockPosCovered(){let e=this.lastBlock;return e!=null&&!e.breakAfter&&(!e.isWidget()||(e.flags&160)>0)}getBuffer(e){let t=2|(e<0?16:32),i=this.cache.find(Cs,void 0,1);return i&&(i.flags=t),i||new Cs(t)}flushBuffer(){this.afterWidget&&!(this.afterWidget.flags&32)&&(this.afterWidget.parent.append(this.getBuffer(-1)),this.afterWidget=null)}}class Am{constructor(e){this.skipCount=0,this.text="",this.textOff=0,this.cursor=e.iter()}skip(e){this.textOff+e<=this.text.length?this.textOff+=e:(this.skipCount+=e-(this.text.length-this.textOff),this.text="",this.textOff=0)}next(e){if(this.textOff==this.text.length){let{value:o,lineBreak:s,done:r}=this.cursor.next(this.skipCount);if(this.skipCount=0,r)throw new Error("Ran out of text content when drawing inline views");this.text=o;let l=this.textOff=Math.min(e,o.length);return s?null:o.slice(0,l)}let t=Math.min(this.text.length,this.textOff+e),i=this.text.slice(this.textOff,t);return this.textOff=t,i}}const Ts=[Ei,Ti,Kn,tt,Cs,An,Js];for(let n=0;n<Ts.length;n++)Ts[n].bucket=n;class _m{constructor(e){this.view=e,this.buckets=Ts.map(()=>[]),this.index=Ts.map(()=>0),this.reused=new Map}add(e){let t=e.constructor.bucket,i=this.buckets[t];i.length<6?i.push(e):i[this.index[t]=(this.index[t]+1)%6]=e}find(e,t,i=2){let o=e.bucket,s=this.buckets[o],r=this.index[o];for(let l=s.length-1;l>=0;l--){let a=(l+r)%s.length,c=s[a];if((!t||t(c))&&!this.reused.has(c))return s.splice(a,1),a<r&&this.index[o]--,this.reused.set(c,i),c}return null}findWidget(e,t,i){let o=this.buckets[0];if(o.length)for(let s=0,r=0;;s++){if(s==o.length){if(r)return null;r=1,s=0}let l=o[s];if(!this.reused.has(l)&&(r==0?l.widget.compare(e):l.widget.constructor==e.constructor&&e.updateDOM(l.dom,this.view)))return o.splice(s,1),s<this.index[0]&&this.index[0]--,this.reused.set(l,1),l.length=t,l.flags=l.flags&-498|i,l}}reuse(e){return this.reused.set(e,1),e}maybeReuse(e,t=2){if(!this.reused.has(e))return this.reused.set(e,t),e.dom}}class Mm{constructor(e,t,i,o,s){this.view=e,this.decorations=o,this.disallowBlockEffectsFor=s,this.openWidget=!1,this.openMarks=0,this.cache=new _m(e),this.text=new Am(e.state.doc),this.builder=new Em(this.cache,new Js(e,e.contentDOM),ve.iter(i)),this.cache.reused.set(t,2),this.old=new Cm(t),this.reuseWalker={skip:(r,l,a)=>{if(this.cache.add(r),r.isComposite())return!1},enter:r=>this.cache.add(r),leave:()=>{},break:()=>{}}}run(e,t){let i=t&&this.getCompositionContext(t.text);for(let o=0,s=0,r=0;;){let l=r<e.length?e[r++]:null,a=l?l.fromA:this.old.root.length;if(a>o){let c=a-o;this.preserve(c,!r,!l),o=a,s+=c}if(!l)break;this.forward(l.fromA,l.toA),t&&l.fromA<=t.range.fromA&&l.toA>=t.range.toA?(this.emit(s,t.range.fromB),this.builder.addComposition(t,i),this.text.skip(t.range.toB-t.range.fromB),this.emit(t.range.toB,l.toB)):this.emit(s,l.toB),s=l.toB,o=l.toA}return this.builder.curLine&&this.builder.endLine(),this.builder.root}preserve(e,t,i){let o=Rm(this.old),s=this.openMarks;this.old.advance(e,i?1:-1,{skip:(r,l,a)=>{if(r.isWidget())if(this.openWidget)this.builder.continueWidget(a-l);else{let c=a>0||l<r.length?Ei.of(r.widget,this.view,a-l,r.flags&496,this.cache.maybeReuse(r)):this.cache.reuse(r);c.flags&256?(c.flags&=-2,this.builder.addBlockWidget(c)):(this.builder.ensureLine(null),this.builder.addInlineWidget(c,o,s),s=o.length)}else if(r.isText())this.builder.ensureLine(null),!l&&a==r.length?this.builder.addText(r.text,o,s,this.cache.reuse(r)):(this.cache.add(r),this.builder.addText(r.text.slice(l,a),o,s)),s=o.length;else if(r.isLine())r.flags&=-2,this.cache.reused.set(r,1),this.builder.addLine(r);else if(r instanceof Cs)this.cache.add(r);else if(r instanceof tt)this.builder.ensureLine(null),this.builder.addMark(r,o,s),this.cache.reused.set(r,1),s=o.length;else return!1;this.openWidget=!1},enter:r=>{r.isLine()?this.builder.addLineStart(r.attrs,this.cache.maybeReuse(r)):(this.cache.add(r),r instanceof tt&&o.unshift(r.mark)),this.openWidget=!1},leave:r=>{r.isLine()?o.length&&(o.length=s=0):r instanceof tt&&(o.shift(),s=Math.min(s,o.length))},break:()=>{this.builder.addBreak(),this.openWidget=!1}}),this.text.skip(e)}emit(e,t){let i=null,o=this.builder,s=0,r=ve.spans(this.decorations,e,t,{point:(l,a,c,h,u,p)=>{if(c instanceof ei){if(this.disallowBlockEffectsFor[p]){if(c.block)throw new RangeError("Block decorations may not be specified via plugins");if(a>this.view.state.doc.lineAt(l).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}if(s=h.length,u>h.length)o.continueWidget(a-l);else{let g=c.widget||(c.block?Ai.block:Ai.inline),y=Om(c),m=this.cache.findWidget(g,a-l,y)||Ei.of(g,this.view,a-l,y);c.block?(c.startSide>0&&o.addLineStartIfNotCovered(i),o.addBlockWidget(m)):(o.ensureLine(i),o.addInlineWidget(m,h,u))}i=null}else i=Nm(i,c);a>l&&this.text.skip(a-l)},span:(l,a,c,h)=>{for(let u=l;u<a;){let p=this.text.next(Math.min(512,a-u));p==null?(o.addLineStartIfNotCovered(i),o.addBreak(),u++):(o.ensureLine(i),o.addText(p,c,h),u+=p.length),i=null}}});o.addLineStartIfNotCovered(i),this.openWidget=r>s,this.openMarks=r}forward(e,t){t-e<=10?this.old.advance(t-e,1,this.reuseWalker):(this.old.advance(5,-1,this.reuseWalker),this.old.advance(t-e-10,-1),this.old.advance(5,1,this.reuseWalker))}getCompositionContext(e){let t=[],i=null;for(let o=e.parentNode;;o=o.parentNode){let s=Le.get(o);if(o==this.view.contentDOM)break;s instanceof tt?t.push(s):s!=null&&s.isLine()?i=s:o.nodeName=="DIV"&&!i&&o!=this.view.contentDOM?i=new Ti(o,cd):t.push(tt.of(new Co({tagName:o.nodeName.toLowerCase(),attributes:nm(o)}),o))}return{line:i,marks:t}}}function xc(n,e){let t=i=>{for(let o of i.children)if((e?o.isText():o.length)||t(o))return!0;return!1};return t(n)}function Om(n){let e=n.isReplace?(n.startSide<0?64:0)|(n.endSide>0?128:0):n.startSide>0?32:16;return n.block&&(e|=256),e}const cd={class:"cm-line"};function Nm(n,e){let t=e.spec.attributes,i=e.spec.class;return!t&&!i||(n||(n={class:"cm-line"}),t&&ua(t,n),i&&(n.class+=" "+i)),n}function Rm(n){let e=[];for(let t=n.parents.length;t>1;t--){let i=t==n.parents.length?n.tile:n.parents[t].tile;i instanceof tt&&e.push(i.mark)}return e}function xr(n){let e=Le.get(n);return e&&e.setDOM(n.cloneNode()),n}class Ai extends Bi{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Ai.inline=new Ai("span");Ai.block=new Ai("div");const br=new class extends Bi{toDOM(){return document.createElement("br")}get isHidden(){return!0}get editable(){return!0}};class bc{constructor(e){this.view=e,this.decorations=[],this.blockWrappers=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.editContextFormatting=pe.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.updateDeco(),this.tile=new Js(e,e.contentDOM),this.updateInner([new xt(0,0,0,e.state.doc.length)],null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:h,toA:u})=>u<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let o=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?o=this.domChanged.newSel.head:!$m(e.changes,this.hasComposition)&&!e.selectionSet&&(o=e.state.selection.main.head));let s=o>-1?Dm(this.view,e.changes,o):null;if(this.domChanged=null,this.hasComposition){let{from:h,to:u}=this.hasComposition;i=new xt(h,u,e.changes.mapPos(h,-1),e.changes.mapPos(u,1)).addToSet(i.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(Z.ie||Z.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let r=this.decorations,l=this.blockWrappers;this.updateDeco();let a=Im(r,this.decorations,e.changes);a.length&&(i=xt.extendWithRanges(i,a));let c=Lm(l,this.blockWrappers,e.changes);return c.length&&(i=xt.extendWithRanges(i,c)),s&&!i.some(h=>h.fromA<=s.range.fromA&&h.toA>=s.range.toA)&&(i=s.range.addToSet(i.slice())),this.tile.flags&2&&i.length==0?!1:(this.updateInner(i,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0;let{observer:i}=this.view;i.ignore(()=>{if(t||e.length){let r=this.tile,l=new Mm(this.view,r,this.blockWrappers,this.decorations,this.dynamicDecorationMap);this.tile=l.run(e,t),kl(r,l.cache.reused)}this.tile.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.tile.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let s=Z.chrome||Z.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.tile.sync(s),s&&(s.written||i.selectionRange.focusNode!=s.node||!this.tile.dom.contains(s.node))&&(this.forceSelection=!0),this.tile.dom.style.height=""});let o=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.tile.children)s.isWidget()&&s.widget instanceof vr&&o.push(s.dom);i.updateGaps(o)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let i of t.effects)i.is(id)&&(this.editContextFormatting=i.value)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let{dom:i}=this.tile,o=this.view.root.activeElement,s=o==i,r=!s&&!(this.view.state.facet(rn)||i.tabIndex>-1)&&cs(i,this.view.observer.selectionRange)&&!(o&&i.contains(o));if(!(s||t||r))return;let l=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,c,h;if(a.empty?h=c=this.inlineDOMNearPos(a.anchor,a.assoc||1):(h=this.inlineDOMNearPos(a.head,a.head==a.from?1:-1),c=this.inlineDOMNearPos(a.anchor,a.anchor==a.from?1:-1)),Z.gecko&&a.empty&&!this.hasComposition&&jm(c)){let p=document.createTextNode("");this.view.observer.ignore(()=>c.node.insertBefore(p,c.node.childNodes[c.offset]||null)),c=h=new Nt(p,0),l=!0}let u=this.view.observer.selectionRange;(l||!u.focusNode||(!Zi(c.node,c.offset,u.anchorNode,u.anchorOffset)||!Zi(h.node,h.offset,u.focusNode,u.focusOffset))&&!this.suppressWidgetCursorChange(u,a))&&(this.view.observer.ignore(()=>{Z.android&&Z.chrome&&i.contains(u.focusNode)&&Fm(u.focusNode,i)&&(i.blur(),i.focus({preventScroll:!0}));let p=lo(this.view.root);if(p)if(a.empty){if(Z.gecko){let g=Bm(c.node,c.offset);if(g&&g!=3){let y=(g==1?Wu:Hu)(c.node,c.offset);y&&(c=new Nt(y.node,y.offset))}}p.collapse(c.node,c.offset),a.bidiLevel!=null&&p.caretBidiLevel!==void 0&&(p.caretBidiLevel=a.bidiLevel)}else if(p.extend){p.collapse(c.node,c.offset);try{p.extend(h.node,h.offset)}catch{}}else{let g=document.createRange();a.anchor>a.head&&([c,h]=[h,c]),g.setEnd(h.node,h.offset),g.setStart(c.node,c.offset),p.removeAllRanges(),p.addRange(g)}r&&this.view.root.activeElement==i&&(i.blur(),o&&o.focus())}),this.view.observer.setSelectionRange(c,h)),this.impreciseAnchor=c.precise?null:new Nt(u.anchorNode,u.anchorOffset),this.impreciseHead=h.precise?null:new Nt(u.focusNode,u.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Zi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=lo(e.root),{anchorNode:o,anchorOffset:s}=e.observer.selectionRange;if(!i||!t.empty||!t.assoc||!i.modify)return;let r=this.lineAt(t.head,t.assoc);if(!r)return;let l=r.posAtStart;if(t.head==l||t.head==l+r.length)return;let a=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!a||!c||a.bottom>c.top)return;let h=this.domAtPos(t.head+t.assoc,t.assoc);i.collapse(h.node,h.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let u=e.observer.selectionRange;e.docView.posFromDOM(u.anchorNode,u.anchorOffset)!=t.from&&i.collapse(o,s)}posFromDOM(e,t){let i=this.tile.nearest(e);if(!i)return this.tile.dom.compareDocumentPosition(e)&2?0:this.view.state.doc.length;let o=i.posAtStart;if(i.isComposite()){let s;if(e==i.dom)s=i.dom.childNodes[t];else{let r=hn(e)==0?0:t==0?-1:1;for(;;){let l=e.parentNode;if(l==i.dom)break;r==0&&l.firstChild!=l.lastChild&&(e==l.firstChild?r=-1:r=1),e=l}r<0?s=e:s=e.nextSibling}if(s==i.dom.firstChild)return o;for(;s&&!Le.get(s);)s=s.nextSibling;if(!s)return o+i.length;for(let r=0,l=o;;r++){let a=i.children[r];if(a.dom==s)return l;l+=a.length+a.breakAfter}}else return i.isText()?e==i.dom?o+t:o+(t?i.length:0):o}domAtPos(e,t){let{tile:i,offset:o}=this.tile.resolveBlock(e,t);return i.isWidget()?i.domPosFor(e,t):i.domIn(o,t)}inlineDOMNearPos(e,t){let i,o=-1,s=!1,r,l=-1,a=!1;return this.tile.blockTiles((c,h)=>{if(c.isWidget()){if(c.flags&32&&h>=e)return!0;c.flags&16&&(s=!0)}else{let u=h+c.length;if(h<=e&&(i=c,o=e-h,s=u<e),u>=e&&!r&&(r=c,l=e-h,a=h>e),h>e&&r)return!0}}),!i&&!r?this.domAtPos(e,t):(s&&r?i=null:a&&i&&(r=null),i&&t<0||!r?i.domIn(o,t):r.domIn(l,t))}coordsAt(e,t){let{tile:i,offset:o}=this.tile.resolveBlock(e,t);return i.isWidget()?i.widget instanceof vr?null:i.coordsInWidget(o,t,!0):i.coordsIn(o,t)}lineAt(e,t){let{tile:i}=this.tile.resolveBlock(e,t);return i.isLine()?i:null}coordsForChar(e){let{tile:t,offset:i}=this.tile.resolveBlock(e,1);if(!t.isLine())return null;function o(s,r){if(s.isComposite())for(let l of s.children){if(l.length>=r){let a=o(l,r);if(a)return a}if(r-=l.length,r<0)break}else if(s.isText()&&r<s.length){let l=yt(s.text,r);if(l==r)return null;let a=ao(s.dom,r,l).getClientRects();for(let c=0;c<a.length;c++){let h=a[c];if(c==a.length-1||h.top<h.bottom&&h.left<h.right)return h}}return null}return o(t,i)}measureVisibleLineHeights(e){let t=[],{from:i,to:o}=e,s=this.view.contentDOM.clientWidth,r=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==Be.LTR,c=0,h=(u,p,g)=>{for(let y=0;y<u.children.length&&!(p>o);y++){let m=u.children[y],b=p+m.length,x=m.dom.getBoundingClientRect(),{height:T}=x;if(g&&!y&&(c+=x.top-g.top),m instanceof An)b>i&&h(m,p,x);else if(p>=i&&(c>0&&t.push(-c),t.push(T+c),c=0,r)){let k=m.dom.lastChild,E=k?hs(k):[];if(E.length){let M=E[E.length-1],_=a?M.right-x.left:x.right-M.left;_>l&&(l=_,this.minWidth=s,this.minWidthFrom=p,this.minWidthTo=b)}}g&&y==u.children.length-1&&(c+=g.bottom-x.bottom),p=b+m.breakAfter}};return h(this.tile,0,null),t}textDirectionAt(e){let{tile:t}=this.tile.resolveBlock(e,1);return getComputedStyle(t.dom).direction=="rtl"?Be.RTL:Be.LTR}measureTextSize(){let e=this.tile.blockTiles(r=>{if(r.isLine()&&r.children.length&&r.length<=20){let l=0,a;for(let c of r.children){if(!c.isText()||/[^ -~]/.test(c.text))return;let h=hs(c.dom);if(h.length!=1)return;l+=h[0].width,a=h[0].height}if(l)return{lineHeight:r.dom.getBoundingClientRect().height,charWidth:l/r.length,textHeight:a}}});if(e)return e;let t=document.createElement("div"),i,o,s;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.tile.dom.appendChild(t);let r=hs(t.firstChild)[0];i=t.getBoundingClientRect().height,o=r&&r.width?r.width/27:7,s=r&&r.height?r.height:i,t.remove()}),{lineHeight:i,charWidth:o,textHeight:s}}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,o=0;;o++){let s=o==t.viewports.length?null:t.viewports[o],r=s?s.from-1:this.view.state.doc.length;if(r>i){let l=(t.lineBlockAt(r).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(pe.replace({widget:new vr(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return pe.set(e)}updateDeco(){let e=1,t=this.view.state.facet(co).map(s=>(this.dynamicDecorationMap[e++]=typeof s=="function")?s(this.view):s),i=!1,o=this.view.state.facet(rd).map((s,r)=>{let l=typeof s=="function";return l&&(i=!0),l?s(this.view):s});for(o.length&&(this.dynamicDecorationMap[e++]=i,t.push(ve.join(o))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;this.blockWrappers=this.view.state.facet(sd).map(s=>typeof s=="function"?s(this.view):s)}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(nd))try{if(c(this.view,e.range,e))return!0}catch(h){ut(this.view.state,h,"scroll handler")}let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),o;if(!i)return;!t.empty&&(o=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,o.left),top:Math.min(i.top,o.top),right:Math.max(i.right,o.right),bottom:Math.max(i.bottom,o.bottom)});let s=ya(this.view),r={left:i.left-s.left,top:i.top-s.top,right:i.right+s.right,bottom:i.bottom+s.bottom},{offsetWidth:l,offsetHeight:a}=this.view.scrollDOM;sm(this.view.scrollDOM,r,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,l),-l),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==Be.LTR)}lineHasWidget(e){let t=i=>i.isWidget()||i.children.some(t);return t(this.tile.resolveBlock(e,1).tile)}destroy(){kl(this.tile)}}function kl(n,e){let t=e==null?void 0:e.get(n);if(t!=1){t==null&&n.destroy();for(let i of n.children)kl(i,e)}}function jm(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}function hd(n,e){let t=n.observer.selectionRange;if(!t.focusNode)return null;let i=Wu(t.focusNode,t.focusOffset),o=Hu(t.focusNode,t.focusOffset),s=i||o;if(o&&i&&o.node!=i.node){let l=Le.get(o.node);if(!l||l.isText()&&l.text!=o.node.nodeValue)s=o;else if(n.docView.lastCompositionAfterCursor){let a=Le.get(i.node);!a||a.isText()&&a.text!=i.node.nodeValue||(s=o)}}if(n.docView.lastCompositionAfterCursor=s!=i,!s)return null;let r=e-s.offset;return{from:r,to:r+s.node.nodeValue.length,node:s.node}}function Dm(n,e,t){let i=hd(n,t);if(!i)return null;let{node:o,from:s,to:r}=i,l=o.nodeValue;if(/[\n\r]/.test(l)||n.state.doc.sliceString(i.from,i.to)!=l)return null;let a=e.invertedDesc;return{range:new xt(a.mapPos(s),a.mapPos(r),s,r),text:o}}function Bm(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}let Pm=class{constructor(){this.changes=[]}compareRange(e,t){gi(e,t,this.changes)}comparePoint(e,t){gi(e,t,this.changes)}boundChange(e){gi(e,e,this.changes)}};function Im(n,e,t){let i=new Pm;return ve.compare(n,e,t,i),i.changes}class zm{constructor(){this.changes=[]}compareRange(e,t){gi(e,t,this.changes)}comparePoint(){}boundChange(e){gi(e,e,this.changes)}}function Lm(n,e,t){let i=new zm;return ve.compare(n,e,t,i),i.changes}function Fm(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function $m(n,e){let t=!1;return e&&n.iterChangedRanges((i,o)=>{i<e.to&&o>e.from&&(t=!0)}),t}class vr extends Bi{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function Wm(n,e,t=1){let i=n.charCategorizer(e),o=n.doc.lineAt(e),s=e-o.from;if(o.length==0)return te.cursor(e);s==0?t=1:s==o.length&&(t=-1);let r=s,l=s;t<0?r=yt(o.text,s,!1):l=yt(o.text,s);let a=i(o.text.slice(r,l));for(;r>0;){let c=yt(o.text,r,!1);if(i(o.text.slice(c,r))!=a)break;r=c}for(;l<o.length;){let c=yt(o.text,l);if(i(o.text.slice(l,c))!=a)break;l=c}return te.range(r+o.from,l+o.from)}function Hm(n,e,t,i,o){let s=Math.round((i-e.left)*n.defaultCharacterWidth);if(n.lineWrapping&&t.height>n.defaultLineHeight*1.5){let l=n.viewState.heightOracle.textHeight,a=Math.floor((o-t.top-(n.defaultLineHeight-l)*.5)/l);s+=a*n.viewState.heightOracle.lineLength}let r=n.state.sliceDoc(t.from,t.to);return t.from+Xg(r,s,n.state.tabSize)}function Vm(n,e,t){let i=n.lineBlockAt(e);if(Array.isArray(i.type)){let o;for(let s of i.type){if(s.from>e)break;if(!(s.to<e)){if(s.from<e&&s.to>e)return s;(!o||s.type==ot.Text&&(o.type!=s.type||(t<0?s.from<e:s.to>e)))&&(o=s)}}return o||i}return i}function Um(n,e,t,i){let o=Vm(n,e.head,e.assoc||-1),s=!i||o.type!=ot.Text||!(n.lineWrapping||o.widgetLineBreaks)?null:n.coordsAtPos(e.assoc<0&&e.head>o.from?e.head-1:e.head);if(s){let r=n.dom.getBoundingClientRect(),l=n.textDirectionAt(o.from),a=n.posAtCoords({x:t==(l==Be.LTR)?r.right-1:r.left+1,y:(s.top+s.bottom)/2});if(a!=null)return te.cursor(a,t?-1:1)}return te.cursor(t?o.to:o.from,t?-1:1)}function vc(n,e,t,i){let o=n.state.doc.lineAt(e.head),s=n.bidiSpans(o),r=n.textDirectionAt(o.from);for(let l=e,a=null;;){let c=ym(o,s,r,l,t),h=Qu;if(!c){if(o.number==(t?n.state.doc.lines:1))return l;h=`
`,o=n.state.doc.line(o.number+(t?1:-1)),s=n.bidiSpans(o),c=n.visualLineSide(o,!t)}if(a){if(!a(h))return l}else{if(!i)return c;a=i(h)}l=c}}function qm(n,e,t){let i=n.state.charCategorizer(e),o=i(t);return s=>{let r=i(s);return o==ht.Space&&(o=r),o==r}}function Km(n,e,t,i){let o=e.head,s=t?1:-1;if(o==(t?n.state.doc.length:0))return te.cursor(o,e.assoc);let r=e.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),c=n.coordsAtPos(o,e.assoc||-1),h=n.documentTop;if(c)r==null&&(r=c.left-a.left),l=s<0?c.top:c.bottom;else{let g=n.viewState.lineBlockAt(o);r==null&&(r=Math.min(a.right-a.left,n.defaultCharacterWidth*(o-g.from))),l=(s<0?g.top:g.bottom)+h}let u=a.left+r,p=i??n.viewState.heightOracle.textHeight>>1;for(let g=0;;g+=10){let y=l+(p+g)*s,m=Cl(n,{x:u,y},!1,s);return te.cursor(m.pos,m.assoc,void 0,r)}}function eo(n,e,t){for(;;){let i=0;for(let o of n)o.between(e-1,e+1,(s,r,l)=>{if(e>s&&e<r){let a=i||t||(e-s<r-e?-1:1);e=a<0?s:r,i=a}});if(!i)return e}}function ud(n,e){let t=null;for(let i=0;i<e.ranges.length;i++){let o=e.ranges[i],s=null;if(o.empty){let r=eo(n,o.from,0);r!=o.from&&(s=te.cursor(r,-1))}else{let r=eo(n,o.from,-1),l=eo(n,o.to,1);(r!=o.from||l!=o.to)&&(s=te.range(o.from==o.anchor?r:l,o.from==o.head?r:l))}s&&(t||(t=e.ranges.slice()),t[i]=s)}return t?te.create(t,e.mainIndex):e}function wr(n,e,t){let i=eo(n.state.facet(Eo).map(o=>o(n)),t.from,e.head>t.from?-1:1);return i==t.from?t:te.cursor(i,i<t.from?1:-1)}class Qt{constructor(e,t){this.pos=e,this.assoc=t}}function Cl(n,e,t,i){let o=n.contentDOM.getBoundingClientRect(),s=o.top+n.viewState.paddingTop,{x:r,y:l}=e,a=l-s,c;for(;;){if(a<0)return new Qt(0,1);if(a>n.viewState.docHeight)return new Qt(n.state.doc.length,-1);if(c=n.elementAtHeight(a),i==null)break;if(c.type==ot.Text){let p=n.docView.coordsAt(i<0?c.from:c.to,i);if(p&&(i<0?p.top<=a+s:p.bottom>=a+s))break}let u=n.viewState.heightOracle.textHeight/2;a=i>0?c.bottom+u:c.top-u}if(n.viewport.from>=c.to||n.viewport.to<=c.from){if(t)return null;if(c.type==ot.Text){let u=Hm(n,o,c,r,l);return new Qt(u,u==c.from?1:-1)}}if(c.type!=ot.Text)return a<(c.top+c.bottom)/2?new Qt(c.from,1):new Qt(c.to,-1);let h=n.docView.lineAt(c.from,2);return(!h||h.length!=c.length)&&(h=n.docView.lineAt(c.from,-2)),dd(n,h,c.from,r,l)}function dd(n,e,t,i,o){let s=-1,r=null,l=1e9,a=1e9,c=o,h=o,u=(p,g)=>{for(let y=0;y<p.length;y++){let m=p[y];if(m.top==m.bottom)continue;let b=m.left>i?m.left-i:m.right<i?i-m.right:0,x=m.top>o?m.top-o:m.bottom<o?o-m.bottom:0;m.top<=h&&m.bottom>=c&&(c=Math.min(m.top,c),h=Math.max(m.bottom,h),x=0),(s<0||(x-a||b-l)<0)&&(s>=0&&a&&l<b&&r.top<=h-2&&r.bottom>=c+2?a=0:(s=g,l=b,a=x,r=m))}};if(e.isText()){for(let g=0;g<e.length;){let y=yt(e.text,g);if(u(ao(e.dom,g,y).getClientRects(),g),!l&&!a)break;g=y}return i>(r.left+r.right)/2==(wc(n,s+t)==Be.LTR)?new Qt(t+yt(e.text,s),-1):new Qt(t+s,1)}else{if(!e.length)return new Qt(t,1);for(let m=0;m<e.children.length;m++){let b=e.children[m];if(b.flags&48)continue;let x=(b.dom.nodeType==1?b.dom:ao(b.dom,0,b.length)).getClientRects();if(u(x,m),!l&&!a)break}let p=e.children[s],g=e.posBefore(p,t);return p.isComposite()||p.isText()?dd(n,p,g,Math.max(r.left,Math.min(r.right,i)),o):i>(r.left+r.right)/2==(wc(n,s+t)==Be.LTR)?new Qt(g+p.length,-1):new Qt(g,1)}}function wc(n,e){let t=n.state.doc.lineAt(e);return n.bidiSpans(t)[ln.find(n.bidiSpans(t),e-t.from,-1,1)].dir}const qi="ï¿¿";class Qm{constructor(e,t){this.points=e,this.view=t,this.text="",this.lineSeparator=t.state.facet(we.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=qi}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let o=e;;){this.findPointBefore(i,o);let s=this.text.length;this.readNode(o);let r=Le.get(o),l=o.nextSibling;if(l==t){r!=null&&r.breakAfter&&!l&&i!=this.view.contentDOM&&this.lineBreak();break}let a=Le.get(l);(r&&a?r.breakAfter:(r?r.breakAfter:ws(o))||ws(l)&&(o.nodeName!="BR"||r!=null&&r.isWidget())&&this.text.length>s)&&!Xm(l,t)&&this.lineBreak(),o=l}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,o=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,r=1,l;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),r=this.lineSeparator.length):(l=o.exec(t))&&(s=l.index,r=l[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),r>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=r-1);i=s+r}}readNode(e){let t=Le.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let o=i.iter();!o.next().done;)o.lineBreak?this.lineBreak():this.append(o.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(Ym(e,i.node,i.offset)?t:0))}}function Ym(n,e,t){for(;;){if(!e||t<hn(e))return!1;if(e==n)return!0;t=Rn(e)+1,e=e.parentNode}}function Xm(n,e){let t;for(;!(n==e||!n);n=n.nextSibling){let i=Le.get(n);if(!(i!=null&&i.isWidget()))return!1;i&&(t||(t=[])).push(i)}if(t)for(let i of t){let o=i.overrideDOMText;if(o!=null&&o.length)return!1}return!0}class Sc{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class Gm{constructor(e,t,i,o){this.typeOver=o,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:s,impreciseAnchor:r}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=fd(e.docView.tile,t,i,0))){let l=s||r?[]:Zm(e),a=new Qm(l,e);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=e0(l,this.bounds.from)}else{let l=e.observer.selectionRange,a=s&&s.node==l.focusNode&&s.offset==l.focusOffset||!xl(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),c=r&&r.node==l.anchorNode&&r.offset==l.anchorOffset||!xl(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset),h=e.viewport;if((Z.ios||Z.chrome)&&e.state.selection.main.empty&&a!=c&&(h.from>0||h.to<e.state.doc.length)){let u=Math.min(a,c),p=Math.max(a,c),g=h.from-u,y=h.to-p;(g==0||g==1||u==0)&&(y==0||y==-1||p==e.state.doc.length)&&(a=0,c=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(te.range(c,a)):this.newSel=te.single(c,a)}}}function fd(n,e,t,i){if(n.isComposite()){let o=-1,s=-1,r=-1,l=-1;for(let a=0,c=i,h=i;a<n.children.length;a++){let u=n.children[a],p=c+u.length;if(c<e&&p>t)return fd(u,e,t,c);if(p>=e&&o==-1&&(o=a,s=c),c>t&&u.dom.parentNode==n.dom){r=a,l=h;break}h=p,c=p+u.breakAfter}return{from:s,to:l<0?i+n.length:l,startDOM:(o?n.children[o-1].dom.nextSibling:null)||n.dom.firstChild,endDOM:r<n.children.length&&r>=0?n.children[r].dom:null}}else return n.isText()?{from:i,to:i+n.length,startDOM:n.dom,endDOM:n.dom.nextSibling}:null}function pd(n,e){let t,{newSel:i}=e,o=n.state.selection.main,s=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(e.bounds){let{from:r,to:l}=e.bounds,a=o.from,c=null;(s===8||Z.android&&e.text.length<l-r)&&(a=o.to,c="end");let h=gd(n.state.doc.sliceString(r,l,qi),e.text,a-r,c);h&&(Z.chrome&&s==13&&h.toB==h.from+2&&e.text.slice(h.from,h.toB)==qi+qi&&h.toB--,t={from:r+h.from,to:r+h.toA,insert:ke.of(e.text.slice(h.from,h.toB).split(qi))})}else i&&(!n.hasFocus&&n.state.facet(rn)||i.main.eq(o))&&(i=null);if(!t&&!i)return!1;if(!t&&e.typeOver&&!o.empty&&i&&i.main.empty?t={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,o.to)}:(Z.mac||Z.android)&&t&&t.from==t.to&&t.from==o.head-1&&/^\. ?$/.test(t.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(i&&t.insert.length==2&&(i=te.single(i.main.anchor-1,i.main.head-1)),t={from:t.from,to:t.to,insert:ke.of([t.insert.toString().replace("."," ")])}):t&&t.from>=o.from&&t.to<=o.to&&(t.from!=o.from||t.to!=o.to)&&o.to-o.from-(t.to-t.from)<=4?t={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,t.from).append(t.insert).append(n.state.doc.slice(t.to,o.to))}:n.state.doc.lineAt(o.from).to<o.to&&n.docView.lineHasWidget(o.to)&&n.inputState.insertingTextAt>Date.now()-50?t={from:o.from,to:o.to,insert:n.state.toText(n.inputState.insertingText)}:Z.chrome&&t&&t.from==t.to&&t.from==o.head&&t.insert.toString()==`
 `&&n.lineWrapping&&(i&&(i=te.single(i.main.anchor-1,i.main.head-1)),t={from:o.from,to:o.to,insert:ke.of([" "])}),t)return xa(n,t,i,s);if(i&&!i.main.eq(o)){let r=!1,l="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(r=!0),l=n.inputState.lastSelectionOrigin,l=="select.pointer"&&(i=ud(n.state.facet(Eo).map(a=>a(n)),i))),n.dispatch({selection:i,scrollIntoView:r,userEvent:l}),!0}else return!1}function xa(n,e,t,i=-1){if(Z.ios&&n.inputState.flushIOSKey(e))return!0;let o=n.state.selection.main;if(Z.android&&(e.to==o.to&&(e.from==o.from||e.from==o.from-1&&n.state.sliceDoc(e.from,o.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&mi(n.contentDOM,"Enter",13)||(e.from==o.from-1&&e.to==o.to&&e.insert.length==0||i==8&&e.insert.length<e.to-e.from&&e.to>o.head)&&mi(n.contentDOM,"Backspace",8)||e.from==o.from&&e.to==o.to+1&&e.insert.length==0&&mi(n.contentDOM,"Delete",46)))return!0;let s=e.insert.toString();n.inputState.composing>=0&&n.inputState.composing++;let r,l=()=>r||(r=Jm(n,e,t));return n.state.facet(Zu).some(a=>a(n,e.from,e.to,s,l))||n.dispatch(l()),!0}function Jm(n,e,t){let i,o=n.state,s=o.selection.main,r=-1;if(e.from==e.to&&e.from<s.from||e.from>s.to){let a=e.from<s.from?-1:1,c=a<0?s.from:s.to,h=eo(o.facet(Eo).map(u=>u(n)),c,a);e.from==h&&(r=h)}if(r>-1)i={changes:e,selection:te.cursor(e.from+e.insert.length,-1)};else if(e.from>=s.from&&e.to<=s.to&&e.to-e.from>=(s.to-s.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&n.inputState.composing<0){let a=s.from<e.from?o.sliceDoc(s.from,e.from):"",c=s.to>e.to?o.sliceDoc(e.to,s.to):"";i=o.replaceSelection(n.state.toText(a+e.insert.sliceString(0,void 0,n.state.lineBreak)+c))}else{let a=o.changes(e),c=t&&t.main.to<=a.newLength?t.main:void 0;if(o.selection.ranges.length>1&&(n.inputState.composing>=0||n.inputState.compositionPendingChange)&&e.to<=s.to+10&&e.to>=s.to-10){let h=n.state.sliceDoc(e.from,e.to),u,p=t&&hd(n,t.main.head);if(p){let y=e.insert.length-(e.to-e.from);u={from:p.from,to:p.to-y}}else u=n.state.doc.lineAt(s.head);let g=s.to-e.to;i=o.changeByRange(y=>{if(y.from==s.from&&y.to==s.to)return{changes:a,range:c||y.map(a)};let m=y.to-g,b=m-h.length;if(n.state.sliceDoc(b,m)!=h||m>=u.from&&b<=u.to)return{range:y};let x=o.changes({from:b,to:m,insert:e.insert}),T=y.to-s.to;return{changes:x,range:c?te.range(Math.max(0,c.anchor+T),Math.max(0,c.head+T)):y.map(x)}})}else i={changes:a,selection:c&&o.selection.replaceRange(c)}}let l="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,l+=".compose",n.inputState.compositionFirstChange&&(l+=".start",n.inputState.compositionFirstChange=!1)),o.update(i,{userEvent:l,scrollIntoView:!0})}function gd(n,e,t,i){let o=Math.min(n.length,e.length),s=0;for(;s<o&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==o&&n.length==e.length)return null;let r=n.length,l=e.length;for(;r>0&&l>0&&n.charCodeAt(r-1)==e.charCodeAt(l-1);)r--,l--;if(i=="end"){let a=Math.max(0,s-Math.min(r,l));t-=r+a-s}if(r<s&&n.length<e.length){let a=t<=s&&t>=r?s-t:0;s-=a,l=s+(l-r),r=s}else if(l<s){let a=t<=s&&t>=l?s-t:0;s-=a,r=s+(r-l),l=s}return{from:s,toA:r,toB:l}}function Zm(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:o,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new Sc(t,i)),(o!=t||s!=i)&&e.push(new Sc(o,s))),e}function e0(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?te.single(t+e,i+e):null}class t0{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Z.safari&&e.contentDOM.addEventListener("input",()=>null),Z.gecko&&m0(e.contentDOM.ownerDocument)}handleEvent(e){!c0(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let i=this.handlers[e];if(i){for(let o of i.observers)o(this.view,t);for(let o of i.handlers){if(t.defaultPrevented)break;if(o(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=n0(e),i=this.handlers,o=this.view.contentDOM;for(let s in t)if(s!="scroll"){let r=!t[s].handlers.length,l=i[s];l&&r!=!l.handlers.length&&(o.removeEventListener(s,this.handleEvent),l=null),l||o.addEventListener(s,this.handleEvent,{passive:r})}for(let s in i)s!="scroll"&&!t[s]&&o.removeEventListener(s,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&yd.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),Z.android&&Z.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return Z.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=md.find(i=>i.keyCode==e.keyCode))&&!e.ctrlKey||i0.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,mi(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:Z.safari&&!Z.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function kc(n,e){return(t,i)=>{try{return e.call(n,i,t)}catch(o){ut(t.state,o)}}}function n0(n){let e=Object.create(null);function t(i){return e[i]||(e[i]={observers:[],handlers:[]})}for(let i of n){let o=i.spec,s=o&&o.plugin.domEventHandlers,r=o&&o.plugin.domEventObservers;if(s)for(let l in s){let a=s[l];a&&t(l).handlers.push(kc(i.value,a))}if(r)for(let l in r){let a=r[l];a&&t(l).observers.push(kc(i.value,a))}}for(let i in jt)t(i).handlers.push(jt[i]);for(let i in Tt)t(i).observers.push(Tt[i]);return e}const md=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],i0="dthko",yd=[16,17,18,20,91,92,224,225],Io=6;function zo(n){return Math.max(0,n)*.7+8}function o0(n,e){return Math.max(Math.abs(n.clientX-e.clientX),Math.abs(n.clientY-e.clientY))}class s0{constructor(e,t,i,o){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=o,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=rm(e.contentDOM),this.atoms=e.state.facet(Eo).map(r=>r(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(we.allowMultipleSelections)&&r0(e,t),this.dragging=a0(e,t)&&vd(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&o0(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,i=0,o=0,s=0,r=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:o,right:r}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:l}=this.scrollParents.y.getBoundingClientRect());let a=ya(this.view);e.clientX-a.left<=o+Io?t=-zo(o-e.clientX):e.clientX+a.right>=r-Io&&(t=zo(e.clientX-r)),e.clientY-a.top<=s+Io?i=-zo(s-e.clientY):e.clientY+a.bottom>=l-Io&&(i=zo(e.clientY-l)),this.setScrollSpeed(t,i)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:t}=this,i=ud(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!i.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function r0(n,e){let t=n.state.facet(Yu);return t.length?t[0](e):Z.mac?e.metaKey:e.ctrlKey}function l0(n,e){let t=n.state.facet(Xu);return t.length?t[0](e):Z.mac?!e.altKey:!e.ctrlKey}function a0(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=lo(n.root);if(!i||i.rangeCount==0)return!0;let o=i.getRangeAt(0).getClientRects();for(let s=0;s<o.length;s++){let r=o[s];if(r.left<=e.clientX&&r.right>=e.clientX&&r.top<=e.clientY&&r.bottom>=e.clientY)return!0}return!1}function c0(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=Le.get(t))&&i.isWidget()&&!i.isHidden&&i.widget.ignoreEvent(e))return!1;return!0}const jt=Object.create(null),Tt=Object.create(null),xd=Z.ie&&Z.ie_version<15||Z.ios&&Z.webkit_version<604;function h0(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),bd(n,t.value)},50)}function Zs(n,e,t){for(let i of n.facet(e))t=i(t,n);return t}function bd(n,e){e=Zs(n.state,pa,e);let{state:t}=n,i,o=1,s=t.toText(e),r=s.lines==t.selection.ranges.length;if(Tl!=null&&t.selection.ranges.every(a=>a.empty)&&Tl==s.toString()){let a=-1;i=t.changeByRange(c=>{let h=t.doc.lineAt(c.from);if(h.from==a)return{range:c};a=h.from;let u=t.toText((r?s.line(o++).text:e)+t.lineBreak);return{changes:{from:h.from,insert:u},range:te.cursor(c.from+u.length)}})}else r?i=t.changeByRange(a=>{let c=s.line(o++);return{changes:{from:a.from,to:a.to,insert:c.text},range:te.cursor(a.from+c.length)}}):i=t.replaceSelection(s);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Tt.scroll=n=>{n.inputState.lastScrollTop=n.scrollDOM.scrollTop,n.inputState.lastScrollLeft=n.scrollDOM.scrollLeft};jt.keydown=(n,e)=>(n.inputState.setSelectionOrigin("select"),e.keyCode==27&&n.inputState.tabFocusMode!=0&&(n.inputState.tabFocusMode=Date.now()+2e3),!1);Tt.touchstart=(n,e)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};Tt.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};jt.mousedown=(n,e)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let i of n.state.facet(Gu))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=d0(n,e)),t){let i=!n.hasFocus;n.inputState.startMouseSelection(new s0(n,e,t,i)),i&&n.observer.ignore(()=>{Fu(n.contentDOM);let s=n.root.activeElement;s&&!s.contains(n.contentDOM)&&s.blur()});let o=n.inputState.mouseSelection;if(o)return o.start(e),o.dragging===!1}else n.inputState.setSelectionOrigin("select.pointer");return!1};function Cc(n,e,t,i){if(i==1)return te.cursor(e,t);if(i==2)return Wm(n.state,e,t);{let o=n.docView.lineAt(e,t),s=n.state.doc.lineAt(o?o.posAtEnd:e),r=o?o.posAtStart:s.from,l=o?o.posAtEnd:s.to;return l<n.state.doc.length&&l==s.to&&l++,te.range(r,l)}}const u0=Z.ie&&Z.ie_version<=11;let Tc=null,Ec=0,Ac=0;function vd(n){if(!u0)return n.detail;let e=Tc,t=Ac;return Tc=n,Ac=Date.now(),Ec=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(Ec+1)%3:1}function d0(n,e){let t=n.posAndSideAtCoords({x:e.clientX,y:e.clientY},!1),i=vd(e),o=n.state.selection;return{update(s){s.docChanged&&(t.pos=s.changes.mapPos(t.pos),o=o.map(s.changes))},get(s,r,l){let a=n.posAndSideAtCoords({x:s.clientX,y:s.clientY},!1),c,h=Cc(n,a.pos,a.assoc,i);if(t.pos!=a.pos&&!r){let u=Cc(n,t.pos,t.assoc,i),p=Math.min(u.from,h.from),g=Math.max(u.to,h.to);h=p<h.from?te.range(p,g):te.range(g,p)}return r?o.replaceRange(o.main.extend(h.from,h.to)):l&&i==1&&o.ranges.length>1&&(c=f0(o,a.pos))?c:l?o.addRange(h):te.create([h])}}}function f0(n,e){for(let t=0;t<n.ranges.length;t++){let{from:i,to:o}=n.ranges[t];if(i<=e&&o>=e)return te.create(n.ranges.slice(0,t).concat(n.ranges.slice(t+1)),n.mainIndex==t?0:n.mainIndex-(n.mainIndex>t?1:0))}return null}jt.dragstart=(n,e)=>{let{selection:{main:t}}=n.state;if(e.target.draggable){let o=n.docView.tile.nearest(e.target);if(o&&o.isWidget()){let s=o.posAtStart,r=s+o.length;(s>=t.to||r<=t.from)&&(t=te.range(s,r))}}let{inputState:i}=n;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",Zs(n.state,ga,n.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};jt.dragend=n=>(n.inputState.draggedContent=null,!1);function _c(n,e,t,i){if(t=Zs(n.state,pa,t),!t)return;let o=n.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:s}=n.inputState,r=i&&s&&l0(n,e)?{from:s.from,to:s.to}:null,l={from:o,insert:t},a=n.state.changes(r?[r,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(o,-1),head:a.mapPos(o,1)},userEvent:r?"move.drop":"input.drop"}),n.inputState.draggedContent=null}jt.drop=(n,e)=>{if(!e.dataTransfer)return!1;if(n.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let i=Array(t.length),o=0,s=()=>{++o==t.length&&_c(n,e,i.filter(r=>r!=null).join(n.state.lineBreak),!1)};for(let r=0;r<t.length;r++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[r]=l.result),s()},l.readAsText(t[r])}return!0}else{let i=e.dataTransfer.getData("Text");if(i)return _c(n,e,i,!0),!0}return!1};jt.paste=(n,e)=>{if(n.state.readOnly)return!0;n.observer.flush();let t=xd?null:e.clipboardData;return t?(bd(n,t.getData("text/plain")||t.getData("text/uri-list")),!0):(h0(n),!1)};function p0(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function g0(n){let e=[],t=[],i=!1;for(let o of n.selection.ranges)o.empty||(e.push(n.sliceDoc(o.from,o.to)),t.push(o));if(!e.length){let o=-1;for(let{from:s}of n.selection.ranges){let r=n.doc.lineAt(s);r.number>o&&(e.push(r.text),t.push({from:r.from,to:Math.min(n.doc.length,r.to+1)})),o=r.number}i=!0}return{text:Zs(n,ga,e.join(n.lineBreak)),ranges:t,linewise:i}}let Tl=null;jt.copy=jt.cut=(n,e)=>{let{text:t,ranges:i,linewise:o}=g0(n.state);if(!t&&!o)return!1;Tl=o?t:null,e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let s=xd?null:e.clipboardData;return s?(s.clearData(),s.setData("text/plain",t),!0):(p0(n,t),!1)};const wd=fn.define();function Sd(n,e){let t=[];for(let i of n.facet(ed)){let o=i(n,e);o&&t.push(o)}return t.length?n.update({effects:t,annotations:wd.of(!0)}):null}function kd(n){setTimeout(()=>{let e=n.hasFocus;if(e!=n.inputState.notifiedFocused){let t=Sd(n.state,e);t?n.dispatch(t):n.update([])}},10)}Tt.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),kd(n)};Tt.blur=n=>{n.observer.clearSelectionRange(),kd(n)};Tt.compositionstart=Tt.compositionupdate=n=>{n.observer.editContext||(n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0))};Tt.compositionend=n=>{n.observer.editContext||(n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,Z.chrome&&Z.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.hasComposition&&n.update([])},50))};Tt.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};jt.beforeinput=(n,e)=>{var t,i;if((e.inputType=="insertText"||e.inputType=="insertCompositionText")&&(n.inputState.insertingText=e.data,n.inputState.insertingTextAt=Date.now()),e.inputType=="insertReplacementText"&&n.observer.editContext){let s=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),r=e.getTargetRanges();if(s&&r.length){let l=r[0],a=n.posAtDOM(l.startContainer,l.startOffset),c=n.posAtDOM(l.endContainer,l.endOffset);return xa(n,{from:a,to:c,insert:n.state.toText(s)},null),!0}}let o;if(Z.chrome&&Z.android&&(o=md.find(s=>s.inputType==e.inputType))&&(n.observer.delayAndroidKey(o.key,o.keyCode),o.key=="Backspace"||o.key=="Delete")){let s=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>s+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}return Z.ios&&e.inputType=="deleteContentForward"&&n.observer.flushSoon(),Z.safari&&e.inputType=="insertText"&&n.inputState.composing>=0&&setTimeout(()=>Tt.compositionend(n,e),20),!1};const Mc=new Set;function m0(n){Mc.has(n)||(Mc.add(n),n.addEventListener("copy",()=>{}),n.addEventListener("cut",()=>{}))}const Oc=["pre-wrap","normal","pre-line","break-spaces"];let _i=!1;function Nc(){_i=!1}class y0{constructor(e){this.lineWrapping=e,this.doc=ke.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return Oc.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let o=e[i];o<0?i++:this.heightSamples[Math.floor(o*10)]||(t=!0,this.heightSamples[Math.floor(o*10)]=!0)}return t}refresh(e,t,i,o,s,r){let l=Oc.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=t,this.charWidth=i,this.textHeight=o,this.lineLength=s,a){this.heightSamples={};for(let c=0;c<r.length;c++){let h=r[c];h<0?c++:this.heightSamples[Math.floor(h*10)]=!0}}return a}}class x0{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Mt{constructor(e,t,i,o,s){this.from=e,this.length=t,this.top=i,this.height=o,this._content=s}get type(){return typeof this._content=="number"?ot.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof ei?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new Mt(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var _e=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(_e||(_e={}));const us=.001;class Ze{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>us&&(_i=!0),this.height=e)}replace(e,t,i){return Ze.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,o){let s=this,r=i.doc;for(let l=o.length-1;l>=0;l--){let{fromA:a,toA:c,fromB:h,toB:u}=o[l],p=s.lineAt(a,_e.ByPosNoHeight,i.setDoc(t),0,0),g=p.to>=c?p:s.lineAt(c,_e.ByPosNoHeight,i,0,0);for(u+=g.to-c,c=g.to;l>0&&p.from<=o[l-1].toA;)a=o[l-1].fromA,h=o[l-1].fromB,l--,a<p.from&&(p=s.lineAt(a,_e.ByPosNoHeight,i,0,0));h+=p.from-a,a=p.from;let y=ba.build(i.setDoc(r),e,h,u);s=Es(s,s.replace(a,c,y))}return s.updateHeight(i,0)}static empty(){return new at(0,0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,o=0,s=0;for(;;)if(t==i)if(o>s*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,o-=l.size}else if(s>o*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(o<s){let l=e[t++];l&&(o+=l.size)}else{let l=e[--i];l&&(s+=l.size)}let r=0;return e[t-1]==null?(r=1,t--):e[t]==null&&(r=1,i++),new v0(Ze.of(e.slice(0,t)),r,Ze.of(e.slice(i)))}}function Es(n,e){return n==e?n:(n.constructor!=e.constructor&&(_i=!0),e)}Ze.prototype.size=1;const b0=pe.replace({});class Cd extends Ze{constructor(e,t,i){super(e,t),this.deco=i,this.spaceAbove=0}mainBlock(e,t){return new Mt(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.deco||0)}blockAt(e,t,i,o){return this.spaceAbove&&e<i+this.spaceAbove?new Mt(o,0,i,this.spaceAbove,b0):this.mainBlock(i,o)}lineAt(e,t,i,o,s){let r=this.mainBlock(o,s);return this.spaceAbove?this.blockAt(0,i,o,s).join(r):r}forEachLine(e,t,i,o,s,r){e<=s+this.length&&t>=s&&r(this.lineAt(0,_e.ByPos,i,o,s))}setMeasuredHeight(e){let t=e.heights[e.index++];t<0?(this.spaceAbove=-t,t=e.heights[e.index++]):this.spaceAbove=0,this.setHeight(t)}updateHeight(e,t=0,i=!1,o){return o&&o.from<=t&&o.more&&this.setMeasuredHeight(o),this.outdated=!1,this}toString(){return`block(${this.length})`}}class at extends Cd{constructor(e,t,i){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0,this.spaceAbove=i}mainBlock(e,t){return new Mt(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.breaks)}replace(e,t,i){let o=i[0];return i.length==1&&(o instanceof at||o instanceof Ke&&o.flags&4)&&Math.abs(this.length-o.length)<10?(o instanceof Ke?o=new at(o.length,this.height,this.spaceAbove):o.height=this.height,this.outdated||(o.outdated=!1),o):Ze.of(i)}updateHeight(e,t=0,i=!1,o){return o&&o.from<=t&&o.more?this.setMeasuredHeight(o):(i||this.outdated)&&(this.spaceAbove=0,this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight)),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Ke extends Ze{constructor(e){super(e,0)}heightMetrics(e,t){let i=e.doc.lineAt(t).number,o=e.doc.lineAt(t+this.length).number,s=o-i+1,r,l=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*s);r=a/s,this.length>s+1&&(l=(this.height-a)/(this.length-s-1))}else r=this.height/s;return{firstLine:i,lastLine:o,perLine:r,perChar:l}}blockAt(e,t,i,o){let{firstLine:s,lastLine:r,perLine:l,perChar:a}=this.heightMetrics(t,o);if(t.lineWrapping){let c=o+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),h=t.doc.lineAt(c),u=l+h.length*a,p=Math.max(i,e-u/2);return new Mt(h.from,h.length,p,u,0)}else{let c=Math.max(0,Math.min(r-s,Math.floor((e-i)/l))),{from:h,length:u}=t.doc.line(s+c);return new Mt(h,u,i+l*c,l,0)}}lineAt(e,t,i,o,s){if(t==_e.ByHeight)return this.blockAt(e,i,o,s);if(t==_e.ByPosNoHeight){let{from:g,to:y}=i.doc.lineAt(e);return new Mt(g,y-g,0,0,0)}let{firstLine:r,perLine:l,perChar:a}=this.heightMetrics(i,s),c=i.doc.lineAt(e),h=l+c.length*a,u=c.number-r,p=o+l*u+a*(c.from-s-u);return new Mt(c.from,c.length,Math.max(o,Math.min(p,o+this.height-h)),h,0)}forEachLine(e,t,i,o,s,r){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:l,perLine:a,perChar:c}=this.heightMetrics(i,s);for(let h=e,u=o;h<=t;){let p=i.doc.lineAt(h);if(h==e){let y=p.number-l;u+=a*y+c*(e-s-y)}let g=a+c*p.length;r(new Mt(p.from,p.length,u,g,0)),u+=g,h=p.to+1}}replace(e,t,i){let o=this.length-t;if(o>0){let s=i[i.length-1];s instanceof Ke?i[i.length-1]=new Ke(s.length+o):i.push(null,new Ke(o-1))}if(e>0){let s=i[0];s instanceof Ke?i[0]=new Ke(e+s.length):i.unshift(new Ke(e-1),null)}return Ze.of(i)}decomposeLeft(e,t){t.push(new Ke(e-1),null)}decomposeRight(e,t){t.push(null,new Ke(this.length-e-1))}updateHeight(e,t=0,i=!1,o){let s=t+this.length;if(o&&o.from<=t+this.length&&o.more){let r=[],l=Math.max(t,o.from),a=-1;for(o.from>t&&r.push(new Ke(o.from-t-1).updateHeight(e,t));l<=s&&o.more;){let h=e.doc.lineAt(l).length;r.length&&r.push(null);let u=o.heights[o.index++],p=0;u<0&&(p=-u,u=o.heights[o.index++]),a==-1?a=u:Math.abs(u-a)>=us&&(a=-2);let g=new at(h,u,p);g.outdated=!1,r.push(g),l+=h+1}l<=s&&r.push(null,new Ke(s-l).updateHeight(e,l));let c=Ze.of(r);return(a<0||Math.abs(c.height-this.height)>=us||Math.abs(a-this.heightMetrics(e,t).perLine)>=us)&&(_i=!0),Es(this,c)}else(i||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class v0 extends Ze{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,o){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,o):this.right.blockAt(e,t,s,o+this.left.length+this.break)}lineAt(e,t,i,o,s){let r=o+this.left.height,l=s+this.left.length+this.break,a=t==_e.ByHeight?e<r:e<l,c=a?this.left.lineAt(e,t,i,o,s):this.right.lineAt(e,t,i,r,l);if(this.break||(a?c.to<l:c.from>l))return c;let h=t==_e.ByPosNoHeight?_e.ByPosNoHeight:_e.ByPos;return a?c.join(this.right.lineAt(l,h,i,r,l)):this.left.lineAt(l,h,i,o,s).join(c)}forEachLine(e,t,i,o,s,r){let l=o+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,o,s,r),t>=a&&this.right.forEachLine(e,t,i,l,a,r);else{let c=this.lineAt(a,_e.ByPos,i,o,s);e<c.from&&this.left.forEachLine(e,c.from-1,i,o,s,r),c.to>=e&&c.from<=t&&r(c),t>c.to&&this.right.forEachLine(c.to+1,t,i,l,a,r)}}replace(e,t,i){let o=this.left.length+this.break;if(t<o)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-o,t-o,i));let s=[];e>0&&this.decomposeLeft(e,s);let r=s.length;for(let l of i)s.push(l);if(e>0&&Rc(s,r-1),t<this.length){let l=s.length;this.decomposeRight(t,s),Rc(s,l)}return Ze.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,o=i+this.break;if(e>=o)return this.right.decomposeRight(e-o,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<o&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Ze.of(this.break?[e,null,t]:[e,t]):(this.left=Es(this.left,e),this.right=Es(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,o){let{left:s,right:r}=this,l=t+s.length+this.break,a=null;return o&&o.from<=t+s.length&&o.more?a=s=s.updateHeight(e,t,i,o):s.updateHeight(e,t,i),o&&o.from<=l+r.length&&o.more?a=r=r.updateHeight(e,l,i,o):r.updateHeight(e,l,i),a?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Rc(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof Ke&&(i=n[e+1])instanceof Ke&&n.splice(e-1,3,new Ke(t.length+1+i.length))}const w0=5;class ba{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),o=this.nodes[this.nodes.length-1];o instanceof at?o.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new at(i-this.pos,-1,0)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let o=i.widget?i.widget.estimatedHeight:0,s=i.widget?i.widget.lineBreaks:0;o<0&&(o=this.oracle.lineHeight);let r=t-e;i.block?this.addBlock(new Cd(r,o,i)):(r||s||o>=w0)&&this.addLineDeco(o,s,r)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new at(this.pos-e,-1,0)),this.writtenTo=this.pos}blankContent(e,t){let i=new Ke(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof at)return e;let t=new at(0,-1,0);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let o=this.ensureLine();o.length+=i,o.collapsed+=i,o.widgetHeight=Math.max(o.widgetHeight,e),o.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof at)&&!this.isCovered?this.nodes.push(new at(0,-1,0)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let o of this.nodes)o instanceof at&&o.updateHeight(this.oracle,i),i+=o?o.length:1;return this.nodes}static build(e,t,i,o){let s=new ba(i,e);return ve.spans(t,i,o,s,0),s.finish(i)}}function S0(n,e,t){let i=new k0;return ve.compare(n,e,t,i,0),i.changes}class k0{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,o){(e<t||i&&i.heightRelevant||o&&o.heightRelevant)&&gi(e,t,this.changes,5)}}function C0(n,e){let t=n.getBoundingClientRect(),i=n.ownerDocument,o=i.defaultView||window,s=Math.max(0,t.left),r=Math.min(o.innerWidth,t.right),l=Math.max(0,t.top),a=Math.min(o.innerHeight,t.bottom);for(let c=n.parentNode;c&&c!=i.body;)if(c.nodeType==1){let h=c,u=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&u.overflow!="visible"){let p=h.getBoundingClientRect();s=Math.max(s,p.left),r=Math.min(r,p.right),l=Math.max(l,p.top),a=Math.min(c==n.parentNode?o.innerHeight:a,p.bottom)}c=u.position=="absolute"||u.position=="fixed"?h.offsetParent:h.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:s-t.left,right:Math.max(s,r)-t.left,top:l-(t.top+e),bottom:Math.max(l,a)-(t.top+e)}}function T0(n){let e=n.getBoundingClientRect(),t=n.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function E0(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Sr{constructor(e,t,i,o){this.from=e,this.to=t,this.size=i,this.displaySize=o}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let o=e[i],s=t[i];if(o.from!=s.from||o.to!=s.to||o.size!=s.size)return!1}return!0}draw(e,t){return pe.replace({widget:new A0(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class A0 extends Bi{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class jc{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Dc,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Be.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(ma).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new y0(t),this.stateDeco=e.facet(co).filter(i=>typeof i!="function"),this.heightMap=Ze.empty().applyChanges(this.stateDeco,ke.empty,this.heightOracle.setDoc(e.doc),[new xt(0,0,0,e.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=pe.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let o=i?t.head:t.anchor;if(!e.some(({from:s,to:r})=>o>=s&&o<=r)){let{from:s,to:r}=this.lineBlockAt(o);e.push(new Lo(s,r))}}return this.viewports=e.sort((i,o)=>i.from-o.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?Dc:new va(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Ki(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(co).filter(h=>typeof h!="function");let o=e.changedRanges,s=xt.extendWithRanges(o,S0(i,this.stateDeco,e?e.changes:$e.empty(this.state.doc.length))),r=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);Nc(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=r||_i)&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=r);let a=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let c=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(bm)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),o=this.heightOracle,s=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?Be.RTL:Be.LTR;let r=this.heightOracle.mustRefreshForWrapping(s),l=t.getBoundingClientRect(),a=r||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let c=0,h=0;if(l.width&&l.height){let{scaleX:E,scaleY:M}=Lu(t,l);(E>.005&&Math.abs(this.scaleX-E)>.005||M>.005&&Math.abs(this.scaleY-M)>.005)&&(this.scaleX=E,this.scaleY=M,c|=16,r=a=!0)}let u=(parseInt(i.paddingTop)||0)*this.scaleY,p=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=u||this.paddingBottom!=p)&&(this.paddingTop=u,this.paddingBottom=p,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(o.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let g=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=g&&(this.scrollAnchorHeight=-1,this.scrollTop=g),this.scrolledToBottom=$u(e.scrollDOM);let y=(this.printing?E0:C0)(t,this.paddingTop),m=y.top-this.pixelViewport.top,b=y.bottom-this.pixelViewport.bottom;this.pixelViewport=y;let x=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(x!=this.inView&&(this.inView=x,x&&(a=!0)),!this.inView&&!this.scrollTarget&&!T0(e.dom))return 0;let T=l.width;if((this.contentDOMWidth!=T||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),a){let E=e.docView.measureVisibleLineHeights(this.viewport);if(o.mustRefreshForHeights(E)&&(r=!0),r||o.lineWrapping&&Math.abs(T-this.contentDOMWidth)>o.charWidth){let{lineHeight:M,charWidth:_,textHeight:C}=e.docView.measureTextSize();r=M>0&&o.refresh(s,M,_,C,Math.max(5,T/_),E),r&&(e.docView.minWidth=0,c|=16)}m>0&&b>0?h=Math.max(m,b):m<0&&b<0&&(h=Math.min(m,b)),Nc();for(let M of this.viewports){let _=M.from==this.viewport.from?E:e.docView.measureVisibleLineHeights(M);this.heightMap=(r?Ze.empty().applyChanges(this.stateDeco,ke.empty,this.heightOracle,[new xt(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(o,0,r,new x0(M.from,_))}_i&&(c|=2)}let k=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return k&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(h,this.scrollTarget),c|=this.updateForViewport()),(c&2||k)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(r?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),o=this.heightMap,s=this.heightOracle,{visibleTop:r,visibleBottom:l}=this,a=new Lo(o.lineAt(r-i*1e3,_e.ByHeight,s,0,0).from,o.lineAt(l+(1-i)*1e3,_e.ByHeight,s,0,0).to);if(t){let{head:c}=t.range;if(c<a.from||c>a.to){let h=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=o.lineAt(c,_e.ByPos,s,0,0),p;t.y=="center"?p=(u.top+u.bottom)/2-h/2:t.y=="start"||t.y=="nearest"&&c<a.from?p=u.top:p=u.bottom-h,a=new Lo(o.lineAt(p-1e3/2,_e.ByHeight,s,0,0).from,o.lineAt(p+h+1e3/2,_e.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),o=t.mapPos(e.to,1);return new Lo(this.heightMap.lineAt(i,_e.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(o,_e.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:o}=this.heightMap.lineAt(e,_e.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,_e.ByPos,this.heightOracle,0,0),{visibleTop:r,visibleBottom:l}=this;return(e==0||o<=r-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&o>r-2*1e3&&s<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let o of e)t.touchesRange(o.from,o.to)||i.push(new Sr(t.mapPos(o.from),t.mapPos(o.to),o.size,o.displaySize));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,o=i?1e4:2e3,s=o>>1,r=o<<1;if(this.defaultTextDirection!=Be.LTR&&!i)return[];let l=[],a=(h,u,p,g)=>{if(u-h<s)return;let y=this.state.selection.main,m=[y.from];y.empty||m.push(y.to);for(let x of m)if(x>h&&x<u){a(h,x-10,p,g),a(x+10,u,p,g);return}let b=M0(e,x=>x.from>=p.from&&x.to<=p.to&&Math.abs(x.from-h)<s&&Math.abs(x.to-u)<s&&!m.some(T=>x.from<T&&x.to>T));if(!b){if(u<p.to&&t&&i&&t.visibleRanges.some(k=>k.from<=u&&k.to>=u)){let k=t.moveToLineBoundary(te.cursor(u),!1,!0).head;k>h&&(u=k)}let x=this.gapSize(p,h,u,g),T=i||x<2e6?x:2e6;b=new Sr(h,u,x,T)}l.push(b)},c=h=>{if(h.length<r||h.type!=ot.Text)return;let u=_0(h.from,h.to,this.stateDeco);if(u.total<r)return;let p=this.scrollTarget?this.scrollTarget.range.head:null,g,y;if(i){let m=o/this.heightOracle.lineLength*this.heightOracle.lineHeight,b,x;if(p!=null){let T=$o(u,p),k=((this.visibleBottom-this.visibleTop)/2+m)/h.height;b=T-k,x=T+k}else b=(this.visibleTop-h.top-m)/h.height,x=(this.visibleBottom-h.top+m)/h.height;g=Fo(u,b),y=Fo(u,x)}else{let m=u.total*this.heightOracle.charWidth,b=o*this.heightOracle.charWidth,x=0;if(m>2e6)for(let _ of e)_.from>=h.from&&_.from<h.to&&_.size!=_.displaySize&&_.from*this.heightOracle.charWidth+x<this.pixelViewport.left&&(x=_.size-_.displaySize);let T=this.pixelViewport.left+x,k=this.pixelViewport.right+x,E,M;if(p!=null){let _=$o(u,p),C=((k-T)/2+b)/m;E=_-C,M=_+C}else E=(T-b)/m,M=(k+b)/m;g=Fo(u,E),y=Fo(u,M)}g>h.from&&a(h.from,g,h,u),y<h.to&&a(y,h.to,h,u)};for(let h of this.viewportLines)Array.isArray(h.type)?h.type.forEach(c):c(h);return l}gapSize(e,t,i,o){let s=$o(o,i)-$o(o,t);return this.heightOracle.lineWrapping?e.height*s:o.total*this.heightOracle.charWidth*s}updateLineGaps(e){Sr.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=pe.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let i=[];ve.spans(t,this.viewport.from,this.viewport.to,{span(s,r){i.push({from:s,to:r})},point(){}},20);let o=0;if(i.length!=this.visibleRanges.length)o=12;else for(let s=0;s<i.length&&!(o&8);s++){let r=this.visibleRanges[s],l=i[s];(r.from!=l.from||r.to!=l.to)&&(o|=4,e&&e.mapPos(r.from,-1)==l.from&&e.mapPos(r.to,1)==l.to||(o|=8))}return this.visibleRanges=i,o}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Ki(this.heightMap.lineAt(e,_e.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||Ki(this.heightMap.lineAt(this.scaler.fromDOM(e),_e.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Ki(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}let Lo=class{constructor(e,t){this.from=e,this.to=t}};function _0(n,e,t){let i=[],o=n,s=0;return ve.spans(t,n,e,{span(){},point(r,l){r>o&&(i.push({from:o,to:r}),s+=r-o),o=l}},20),o<e&&(i.push({from:o,to:e}),s+=e-o),{total:s,ranges:i}}function Fo({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let o=0;;o++){let{from:s,to:r}=e[o],l=r-s;if(i<=l)return s+i;i-=l}}function $o(n,e){let t=0;for(let{from:i,to:o}of n.ranges){if(e<=o){t+=e-i;break}t+=o-i}return t/n.total}function M0(n,e){for(let t of n)if(e(t))return t}const Dc={toDOM(n){return n},fromDOM(n){return n},scale:1,eq(n){return n==this}};class va{constructor(e,t,i){let o=0,s=0,r=0;this.viewports=i.map(({from:l,to:a})=>{let c=t.lineAt(l,_e.ByPos,e,0,0).top,h=t.lineAt(a,_e.ByPos,e,0,0).bottom;return o+=h-c,{from:l,to:a,top:c,bottom:h,domTop:0,domBottom:0}}),this.scale=(7e6-o)/(t.height-o);for(let l of this.viewports)l.domTop=r+(l.top-s)*this.scale,r=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(e){for(let t=0,i=0,o=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return o+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,o=s.domBottom}}fromDOM(e){for(let t=0,i=0,o=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-o)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,o=s.domBottom}}eq(e){return e instanceof va?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,i)=>t.from==e.viewports[i].from&&t.to==e.viewports[i].to):!1}}function Ki(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new Mt(n.from,n.length,t,i-t,Array.isArray(n._content)?n._content.map(o=>Ki(o,e)):n._content)}const Wo=ne.define({combine:n=>n.join(" ")}),El=ne.define({combine:n=>n.indexOf(!0)>-1}),Al=On.newName(),Td=On.newName(),Ed=On.newName(),Ad={"&light":"."+Td,"&dark":"."+Ed};function _l(n,e,t){return new On(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,o=>{if(o=="&")return n;if(!t||!t[o])throw new RangeError(`Unsupported selector: ${o}`);return t[o]}):n+" "+i}})}const O0=_l("."+Al,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Ad),N0={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},kr=Z.ie&&Z.ie_version<=11;class R0{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new lm,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let i of t)this.queue.push(i);(Z.ie&&Z.ie_version<=11||Z.ios&&e.composing)&&t.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&Z.android&&e.constructor.EDIT_CONTEXT!==!1&&!(Z.chrome&&Z.chrome_version<126)&&(this.editContext=new D0(e),e.state.facet(rn)&&(e.contentDOM.editContext=this.editContext.editContext)),kr&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,o=this.selectionRange;if(i.state.facet(rn)?i.root.activeElement!=this.dom:!cs(this.dom,o))return;let s=o.anchorNode&&i.docView.tile.nearest(o.anchorNode);if(s&&s.isWidget()&&s.widget.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(Z.ie&&Z.ie_version<=11||Z.android&&Z.chrome)&&!i.state.selection.main.empty&&o.focusNode&&Zi(o.focusNode,o.focusOffset,o.anchorNode,o.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=lo(e.root);if(!t)return!1;let i=Z.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&j0(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let o=cs(this.dom,i);return o&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&cm(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),o&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,N0),kr&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),kr&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let o=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&mi(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(o)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,o=!1;for(let s of e){let r=this.readMutation(s);r&&(r.typeOver&&(o=!0),t==-1?{from:t,to:i}=r:(t=Math.min(r.from,t),i=Math.max(r.to,i)))}return{from:t,to:i,typeOver:o}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),o=this.selectionChanged&&cs(this.dom,this.selectionRange);if(e<0&&!o)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new Gm(this.view,e,t,i);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,o=pd(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),o}readMutation(e){let t=this.view.docView.tile.nearest(e.target);if(!t||t.isWidget())return null;if(t.markDirty(e.type=="attributes"),e.type=="childList"){let i=Bc(t,e.previousSibling||e.target.previousSibling,-1),o=Bc(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:o?t.posBefore(o):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(rn)!=e.state.facet(rn)&&(e.view.contentDOM.editContext=e.state.facet(rn)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let o of this.scrollTargets)o.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Bc(n,e,t){for(;e;){let i=Le.get(e);if(i&&i.parent==n)return i;let o=e.parentNode;e=o!=n.dom?o:t>0?e.nextSibling:e.previousSibling}return null}function Pc(n,e){let t=e.startContainer,i=e.startOffset,o=e.endContainer,s=e.endOffset,r=n.docView.domAtPos(n.state.selection.main.anchor,1);return Zi(r.node,r.offset,o,s)&&([t,i,o,s]=[o,s,t,i]),{anchorNode:t,anchorOffset:i,focusNode:o,focusOffset:s}}function j0(n,e){if(e.getComposedRanges){let o=e.getComposedRanges(n.root)[0];if(o)return Pc(n,o)}let t=null;function i(o){o.preventDefault(),o.stopImmediatePropagation(),t=o.getTargetRanges()[0]}return n.contentDOM.addEventListener("beforeinput",i,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",i,!0),t?Pc(n,t):null}class D0{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=i=>{let o=e.state.selection.main,{anchor:s,head:r}=o,l=this.toEditorPos(i.updateRangeStart),a=this.toEditorPos(i.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:i.updateRangeStart,editorBase:l,drifted:!1});let c=a-l>i.text.length;l==this.from&&s<this.from?l=s:a==this.to&&s>this.to&&(a=s);let h=gd(e.state.sliceDoc(l,a),i.text,(c?o.from:o.to)-l,c?"end":null);if(!h){let p=te.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd));p.main.eq(o)||e.dispatch({selection:p,userEvent:"select"});return}let u={from:h.from+l,to:h.toA+l,insert:ke.of(i.text.slice(h.from,h.toB).split(`
`))};if((Z.mac||Z.android)&&u.from==r-1&&/^\. ?$/.test(i.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(u={from:l,to:a,insert:ke.of([i.text.replace("."," ")])}),this.pendingContextChange=u,!e.state.readOnly){let p=this.to-this.from+(u.to-u.from+u.insert.length);xa(e,u,te.single(this.toEditorPos(i.selectionStart,p),this.toEditorPos(i.selectionEnd,p)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),u.from<u.to&&!u.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,i.updateRangeStart-1),Math.min(t.text.length,i.updateRangeStart+1)))&&this.handlers.compositionend(i)},this.handlers.characterboundsupdate=i=>{let o=[],s=null;for(let r=this.toEditorPos(i.rangeStart),l=this.toEditorPos(i.rangeEnd);r<l;r++){let a=e.coordsForChar(r);s=a&&new DOMRect(a.left,a.top,a.right-a.left,a.bottom-a.top)||s||new DOMRect,o.push(s)}t.updateCharacterBounds(i.rangeStart,o)},this.handlers.textformatupdate=i=>{let o=[];for(let s of i.getTextFormats()){let r=s.underlineStyle,l=s.underlineThickness;if(!/none/i.test(r)&&!/none/i.test(l)){let a=this.toEditorPos(s.rangeStart),c=this.toEditorPos(s.rangeEnd);if(a<c){let h=`text-decoration: underline ${/^[a-z]/.test(r)?r+" ":r=="Dashed"?"dashed ":r=="Squiggle"?"wavy ":""}${/thin/i.test(l)?1:2}px`;o.push(pe.mark({attributes:{style:h}}).range(a,c))}}}e.dispatch({effects:id.of(pe.set(o))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:i}=this.composing;this.composing=null,i&&this.reset(e.state)}};for(let i in this.handlers)t.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let o=lo(i.root);o&&o.rangeCount&&this.editContext.updateSelectionBounds(o.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,o=this.pendingContextChange;return e.changes.iterChanges((s,r,l,a,c)=>{if(i)return;let h=c.length-(r-s);if(o&&r>=o.to)if(o.from==s&&o.to==r&&o.insert.eq(c)){o=this.pendingContextChange=null,t+=h,this.to+=h;return}else o=null,this.revertPending(e.state);if(s+=t,r+=t,r<=this.from)this.from+=h,this.to+=h;else if(s<this.to){if(s<this.from||r>this.to||this.to-this.from+c.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(r),c.toString()),this.to+=h}t+=h}),o&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange,i=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(i.from,i.to)&&e.transactions.some(o=>!o.isUserEvent("input.type")&&o.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),o=this.toContextPos(t.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=o)&&this.editContext.updateSelection(i,o)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let i=this.composing;return i&&i.drifted?i.editorBase+(e-i.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class re{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(o=>o.forEach(s=>i(s,this)))||(o=>this.update(o)),this.dispatch=this.dispatch.bind(this),this._root=e.root||am(e.parent)||document,this.viewState=new jc(e.state||we.create(e)),e.scrollTo&&e.scrollTo.is(Po)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(ci).map(o=>new yr(o));for(let o of this.plugins)o.update(this);this.observer=new R0(this),this.inputState=new t0(this),this.inputState.ensureHandlers(this.plugins),this.docView=new bc(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=e.length==1&&e[0]instanceof We?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i=!1,o,s=this.state;for(let p of e){if(p.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=p.state}if(this.destroyed){this.viewState.state=s;return}let r=this.hasFocus,l=0,a=null;e.some(p=>p.annotation(wd))?(this.inputState.notifiedFocused=r,l=1):r!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=r,a=Sd(s,r),a||(l=1));let c=this.observer.delayedAndroidKey,h=null;if(c?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(h=null)):this.observer.clear(),s.facet(we.phrases)!=this.state.facet(we.phrases))return this.setState(s);o=ks.create(this,s,e),o.flags|=l;let u=this.viewState.scrollTarget;try{this.updateState=2;for(let p of e){if(u&&(u=u.map(p.changes)),p.scrollIntoView){let{main:g}=p.state.selection;u=new yi(g.empty?g:te.cursor(g.head,g.head>g.anchor?-1:1))}for(let g of p.effects)g.is(Po)&&(u=g.value.clip(this.state))}this.viewState.update(o,u),this.bidiCache=As.update(this.bidiCache,o.changes),o.empty||(this.updatePlugins(o),this.inputState.update(o)),t=this.docView.update(o),this.state.facet(Ui)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(p=>p.isUserEvent("select.pointer")))}finally{this.updateState=0}if(o.startState.facet(Wo)!=o.state.facet(Wo)&&(this.viewState.mustMeasureContent=!0),(t||i||u||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!o.empty)for(let p of this.state.facet(Sl))try{p(o)}catch(g){ut(this.state,g,"update listener")}(a||h)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),h&&!pd(this,h)&&c.force&&mi(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new jc(e),this.plugins=e.facet(ci).map(i=>new yr(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new bc(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(ci),i=e.state.facet(ci);if(t!=i){let o=[];for(let s of i){let r=t.indexOf(s);if(r<0)o.push(new yr(s));else{let l=this.plugins[r];l.mustUpdate=e,o.push(l)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=o,this.pluginMap.clear()}else for(let o of this.plugins)o.mustUpdate=e;for(let o=0;o<this.plugins.length;o++)this.plugins[o].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(i){ut(this.state,i,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,o=i.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:r}=this.viewState;Math.abs(o-this.viewState.scrollTop)>1&&(r=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(r<0)if($u(i))s=-1,r=this.viewState.heightMap.height;else{let g=this.viewState.scrollAnchorAt(o);s=g.from,r=g.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];a&4||([this.measureRequests,c]=[c,this.measureRequests]);let h=c.map(g=>{try{return g.read(this)}catch(y){return ut(this.state,y),Ic}}),u=ks.create(this,this.state,[]),p=!1;u.flags|=a,t?t.flags|=a:t=u,this.updateState=2,u.empty||(this.updatePlugins(u),this.inputState.update(u),this.updateAttrs(),p=this.docView.update(u),p&&this.docViewUpdate());for(let g=0;g<c.length;g++)if(h[g]!=Ic)try{let y=c[g];y.write&&y.write(h[g],this)}catch(y){ut(this.state,y)}if(p&&this.docView.updateSelection(!0),!u.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,r=-1;continue}else{let y=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-r;if(y>1||y<-1){o=o+y,i.scrollTop=o/this.scaleY,r=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let l of this.state.facet(Sl))l(t)}get themeClasses(){return Al+" "+(this.state.facet(El)?Ed:Td)+" "+this.state.facet(Wo)}updateAttrs(){let e=zc(this,od,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(rn)?"true":"false",class:"cm-content",style:`${Z.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),zc(this,ma,t);let i=this.observer.ignore(()=>{let o=fc(this.contentDOM,this.contentAttrs,t),s=fc(this.dom,this.editorAttrs,e);return o||s});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let o of i.effects)if(o.is(re.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=o.value}}mountStyles(){this.styleModules=this.state.facet(Ui);let e=this.state.facet(re.cspNonce);On.mount(this.root,this.styleModules.concat(O0).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return wr(this,e,vc(this,e,t,i))}moveByGroup(e,t){return wr(this,e,vc(this,e,t,i=>qm(this,e.head,i)))}visualLineSide(e,t){let i=this.bidiSpans(e),o=this.textDirectionAt(e.from),s=i[t?i.length-1:0];return te.cursor(s.side(t,o)+e.from,s.forward(!t,o)?1:-1)}moveToLineBoundary(e,t,i=!0){return Um(this,e,t,i)}moveVertically(e,t,i){return wr(this,e,Km(this,e,t,i))}domAtPos(e,t=1){return this.docView.domAtPos(e,t)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){this.readMeasured();let i=Cl(this,e,t);return i&&i.pos}posAndSideAtCoords(e,t=!0){return this.readMeasured(),Cl(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let o=this.state.doc.lineAt(e),s=this.bidiSpans(o),r=s[ln.find(s,e-o.from,-1,t)];return Ss(i,r.dir==Be.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(td)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>B0)return Ku(e.length);let t=this.textDirectionAt(e.from),i;for(let s of this.bidiCache)if(s.from==e.from&&s.dir==t&&(s.fresh||qu(s.isolates,i=mc(this,e))))return s.order;i||(i=mc(this,e));let o=mm(e.text,t,i);return this.bidiCache.push(new As(e.from,e.to,t,i,!0,o)),o}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Z.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Fu(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Po.of(new yi(typeof e=="number"?te.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return Po.of(new yi(te.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return Ct.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Ct.define(()=>({}),{eventObservers:e})}static theme(e,t){let i=On.newName(),o=[Wo.of(i),Ui.of(_l(`.${i}`,e))];return t&&t.dark&&o.push(El.of(!0)),o}static baseTheme(e){return ko.lowest(Ui.of(_l("."+Al,e,Ad)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),o=i&&Le.get(i)||Le.get(e);return((t=o==null?void 0:o.root)===null||t===void 0?void 0:t.view)||null}}re.styleModule=Ui;re.inputHandler=Zu;re.clipboardInputFilter=pa;re.clipboardOutputFilter=ga;re.scrollHandler=nd;re.focusChangeEffect=ed;re.perLineTextDirection=td;re.exceptionSink=Ju;re.updateListener=Sl;re.editable=rn;re.mouseSelectionStyle=Gu;re.dragMovesSelection=Xu;re.clickAddsSelectionRange=Yu;re.decorations=co;re.blockWrappers=sd;re.outerDecorations=rd;re.atomicRanges=Eo;re.bidiIsolatedRanges=ld;re.scrollMargins=ad;re.darkTheme=El;re.cspNonce=ne.define({combine:n=>n.length?n[0]:""});re.contentAttributes=ma;re.editorAttributes=od;re.lineWrapping=re.contentAttributes.of({class:"cm-lineWrapping"});re.announce=Te.define();const B0=4096,Ic={};class As{constructor(e,t,i,o,s,r){this.from=e,this.to=t,this.dir=i,this.isolates=o,this.fresh=s,this.order=r}static update(e,t){if(t.empty&&!e.some(s=>s.fresh))return e;let i=[],o=e.length?e[e.length-1].dir:Be.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let r=e[s];r.dir==o&&!t.touchesRange(r.from,r.to)&&i.push(new As(t.mapPos(r.from,1),t.mapPos(r.to,-1),r.dir,r.isolates,!1,r.order))}return i}}function zc(n,e,t){for(let i=n.state.facet(e),o=i.length-1;o>=0;o--){let s=i[o],r=typeof s=="function"?s(n):s;r&&ua(r,t)}return t}const P0=Z.mac?"mac":Z.windows?"win":Z.linux?"linux":"key";function I0(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let o,s,r,l;for(let a=0;a<t.length-1;++a){const c=t[a];if(/^(cmd|meta|m)$/i.test(c))l=!0;else if(/^a(lt)?$/i.test(c))o=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))r=!0;else if(/^mod$/i.test(c))e=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return o&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),r&&(i="Shift-"+i),i}function Ho(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const z0=ko.default(re.domEventHandlers({keydown(n,e){return W0(L0(e.state),n,e,"editor")}})),wa=ne.define({enables:z0}),Lc=new WeakMap;function L0(n){let e=n.facet(wa),t=Lc.get(e);return t||Lc.set(e,t=$0(e.reduce((i,o)=>i.concat(o),[]))),t}let kn=null;const F0=4e3;function $0(n,e=P0){let t=Object.create(null),i=Object.create(null),o=(r,l)=>{let a=i[r];if(a==null)i[r]=l;else if(a!=l)throw new Error("Key binding "+r+" is used both as a regular binding and as a multi-stroke prefix")},s=(r,l,a,c,h)=>{var u,p;let g=t[r]||(t[r]=Object.create(null)),y=l.split(/ (?!$)/).map(x=>I0(x,e));for(let x=1;x<y.length;x++){let T=y.slice(0,x).join(" ");o(T,!0),g[T]||(g[T]={preventDefault:!0,stopPropagation:!1,run:[k=>{let E=kn={view:k,prefix:T,scope:r};return setTimeout(()=>{kn==E&&(kn=null)},F0),!0}]})}let m=y.join(" ");o(m,!1);let b=g[m]||(g[m]={preventDefault:!1,stopPropagation:!1,run:((p=(u=g._any)===null||u===void 0?void 0:u.run)===null||p===void 0?void 0:p.slice())||[]});a&&b.run.push(a),c&&(b.preventDefault=!0),h&&(b.stopPropagation=!0)};for(let r of n){let l=r.scope?r.scope.split(" "):["editor"];if(r.any)for(let c of l){let h=t[c]||(t[c]=Object.create(null));h._any||(h._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:u}=r;for(let p in h)h[p].run.push(g=>u(g,Ml))}let a=r[e]||r.key;if(a)for(let c of l)s(c,a,r.run,r.preventDefault,r.stopPropagation),r.shift&&s(c,"Shift-"+a,r.shift,r.preventDefault,r.stopPropagation)}return t}let Ml=null;function W0(n,e,t,i){Ml=e;let o=em(e),s=xn(o,0),r=Vn(s)==o.length&&o!=" ",l="",a=!1,c=!1,h=!1;kn&&kn.view==t&&kn.scope==i&&(l=kn.prefix+" ",yd.indexOf(e.keyCode)<0&&(c=!0,kn=null));let u=new Set,p=b=>{if(b){for(let x of b.run)if(!u.has(x)&&(u.add(x),x(t)))return b.stopPropagation&&(h=!0),!0;b.preventDefault&&(b.stopPropagation&&(h=!0),c=!0)}return!1},g=n[i],y,m;return g&&(p(g[l+Ho(o,e,!r)])?a=!0:r&&(e.altKey||e.metaKey||e.ctrlKey)&&!(Z.windows&&e.ctrlKey&&e.altKey)&&!(Z.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(y=Nn[e.keyCode])&&y!=o?(p(g[l+Ho(y,e,!0)])||e.shiftKey&&(m=so[e.keyCode])!=o&&m!=y&&p(g[l+Ho(m,e,!1)]))&&(a=!0):r&&e.shiftKey&&p(g[l+Ho(o,e,!0)])&&(a=!0),!a&&p(g._any)&&(a=!0)),c&&(a=!0),a&&h&&e.stopPropagation(),Ml=null,a}const Vo="-10000px";class H0{constructor(e,t,i,o){this.facet=t,this.createTooltipView=i,this.removeTooltipView=o,this.input=e.state.facet(t),this.tooltips=this.input.filter(r=>r);let s=null;this.tooltipViews=this.tooltips.map(r=>s=i(r,s))}update(e,t){var i;let o=e.state.facet(this.facet),s=o.filter(a=>a);if(o===this.input){for(let a of this.tooltipViews)a.update&&a.update(e);return!1}let r=[],l=t?[]:null;for(let a=0;a<s.length;a++){let c=s[a],h=-1;if(c){for(let u=0;u<this.tooltips.length;u++){let p=this.tooltips[u];p&&p.create==c.create&&(h=u)}if(h<0)r[a]=this.createTooltipView(c,a?r[a-1]:null),l&&(l[a]=!!c.above);else{let u=r[a]=this.tooltipViews[h];l&&(l[a]=t[h]),u.update&&u.update(e)}}}for(let a of this.tooltipViews)r.indexOf(a)<0&&(this.removeTooltipView(a),(i=a.destroy)===null||i===void 0||i.call(a));return t&&(l.forEach((a,c)=>t[c]=a),t.length=l.length),this.input=o,this.tooltips=s,this.tooltipViews=r,!0}}function V0(n){let e=n.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:e.clientHeight,right:e.clientWidth}}const Cr=ne.define({combine:n=>{var e,t,i;return{position:Z.ios?"absolute":((e=n.find(o=>o.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=n.find(o=>o.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((i=n.find(o=>o.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||V0}}}),Fc=new WeakMap,_d=Ct.fromClass(class{constructor(n){this.view=n,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=n.state.facet(Cr);this.position=e.position,this.parent=e.parent,this.classes=n.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new H0(n,Md,(t,i)=>this.createTooltip(t,i),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),n.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let n of this.manager.tooltipViews)this.intersectionObserver.observe(n.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(n){n.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(n,this.above);e&&this.observeIntersection();let t=e||n.geometryChanged,i=n.state.facet(Cr);if(i.position!=this.position&&!this.madeAbsolute){this.position=i.position;for(let o of this.manager.tooltipViews)o.dom.style.position=this.position;t=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let o of this.manager.tooltipViews)this.container.appendChild(o.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(n,e){let t=n.create(this.view),i=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),n.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let o=document.createElement("div");o.className="cm-tooltip-arrow",t.dom.appendChild(o)}return t.dom.style.position=this.position,t.dom.style.top=Vo,t.dom.style.left="0px",this.container.insertBefore(t.dom,i),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var n,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let i of this.manager.tooltipViews)i.dom.remove(),(n=i.destroy)===null||n===void 0||n.call(i);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let n=1,e=1,t=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if(Z.safari){let r=s.getBoundingClientRect();t=Math.abs(r.top+1e4)>1||Math.abs(r.left)>1}else t=!!s.offsetParent&&s.offsetParent!=this.container.ownerDocument.body}if(t||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(n=s.width/this.parent.offsetWidth,e=s.height/this.parent.offsetHeight)}else({scaleX:n,scaleY:e}=this.view.viewState);let i=this.view.scrollDOM.getBoundingClientRect(),o=ya(this.view);return{visible:{left:i.left+o.left,top:i.top+o.top,right:i.right-o.right,bottom:i.bottom-o.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((s,r)=>{let l=this.manager.tooltipViews[r];return l.getCoords?l.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(Cr).tooltipSpace(this.view),scaleX:n,scaleY:e,makeAbsolute:t}}writeMeasure(n){var e;if(n.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{visible:t,space:i,scaleX:o,scaleY:s}=n,r=[];for(let l=0;l<this.manager.tooltips.length;l++){let a=this.manager.tooltips[l],c=this.manager.tooltipViews[l],{dom:h}=c,u=n.pos[l],p=n.size[l];if(!u||a.clip!==!1&&(u.bottom<=Math.max(t.top,i.top)||u.top>=Math.min(t.bottom,i.bottom)||u.right<Math.max(t.left,i.left)-.1||u.left>Math.min(t.right,i.right)+.1)){h.style.top=Vo;continue}let g=a.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,y=g?7:0,m=p.right-p.left,b=(e=Fc.get(c))!==null&&e!==void 0?e:p.bottom-p.top,x=c.offset||q0,T=this.view.textDirection==Be.LTR,k=p.width>i.right-i.left?T?i.left:i.right-p.width:T?Math.max(i.left,Math.min(u.left-(g?14:0)+x.x,i.right-m)):Math.min(Math.max(i.left,u.left-m+(g?14:0)-x.x),i.right-m),E=this.above[l];!a.strictSide&&(E?u.top-b-y-x.y<i.top:u.bottom+b+y+x.y>i.bottom)&&E==i.bottom-u.bottom>u.top-i.top&&(E=this.above[l]=!E);let M=(E?u.top-i.top:i.bottom-u.bottom)-y;if(M<b&&c.resize!==!1){if(M<this.view.defaultLineHeight){h.style.top=Vo;continue}Fc.set(c,b),h.style.height=(b=M)/s+"px"}else h.style.height&&(h.style.height="");let _=E?u.top-b-y-x.y:u.bottom+y+x.y,C=k+m;if(c.overlap!==!0)for(let P of r)P.left<C&&P.right>k&&P.top<_+b&&P.bottom>_&&(_=E?P.top-b-2-y:P.bottom+y+2);if(this.position=="absolute"?(h.style.top=(_-n.parent.top)/s+"px",$c(h,(k-n.parent.left)/o)):(h.style.top=_/s+"px",$c(h,k/o)),g){let P=u.left+(T?x.x:-x.x)-(k+14-7);g.style.left=P/o+"px"}c.overlap!==!0&&r.push({left:k,top:_,right:C,bottom:_+b}),h.classList.toggle("cm-tooltip-above",E),h.classList.toggle("cm-tooltip-below",!E),c.positioned&&c.positioned(n.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let n of this.manager.tooltipViews)n.dom.style.top=Vo}},{eventObservers:{scroll(){this.maybeMeasure()}}});function $c(n,e){let t=parseInt(n.style.left,10);(isNaN(t)||Math.abs(e-t)>1)&&(n.style.left=e+"px")}const U0=re.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),q0={x:0,y:0},Md=ne.define({enables:[_d,U0]});function Od(n,e){let t=n.plugin(_d);if(!t)return null;let i=t.manager.tooltips.indexOf(e);return i<0?null:t.manager.tooltipViews[i]}class jn extends Mn{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}jn.prototype.elementClass="";jn.prototype.toDOM=void 0;jn.prototype.mapMode=ct.TrackBefore;jn.prototype.startSide=jn.prototype.endSide=-1;jn.prototype.point=!0;const Tr=ne.define(),K0=ne.define(),Q0={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>ve.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},to=ne.define();function Y0(n){return[Nd(),to.of({...Q0,...n})]}const Ol=ne.define({combine:n=>n.some(e=>e)});function Nd(n){let e=[X0];return n&&n.fixed===!1&&e.push(Ol.of(!0)),e}const X0=Ct.fromClass(class{constructor(n){this.view=n,this.domAfter=null,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=n.state.facet(to).map(e=>new Hc(n,e)),this.fixed=!n.state.facet(Ol);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(n){if(this.updateGutters(n)){let e=this.prevViewport,t=n.view.viewport,i=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(i<(t.to-t.from)*.8)}if(n.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(Ol)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=n.view.viewport}syncGutters(n){let e=this.dom.nextSibling;n&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let t=ve.iter(this.view.state.facet(Tr),this.view.viewport.from),i=[],o=this.gutters.map(s=>new G0(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(s.type)){let r=!0;for(let l of s.type)if(l.type==ot.Text&&r){Nl(t,i,l.from);for(let a of o)a.line(this.view,l,i);r=!1}else if(l.widget)for(let a of o)a.widget(this.view,l)}else if(s.type==ot.Text){Nl(t,i,s.from);for(let r of o)r.line(this.view,s,i)}else if(s.widget)for(let r of o)r.widget(this.view,s);for(let s of o)s.finish();n&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(n){let e=n.startState.facet(to),t=n.state.facet(to),i=n.docChanged||n.heightChanged||n.viewportChanged||!ve.eq(n.startState.facet(Tr),n.state.facet(Tr),n.view.viewport.from,n.view.viewport.to);if(e==t)for(let o of this.gutters)o.update(n)&&(i=!0);else{i=!0;let o=[];for(let s of t){let r=e.indexOf(s);r<0?o.push(new Hc(this.view,s)):(this.gutters[r].update(n),o.push(this.gutters[r]))}for(let s of this.gutters)s.dom.remove(),o.indexOf(s)<0&&s.destroy();for(let s of o)s.config.side=="after"?this.getDOMAfter().appendChild(s.dom):this.dom.appendChild(s.dom);this.gutters=o}return i}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:n=>re.scrollMargins.of(e=>{let t=e.plugin(n);if(!t||t.gutters.length==0||!t.fixed)return null;let i=t.dom.offsetWidth*e.scaleX,o=t.domAfter?t.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==Be.LTR?{left:i,right:o}:{right:i,left:o}})});function Wc(n){return Array.isArray(n)?n:[n]}function Nl(n,e,t){for(;n.value&&n.from<=t;)n.from==t&&e.push(n.value),n.next()}class G0{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=ve.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:o}=this,s=(t.top-this.height)/e.scaleY,r=t.height/e.scaleY;if(this.i==o.elements.length){let l=new Rd(e,r,s,i);o.elements.push(l),o.dom.appendChild(l.dom)}else o.elements[this.i].update(e,r,s,i);this.height=t.bottom,this.i++}line(e,t,i){let o=[];Nl(this.cursor,o,t.from),i.length&&(o=o.concat(i));let s=this.gutter.config.lineMarker(e,t,o);s&&o.unshift(s);let r=this.gutter;o.length==0&&!r.config.renderEmptyElements||this.addElement(e,t,o)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t),o=i?[i]:null;for(let s of e.state.facet(K0)){let r=s(e,t.widget,t);r&&(o||(o=[])).push(r)}o&&this.addElement(e,t,o)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Hc{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,o=>{let s=o.target,r;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let a=s.getBoundingClientRect();r=(a.top+a.bottom)/2}else r=o.clientY;let l=e.lineBlockAtHeight(r-e.documentTop);t.domEventHandlers[i](e,l,o)&&o.preventDefault()});this.markers=Wc(t.markers(e)),t.initialSpacer&&(this.spacer=new Rd(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Wc(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let o=this.config.updateSpacer(this.spacer.markers[0],e);o!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[o])}let i=e.view.viewport;return!ve.eq(this.markers,t,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Rd{constructor(e,t,i,o){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,o)}update(e,t,i,o){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),J0(this.markers,o)||this.setMarkers(e,o)}setMarkers(e,t){let i="cm-gutterElement",o=this.dom.firstChild;for(let s=0,r=0;;){let l=r,a=s<t.length?t[s++]:null,c=!1;if(a){let h=a.elementClass;h&&(i+=" "+h);for(let u=r;u<this.markers.length;u++)if(this.markers[u].compare(a)){l=u,c=!0;break}}else l=this.markers.length;for(;r<l;){let h=this.markers[r++];if(h.toDOM){h.destroy(o);let u=o.nextSibling;o.remove(),o=u}}if(!a)break;a.toDOM&&(c?o=o.nextSibling:this.dom.insertBefore(a.toDOM(e),o)),c&&r++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function J0(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].compare(e[t]))return!1;return!0}const Z0=ne.define(),ey=ne.define(),hi=ne.define({combine(n){return Di(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let o in t){let s=i[o],r=t[o];i[o]=s?(l,a,c)=>s(l,a,c)||r(l,a,c):r}return i}})}});class Er extends jn{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Ar(n,e){return n.state.facet(hi).formatNumber(e,n.state)}const ty=to.compute([hi],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(Z0)},lineMarker(e,t,i){return i.some(o=>o.toDOM)?null:new Er(Ar(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,i)=>{for(let o of e.state.facet(ey)){let s=o(e,t,i);if(s)return s}return null},lineMarkerChange:e=>e.startState.facet(hi)!=e.state.facet(hi),initialSpacer(e){return new Er(Ar(e,Vc(e.state.doc.lines)))},updateSpacer(e,t){let i=Ar(t.view,Vc(t.view.state.doc.lines));return i==e.number?e:new Er(i)},domEventHandlers:n.facet(hi).domEventHandlers,side:"before"}));function ny(n={}){return[hi.of(n),Nd(),ty]}function Vc(n){let e=9;for(;e<n;)e=e*10+9;return e}const jd=1024;let iy=0;class _r{constructor(e,t){this.from=e,this.to=t}}class ye{constructor(e={}){this.id=iy++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=st.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}ye.closedBy=new ye({deserialize:n=>n.split(" ")});ye.openedBy=new ye({deserialize:n=>n.split(" ")});ye.group=new ye({deserialize:n=>n.split(" ")});ye.isolate=new ye({deserialize:n=>{if(n&&n!="rtl"&&n!="ltr"&&n!="auto")throw new RangeError("Invalid value for isolate: "+n);return n||"auto"}});ye.contextHash=new ye({perNode:!0});ye.lookAhead=new ye({perNode:!0});ye.mounted=new ye({perNode:!0});class no{constructor(e,t,i,o=!1){this.tree=e,this.overlay=t,this.parser=i,this.bracketed=o}static get(e){return e&&e.props&&e.props[ye.mounted.id]}}const oy=Object.create(null);class st{constructor(e,t,i,o=0){this.name=e,this.props=t,this.id=i,this.flags=o}static define(e){let t=e.props&&e.props.length?Object.create(null):oy,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),o=new st(e.name||"",t,e.id,i);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(o)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return o}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(ye.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let o of i.split(" "))t[o]=e[i];return i=>{for(let o=i.prop(ye.group),s=-1;s<(o?o.length:0);s++){let r=t[s<0?i.name:o[s]];if(r)return r}}}}st.none=new st("",Object.create(null),0,8);class Sa{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let o=null;for(let s of e){let r=s(i);if(r){o||(o=Object.assign({},i.props));let l=r[1],a=r[0];a.combine&&a.id in o&&(l=a.combine(o[a.id],l)),o[a.id]=l}}t.push(o?new st(i.name,o,i.id,i.flags):i)}return new Sa(t)}}const Uo=new WeakMap,Uc=new WeakMap;var De;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays",n[n.EnterBracketed=16]="EnterBracketed"})(De||(De={}));class ze{constructor(e,t,i,o,s){if(this.type=e,this.children=t,this.positions=i,this.length=o,this.props=null,s&&s.length){this.props=Object.create(null);for(let[r,l]of s)this.props[typeof r=="number"?r:r.id]=l}}toString(){let e=no.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let o=i.toString();o&&(t&&(t+=","),t+=o)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new jl(this.topNode,e)}cursorAt(e,t=0,i=0){let o=Uo.get(this)||this.topNode,s=new jl(o);return s.moveTo(e,t),Uo.set(this,s._tree),s}get topNode(){return new St(this,0,0,null)}resolve(e,t=0){let i=ho(Uo.get(this)||this.topNode,e,t,!1);return Uo.set(this,i),i}resolveInner(e,t=0){let i=ho(Uc.get(this)||this.topNode,e,t,!0);return Uc.set(this,i),i}resolveStack(e,t=0){return ly(this,e,t)}iterate(e){let{enter:t,leave:i,from:o=0,to:s=this.length}=e,r=e.mode||0,l=(r&De.IncludeAnonymous)>0;for(let a=this.cursor(r|De.IncludeAnonymous);;){let c=!1;if(a.from<=s&&a.to>=o&&(!l&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;c=!0}for(;c&&i&&(l||!a.type.isAnonymous)&&i(a),!a.nextSibling();){if(!a.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Ta(st.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,o)=>new ze(this.type,t,i,o,this.propValues),e.makeTree||((t,i,o)=>new ze(st.none,t,i,o)))}static build(e){return ay(e)}}ze.empty=new ze(st.none,[],[],0);class ka{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ka(this.buffer,this.index)}}class Dn{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return st.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],o=this.set.types[t],s=o.name;if(/\W/.test(s)&&!o.isError&&(s=JSON.stringify(s)),e+=4,i==e)return s;let r=[];for(;e<i;)r.push(this.childString(e)),e=this.buffer[e+3];return s+"("+r.join(",")+")"}findChild(e,t,i,o,s){let{buffer:r}=this,l=-1;for(let a=e;a!=t&&!(Dd(s,o,r[a+1],r[a+2])&&(l=a,i>0));a=r[a+3]);return l}slice(e,t,i){let o=this.buffer,s=new Uint16Array(t-e),r=0;for(let l=e,a=0;l<t;){s[a++]=o[l++],s[a++]=o[l++]-i;let c=s[a++]=o[l++]-i;s[a++]=o[l++]-e,r=Math.max(r,c)}return new Dn(s,r,this.set)}}function Dd(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function ho(n,e,t,i){for(var o;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let r=!i&&n instanceof St&&n.index<0?null:n.parent;if(!r)return n;n=r}let s=i?0:De.IgnoreOverlays;if(i)for(let r=n,l=r.parent;l;r=l,l=r.parent)r instanceof St&&r.index<0&&((o=l.enter(e,t,s))===null||o===void 0?void 0:o.from)!=r.from&&(n=l);for(;;){let r=n.enter(e,t,s);if(!r)return n;n=r}}class Bd{cursor(e=0){return new jl(this,e)}getChild(e,t=null,i=null){let o=qc(this,e,t,i);return o.length?o[0]:null}getChildren(e,t=null,i=null){return qc(this,e,t,i)}resolve(e,t=0){return ho(this,e,t,!1)}resolveInner(e,t=0){return ho(this,e,t,!0)}matchContext(e){return Rl(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let o=t.lastChild;if(!o||o.to!=t.to)break;o.type.isError&&o.from==o.to?(i=t,t=o.prevSibling):t=o}return i}get node(){return this}get next(){return this.parent}}class St extends Bd{constructor(e,t,i,o){super(),this._tree=e,this.from=t,this.index=i,this._parent=o}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,o,s=0){var r;for(let l=this;;){for(let{children:a,positions:c}=l._tree,h=t>0?a.length:-1;e!=h;e+=t){let u=a[e],p=c[e]+l.from;if(!(!(s&De.EnterBracketed&&u instanceof ze&&((r=no.get(u))===null||r===void 0?void 0:r.overlay)===null&&(p>=i||p+u.length<=i))&&!Dd(o,i,p,p+u.length))){if(u instanceof Dn){if(s&De.ExcludeBuffers)continue;let g=u.findChild(0,u.buffer.length,t,i-p,o);if(g>-1)return new En(new sy(l,u,e,p),null,g)}else if(s&De.IncludeAnonymous||!u.type.isAnonymous||Ca(u)){let g;if(!(s&De.IgnoreMounts)&&(g=no.get(u))&&!g.overlay)return new St(g.tree,p,e,l);let y=new St(u,p,e,l);return s&De.IncludeAnonymous||!y.type.isAnonymous?y:y.nextChild(t<0?u.children.length-1:0,t,i,o,s)}}}if(s&De.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+t:e=t<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,i=0){let o;if(!(i&De.IgnoreOverlays)&&(o=no.get(this._tree))&&o.overlay){let s=e-this.from,r=i&De.EnterBracketed&&o.bracketed;for(let{from:l,to:a}of o.overlay)if((t>0||r?l<=s:l<s)&&(t<0||r?a>=s:a>s))return new St(o.tree,o.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function qc(n,e,t,i){let o=n.cursor(),s=[];if(!o.firstChild())return s;if(t!=null){for(let r=!1;!r;)if(r=o.type.is(t),!o.nextSibling())return s}for(;;){if(i!=null&&o.type.is(i))return s;if(o.type.is(e)&&s.push(o.node),!o.nextSibling())return i==null?s:[]}}function Rl(n,e,t=e.length-1){for(let i=n;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class sy{constructor(e,t,i,o){this.parent=e,this.buffer=t,this.index=i,this.start=o}}class En extends Bd{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:o}=this.context,s=o.findChild(this.index+4,o.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new En(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,i=0){if(i&De.ExcludeBuffers)return null;let{buffer:o}=this.context,s=o.findChild(this.index+4,o.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new En(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new En(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new En(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,o=this.index+4,s=i.buffer[this.index+3];if(s>o){let r=i.buffer[this.index+1];e.push(i.slice(o,s,r)),t.push(0)}return new ze(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function Pd(n){if(!n.length)return null;let e=0,t=n[0];for(let s=1;s<n.length;s++){let r=n[s];(r.from>t.from||r.to<t.to)&&(t=r,e=s)}let i=t instanceof St&&t.index<0?null:t.parent,o=n.slice();return i?o[e]=i:o.splice(e,1),new ry(o,t)}class ry{constructor(e,t){this.heads=e,this.node=t}get next(){return Pd(this.heads)}}function ly(n,e,t){let i=n.resolveInner(e,t),o=null;for(let s=i instanceof St?i:i.context.parent;s;s=s.parent)if(s.index<0){let r=s.parent;(o||(o=[i])).push(r.resolve(e,t)),s=r}else{let r=no.get(s.tree);if(r&&r.overlay&&r.overlay[0].from<=e&&r.overlay[r.overlay.length-1].to>=e){let l=new St(r.tree,r.overlay[0].from+s.from,-1,s);(o||(o=[i])).push(ho(l,e,t,!1))}}return o?Pd(o):i}class jl{get name(){return this.type.name}constructor(e,t=0){if(this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,this.mode=t&~De.EnterBracketed,e instanceof St)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:o}=this.buffer;return this.type=t||o.set.types[o.buffer[e]],this.from=i+o.buffer[e+1],this.to=i+o.buffer[e+2],!0}yield(e){return e?e instanceof St?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:o}=this.buffer,s=o.findChild(this.index+4,o.buffer[this.index+3],e,t-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&De.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&De.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&De.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let o=i<0?0:this.stack[i]+4;if(this.index!=o)return this.yieldBuf(t.findChild(o,this.index,-1,0,4))}else{let o=t.buffer[this.index+3];if(o<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(o)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:o}=this;if(o){if(e>0){if(this.index<o.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(o.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:i}=o)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let s=t+e,r=e<0?-1:i._tree.children.length;s!=r;s+=e){let l=i._tree.children[s];if(this.mode&De.IncludeAnonymous||l instanceof Dn||!l.type.isAnonymous||Ca(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let o=this.index,s=this.stack.length;s>=0;){for(let r=e;r;r=r._parent)if(r.index==o){if(o==this.index)return r;t=r,i=s+1;break e}o=this.stack[--s]}for(let o=i;o<this.stack.length;o++)t=new En(this.buffer,t,this.stack[o]);return this.bufferNode=new En(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let o=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(o=!0)}for(;;){if(o&&t&&t(this),o=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,o=!0}}}matchContext(e){if(!this.buffer)return Rl(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let o=e.length-1,s=this.stack.length-1;o>=0;s--){if(s<0)return Rl(this._tree,e,o);let r=i[t.buffer[this.stack[s]]];if(!r.isAnonymous){if(e[o]&&e[o]!=r.name)return!1;o--}}return!0}}function Ca(n){return n.children.some(e=>e instanceof Dn||!e.type.isAnonymous||Ca(e))}function ay(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:o=jd,reused:s=[],minRepeatType:r=i.types.length}=n,l=Array.isArray(t)?new ka(t,t.length):t,a=i.types,c=0,h=0;function u(M,_,C,P,R,$){let{id:F,start:L,end:W,size:w}=l,O=h,S=c;if(w<0)if(l.next(),w==-1){let B=s[F];C.push(B),P.push(L-M);return}else if(w==-3){c=F;return}else if(w==-4){h=F;return}else throw new RangeError(`Unrecognized record size: ${w}`);let z=a[F],j,v,D=L-M;if(W-L<=o&&(v=b(l.pos-_,R))){let B=new Uint16Array(v.size-v.skip),I=l.pos-v.size,V=B.length;for(;l.pos>I;)V=x(v.start,B,V);j=new Dn(B,W-v.start,i),D=v.start-M}else{let B=l.pos-w;l.next();let I=[],V=[],Q=F>=r?F:-1,J=0,se=W;for(;l.pos>B;)Q>=0&&l.id==Q&&l.size>=0?(l.end<=se-o&&(y(I,V,L,J,l.end,se,Q,O,S),J=I.length,se=l.end),l.next()):$>2500?p(L,B,I,V):u(L,B,I,V,Q,$+1);if(Q>=0&&J>0&&J<I.length&&y(I,V,L,J,L,se,Q,O,S),I.reverse(),V.reverse(),Q>-1&&J>0){let le=g(z,S);j=Ta(z,I,V,0,I.length,0,W-L,le,le)}else j=m(z,I,V,W-L,O-W,S)}C.push(j),P.push(D)}function p(M,_,C,P){let R=[],$=0,F=-1;for(;l.pos>_;){let{id:L,start:W,end:w,size:O}=l;if(O>4)l.next();else{if(F>-1&&W<F)break;F<0&&(F=w-o),R.push(L,W,w),$++,l.next()}}if($){let L=new Uint16Array($*4),W=R[R.length-2];for(let w=R.length-3,O=0;w>=0;w-=3)L[O++]=R[w],L[O++]=R[w+1]-W,L[O++]=R[w+2]-W,L[O++]=O;C.push(new Dn(L,R[2]-W,i)),P.push(W-M)}}function g(M,_){return(C,P,R)=>{let $=0,F=C.length-1,L,W;if(F>=0&&(L=C[F])instanceof ze){if(!F&&L.type==M&&L.length==R)return L;(W=L.prop(ye.lookAhead))&&($=P[F]+L.length+W)}return m(M,C,P,R,$,_)}}function y(M,_,C,P,R,$,F,L,W){let w=[],O=[];for(;M.length>P;)w.push(M.pop()),O.push(_.pop()+C-R);M.push(m(i.types[F],w,O,$-R,L-$,W)),_.push(R-C)}function m(M,_,C,P,R,$,F){if($){let L=[ye.contextHash,$];F=F?[L].concat(F):[L]}if(R>25){let L=[ye.lookAhead,R];F=F?[L].concat(F):[L]}return new ze(M,_,C,P,F)}function b(M,_){let C=l.fork(),P=0,R=0,$=0,F=C.end-o,L={size:0,start:0,skip:0};e:for(let W=C.pos-M;C.pos>W;){let w=C.size;if(C.id==_&&w>=0){L.size=P,L.start=R,L.skip=$,$+=4,P+=4,C.next();continue}let O=C.pos-w;if(w<0||O<W||C.start<F)break;let S=C.id>=r?4:0,z=C.start;for(C.next();C.pos>O;){if(C.size<0)if(C.size==-3||C.size==-4)S+=4;else break e;else C.id>=r&&(S+=4);C.next()}R=z,P+=w,$+=S}return(_<0||P==M)&&(L.size=P,L.start=R,L.skip=$),L.size>4?L:void 0}function x(M,_,C){let{id:P,start:R,end:$,size:F}=l;if(l.next(),F>=0&&P<r){let L=C;if(F>4){let W=l.pos-(F-4);for(;l.pos>W;)C=x(M,_,C)}_[--C]=L,_[--C]=$-M,_[--C]=R-M,_[--C]=P}else F==-3?c=P:F==-4&&(h=P);return C}let T=[],k=[];for(;l.pos>0;)u(n.start||0,n.bufferStart||0,T,k,-1,0);let E=(e=n.length)!==null&&e!==void 0?e:T.length?k[0]+T[0].length:0;return new ze(a[n.topID],T.reverse(),k.reverse(),E)}const Kc=new WeakMap;function ds(n,e){if(!n.isAnonymous||e instanceof Dn||e.type!=n)return 1;let t=Kc.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof ze)){t=1;break}t+=ds(n,i)}Kc.set(e,t)}return t}function Ta(n,e,t,i,o,s,r,l,a){let c=0;for(let y=i;y<o;y++)c+=ds(n,e[y]);let h=Math.ceil(c*1.5/8),u=[],p=[];function g(y,m,b,x,T){for(let k=b;k<x;){let E=k,M=m[k],_=ds(n,y[k]);for(k++;k<x;k++){let C=ds(n,y[k]);if(_+C>=h)break;_+=C}if(k==E+1){if(_>h){let C=y[E];g(C.children,C.positions,0,C.children.length,m[E]+T);continue}u.push(y[E])}else{let C=m[k-1]+y[k-1].length-M;u.push(Ta(n,y,m,E,k,M,C,null,a))}p.push(M+T-s)}}return g(e,t,i,o,0),(l||a)(u,p,r)}class Xn{constructor(e,t,i,o,s=!1,r=!1){this.from=e,this.to=t,this.tree=i,this.offset=o,this.open=(s?1:0)|(r?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let o=[new Xn(0,e.length,e,0,!1,i)];for(let s of t)s.to>e.length&&o.push(s);return o}static applyChanges(e,t,i=128){if(!t.length)return e;let o=[],s=1,r=e.length?e[0]:null;for(let l=0,a=0,c=0;;l++){let h=l<t.length?t[l]:null,u=h?h.fromA:1e9;if(u-a>=i)for(;r&&r.from<u;){let p=r;if(a>=p.from||u<=p.to||c){let g=Math.max(p.from,a)-c,y=Math.min(p.to,u)-c;p=g>=y?null:new Xn(g,y,p.tree,p.offset+c,l>0,!!h)}if(p&&o.push(p),r.to>u)break;r=s<e.length?e[s++]:null}if(!h)break;a=h.toA,c=h.toA-h.toB}return o}}class Id{startParse(e,t,i){return typeof e=="string"&&(e=new cy(e)),i=i?i.length?i.map(o=>new _r(o.from,o.to)):[new _r(0,0)]:[new _r(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let o=this.startParse(e,t,i);for(;;){let s=o.advance();if(s)return s}}}class cy{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new ye({perNode:!0});let hy=0;class gt{constructor(e,t,i,o){this.name=e,this.set=t,this.base=i,this.modified=o,this.id=hy++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i=typeof e=="string"?e:"?";if(e instanceof gt&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let o=new gt(i,[],null,[]);if(o.set.push(o),t)for(let s of t.set)o.set.push(s);return o}static defineModifier(e){let t=new _s(e);return i=>i.modified.indexOf(t)>-1?i:_s.get(i.base||i,i.modified.concat(t).sort((o,s)=>o.id-s.id))}}let uy=0;class _s{constructor(e){this.name=e,this.instances=[],this.id=uy++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(l=>l.base==e&&dy(t,l.modified));if(i)return i;let o=[],s=new gt(e.name,o,e,t);for(let l of t)l.instances.push(s);let r=fy(t);for(let l of e.set)if(!l.modified.length)for(let a of r)o.push(_s.get(l,a));return s}}function dy(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function fy(n){let e=[[]];for(let t=0;t<n.length;t++)for(let i=0,o=e.length;i<o;i++)e.push(e[i].concat(n[t]));return e.sort((t,i)=>i.length-t.length)}function zd(n){let e=Object.create(null);for(let t in n){let i=n[t];Array.isArray(i)||(i=[i]);for(let o of t.split(" "))if(o){let s=[],r=2,l=o;for(let u=0;;){if(l=="..."&&u>0&&u+3==o.length){r=1;break}let p=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!p)throw new RangeError("Invalid path: "+o);if(s.push(p[0]=="*"?"":p[0][0]=='"'?JSON.parse(p[0]):p[0]),u+=p[0].length,u==o.length)break;let g=o[u++];if(u==o.length&&g=="!"){r=0;break}if(g!="/")throw new RangeError("Invalid path: "+o);l=o.slice(u)}let a=s.length-1,c=s[a];if(!c)throw new RangeError("Invalid path: "+o);let h=new uo(i,r,a>0?s.slice(0,a):null);e[c]=h.sort(e[c])}}return Ld.add(e)}const Ld=new ye({combine(n,e){let t,i,o;for(;n||e;){if(!n||e&&n.depth>=e.depth?(o=e,e=e.next):(o=n,n=n.next),t&&t.mode==o.mode&&!o.context&&!t.context)continue;let s=new uo(o.tags,o.mode,o.context);t?t.next=s:i=s,t=s}return i}});class uo{constructor(e,t,i,o){this.tags=e,this.mode=t,this.context=i,this.next=o}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}uo.empty=new uo([],2,null);function Fd(n,e){let t=Object.create(null);for(let s of n)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let r of s.tag)t[r.id]=s.class;let{scope:i,all:o=null}=e||{};return{style:s=>{let r=o;for(let l of s)for(let a of l.set){let c=t[a.id];if(c){r=r?r+" "+c:c;break}}return r},scope:i}}function py(n,e){let t=null;for(let i of n){let o=i.style(e);o&&(t=t?t+" "+o:o)}return t}function gy(n,e,t,i=0,o=n.length){let s=new my(i,Array.isArray(e)?e:[e],t);s.highlightRange(n.cursor(),i,o,"",s.highlighters),s.flush(o)}class my{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,o,s){let{type:r,from:l,to:a}=e;if(l>=i||a<=t)return;r.isTop&&(s=this.highlighters.filter(g=>!g.scope||g.scope(r)));let c=o,h=yy(e)||uo.empty,u=py(s,h.tags);if(u&&(c&&(c+=" "),c+=u,h.mode==1&&(o+=(o?" ":"")+u)),this.startSpan(Math.max(t,l),c),h.opaque)return;let p=e.tree&&e.tree.prop(ye.mounted);if(p&&p.overlay){let g=e.node.enter(p.overlay[0].from+l,1),y=this.highlighters.filter(b=>!b.scope||b.scope(p.tree.type)),m=e.firstChild();for(let b=0,x=l;;b++){let T=b<p.overlay.length?p.overlay[b]:null,k=T?T.from+l:a,E=Math.max(t,x),M=Math.min(i,k);if(E<M&&m)for(;e.from<M&&(this.highlightRange(e,E,M,o,s),this.startSpan(Math.min(M,e.to),c),!(e.to>=k||!e.nextSibling())););if(!T||k>i)break;x=T.to+l,x>t&&(this.highlightRange(g.cursor(),Math.max(t,T.from+l),Math.min(i,x),"",y),this.startSpan(Math.min(i,x),c))}m&&e.parent()}else if(e.firstChild()){p&&(o="");do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,o,s),this.startSpan(Math.min(i,e.to),c)}while(e.nextSibling());e.parent()}}}function yy(n){let e=n.type.prop(Ld);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const X=gt.define,qo=X(),bn=X(),Qc=X(bn),Yc=X(bn),vn=X(),Ko=X(vn),Mr=X(vn),Ut=X(),Ln=X(Ut),Ht=X(),Vt=X(),Dl=X(),zi=X(Dl),Qo=X(),K={comment:qo,lineComment:X(qo),blockComment:X(qo),docComment:X(qo),name:bn,variableName:X(bn),typeName:Qc,tagName:X(Qc),propertyName:Yc,attributeName:X(Yc),className:X(bn),labelName:X(bn),namespace:X(bn),macroName:X(bn),literal:vn,string:Ko,docString:X(Ko),character:X(Ko),attributeValue:X(Ko),number:Mr,integer:X(Mr),float:X(Mr),bool:X(vn),regexp:X(vn),escape:X(vn),color:X(vn),url:X(vn),keyword:Ht,self:X(Ht),null:X(Ht),atom:X(Ht),unit:X(Ht),modifier:X(Ht),operatorKeyword:X(Ht),controlKeyword:X(Ht),definitionKeyword:X(Ht),moduleKeyword:X(Ht),operator:Vt,derefOperator:X(Vt),arithmeticOperator:X(Vt),logicOperator:X(Vt),bitwiseOperator:X(Vt),compareOperator:X(Vt),updateOperator:X(Vt),definitionOperator:X(Vt),typeOperator:X(Vt),controlOperator:X(Vt),punctuation:Dl,separator:X(Dl),bracket:zi,angleBracket:X(zi),squareBracket:X(zi),paren:X(zi),brace:X(zi),content:Ut,heading:Ln,heading1:X(Ln),heading2:X(Ln),heading3:X(Ln),heading4:X(Ln),heading5:X(Ln),heading6:X(Ln),contentSeparator:X(Ut),list:X(Ut),quote:X(Ut),emphasis:X(Ut),strong:X(Ut),link:X(Ut),monospace:X(Ut),strikethrough:X(Ut),inserted:X(),deleted:X(),changed:X(),invalid:X(),meta:Qo,documentMeta:X(Qo),annotation:X(Qo),processingInstruction:X(Qo),definition:gt.defineModifier("definition"),constant:gt.defineModifier("constant"),function:gt.defineModifier("function"),standard:gt.defineModifier("standard"),local:gt.defineModifier("local"),special:gt.defineModifier("special")};for(let n in K){let e=K[n];e instanceof gt&&(e.name=n)}Fd([{tag:K.link,class:"tok-link"},{tag:K.heading,class:"tok-heading"},{tag:K.emphasis,class:"tok-emphasis"},{tag:K.strong,class:"tok-strong"},{tag:K.keyword,class:"tok-keyword"},{tag:K.atom,class:"tok-atom"},{tag:K.bool,class:"tok-bool"},{tag:K.url,class:"tok-url"},{tag:K.labelName,class:"tok-labelName"},{tag:K.inserted,class:"tok-inserted"},{tag:K.deleted,class:"tok-deleted"},{tag:K.literal,class:"tok-literal"},{tag:K.string,class:"tok-string"},{tag:K.number,class:"tok-number"},{tag:[K.regexp,K.escape,K.special(K.string)],class:"tok-string2"},{tag:K.variableName,class:"tok-variableName"},{tag:K.local(K.variableName),class:"tok-variableName tok-local"},{tag:K.definition(K.variableName),class:"tok-variableName tok-definition"},{tag:K.special(K.variableName),class:"tok-variableName2"},{tag:K.definition(K.propertyName),class:"tok-propertyName tok-definition"},{tag:K.typeName,class:"tok-typeName"},{tag:K.namespace,class:"tok-namespace"},{tag:K.className,class:"tok-className"},{tag:K.macroName,class:"tok-macroName"},{tag:K.propertyName,class:"tok-propertyName"},{tag:K.operator,class:"tok-operator"},{tag:K.comment,class:"tok-comment"},{tag:K.meta,class:"tok-meta"},{tag:K.invalid,class:"tok-invalid"},{tag:K.punctuation,class:"tok-punctuation"}]);var Or;const ui=new ye;function xy(n){return ne.define({combine:n?e=>e.concat(n):void 0})}const by=new ye;class Rt{constructor(e,t,i=[],o=""){this.data=e,this.name=o,we.prototype.hasOwnProperty("tree")||Object.defineProperty(we.prototype,"tree",{get(){return dt(this)}}),this.parser=t,this.extension=[Bn.of(this),we.languageData.of((s,r,l)=>{let a=Xc(s,r,l),c=a.type.prop(ui);if(!c)return[];let h=s.facet(c),u=a.type.prop(by);if(u){let p=a.resolve(r-a.from,l);for(let g of u)if(g.test(p,s)){let y=s.facet(g.facet);return g.type=="replace"?y:y.concat(h)}}return h})].concat(i)}isActiveAt(e,t,i=-1){return Xc(e,t,i).type.prop(ui)==this.data}findRegions(e){let t=e.facet(Bn);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],o=(s,r)=>{if(s.prop(ui)==this.data){i.push({from:r,to:r+s.length});return}let l=s.prop(ye.mounted);if(l){if(l.tree.prop(ui)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+r,to:a.to+r});else i.push({from:r,to:r+s.length});return}else if(l.overlay){let a=i.length;if(o(l.tree,l.overlay[0].from+r),i.length>a)return}}for(let a=0;a<s.children.length;a++){let c=s.children[a];c instanceof ze&&o(c,s.positions[a]+r)}};return o(dt(e),0),i}get allowsNesting(){return!0}}Rt.setState=Te.define();function Xc(n,e,t){let i=n.facet(Bn),o=dt(n).topNode;if(!i||i.allowsNesting)for(let s=o;s;s=s.enter(e,t,De.ExcludeBuffers|De.EnterBracketed))s.type.isTop&&(o=s);return o}class Ms extends Rt{constructor(e,t,i){super(e,t,[],i),this.parser=t}static define(e){let t=xy(e.languageData);return new Ms(t,e.parser.configure({props:[ui.add(i=>i.isTop?t:void 0)]}),e.name)}configure(e,t){return new Ms(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function dt(n){let e=n.field(Rt.state,!1);return e?e.tree:ze.empty}class vy{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let Li=null;class Os{constructor(e,t,i=[],o,s,r,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=o,this.treeLen=s,this.viewport=r,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new Os(e,t,[],ze.empty,0,i,[],null)}startParse(){return this.parser.startParse(new vy(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=ze.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let o=Date.now()+e;e=()=>Date.now()>o}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let o=this.parse.advance();if(o)if(this.fragments=this.withoutTempSkipped(Xn.addTree(o,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=o,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Xn.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Li;Li=this;try{return e()}finally{Li=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Gc(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:o,treeLen:s,viewport:r,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((c,h,u,p)=>a.push({fromA:c,toA:h,fromB:u,toB:p})),i=Xn.applyChanges(i,a),o=ze.empty,s=0,r={from:e.mapPos(r.from,-1),to:e.mapPos(r.to,1)},this.skipped.length){l=[];for(let c of this.skipped){let h=e.mapPos(c.from,1),u=e.mapPos(c.to,-1);h<u&&l.push({from:h,to:u})}}}return new Os(this.parser,t,i,o,s,r,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:o,to:s}=this.skipped[i];o<e.to&&s>e.from&&(this.fragments=Gc(this.fragments,o,s),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Id{createParse(t,i,o){let s=o[0].from,r=o[o.length-1].to;return{parsedPos:s,advance(){let a=Li;if(a){for(let c of o)a.tempSkipped.push(c);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=r,new ze(st.none,[],[],r-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Li}}function Gc(n,e,t){return Xn.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Mi{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Mi(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=Os.create(e.facet(Bn).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new Mi(i)}}Rt.state=Dt.define({create:Mi.init,update(n,e){for(let t of e.effects)if(t.is(Rt.setState))return t.value;return e.startState.facet(Bn)!=e.state.facet(Bn)?Mi.init(e.state):n.apply(e)}});let $d=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&($d=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Nr=typeof navigator<"u"&&(!((Or=navigator.scheduling)===null||Or===void 0)&&Or.isInputPending)?()=>navigator.scheduling.isInputPending():null,wy=Ct.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Rt.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Rt.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=$d(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:o}}=this.view,s=i.field(Rt.state);if(s.tree==s.context.tree&&s.context.isDone(o+1e5))return;let r=Date.now()+Math.min(this.chunkBudget,100,e&&!Nr?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<o&&i.doc.length>o+1e3,a=s.context.work(()=>Nr&&Nr()||Date.now()>r,o+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Rt.setState.of(new Mi(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>ut(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Bn=ne.define({combine(n){return n.length?n[0]:null},enables:n=>[Rt.state,wy,re.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class Sy{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const ky=ne.define(),Wd=ne.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function Cy(n){let e=n.facet(Wd);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function Ty(n,e){let t="",i=n.tabSize,o=n.facet(Wd)[0];if(o=="	"){for(;e>=i;)t+="	",e-=i;o=" "}for(let s=0;s<e;s++)t+=o;return t}function Ey(n,e){n instanceof we&&(n=new Hd(n));for(let i of n.state.facet(ky)){let o=i(n,e);if(o!==void 0)return o}let t=dt(n.state);return t.length>=e?Ay(n,t,e):null}class Hd{constructor(e,t={}){this.state=e,this.options=t,this.unit=Cy(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:o,simulateDoubleBreak:s}=this.options;return o!=null&&o>=i.from&&o<=i.to?s&&o==e?{text:"",from:e}:(t<0?o<e:o<=e)?{text:i.text.slice(o-i.from),from:o}:{text:i.text.slice(0,o-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:o}=this.lineAt(e,t);return i.slice(e-o,Math.min(i.length,e+100-o))}column(e,t=1){let{text:i,from:o}=this.lineAt(e,t),s=this.countColumn(i,e-o),r=this.options.overrideIndentation?this.options.overrideIndentation(o):-1;return r>-1&&(s+=r-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return Yg(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:o}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let r=s(o);if(r>-1)return r}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Vd=new ye;function Ay(n,e,t){let i=e.resolveStack(t),o=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(o!=i.node){let s=[];for(let r=o;r&&!(r.from<i.node.from||r.to>i.node.to||r.from==i.node.from&&r.type==i.node.type);r=r.parent)s.push(r);for(let r=s.length-1;r>=0;r--)i={node:s[r],next:i}}return Ud(i,n,t)}function Ud(n,e,t){for(let i=n;i;i=i.next){let o=My(i.node);if(o)return o(Ea.create(e,t,i))}return 0}function _y(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function My(n){let e=n.type.prop(Vd);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(ye.closedBy))){let o=n.lastChild,s=o&&i.indexOf(o.name)>-1;return r=>jy(r,!0,1,void 0,s&&!_y(r)?o.from:void 0)}return n.parent==null?Oy:null}function Oy(){return 0}class Ea extends Hd{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new Ea(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(Ny(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return Ud(this.context.next,this.base,this.pos)}}function Ny(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function Ry(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let o=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),r=o==null||o<=s.from?s.to:Math.min(s.to,o);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped){if(a.from>=r)return null;let c=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+c}}l=a.to}}function jy(n,e,t,i,o){let s=n.textAfter,r=s.match(/^\s*/)[0].length,l=i&&s.slice(r,r+i.length)==i||o==n.pos+r,a=e?Ry(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}function Dy({except:n,units:e=1}={}){return t=>{let i=n&&n.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const By=200;function Py(){return we.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:i}=n.newSelection.main,o=t.lineAt(i);if(i>o.from+By)return n;let s=t.sliceString(o.from,i);if(!e.some(c=>c.test(s)))return n;let{state:r}=n,l=-1,a=[];for(let{head:c}of r.selection.ranges){let h=r.doc.lineAt(c);if(h.from==l)continue;l=h.from;let u=Ey(r,h.from);if(u==null)continue;let p=/^\s*/.exec(h.text)[0],g=Ty(r,u);p!=g&&a.push({from:h.from,to:h.from+p.length,insert:g})}return a.length?[n,{changes:a,sequential:!0}]:n})}const Iy=ne.define(),qd=new ye;function zy(n,e,t){let i=dt(n);if(i.length<t)return null;let o=i.resolveStack(t,1),s=null;for(let r=o;r;r=r.next){let l=r.node;if(l.to<=t||l.from>t)continue;if(s&&l.from<e)break;let a=l.type.prop(qd);if(a&&(l.to<i.length-50||i.length==n.doc.length||!Ly(l))){let c=a(l,n);c&&c.from<=t&&c.from>=e&&c.to>t&&(s=c)}}return s}function Ly(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function Jc(n,e,t){for(let i of n.facet(Iy)){let o=i(n,e,t);if(o)return o}return zy(n,e,t)}function Kd(n,e){let t=e.mapPos(n.from,1),i=e.mapPos(n.to,-1);return t>=i?void 0:{from:t,to:i}}const Qd=Te.define({map:Kd}),Aa=Te.define({map:Kd}),Ns=Dt.define({create(){return pe.none},update(n,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,i)=>n=Zc(n,t,i)),n=n.map(e.changes);for(let t of e.effects)if(t.is(Qd)&&!Fy(n,t.value.from,t.value.to)){let{preparePlaceholder:i}=e.state.facet(_a),o=i?pe.replace({widget:new Hy(i(e.state,t.value))}):eh;n=n.update({add:[o.range(t.value.from,t.value.to)]})}else t.is(Aa)&&(n=n.update({filter:(i,o)=>t.value.from!=i||t.value.to!=o,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(n=Zc(n,e.selection.main.head)),n},provide:n=>re.decorations.from(n),toJSON(n,e){let t=[];return n.between(0,e.doc.length,(i,o)=>{t.push(i,o)}),t},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<n.length;){let i=n[t++],o=n[t++];if(typeof i!="number"||typeof o!="number")throw new RangeError("Invalid JSON for fold state");e.push(eh.range(i,o))}return pe.set(e,!0)}});function Zc(n,e,t=e){let i=!1;return n.between(e,t,(o,s)=>{o<t&&s>e&&(i=!0)}),i?n.update({filterFrom:e,filterTo:t,filter:(o,s)=>o>=t||s<=e}):n}function Bl(n,e,t){var i;let o=null;return(i=n.field(Ns,!1))===null||i===void 0||i.between(e,t,(s,r)=>{(!o||o.from>s)&&(o={from:s,to:r})}),o}function Fy(n,e,t){let i=!1;return n.between(e,e,(o,s)=>{o==e&&s==t&&(i=!0)}),i}const $y={placeholderDOM:null,preparePlaceholder:null,placeholderText:"â€¦"},_a=ne.define({combine(n){return Di(n,$y)}});function Wy(n){let e=[Ns,qy];return n&&e.push(_a.of(n)),e}function Yd(n,e){let{state:t}=n,i=t.facet(_a),o=r=>{let l=n.lineBlockAt(n.posAtDOM(r.target)),a=Bl(n.state,l.from,l.to);a&&n.dispatch({effects:Aa.of(a)}),r.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(n,o,e);let s=document.createElement("span");return s.textContent=i.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=o,s}const eh=pe.replace({widget:new class extends Bi{toDOM(n){return Yd(n,null)}}});class Hy extends Bi{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return Yd(e,this.value)}}const Vy={openText:"âŒ„",closedText:"â€º",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Rr extends jn{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function Uy(n={}){let e={...Vy,...n},t=new Rr(e,!0),i=new Rr(e,!1),o=Ct.fromClass(class{constructor(r){this.from=r.viewport.from,this.markers=this.buildMarkers(r)}update(r){(r.docChanged||r.viewportChanged||r.startState.facet(Bn)!=r.state.facet(Bn)||r.startState.field(Ns,!1)!=r.state.field(Ns,!1)||dt(r.startState)!=dt(r.state)||e.foldingChanged(r))&&(this.markers=this.buildMarkers(r.view))}buildMarkers(r){let l=new Ci;for(let a of r.viewportLineBlocks){let c=Bl(r.state,a.from,a.to)?i:Jc(r.state,a.from,a.to)?t:null;c&&l.add(a.from,a.from,c)}return l.finish()}}),{domEventHandlers:s}=e;return[o,Y0({class:"cm-foldGutter",markers(r){var l;return((l=r.plugin(o))===null||l===void 0?void 0:l.markers)||ve.empty},initialSpacer(){return new Rr(e,!1)},domEventHandlers:{...s,click:(r,l,a)=>{if(s.click&&s.click(r,l,a))return!0;let c=Bl(r.state,l.from,l.to);if(c)return r.dispatch({effects:Aa.of(c)}),!0;let h=Jc(r.state,l.from,l.to);return h?(r.dispatch({effects:Qd.of(h)}),!0):!1}}}),Wy()]}const qy=re.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class er{constructor(e,t){this.specs=e;let i;function o(l){let a=On.newName();return(i||(i=Object.create(null)))["."+a]=l,a}const s=typeof t.all=="string"?t.all:t.all?o(t.all):void 0,r=t.scope;this.scope=r instanceof Rt?l=>l.prop(ui)==r.data:r?l=>l==r:void 0,this.style=Fd(e.map(l=>({tag:l.tag,class:l.class||o(Object.assign({},l,{tag:null}))})),{all:s}).style,this.module=i?new On(i):null,this.themeType=t.themeType}static define(e,t){return new er(e,t||{})}}const Pl=ne.define(),Xd=ne.define({combine(n){return n.length?[n[0]]:null}});function jr(n){let e=n.facet(Pl);return e.length?e:n.facet(Xd)}function Ky(n,e){let t=[Yy],i;return n instanceof er&&(n.module&&t.push(re.styleModule.of(n.module)),i=n.themeType),e!=null&&e.fallback?t.push(Xd.of(n)):i?t.push(Pl.computeN([re.darkTheme],o=>o.facet(re.darkTheme)==(i=="dark")?[n]:[])):t.push(Pl.of(n)),t}class Qy{constructor(e){this.markCache=Object.create(null),this.tree=dt(e.state),this.decorations=this.buildDeco(e,jr(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=dt(e.state),i=jr(e.state),o=i!=jr(e.startState),{viewport:s}=e.view,r=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!o&&t.type==this.tree.type&&r>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=r):(t!=this.tree||e.viewportChanged||o)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return pe.none;let i=new Ci;for(let{from:o,to:s}of e.visibleRanges)gy(this.tree,t,(r,l,a)=>{i.add(r,l,this.markCache[a]||(this.markCache[a]=pe.mark({class:a})))},o,s);return i.finish()}}const Yy=ko.high(Ct.fromClass(Qy,{decorations:n=>n.decorations})),Xy=er.define([{tag:K.meta,color:"#404740"},{tag:K.link,textDecoration:"underline"},{tag:K.heading,textDecoration:"underline",fontWeight:"bold"},{tag:K.emphasis,fontStyle:"italic"},{tag:K.strong,fontWeight:"bold"},{tag:K.strikethrough,textDecoration:"line-through"},{tag:K.keyword,color:"#708"},{tag:[K.atom,K.bool,K.url,K.contentSeparator,K.labelName],color:"#219"},{tag:[K.literal,K.inserted],color:"#164"},{tag:[K.string,K.deleted],color:"#a11"},{tag:[K.regexp,K.escape,K.special(K.string)],color:"#e40"},{tag:K.definition(K.variableName),color:"#00f"},{tag:K.local(K.variableName),color:"#30a"},{tag:[K.typeName,K.namespace],color:"#085"},{tag:K.className,color:"#167"},{tag:[K.special(K.variableName),K.macroName],color:"#256"},{tag:K.definition(K.propertyName),color:"#00c"},{tag:K.comment,color:"#940"},{tag:K.invalid,color:"#f00"}]),Gy=re.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Gd=1e4,Jd="()[]{}",Zd=ne.define({combine(n){return Di(n,{afterCursor:!0,brackets:Jd,maxScanDistance:Gd,renderMatch:ex})}}),Jy=pe.mark({class:"cm-matchingBracket"}),Zy=pe.mark({class:"cm-nonmatchingBracket"});function ex(n){let e=[],t=n.matched?Jy:Zy;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}const tx=Dt.define({create(){return pe.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],i=e.state.facet(Zd);for(let o of e.state.selection.ranges){if(!o.empty)continue;let s=Yo(e.state,o.head,-1,i)||o.head>0&&Yo(e.state,o.head-1,1,i)||i.afterCursor&&(Yo(e.state,o.head,1,i)||o.head<e.state.doc.length&&Yo(e.state,o.head+1,-1,i));s&&(t=t.concat(i.renderMatch(s,e.state)))}return pe.set(t,!0)},provide:n=>re.decorations.from(n)}),nx=[tx,Gy];function ix(n={}){return[Zd.of(n),nx]}const ox=new ye;function Il(n,e,t){let i=n.prop(e<0?ye.openedBy:ye.closedBy);if(i)return i;if(n.name.length==1){let o=t.indexOf(n.name);if(o>-1&&o%2==(e<0?1:0))return[t[o+e]]}return null}function zl(n){let e=n.type.prop(ox);return e?e(n.node):n}function Yo(n,e,t,i={}){let o=i.maxScanDistance||Gd,s=i.brackets||Jd,r=dt(n),l=r.resolveInner(e,t);for(let a=l;a;a=a.parent){let c=Il(a.type,t,s);if(c&&a.from<a.to){let h=zl(a);if(h&&(t>0?e>=h.from&&e<h.to:e>h.from&&e<=h.to))return sx(n,e,t,a,h,c,s)}}return rx(n,e,t,r,l.type,o,s)}function sx(n,e,t,i,o,s,r){let l=i.parent,a={from:o.from,to:o.to},c=0,h=l==null?void 0:l.cursor();if(h&&(t<0?h.childBefore(i.from):h.childAfter(i.to)))do if(t<0?h.to<=i.from:h.from>=i.to){if(c==0&&s.indexOf(h.type.name)>-1&&h.from<h.to){let u=zl(h);return{start:a,end:u?{from:u.from,to:u.to}:void 0,matched:!0}}else if(Il(h.type,t,r))c++;else if(Il(h.type,-t,r)){if(c==0){let u=zl(h);return{start:a,end:u&&u.from<u.to?{from:u.from,to:u.to}:void 0,matched:!1}}c--}}while(t<0?h.prevSibling():h.nextSibling());return{start:a,matched:!1}}function rx(n,e,t,i,o,s,r){let l=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),a=r.indexOf(l);if(a<0||a%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},h=n.doc.iterRange(e,t>0?n.doc.length:0),u=0;for(let p=0;!h.next().done&&p<=s;){let g=h.value;t<0&&(p+=g.length);let y=e+p*t;for(let m=t>0?0:g.length-1,b=t>0?g.length:-1;m!=b;m+=t){let x=r.indexOf(g[m]);if(!(x<0||i.resolveInner(y+m,1).type!=o))if(x%2==0==t>0)u++;else{if(u==1)return{start:c,end:{from:y+m,to:y+m+1},matched:x>>1==a>>1};u--}}t>0&&(p+=g.length)}return h.done?{start:c,matched:!1}:null}const lx=Object.create(null),th=[st.none],nh=[],ih=Object.create(null),ax=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])ax[n]=cx(lx,e);function Dr(n,e){nh.indexOf(n)>-1||(nh.push(n),console.warn(e))}function cx(n,e){let t=[];for(let l of e.split(" ")){let a=[];for(let c of l.split(".")){let h=n[c]||K[c];h?typeof h=="function"?a.length?a=a.map(h):Dr(c,`Modifier ${c} used at start of tag`):a.length?Dr(c,`Tag ${c} used as modifier`):a=Array.isArray(h)?h:[h]:Dr(c,`Unknown highlighting tag ${c}`)}for(let c of a)t.push(c)}if(!t.length)return 0;let i=e.replace(/ /g,"_"),o=i+" "+t.map(l=>l.id),s=ih[o];if(s)return s.id;let r=ih[o]=st.define({id:th.length,name:i,props:[zd({[i]:t})]});return th.push(r),r.id}Be.RTL,Be.LTR;class Rs{constructor(e,t,i,o,s,r,l,a,c,h=0,u){this.p=e,this.stack=t,this.state=i,this.reducePos=o,this.pos=s,this.score=r,this.buffer=l,this.bufferBase=a,this.curContext=c,this.lookAhead=h,this.parent=u}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,i=0){let o=e.parser.context;return new Rs(e,[],t,i,i,0,[],0,o?new oh(o,o.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let i=e>>19,o=e&65535,{parser:s}=this.p,r=this.reducePos<this.pos-25&&this.setLookAhead(this.pos),l=s.dynamicPrecedence(o);if(l&&(this.score+=l),i==0){this.pushState(s.getGoto(this.state,o,!0),this.reducePos),o<s.minRepeatTerm&&this.storeNode(o,this.reducePos,this.reducePos,r?8:4,!0),this.reduceContext(o,this.reducePos);return}let a=this.stack.length-(i-1)*3-(e&262144?6:0),c=a?this.stack[a-2]:this.p.ranges[0].from,h=this.reducePos-c;h>=2e3&&!(!((t=this.p.parser.nodeSet.types[o])===null||t===void 0)&&t.isAnonymous)&&(c==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=h):this.p.lastBigReductionSize<h&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=c,this.p.lastBigReductionSize=h));let u=a?this.stack[a-1]:0,p=this.bufferBase+this.buffer.length-u;if(o<s.minRepeatTerm||e&131072){let g=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(o,c,g,p+4,!0)}if(e&262144)this.state=this.stack[a];else{let g=this.stack[a-3];this.state=s.getGoto(g,o,!0)}for(;this.stack.length>a;)this.stack.pop();this.reduceContext(o,c)}storeNode(e,t,i,o=4,s=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let r=this,l=this.buffer.length;if(l==0&&r.parent&&(l=r.bufferBase-r.parent.bufferBase,r=r.parent),l>0&&r.buffer[l-4]==0&&r.buffer[l-1]>-1){if(t==i)return;if(r.buffer[l-2]>=t){r.buffer[l-2]=i;return}}}if(!s||this.pos==i)this.buffer.push(e,t,i,o);else{let r=this.buffer.length;if(r>0&&(this.buffer[r-4]!=0||this.buffer[r-1]<0)){let l=!1;for(let a=r;a>0&&this.buffer[a-2]>i;a-=4)if(this.buffer[a-1]>=0){l=!0;break}if(l)for(;r>0&&this.buffer[r-2]>i;)this.buffer[r]=this.buffer[r-4],this.buffer[r+1]=this.buffer[r-3],this.buffer[r+2]=this.buffer[r-2],this.buffer[r+3]=this.buffer[r-1],r-=4,o>4&&(o-=4)}this.buffer[r]=e,this.buffer[r+1]=t,this.buffer[r+2]=i,this.buffer[r+3]=o}}shift(e,t,i,o){if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=o,this.shiftContext(t,i),t<=this.p.parser.maxNode&&this.buffer.push(t,i,o,4);else{let s=e,{parser:r}=this.p;(o>this.pos||t<=r.maxNode)&&(this.pos=o,r.stateFlag(s,1)||(this.reducePos=o)),this.pushState(s,i),this.shiftContext(t,i),t<=r.maxNode&&this.buffer.push(t,i,o,4)}}apply(e,t,i,o){e&65536?this.reduce(e):this.shift(e,t,i,o)}useNode(e,t){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=e)&&(this.p.reused.push(e),i++);let o=this.pos;this.reducePos=this.pos=o+e.length,this.pushState(t,o),this.buffer.push(i,o,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let i=e.buffer.slice(t),o=e.bufferBase+t;for(;e&&o==e.bufferBase;)e=e.parent;return new Rs(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,o,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let i=e<=this.p.parser.maxNode;i&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,i?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new hx(this);;){let i=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(i==0)return!1;if(!(i&65536))return!0;t.reduce(i)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let o=[];for(let s=0,r;s<t.length;s+=2)(r=t[s+1])!=this.state&&this.p.parser.hasAction(r,e)&&o.push(t[s],r);if(this.stack.length<120)for(let s=0;o.length<8&&s<t.length;s+=2){let r=t[s+1];o.some((l,a)=>a&1&&l==r)||o.push(t[s],r)}t=o}let i=[];for(let o=0;o<t.length&&i.length<4;o+=2){let s=t[o+1];if(s==this.state)continue;let r=this.split();r.pushState(s,this.pos),r.storeNode(0,r.pos,r.pos,4,!0),r.shiftContext(t[o],this.pos),r.reducePos=this.pos,r.score-=200,i.push(r)}return i}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if(!(t&65536))return!1;if(!e.validAction(this.state,t)){let i=t>>19,o=t&65535,s=this.stack.length-i*3;if(s<0||e.getGoto(this.stack[s],o,!1)<0){let r=this.findForcedReduction();if(r==null)return!1;t=r}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],i=(o,s)=>{if(!t.includes(o))return t.push(o),e.allActions(o,r=>{if(!(r&393216))if(r&65536){let l=(r>>19)-s;if(l>1){let a=r&65535,c=this.stack.length-l*3;if(c>=0&&e.getGoto(this.stack[c],a,!1)>=0)return l<<19|65536|a}}else{let l=i(r,s+1);if(l!=null)return l}})};return i(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new oh(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){return e<=this.lookAhead?!1:(this.emitLookAhead(),this.lookAhead=e,!0)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class oh{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class hx{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=e&65535,i=e>>19;i==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(i-1)*3;let o=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=o}}class js{constructor(e,t,i){this.stack=e,this.pos=t,this.index=i,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new js(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new js(this.stack,this.pos,this.index)}}function Xo(n,e=Uint16Array){if(typeof n!="string")return n;let t=null;for(let i=0,o=0;i<n.length;){let s=0;for(;;){let r=n.charCodeAt(i++),l=!1;if(r==126){s=65535;break}r>=92&&r--,r>=34&&r--;let a=r-32;if(a>=46&&(a-=46,l=!0),s+=a,l)break;s*=46}t?t[o++]=s:t=new e(s)}return t}class fs{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const sh=new fs;class ux{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=sh,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let i=this.range,o=this.rangeIndex,s=this.pos+e;for(;s<i.from;){if(!o)return null;let r=this.ranges[--o];s-=i.from-r.to,i=r}for(;t<0?s>i.to:s>=i.to;){if(o==this.ranges.length-1)return null;let r=this.ranges[++o];s+=r.from-i.to,i=r}return s}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t=this.chunkOff+e,i,o;if(t>=0&&t<this.chunk.length)i=this.pos+e,o=this.chunk.charCodeAt(t);else{let s=this.resolveOffset(e,1);if(s==null)return-1;if(i=s,i>=this.chunk2Pos&&i<this.chunk2Pos+this.chunk2.length)o=this.chunk2.charCodeAt(i-this.chunk2Pos);else{let r=this.rangeIndex,l=this.range;for(;l.to<=i;)l=this.ranges[++r];this.chunk2=this.input.chunk(this.chunk2Pos=i),i+this.chunk2.length>l.to&&(this.chunk2=this.chunk2.slice(0,l.to-i)),o=this.chunk2.charCodeAt(0)}}return i>=this.token.lookAhead&&(this.token.lookAhead=i+1),o}acceptToken(e,t=0){let i=t?this.resolveOffset(t,-1):this.pos;if(i==null||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=i}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=sh,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let i="";for(let o of this.ranges){if(o.from>=t)break;o.to>e&&(i+=this.input.read(Math.max(o.from,e),Math.min(o.to,t)))}return i}}class xi{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:i}=t.p;fx(this.data,e,t,this.id,i.data,i.tokenPrecTable)}}xi.prototype.contextual=xi.prototype.fallback=xi.prototype.extend=!1;xi.prototype.fallback=xi.prototype.extend=!1;class dx{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function fx(n,e,t,i,o,s){let r=0,l=1<<i,{dialect:a}=t.p.parser;e:for(;l&n[r];){let c=n[r+1];for(let g=r+3;g<c;g+=2)if((n[g+1]&l)>0){let y=n[g];if(a.allows(y)&&(e.token.value==-1||e.token.value==y||px(y,e.token.value,o,s))){e.acceptToken(y);break}}let h=e.next,u=0,p=n[r+2];if(e.next<0&&p>u&&n[c+p*3-3]==65535){r=n[c+p*3-1];continue e}for(;u<p;){let g=u+p>>1,y=c+g+(g<<1),m=n[y],b=n[y+1]||65536;if(h<m)p=g;else if(h>=b)u=g+1;else{r=n[y+2],e.advance();continue e}}break}}function rh(n,e,t){for(let i=e,o;(o=n[i])!=65535;i++)if(o==t)return i-e;return-1}function px(n,e,t,i){let o=rh(t,i,e);return o<0||rh(t,i,n)<o}const lt=typeof process<"u"&&process.env&&/\bparse\b/.test({}.LOG);let Br=null;function lh(n,e,t){let i=n.cursor(De.IncludeAnonymous);for(i.moveTo(e);;)if(!(t<0?i.childBefore(e):i.childAfter(e)))for(;;){if((t<0?i.to<e:i.from>e)&&!i.type.isError)return t<0?Math.max(0,Math.min(i.to-1,e-25)):Math.min(n.length,Math.max(i.from+1,e+25));if(t<0?i.prevSibling():i.nextSibling())break;if(!i.parent())return t<0?0:n.length}}class gx{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?lh(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?lh(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let i=this.trees[t],o=this.index[t];if(o==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=i.children[o],r=this.start[t]+i.positions[o];if(r>e)return this.nextStart=r,null;if(s instanceof ze){if(r==e){if(r<this.safeFrom)return null;let l=r+s.length;if(l<=this.safeTo){let a=s.prop(ye.lookAhead);if(!a||l+a<this.fragment.to)return s}}this.index[t]++,r+s.length>=Math.max(this.safeFrom,e)&&(this.trees.push(s),this.start.push(r),this.index.push(0))}else this.index[t]++,this.nextStart=r+s.length}}}class mx{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(i=>new fs)}getActions(e){let t=0,i=null,{parser:o}=e.p,{tokenizers:s}=o,r=o.stateSlot(e.state,3),l=e.curContext?e.curContext.hash:0,a=0;for(let c=0;c<s.length;c++){if(!(1<<c&r))continue;let h=s[c],u=this.tokens[c];if(!(i&&!h.fallback)&&((h.contextual||u.start!=e.pos||u.mask!=r||u.context!=l)&&(this.updateCachedToken(u,h,e),u.mask=r,u.context=l),u.lookAhead>u.end+25&&(a=Math.max(u.lookAhead,a)),u.value!=0)){let p=t;if(u.extended>-1&&(t=this.addActions(e,u.extended,u.end,t)),t=this.addActions(e,u.value,u.end,t),!h.extend&&(i=u,t>p))break}}for(;this.actions.length>t;)this.actions.pop();return a&&e.setLookAhead(a),!i&&e.pos==this.stream.end&&(i=new fs,i.value=e.p.parser.eofTerm,i.start=i.end=e.pos,t=this.addActions(e,i.value,i.end,t)),this.mainToken=i,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new fs,{pos:i,p:o}=e;return t.start=i,t.end=Math.min(i+1,o.stream.end),t.value=i==o.stream.end?o.parser.eofTerm:0,t}updateCachedToken(e,t,i){let o=this.stream.clipPos(i.pos);if(t.token(this.stream.reset(o,e),i),e.value>-1){let{parser:s}=i.p;for(let r=0;r<s.specialized.length;r++)if(s.specialized[r]==e.value){let l=s.specializers[r](this.stream.read(e.start,e.end),i);if(l>=0&&i.p.parser.dialect.allows(l>>1)){l&1?e.extended=l>>1:e.value=l>>1;break}}}else e.value=0,e.end=this.stream.clipPos(o+1)}putAction(e,t,i,o){for(let s=0;s<o;s+=3)if(this.actions[s]==e)return o;return this.actions[o++]=e,this.actions[o++]=t,this.actions[o++]=i,o}addActions(e,t,i,o){let{state:s}=e,{parser:r}=e.p,{data:l}=r;for(let a=0;a<2;a++)for(let c=r.stateSlot(s,a?2:1);;c+=3){if(l[c]==65535)if(l[c+1]==1)c=sn(l,c+2);else{o==0&&l[c+1]==2&&(o=this.putAction(sn(l,c+2),t,i,o));break}l[c]==t&&(o=this.putAction(sn(l,c+1),t,i,o))}return o}}class yx{constructor(e,t,i,o){this.parser=e,this.input=t,this.ranges=o,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new ux(t,o),this.tokens=new mx(e,this.stream),this.topTerm=e.top[1];let{from:s}=o[0];this.stacks=[Rs.start(this,e.top[0],s)],this.fragments=i.length&&this.stream.end-s>e.bufferLength*4?new gx(i,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,t=this.minStackPos,i=this.stacks=[],o,s;if(this.bigReductionCount>300&&e.length==1){let[r]=e;for(;r.forceReduce()&&r.stack.length&&r.stack[r.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let r=0;r<e.length;r++){let l=e[r];for(;;){if(this.tokens.mainToken=null,l.pos>t)i.push(l);else{if(this.advanceStack(l,i,e))continue;{o||(o=[],s=[]),o.push(l);let a=this.tokens.getMainToken(l);s.push(a.value,a.end)}}break}}if(!i.length){let r=o&&bx(o);if(r)return lt&&console.log("Finish with "+this.stackID(r)),this.stackToTree(r);if(this.parser.strict)throw lt&&o&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+t);this.recovering||(this.recovering=5)}if(this.recovering&&o){let r=this.stoppedAt!=null&&o[0].pos>this.stoppedAt?o[0]:this.runRecovery(o,s,i);if(r)return lt&&console.log("Force-finish "+this.stackID(r)),this.stackToTree(r.forceAll())}if(this.recovering){let r=this.recovering==1?1:this.recovering*3;if(i.length>r)for(i.sort((l,a)=>a.score-l.score);i.length>r;)i.pop();i.some(l=>l.reducePos>t)&&this.recovering--}else if(i.length>1){e:for(let r=0;r<i.length-1;r++){let l=i[r];for(let a=r+1;a<i.length;a++){let c=i[a];if(l.sameState(c)||l.buffer.length>500&&c.buffer.length>500)if((l.score-c.score||l.buffer.length-c.buffer.length)>0)i.splice(a--,1);else{i.splice(r--,1);continue e}}}i.length>12&&(i.sort((r,l)=>l.score-r.score),i.splice(12,i.length-12))}this.minStackPos=i[0].pos;for(let r=1;r<i.length;r++)i[r].pos<this.minStackPos&&(this.minStackPos=i[r].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,i){let o=e.pos,{parser:s}=this,r=lt?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&o>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let c=e.curContext&&e.curContext.tracker.strict,h=c?e.curContext.hash:0;for(let u=this.fragments.nodeAt(o);u;){let p=this.parser.nodeSet.types[u.type.id]==u.type?s.getGoto(e.state,u.type.id):-1;if(p>-1&&u.length&&(!c||(u.prop(ye.contextHash)||0)==h))return e.useNode(u,p),lt&&console.log(r+this.stackID(e)+` (via reuse of ${s.getName(u.type.id)})`),!0;if(!(u instanceof ze)||u.children.length==0||u.positions[0]>0)break;let g=u.children[0];if(g instanceof ze&&u.positions[0]==0)u=g;else break}}let l=s.stateSlot(e.state,4);if(l>0)return e.reduce(l),lt&&console.log(r+this.stackID(e)+` (via always-reduce ${s.getName(l&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let a=this.tokens.getActions(e);for(let c=0;c<a.length;){let h=a[c++],u=a[c++],p=a[c++],g=c==a.length||!i,y=g?e:e.split(),m=this.tokens.mainToken;if(y.apply(h,u,m?m.start:y.pos,p),lt&&console.log(r+this.stackID(y)+` (via ${h&65536?`reduce of ${s.getName(h&65535)}`:"shift"} for ${s.getName(u)} @ ${o}${y==e?"":", split"})`),g)return!0;y.pos>o?t.push(y):i.push(y)}return!1}advanceFully(e,t){let i=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>i)return ah(e,t),!0}}runRecovery(e,t,i){let o=null,s=!1;for(let r=0;r<e.length;r++){let l=e[r],a=t[r<<1],c=t[(r<<1)+1],h=lt?this.stackID(l)+" -> ":"";if(l.deadEnd&&(s||(s=!0,l.restart(),lt&&console.log(h+this.stackID(l)+" (restarted)"),this.advanceFully(l,i))))continue;let u=l.split(),p=h;for(let g=0;g<10&&u.forceReduce()&&(lt&&console.log(p+this.stackID(u)+" (via force-reduce)"),!this.advanceFully(u,i));g++)lt&&(p=this.stackID(u)+" -> ");for(let g of l.recoverByInsert(a))lt&&console.log(h+this.stackID(g)+" (via recover-insert)"),this.advanceFully(g,i);this.stream.end>l.pos?(c==l.pos&&(c++,a=0),l.recoverByDelete(a,c),lt&&console.log(h+this.stackID(l)+` (via recover-delete ${this.parser.getName(a)})`),ah(l,i)):(!o||o.score<l.score)&&(o=l)}return o}stackToTree(e){return e.close(),ze.build({buffer:js.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(Br||(Br=new WeakMap)).get(e);return t||Br.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function ah(n,e){for(let t=0;t<e.length;t++){let i=e[t];if(i.pos==n.pos&&i.sameState(n)){e[t].score<n.score&&(e[t]=n);return}}e.push(n)}class xx{constructor(e,t,i){this.source=e,this.flags=t,this.disabled=i}allows(e){return!this.disabled||this.disabled[e]==0}}class Ds extends Id{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let l=0;l<e.repeatNodeCount;l++)t.push("");let i=Object.keys(e.topRules).map(l=>e.topRules[l][1]),o=[];for(let l=0;l<t.length;l++)o.push([]);function s(l,a,c){o[l].push([a,a.deserialize(String(c))])}if(e.nodeProps)for(let l of e.nodeProps){let a=l[0];typeof a=="string"&&(a=ye[a]);for(let c=1;c<l.length;){let h=l[c++];if(h>=0)s(h,a,l[c++]);else{let u=l[c+-h];for(let p=-h;p>0;p--)s(l[c++],a,u);c++}}}this.nodeSet=new Sa(t.map((l,a)=>st.define({name:a>=this.minRepeatTerm?void 0:l,id:a,props:o[a],top:i.indexOf(a)>-1,error:a==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(a)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=jd;let r=Xo(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let l=0;l<this.specializerSpecs.length;l++)this.specialized[l]=this.specializerSpecs[l].term;this.specializers=this.specializerSpecs.map(ch),this.states=Xo(e.states,Uint32Array),this.data=Xo(e.stateData),this.goto=Xo(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(l=>typeof l=="number"?new xi(r,l):l),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,i){let o=new yx(this,e,t,i);for(let s of this.wrappers)o=s(o,e,t,i);return o}getGoto(e,t,i=!1){let o=this.goto;if(t>=o[0])return-1;for(let s=o[t+1];;){let r=o[s++],l=r&1,a=o[s++];if(l&&i)return a;for(let c=s+(r>>1);s<c;s++)if(o[s]==e)return a;if(l)return-1}}hasAction(e,t){let i=this.data;for(let o=0;o<2;o++)for(let s=this.stateSlot(e,o?2:1),r;;s+=3){if((r=i[s])==65535)if(i[s+1]==1)r=i[s=sn(i,s+2)];else{if(i[s+1]==2)return sn(i,s+2);break}if(r==t||r==0)return sn(i,s+1)}return 0}stateSlot(e,t){return this.states[e*6+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,i=>i==t?!0:null)}allActions(e,t){let i=this.stateSlot(e,4),o=i?t(i):void 0;for(let s=this.stateSlot(e,1);o==null;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=sn(this.data,s+2);else break;o=t(sn(this.data,s+1))}return o}nextStates(e){let t=[];for(let i=this.stateSlot(e,1);;i+=3){if(this.data[i]==65535)if(this.data[i+1]==1)i=sn(this.data,i+2);else break;if(!(this.data[i+2]&1)){let o=this.data[i+1];t.some((s,r)=>r&1&&s==o)||t.push(this.data[i],o)}}return t}configure(e){let t=Object.assign(Object.create(Ds.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let i=this.topRules[e.top];if(!i)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=i}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(i=>{let o=e.tokenizers.find(s=>s.from==i);return o?o.to:i})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((i,o)=>{let s=e.specializers.find(l=>l.from==i.external);if(!s)return i;let r=Object.assign(Object.assign({},i),{external:s.to});return t.specializers[o]=ch(r),r})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),e.bufferLength!=null&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return t==null?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),i=t.map(()=>!1);if(e)for(let s of e.split(" ")){let r=t.indexOf(s);r>=0&&(i[r]=!0)}let o=null;for(let s=0;s<t.length;s++)if(!i[s])for(let r=this.dialects[t[s]],l;(l=this.data[r++])!=65535;)(o||(o=new Uint8Array(this.maxTerm+1)))[l]=1;return new xx(e,i,o)}static deserialize(e){return new Ds(e)}}function sn(n,e){return n[e]|n[e+1]<<16}function bx(n){let e=null;for(let t of n){let i=t.p.stoppedAt;(t.pos==t.p.stream.end||i!=null&&t.pos>i)&&t.p.parser.stateFlag(t.state,2)&&(!e||e.score<t.score)&&(e=t)}return e}function ch(n){if(n.external){let e=n.extend?1:0;return(t,i)=>n.external(t,i)<<1|e}return n.get}class ef{constructor(e,t,i,o){this.state=e,this.pos=t,this.explicit=i,this.view=o,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=dt(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),o=t.text.slice(i-t.from,this.pos-t.from),s=o.search(nf(e,!1));return s<0?null:{from:i+s,to:this.pos,text:o.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t,i){e=="abort"&&this.abortListeners&&(this.abortListeners.push(t),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function hh(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function vx(n){let e=Object.create(null),t=Object.create(null);for(let{label:o}of n){e[o[0]]=!0;for(let s=1;s<o.length;s++)t[o[s]]=!0}let i=hh(e)+hh(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function tf(n){let e=n.map(o=>typeof o=="string"?{label:o}:o),[t,i]=e.every(o=>/^\w+$/.test(o.label))?[/\w*$/,/\w+$/]:vx(e);return o=>{let s=o.matchBefore(i);return s||o.explicit?{from:s?s.from:o.pos,options:e,validFor:t}:null}}function wx(n,e){return t=>{for(let i=dt(t.state).resolveInner(t.pos,-1);i;i=i.parent){if(n.indexOf(i.name)>-1)return null;if(i.type.isTop)break}return e(t)}}class uh{constructor(e,t,i,o){this.completion=e,this.source=t,this.match=i,this.score=o}}function Gn(n){return n.selection.main.from}function nf(n,e){var t;let{source:i}=n,o=e&&i[0]!="^",s=i[i.length-1]!="$";return!o&&!s?n:new RegExp(`${o?"^":""}(?:${i})${s?"$":""}`,(t=n.flags)!==null&&t!==void 0?t:n.ignoreCase?"i":"")}const of=fn.define();function Sx(n,e,t,i){let{main:o}=n.selection,s=t-o.from,r=i-o.from;return{...n.changeByRange(l=>{if(l!=o&&t!=i&&n.sliceDoc(l.from+s,l.from+r)!=n.sliceDoc(t,i))return{range:l};let a=n.toText(e);return{changes:{from:l.from+s,to:i==o.from?l.to:l.from+r,insert:a},range:te.cursor(l.from+s+a.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const dh=new WeakMap;function kx(n){if(!Array.isArray(n))return n;let e=dh.get(n);return e||dh.set(n,e=tf(n)),e}const Bs=Te.define(),fo=Te.define();class Cx{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=xn(e,t),o=Vn(i);this.chars.push(i);let s=e.slice(t,t+o),r=s.toUpperCase();this.folded.push(xn(r==s?s.toLowerCase():r,0)),t+=o}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:o,precise:s,byWord:r}=this;if(t.length==1){let T=xn(e,0),k=Vn(T),E=k==e.length?0:-100;if(T!=t[0])if(T==i[0])E+=-200;else return null;return this.ret(E,[0,k])}let l=e.indexOf(this.pattern);if(l==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,c=0;if(l<0){for(let T=0,k=Math.min(e.length,200);T<k&&c<a;){let E=xn(e,T);(E==t[c]||E==i[c])&&(o[c++]=T),T+=Vn(E)}if(c<a)return null}let h=0,u=0,p=!1,g=0,y=-1,m=-1,b=/[a-z]/.test(e),x=!0;for(let T=0,k=Math.min(e.length,200),E=0;T<k&&u<a;){let M=xn(e,T);l<0&&(h<a&&M==t[h]&&(s[h++]=T),g<a&&(M==t[g]||M==i[g]?(g==0&&(y=T),m=T+1,g++):g=0));let _,C=M<255?M>=48&&M<=57||M>=97&&M<=122?2:M>=65&&M<=90?1:0:(_=ku(M))!=_.toLowerCase()?1:_!=_.toUpperCase()?2:0;(!T||C==1&&b||E==0&&C!=0)&&(t[u]==M||i[u]==M&&(p=!0)?r[u++]=T:r.length&&(x=!1)),E=C,T+=Vn(M)}return u==a&&r[0]==0&&x?this.result(-100+(p?-200:0),r,e):g==a&&y==0?this.ret(-200-e.length+(m==e.length?0:-100),[0,m]):l>-1?this.ret(-700-e.length,[l,l+this.pattern.length]):g==a?this.ret(-200+-700-e.length,[y,m]):u==a?this.result(-100+(p?-200:0)+-700+(x?0:-1100),r,e):t.length==2?null:this.result((o[0]?-700:0)+-200+-1100,o,e)}result(e,t,i){let o=[],s=0;for(let r of t){let l=r+(this.astral?Vn(xn(i,r)):1);s&&o[s-1]==r?o[s-1]=l:(o[s++]=r,o[s++]=l)}return this.ret(e-i.length,o)}}class Tx{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),i=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return i==null?null:(this.matched=[0,t.length],this.score=i+(e.length==this.pattern.length?0:-100),this)}}const Ue=ne.define({combine(n){return Di(n,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:Ex,filterStrict:!1,compareCompletions:(e,t)=>(e.sortText||e.label).localeCompare(t.sortText||t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>fh(e(i),t(i)),optionClass:(e,t)=>i=>fh(e(i),t(i)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})}});function fh(n,e){return n?e?n+" "+e:n:e}function Ex(n,e,t,i,o,s){let r=n.textDirection==Be.RTL,l=r,a=!1,c="top",h,u,p=e.left-o.left,g=o.right-e.right,y=i.right-i.left,m=i.bottom-i.top;if(l&&p<Math.min(y,g)?l=!1:!l&&g<Math.min(y,p)&&(l=!0),y<=(l?p:g))h=Math.max(o.top,Math.min(t.top,o.bottom-m))-e.top,u=Math.min(400,l?p:g);else{a=!0,u=Math.min(400,(r?e.right:o.right-e.left)-30);let T=o.bottom-e.bottom;T>=m||T>e.top?h=t.bottom-e.top:(c="bottom",h=e.bottom-t.top)}let b=(e.bottom-e.top)/s.offsetHeight,x=(e.right-e.left)/s.offsetWidth;return{style:`${c}: ${h/b}px; max-width: ${u/x}px`,class:"cm-completionInfo-"+(a?r?"left-narrow":"right-narrow":l?"left":"right")}}function Ax(n){let e=n.addToOptions.slice();return n.icons&&e.push({render(t){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),t.type&&i.classList.add(...t.type.split(/\s+/g).map(o=>"cm-completionIcon-"+o)),i.setAttribute("aria-hidden","true"),i},position:20}),e.push({render(t,i,o,s){let r=document.createElement("span");r.className="cm-completionLabel";let l=t.displayLabel||t.label,a=0;for(let c=0;c<s.length;){let h=s[c++],u=s[c++];h>a&&r.appendChild(document.createTextNode(l.slice(a,h)));let p=r.appendChild(document.createElement("span"));p.appendChild(document.createTextNode(l.slice(h,u))),p.className="cm-completionMatchedText",a=u}return a<l.length&&r.appendChild(document.createTextNode(l.slice(a))),r},position:50},{render(t){if(!t.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=t.detail,i},position:80}),e.sort((t,i)=>t.position-i.position).map(t=>t.render)}function Pr(n,e,t){if(n<=t)return{from:0,to:n};if(e<0&&(e=0),e<=n>>1){let o=Math.floor(e/t);return{from:o*t,to:(o+1)*t}}let i=Math.floor((n-e)/t);return{from:n-(i+1)*t,to:n-i*t}}class _x{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let o=e.state.field(t),{options:s,selected:r}=o.open,l=e.state.facet(Ue);this.optionContent=Ax(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=Pr(s.length,r,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",a=>{let{options:c}=e.state.field(t).open;for(let h=a.target,u;h&&h!=this.dom;h=h.parentNode)if(h.nodeName=="LI"&&(u=/-(\d+)$/.exec(h.id))&&+u[1]<c.length){this.applyCompletion(e,c[+u[1]]),a.preventDefault();return}}),this.dom.addEventListener("focusout",a=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(Ue).closeOnBlur&&a.relatedTarget!=e.contentDOM&&e.dispatch({effects:fo.of(null)})}),this.showOptions(s,o.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let i=e.state.field(this.stateField),o=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=o){let{options:s,selected:r,disabled:l}=i.open;(!o.open||o.open.options!=s)&&(this.range=Pr(s.length,r,e.state.facet(Ue).maxRenderedOptions),this.showOptions(s,i.id)),this.updateSel(),l!=((t=o.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let i of this.currentClass.split(" "))i&&this.dom.classList.remove(i);for(let i of t.split(" "))i&&this.dom.classList.add(i);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;(t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=Pr(t.options.length,t.selected,this.view.state.facet(Ue).maxRenderedOptions),this.showOptions(t.options,e.id));let i=this.updateSelectedOption(t.selected);if(i){this.destroyInfo();let{completion:o}=t.options[t.selected],{info:s}=o;if(!s)return;let r=typeof s=="string"?document.createTextNode(s):s(o);if(!r)return;"then"in r?r.then(l=>{l&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(l,o)}).catch(l=>ut(this.view.state,l,"completion info")):(this.addInfoPane(r,o),i.setAttribute("aria-describedby",this.info.id))}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",i.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),e.nodeType!=null)i.appendChild(e),this.infoDestroy=null;else{let{dom:o,destroy:s}=e;i.appendChild(o),this.infoDestroy=s||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,o=this.range.from;i;i=i.nextSibling,o++)i.nodeName!="LI"||!i.id?o--:o==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&(i.removeAttribute("aria-selected"),i.removeAttribute("aria-describedby"));return t&&Ox(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),o=e.getBoundingClientRect(),s=this.space;if(!s){let r=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:r.clientWidth,bottom:r.clientHeight}}return o.top>Math.min(s.bottom,t.bottom)-10||o.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(Ue).positionInfo(this.view,t,o,i,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const o=document.createElement("ul");o.id=t,o.setAttribute("role","listbox"),o.setAttribute("aria-expanded","true"),o.setAttribute("aria-label",this.view.state.phrase("Completions")),o.addEventListener("mousedown",r=>{r.target==o&&r.preventDefault()});let s=null;for(let r=i.from;r<i.to;r++){let{completion:l,match:a}=e[r],{section:c}=l;if(c){let p=typeof c=="string"?c:c.name;if(p!=s&&(r>i.from||i.from==0))if(s=p,typeof c!="string"&&c.header)o.appendChild(c.header(c));else{let g=o.appendChild(document.createElement("completion-section"));g.textContent=p}}const h=o.appendChild(document.createElement("li"));h.id=t+"-"+r,h.setAttribute("role","option");let u=this.optionClass(l);u&&(h.className=u);for(let p of this.optionContent){let g=p(l,this.view.state,this.view,a);g&&h.appendChild(g)}}return i.from&&o.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&o.classList.add("cm-completionListIncompleteBottom"),o}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function Mx(n,e){return t=>new _x(t,n,e)}function Ox(n,e){let t=n.getBoundingClientRect(),i=e.getBoundingClientRect(),o=t.height/n.offsetHeight;i.top<t.top?n.scrollTop-=(t.top-i.top)/o:i.bottom>t.bottom&&(n.scrollTop+=(i.bottom-t.bottom)/o)}function ph(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function Nx(n,e){let t=[],i=null,o=null,s=h=>{t.push(h);let{section:u}=h.completion;if(u){i||(i=[]);let p=typeof u=="string"?u:u.name;i.some(g=>g.name==p)||i.push(typeof u=="string"?{name:p}:u)}},r=e.facet(Ue);for(let h of n)if(h.hasResult()){let u=h.result.getMatch;if(h.result.filter===!1)for(let p of h.result.options)s(new uh(p,h.source,u?u(p):[],1e9-t.length));else{let p=e.sliceDoc(h.from,h.to),g,y=r.filterStrict?new Tx(p):new Cx(p);for(let m of h.result.options)if(g=y.match(m.label)){let b=m.displayLabel?u?u(m,g.matched):[]:g.matched,x=g.score+(m.boost||0);if(s(new uh(m,h.source,b,x)),typeof m.section=="object"&&m.section.rank==="dynamic"){let{name:T}=m.section;o||(o=Object.create(null)),o[T]=Math.max(x,o[T]||-1e9)}}}}if(i){let h=Object.create(null),u=0,p=(g,y)=>(g.rank==="dynamic"&&y.rank==="dynamic"?o[y.name]-o[g.name]:0)||(typeof g.rank=="number"?g.rank:1e9)-(typeof y.rank=="number"?y.rank:1e9)||(g.name<y.name?-1:1);for(let g of i.sort(p))u-=1e5,h[g.name]=u;for(let g of t){let{section:y}=g.completion;y&&(g.score+=h[typeof y=="string"?y:y.name])}}let l=[],a=null,c=r.compareCompletions;for(let h of t.sort((u,p)=>p.score-u.score||c(u.completion,p.completion))){let u=h.completion;!a||a.label!=u.label||a.detail!=u.detail||a.type!=null&&u.type!=null&&a.type!=u.type||a.apply!=u.apply||a.boost!=u.boost?l.push(h):ph(h.completion)>ph(a)&&(l[l.length-1]=h),a=h.completion}return l}class di{constructor(e,t,i,o,s,r){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=o,this.selected=s,this.disabled=r}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new di(this.options,gh(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,o,s,r){if(o&&!r&&e.some(c=>c.isPending))return o.setDisabled();let l=Nx(e,t);if(!l.length)return o&&e.some(c=>c.isPending)?o.setDisabled():null;let a=t.facet(Ue).selectOnOpen?0:-1;if(o&&o.selected!=a&&o.selected!=-1){let c=o.options[o.selected].completion;for(let h=0;h<l.length;h++)if(l[h].completion==c){a=h;break}}return new di(l,gh(i,a),{pos:e.reduce((c,h)=>h.hasResult()?Math.min(c,h.from):c,1e8),create:Ix,above:s.aboveCursor},o?o.timestamp:Date.now(),a,!1)}map(e){return new di(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new di(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class Ps{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new Ps(Bx,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,i=t.facet(Ue),s=(i.override||t.languageDataAt("autocomplete",Gn(t)).map(kx)).map(a=>(this.active.find(h=>h.source==a)||new bt(a,this.active.some(h=>h.state!=0)?1:0)).update(e,i));s.length==this.active.length&&s.every((a,c)=>a==this.active[c])&&(s=this.active);let r=this.open,l=e.effects.some(a=>a.is(Ma));r&&e.docChanged&&(r=r.map(e.changes)),e.selection||s.some(a=>a.hasResult()&&e.changes.touchesRange(a.from,a.to))||!Rx(s,this.active)||l?r=di.build(s,t,this.id,r,i,l):r&&r.disabled&&!s.some(a=>a.isPending)&&(r=null),!r&&s.every(a=>!a.isPending)&&s.some(a=>a.hasResult())&&(s=s.map(a=>a.hasResult()?new bt(a.source,0):a));for(let a of e.effects)a.is(rf)&&(r=r&&r.setSelected(a.value,this.id));return s==this.active&&r==this.open?this:new Ps(s,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?jx:Dx}}function Rx(n,e){if(n==e)return!0;for(let t=0,i=0;;){for(;t<n.length&&!n[t].hasResult();)t++;for(;i<e.length&&!e[i].hasResult();)i++;let o=t==n.length,s=i==e.length;if(o||s)return o==s;if(n[t++].result!=e[i++].result)return!1}}const jx={"aria-autocomplete":"list"},Dx={};function gh(n,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":n};return e>-1&&(t["aria-activedescendant"]=n+"-"+e),t}const Bx=[];function sf(n,e){if(n.isUserEvent("input.complete")){let i=n.annotation(of);if(i&&e.activateOnCompletion(i))return 12}let t=n.isUserEvent("input.type");return t&&e.activateOnTyping?5:t?1:n.isUserEvent("delete.backward")?2:n.selection?8:n.docChanged?16:0}class bt{constructor(e,t,i=!1){this.source=e,this.state=t,this.explicit=i}hasResult(){return!1}get isPending(){return this.state==1}update(e,t){let i=sf(e,t),o=this;(i&8||i&16&&this.touches(e))&&(o=new bt(o.source,0)),i&4&&o.state==0&&(o=new bt(this.source,1)),o=o.updateFor(e,i);for(let s of e.effects)if(s.is(Bs))o=new bt(o.source,1,s.value);else if(s.is(fo))o=new bt(o.source,0);else if(s.is(Ma))for(let r of s.value)r.source==o.source&&(o=r);return o}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(Gn(e.state))}}class bi extends bt{constructor(e,t,i,o,s,r){super(e,3,t),this.limit=i,this.result=o,this.from=s,this.to=r}hasResult(){return!0}updateFor(e,t){var i;if(!(t&3))return this.map(e.changes);let o=this.result;o.map&&!e.changes.empty&&(o=o.map(o,e.changes));let s=e.changes.mapPos(this.from),r=e.changes.mapPos(this.to,1),l=Gn(e.state);if(l>r||!o||t&2&&(Gn(e.startState)==this.from||l<this.limit))return new bt(this.source,t&4?1:0);let a=e.changes.mapPos(this.limit);return Px(o.validFor,e.state,s,r)?new bi(this.source,this.explicit,a,o,s,r):o.update&&(o=o.update(o,s,r,new ef(e.state,l,!1)))?new bi(this.source,this.explicit,a,o,o.from,(i=o.to)!==null&&i!==void 0?i:Gn(e.state)):new bt(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new bi(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new bt(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function Px(n,e,t,i){if(!n)return!1;let o=e.sliceDoc(t,i);return typeof n=="function"?n(o,t,i,e):nf(n,!0).test(o)}const Ma=Te.define({map(n,e){return n.map(t=>t.map(e))}}),rf=Te.define(),et=Dt.define({create(){return Ps.start()},update(n,e){return n.update(e)},provide:n=>[Md.from(n,e=>e.tooltip),re.contentAttributes.from(n,e=>e.attrs)]});function Oa(n,e){const t=e.completion.apply||e.completion.label;let i=n.state.field(et).active.find(o=>o.source==e.source);return i instanceof bi?(typeof t=="string"?n.dispatch({...Sx(n.state,t,i.from,i.to),annotations:of.of(e.completion)}):t(n,e.completion,i.from,i.to),!0):!1}const Ix=Mx(et,Oa);function Go(n,e="option"){return t=>{let i=t.state.field(et,!1);if(!i||!i.open||i.open.disabled||Date.now()-i.open.timestamp<t.state.facet(Ue).interactionDelay)return!1;let o=1,s;e=="page"&&(s=Od(t,i.open.tooltip))&&(o=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:r}=i.open.options,l=i.open.selected>-1?i.open.selected+o*(n?1:-1):n?0:r-1;return l<0?l=e=="page"?0:r-1:l>=r&&(l=e=="page"?r-1:0),t.dispatch({effects:rf.of(l)}),!0}}const zx=n=>{let e=n.state.field(et,!1);return n.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<n.state.facet(Ue).interactionDelay?!1:Oa(n,e.open.options[e.open.selected])},Ir=n=>n.state.field(et,!1)?(n.dispatch({effects:Bs.of(!0)}),!0):!1,Lx=n=>{let e=n.state.field(et,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(n.dispatch({effects:fo.of(null)}),!0)};class Fx{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const $x=50,Wx=1e3,Hx=Ct.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of n.state.field(et).active)e.isPending&&this.startQuery(e)}update(n){let e=n.state.field(et),t=n.state.facet(Ue);if(!n.selectionSet&&!n.docChanged&&n.startState.field(et)==e)return;let i=n.transactions.some(s=>{let r=sf(s,t);return r&8||(s.selection||s.docChanged)&&!(r&3)});for(let s=0;s<this.running.length;s++){let r=this.running[s];if(i||r.context.abortOnDocChange&&n.docChanged||r.updates.length+n.transactions.length>$x&&Date.now()-r.time>Wx){for(let l of r.context.abortListeners)try{l()}catch(a){ut(this.view.state,a)}r.context.abortListeners=null,this.running.splice(s--,1)}else r.updates.push(...n.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),n.transactions.some(s=>s.effects.some(r=>r.is(Bs)))&&(this.pendingStart=!0);let o=this.pendingStart?50:t.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.isPending&&!this.running.some(r=>r.active.source==s.source))?setTimeout(()=>this.startUpdate(),o):-1,this.composing!=0)for(let s of n.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:n}=this.view,e=n.field(et);for(let t of e.active)t.isPending&&!this.running.some(i=>i.active.source==t.source)&&this.startQuery(t);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Ue).updateSyncTime))}startQuery(n){let{state:e}=this.view,t=Gn(e),i=new ef(e,t,n.explicit,this.view),o=new Fx(n,i);this.running.push(o),Promise.resolve(n.source(i)).then(s=>{o.context.aborted||(o.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:fo.of(null)}),ut(this.view.state,s)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Ue).updateSyncTime))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(Ue),i=this.view.state.field(et);for(let o=0;o<this.running.length;o++){let s=this.running[o];if(s.done===void 0)continue;if(this.running.splice(o--,1),s.done){let l=Gn(s.updates.length?s.updates[0].startState:this.view.state),a=Math.min(l,s.done.from+(s.active.explicit?0:1)),c=new bi(s.active.source,s.active.explicit,a,s.done,s.done.from,(n=s.done.to)!==null&&n!==void 0?n:l);for(let h of s.updates)c=c.update(h,t);if(c.hasResult()){e.push(c);continue}}let r=i.active.find(l=>l.source==s.active.source);if(r&&r.isPending)if(s.done==null){let l=new bt(s.active.source,0);for(let a of s.updates)l=l.update(a,t);l.isPending||e.push(l)}else this.startQuery(r)}(e.length||i.open&&i.open.disabled)&&this.view.dispatch({effects:Ma.of(e)})}},{eventHandlers:{blur(n){let e=this.view.state.field(et,!1);if(e&&e.tooltip&&this.view.state.facet(Ue).closeOnBlur){let t=e.open&&Od(this.view,e.open.tooltip);(!t||!t.dom.contains(n.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:fo.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Bs.of(!1)}),20),this.composing=0}}}),Vx=typeof navigator=="object"&&/Win/.test(navigator.platform),Ux=ko.highest(re.domEventHandlers({keydown(n,e){let t=e.state.field(et,!1);if(!t||!t.open||t.open.disabled||t.open.selected<0||n.key.length>1||n.ctrlKey&&!(Vx&&n.altKey)||n.metaKey)return!1;let i=t.open.options[t.open.selected],o=t.active.find(r=>r.source==i.source),s=i.completion.commitCharacters||o.result.commitCharacters;return s&&s.indexOf(n.key)>-1&&Oa(e,i),!1}})),qx=re.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"Â·Â·Â·"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'Æ’'"}},".cm-completionIcon-class":{"&:after":{content:"'â—‹'"}},".cm-completionIcon-interface":{"&:after":{content:"'â—Œ'"}},".cm-completionIcon-variable":{"&:after":{content:"'ð‘¥'"}},".cm-completionIcon-constant":{"&:after":{content:"'ð¶'"}},".cm-completionIcon-type":{"&:after":{content:"'ð‘¡'"}},".cm-completionIcon-enum":{"&:after":{content:"'âˆª'"}},".cm-completionIcon-property":{"&:after":{content:"'â–¡'"}},".cm-completionIcon-keyword":{"&:after":{content:"'ðŸ”‘ï¸Ž'"}},".cm-completionIcon-namespace":{"&:after":{content:"'â–¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),lf=new class extends Mn{};lf.startSide=1;lf.endSide=-1;function Kx(n={}){return[Ux,et,Ue.of(n),Hx,Yx,qx]}const Qx=[{key:"Ctrl-Space",run:Ir},{mac:"Alt-`",run:Ir},{mac:"Alt-i",run:Ir},{key:"Escape",run:Lx},{key:"ArrowDown",run:Go(!0)},{key:"ArrowUp",run:Go(!1)},{key:"PageDown",run:Go(!0,"page")},{key:"PageUp",run:Go(!1,"page")},{key:"Enter",run:zx}],Yx=ko.highest(wa.computeN([Ue],n=>n.facet(Ue).defaultKeymap?[Qx]:[])),Xx=36,mh=1,Gx=2,oi=3,zr=4,Jx=5,Zx=6,eb=7,tb=8,nb=9,ib=10,ob=11,sb=12,rb=13,lb=14,ab=15,cb=16,hb=17,yh=18,ub=19,af=20,cf=21,xh=22,db=23,fb=24;function Ll(n){return n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57}function pb(n){return n>=48&&n<=57||n>=97&&n<=102||n>=65&&n<=70}function Wn(n,e,t){for(let i=!1;;){if(n.next<0)return;if(n.next==e&&!i){n.advance();return}i=t&&!i&&n.next==92,n.advance()}}function gb(n,e){e:for(;;){if(n.next<0)return;if(n.next==36){n.advance();for(let t=0;t<e.length;t++){if(n.next!=e.charCodeAt(t))continue e;n.advance()}if(n.next==36){n.advance();return}}else n.advance()}}function mb(n,e){let t="[{<(".indexOf(String.fromCharCode(e)),i=t<0?e:"]}>)".charCodeAt(t);for(;;){if(n.next<0)return;if(n.next==i&&n.peek(1)==39){n.advance(2);return}n.advance()}}function Fl(n,e){for(;!(n.next!=95&&!Ll(n.next));)e!=null&&(e+=String.fromCharCode(n.next)),n.advance();return e}function yb(n){if(n.next==39||n.next==34||n.next==96){let e=n.next;n.advance(),Wn(n,e,!1)}else Fl(n)}function bh(n,e){for(;n.next==48||n.next==49;)n.advance();e&&n.next==e&&n.advance()}function vh(n,e){for(;;){if(n.next==46){if(e)break;e=!0}else if(n.next<48||n.next>57)break;n.advance()}if(n.next==69||n.next==101)for(n.advance(),(n.next==43||n.next==45)&&n.advance();n.next>=48&&n.next<=57;)n.advance()}function wh(n){for(;!(n.next<0||n.next==10);)n.advance()}function Fn(n,e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)==n)return!0;return!1}const Lr=` 	\r
`;function hf(n,e,t){let i=Object.create(null);i.true=i.false=Jx,i.null=i.unknown=Zx;for(let o of n.split(" "))o&&(i[o]=af);for(let o of e.split(" "))o&&(i[o]=cf);for(let o of(t||"").split(" "))o&&(i[o]=fb);return i}const xb="array binary bit boolean char character clob date decimal double float int integer interval large national nchar nclob numeric object precision real smallint time timestamp varchar varying ",bb="absolute action add after all allocate alter and any are as asc assertion at authorization before begin between both breadth by call cascade cascaded case cast catalog check close collate collation column commit condition connect connection constraint constraints constructor continue corresponding count create cross cube current current_date current_default_transform_group current_transform_group_for_type current_path current_role current_time current_timestamp current_user cursor cycle data day deallocate declare default deferrable deferred delete depth deref desc describe descriptor deterministic diagnostics disconnect distinct do domain drop dynamic each else elseif end end-exec equals escape except exception exec execute exists exit external fetch first for foreign found from free full function general get global go goto grant group grouping handle having hold hour identity if immediate in indicator initially inner inout input insert intersect into is isolation join key language last lateral leading leave left level like limit local localtime localtimestamp locator loop map match method minute modifies module month names natural nesting new next no none not of old on only open option or order ordinality out outer output overlaps pad parameter partial path prepare preserve primary prior privileges procedure public read reads recursive redo ref references referencing relative release repeat resignal restrict result return returns revoke right role rollback rollup routine row rows savepoint schema scroll search second section select session session_user set sets signal similar size some space specific specifictype sql sqlexception sqlstate sqlwarning start state static system_user table temporary then timezone_hour timezone_minute to trailing transaction translation treat trigger under undo union unique unnest until update usage user using value values view when whenever where while with without work write year zone ",$l={backslashEscapes:!1,hashComments:!1,spaceAfterDashes:!1,slashComments:!1,doubleQuotedStrings:!1,doubleDollarQuotedStrings:!1,unquotedBitLiterals:!1,treatBitsAsBytes:!1,charSetCasts:!1,plsqlQuotingMechanism:!1,operatorChars:"*+-%<>!=&|~^/",specialVar:"?",identifierQuotes:'"',caseInsensitiveIdentifiers:!1,words:hf(bb,xb)};function vb(n,e,t,i){let o={};for(let s in $l)o[s]=(n.hasOwnProperty(s)?n:$l)[s];return e&&(o.words=hf(e,t||"",i)),o}function uf(n){return new dx(e=>{var t;let{next:i}=e;if(e.advance(),Fn(i,Lr)){for(;Fn(e.next,Lr);)e.advance();e.acceptToken(Xx)}else if(i==36&&n.doubleDollarQuotedStrings){let o=Fl(e,"");e.next==36&&(e.advance(),gb(e,o),e.acceptToken(oi))}else if(i==39||i==34&&n.doubleQuotedStrings)Wn(e,i,n.backslashEscapes),e.acceptToken(oi);else if(i==35&&n.hashComments||i==47&&e.next==47&&n.slashComments)wh(e),e.acceptToken(mh);else if(i==45&&e.next==45&&(!n.spaceAfterDashes||e.peek(1)==32))wh(e),e.acceptToken(mh);else if(i==47&&e.next==42){e.advance();for(let o=1;;){let s=e.next;if(e.next<0)break;if(e.advance(),s==42&&e.next==47){if(o--,e.advance(),!o)break}else s==47&&e.next==42&&(o++,e.advance())}e.acceptToken(Gx)}else if((i==101||i==69)&&e.next==39)e.advance(),Wn(e,39,!0),e.acceptToken(oi);else if((i==110||i==78)&&e.next==39&&n.charSetCasts)e.advance(),Wn(e,39,n.backslashEscapes),e.acceptToken(oi);else if(i==95&&n.charSetCasts)for(let o=0;;o++){if(e.next==39&&o>1){e.advance(),Wn(e,39,n.backslashEscapes),e.acceptToken(oi);break}if(!Ll(e.next))break;e.advance()}else if(n.plsqlQuotingMechanism&&(i==113||i==81)&&e.next==39&&e.peek(1)>0&&!Fn(e.peek(1),Lr)){let o=e.peek(1);e.advance(2),mb(e,o),e.acceptToken(oi)}else if(Fn(i,n.identifierQuotes)){const o=i==91?93:i;Wn(e,o,!1),e.acceptToken(ub)}else if(i==40)e.acceptToken(eb);else if(i==41)e.acceptToken(tb);else if(i==123)e.acceptToken(nb);else if(i==125)e.acceptToken(ib);else if(i==91)e.acceptToken(ob);else if(i==93)e.acceptToken(sb);else if(i==59)e.acceptToken(rb);else if(n.unquotedBitLiterals&&i==48&&e.next==98)e.advance(),bh(e),e.acceptToken(xh);else if((i==98||i==66)&&(e.next==39||e.next==34)){const o=e.next;e.advance(),n.treatBitsAsBytes?(Wn(e,o,n.backslashEscapes),e.acceptToken(db)):(bh(e,o),e.acceptToken(xh))}else if(i==48&&(e.next==120||e.next==88)||(i==120||i==88)&&e.next==39){let o=e.next==39;for(e.advance();pb(e.next);)e.advance();o&&e.next==39&&e.advance(),e.acceptToken(zr)}else if(i==46&&e.next>=48&&e.next<=57)vh(e,!0),e.acceptToken(zr);else if(i==46)e.acceptToken(lb);else if(i>=48&&i<=57)vh(e,!1),e.acceptToken(zr);else if(Fn(i,n.operatorChars)){for(;Fn(e.next,n.operatorChars);)e.advance();e.acceptToken(ab)}else if(Fn(i,n.specialVar))e.next==i&&e.advance(),yb(e),e.acceptToken(hb);else if(i==58||i==44)e.acceptToken(cb);else if(Ll(i)){let o=Fl(e,String.fromCharCode(i));e.acceptToken(e.next==46||e.peek(-o.length-1)==46?yh:(t=n.words[o.toLowerCase()])!==null&&t!==void 0?t:yh)}})}const df=uf($l),wb=Ds.deserialize({version:14,states:"%vQ]QQOOO#wQRO'#DSO$OQQO'#CwO%eQQO'#CxO%lQQO'#CyO%sQQO'#CzOOQQ'#DS'#DSOOQQ'#C}'#C}O'UQRO'#C{OOQQ'#Cv'#CvOOQQ'#C|'#C|Q]QQOOQOQQOOO'`QQO'#DOO(xQRO,59cO)PQQO,59cO)UQQO'#DSOOQQ,59d,59dO)cQQO,59dOOQQ,59e,59eO)jQQO,59eOOQQ,59f,59fO)qQQO,59fOOQQ-E6{-E6{OOQQ,59b,59bOOQQ-E6z-E6zOOQQ,59j,59jOOQQ-E6|-E6|O+VQRO1G.}O+^QQO,59cOOQQ1G/O1G/OOOQQ1G/P1G/POOQQ1G/Q1G/QP+kQQO'#C}O+rQQO1G.}O)PQQO,59cO,PQQO'#Cw",stateData:",[~OtOSPOSQOS~ORUOSUOTUOUUOVROXSOZTO]XO^QO_UO`UOaPObPOcPOdUOeUOfUOgUOhUO~O^]ORvXSvXTvXUvXVvXXvXZvX]vX_vX`vXavXbvXcvXdvXevXfvXgvXhvX~OsvX~P!jOa_Ob_Oc_O~ORUOSUOTUOUUOVROXSOZTO^tO_UO`UOa`Ob`Oc`OdUOeUOfUOgUOhUO~OWaO~P$ZOYcO~P$ZO[eO~P$ZORUOSUOTUOUUOVROXSOZTO^QO_UO`UOaPObPOcPOdUOeUOfUOgUOhUO~O]hOsoX~P%zOajObjOcjO~O^]ORkaSkaTkaUkaVkaXkaZka]ka_ka`kaakabkackadkaekafkagkahka~Oska~P'kO^]O~OWvXYvX[vX~P!jOWnO~P$ZOYoO~P$ZO[pO~P$ZO^]ORkiSkiTkiUkiVkiXkiZki]ki_ki`kiakibkickidkiekifkigkihki~Oski~P)xOWkaYka[ka~P'kO]hO~P$ZOWkiYki[ki~P)xOasObsOcsO~O",goto:"#hwPPPPPPPPPPPPPPPPPPPPPPPPPPx||||!Y!^!d!xPPP#[TYOZeUORSTWZbdfqT[OZQZORiZSWOZQbRQdSQfTZgWbdfqQ^PWk^lmrQl_Qm`RrseVORSTWZbdfq",nodeNames:"âš  LineComment BlockComment String Number Bool Null ( ) { } [ ] ; . Operator Punctuation SpecialVar Identifier QuotedIdentifier Keyword Type Bits Bytes Builtin Script Statement CompositeIdentifier Parens Braces Brackets Statement",maxTerm:38,nodeProps:[["isolate",-4,1,2,3,19,""]],skippedNodes:[0,1,2],repeatNodeCount:3,tokenData:"RORO",tokenizers:[0,df],topRules:{Script:[0,25]},tokenPrec:0});function Wl(n){let e=n.cursor().moveTo(n.from,-1);for(;/Comment/.test(e.name);)e.moveTo(e.from,-1);return e.node}function po(n,e){let t=n.sliceString(e.from,e.to),i=/^([`'"\[])(.*)([`'"\]])$/.exec(t);return i?i[2]:t}function Is(n){return n&&(n.name=="Identifier"||n.name=="QuotedIdentifier")}function Sb(n,e){if(e.name=="CompositeIdentifier"){let t=[];for(let i=e.firstChild;i;i=i.nextSibling)Is(i)&&t.push(po(n,i));return t}return[po(n,e)]}function Sh(n,e){for(let t=[];;){if(!e||e.name!=".")return t;let i=Wl(e);if(!Is(i))return t;t.unshift(po(n,i)),e=Wl(i)}}function kb(n,e){let t=dt(n).resolveInner(e,-1),i=Tb(n.doc,t);return t.name=="Identifier"||t.name=="QuotedIdentifier"||t.name=="Keyword"?{from:t.from,quoted:t.name=="QuotedIdentifier"?n.doc.sliceString(t.from,t.from+1):null,parents:Sh(n.doc,Wl(t)),aliases:i}:t.name=="."?{from:e,quoted:null,parents:Sh(n.doc,t),aliases:i}:{from:e,quoted:null,parents:[],empty:!0,aliases:i}}const Cb=new Set("where group having order union intersect except all distinct limit offset fetch for".split(" "));function Tb(n,e){let t;for(let o=e;!t;o=o.parent){if(!o)return null;o.name=="Statement"&&(t=o)}let i=null;for(let o=t.firstChild,s=!1,r=null;o;o=o.nextSibling){let l=o.name=="Keyword"?n.sliceString(o.from,o.to).toLowerCase():null,a=null;if(!s)s=l=="from";else if(l=="as"&&r&&Is(o.nextSibling))a=po(n,o.nextSibling);else{if(l&&Cb.has(l))break;r&&Is(o)&&(a=po(n,o))}a&&(i||(i=Object.create(null)),i[a]=Sb(n,r)),r=/Identifier$/.test(o.name)?o:null}return i}function Eb(n,e,t){return t.map(i=>({...i,label:i.label[0]==n?i.label:n+i.label+e,apply:void 0}))}const Ab=/^\w*$/,_b=/^[`'"\[]?\w*[`'"\]]?$/;function kh(n){return n.self&&typeof n.self.label=="string"}class Na{constructor(e,t){this.idQuote=e,this.idCaseInsensitive=t,this.list=[],this.children=void 0}child(e){let t=this.children||(this.children=Object.create(null)),i=t[e];return i||(e&&!this.list.some(o=>o.label==e)&&this.list.push(Ch(e,"type",this.idQuote,this.idCaseInsensitive)),t[e]=new Na(this.idQuote,this.idCaseInsensitive))}maybeChild(e){return this.children?this.children[e]:null}addCompletion(e){let t=this.list.findIndex(i=>i.label==e.label);t>-1?this.list[t]=e:this.list.push(e)}addCompletions(e){for(let t of e)this.addCompletion(typeof t=="string"?Ch(t,"property",this.idQuote,this.idCaseInsensitive):t)}addNamespace(e){Array.isArray(e)?this.addCompletions(e):kh(e)?this.addNamespace(e.children):this.addNamespaceObject(e)}addNamespaceObject(e){for(let t of Object.keys(e)){let i=e[t],o=null,s=t.replace(/\\?\./g,l=>l=="."?"\0":l).split("\0"),r=this;kh(i)&&(o=i.self,i=i.children);for(let l=0;l<s.length;l++)o&&l==s.length-1&&r.addCompletion(o),r=r.child(s[l].replace(/\\\./g,"."));r.addNamespace(i)}}}function Ch(n,e,t,i){return new RegExp("^[a-z_][a-z_\\d]*$",i?"i":"").test(n)?{label:n,type:e}:{label:n,type:e,apply:t+n+ff(t)}}function ff(n){return n==="["?"]":n}function Mb(n,e,t,i,o,s){var r;let l=((r=s==null?void 0:s.spec.identifierQuotes)===null||r===void 0?void 0:r[0])||'"',a=new Na(l,!!(s!=null&&s.spec.caseInsensitiveIdentifiers)),c=o?a.child(o):null;return a.addNamespace(n),e&&(c||a).addCompletions(e),t&&a.addCompletions(t),c&&a.addCompletions(c.list),i&&a.addCompletions((c||a).child(i).list),h=>{let{parents:u,from:p,quoted:g,empty:y,aliases:m}=kb(h.state,h.pos);if(y&&!h.explicit)return null;m&&u.length==1&&(u=m[u[0]]||u);let b=a;for(let T of u){for(;!b.children||!b.children[T];)if(b==a&&c)b=c;else if(b==c&&i)b=b.child(i);else return null;let k=b.maybeChild(T);if(!k)return null;b=k}let x=b.list;if(b==a&&m&&(x=x.concat(Object.keys(m).map(T=>({label:T,type:"constant"})))),g){let T=g[0],k=ff(T),E=h.state.sliceDoc(h.pos,h.pos+1)==k;return{from:p,to:E?h.pos+1:void 0,options:Eb(T,k,x),validFor:_b}}else return{from:p,options:x,validFor:Ab}}}function Ob(n){return n==cf?"type":n==af?"keyword":"variable"}function Nb(n,e,t){let i=Object.keys(n).map(o=>t(e?o.toUpperCase():o,Ob(n[o])));return wx(["QuotedIdentifier","String","LineComment","BlockComment","."],tf(i))}let Rb=wb.configure({props:[Vd.add({Statement:Dy()}),qd.add({Statement(n,e){return{from:Math.min(n.from+100,e.doc.lineAt(n.from).to),to:n.to}},BlockComment(n){return{from:n.from+2,to:n.to-2}}}),zd({Keyword:K.keyword,Type:K.typeName,Builtin:K.standard(K.name),Bits:K.number,Bytes:K.string,Bool:K.bool,Null:K.null,Number:K.number,String:K.string,Identifier:K.name,QuotedIdentifier:K.special(K.string),SpecialVar:K.special(K.name),LineComment:K.lineComment,BlockComment:K.blockComment,Operator:K.operator,"Semi Punctuation":K.punctuation,"( )":K.paren,"{ }":K.brace,"[ ]":K.squareBracket})]});class zs{constructor(e,t,i){this.dialect=e,this.language=t,this.spec=i}get extension(){return this.language.extension}configureLanguage(e,t){return new zs(this.dialect,this.language.configure(e,t),this.spec)}static define(e){let t=vb(e,e.keywords,e.types,e.builtin),i=Ms.define({name:"sql",parser:Rb.configure({tokenizers:[{from:df,to:uf(t)}]}),languageData:{commentTokens:{line:"--",block:{open:"/*",close:"*/"}},closeBrackets:{brackets:["(","[","{","'",'"',"`"]}}});return new zs(t,i,e)}}function jb(n,e){return{label:n,type:e,boost:-1}}function Db(n,e=!1,t){return Nb(n.dialect.words,e,t||jb)}function Bb(n){return n.schema?Mb(n.schema,n.tables,n.schemas,n.defaultTable,n.defaultSchema,n.dialect||Ra):()=>null}function Pb(n){return n.schema?(n.dialect||Ra).language.data.of({autocomplete:Bb(n)}):[]}function Ib(n={}){let e=n.dialect||Ra;return new Sy(e.language,[Pb(n),e.language.data.of({autocomplete:Db(e,n.upperCaseKeywords,n.keywordCompletion)})])}const Ra=zs.define({}),Th=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class pf{constructor(e,t,i=0,o=e.length,s,r){this.test=r,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,o),this.bufferStart=i,this.normalize=s?l=>s(Th(l)):Th,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return xn(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=ku(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=Vn(e);let o=this.normalize(t);if(o.length)for(let s=0,r=i;;s++){let l=o.charCodeAt(s),a=this.match(l,r,this.bufferPos+this.bufferStart);if(s==o.length-1){if(a)return this.value=a,this;break}r==i&&s<t.length&&t.charCodeAt(s)==l&&r++}}}match(e,t,i){let o=null;for(let s=0;s<this.matches.length;s+=2){let r=this.matches[s],l=!1;this.query.charCodeAt(r)==e&&(r==this.query.length-1?o={from:this.matches[s+1],to:i}:(this.matches[s]++,l=!0)),l||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?o={from:t,to:i}:this.matches.push(1,t)),o&&this.test&&!this.test(o.from,o.to,this.buffer,this.bufferStart)&&(o=null),o}}typeof Symbol<"u"&&(pf.prototype[Symbol.iterator]=function(){return this});const zb={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},gf=ne.define({combine(n){return Di(n,zb,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function Lb(n){let e=[Vb,Hb];return n&&e.push(gf.of(n)),e}const Fb=pe.mark({class:"cm-selectionMatch"}),$b=pe.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Eh(n,e,t,i){return(t==0||n(e.sliceDoc(t-1,t))!=ht.Word)&&(i==e.doc.length||n(e.sliceDoc(i,i+1))!=ht.Word)}function Wb(n,e,t,i){return n(e.sliceDoc(t,t+1))==ht.Word&&n(e.sliceDoc(i-1,i))==ht.Word}const Hb=Ct.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(gf),{state:t}=n,i=t.selection;if(i.ranges.length>1)return pe.none;let o=i.main,s,r=null;if(o.empty){if(!e.highlightWordAroundCursor)return pe.none;let a=t.wordAt(o.head);if(!a)return pe.none;r=t.charCategorizer(o.head),s=t.sliceDoc(a.from,a.to)}else{let a=o.to-o.from;if(a<e.minSelectionLength||a>200)return pe.none;if(e.wholeWords){if(s=t.sliceDoc(o.from,o.to),r=t.charCategorizer(o.head),!(Eh(r,t,o.from,o.to)&&Wb(r,t,o.from,o.to)))return pe.none}else if(s=t.sliceDoc(o.from,o.to),!s)return pe.none}let l=[];for(let a of n.visibleRanges){let c=new pf(t.doc,s,a.from,a.to);for(;!c.next().done;){let{from:h,to:u}=c.value;if((!r||Eh(r,t,h,u))&&(o.empty&&h<=o.from&&u>=o.to?l.push($b.range(h,u)):(h>=o.to||u<=o.from)&&l.push(Fb.range(h,u)),l.length>e.maxMatches))return pe.none}}return pe.set(l)}},{decorations:n=>n.decorations}),Vb=re.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Hl=fn.define(),Ub=fn.define(),qb=ne.define(),mf=ne.define({combine(n){return Di(n,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,o)=>e(i,o)||t(i,o)})}}),yf=Dt.define({create(){return Yt.empty},update(n,e){let t=e.state.facet(mf),i=e.annotation(Hl);if(i){let a=nt.fromTransaction(e,i.selection),c=i.side,h=c==0?n.undone:n.done;return a?h=Ls(h,h.length,t.minDepth,a):h=vf(h,e.startState.selection),new Yt(c==0?i.rest:h,c==0?h:i.rest)}let o=e.annotation(Ub);if((o=="full"||o=="before")&&(n=n.isolate()),e.annotation(We.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let s=nt.fromTransaction(e),r=e.annotation(We.time),l=e.annotation(We.userEvent);return s?n=n.addChanges(s,r,l,t,e):e.selection&&(n=n.addSelection(e.startState.selection,r,l,t.newGroupDelay)),(o=="full"||o=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new Yt(n.done.map(nt.fromJSON),n.undone.map(nt.fromJSON))}});function Kb(n={}){return[yf,mf.of(n),re.domEventHandlers({beforeinput(e,t){let i=e.inputType=="historyUndo"?xf:e.inputType=="historyRedo"?Vl:null;return i?(e.preventDefault(),i(t)):!1}})]}function tr(n,e){return function({state:t,dispatch:i}){if(!e&&t.readOnly)return!1;let o=t.field(yf,!1);if(!o)return!1;let s=o.pop(n,t,e);return s?(i(s),!0):!1}}const xf=tr(0,!1),Vl=tr(1,!1),Qb=tr(0,!0),Yb=tr(1,!0);class nt{constructor(e,t,i,o,s){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=o,this.selectionsAfter=s}setSelAfter(e){return new nt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(o=>o.toJSON())}}static fromJSON(e){return new nt(e.changes&&$e.fromJSON(e.changes),[],e.mapped&&Xt.fromJSON(e.mapped),e.startSelection&&te.fromJSON(e.startSelection),e.selectionsAfter.map(te.fromJSON))}static fromTransaction(e,t){let i=vt;for(let o of e.startState.facet(qb)){let s=o(e);s.length&&(i=i.concat(s))}return!i.length&&e.changes.empty?null:new nt(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,vt)}static selection(e){return new nt(void 0,vt,void 0,void 0,e)}}function Ls(n,e,t,i){let o=e+1>t+20?e-t-1:0,s=n.slice(o,e);return s.push(i),s}function Xb(n,e){let t=[],i=!1;return n.iterChangedRanges((o,s)=>t.push(o,s)),e.iterChangedRanges((o,s,r,l)=>{for(let a=0;a<t.length;){let c=t[a++],h=t[a++];l>=c&&r<=h&&(i=!0)}}),i}function Gb(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,i)=>t.empty!=e.ranges[i].empty).length===0}function bf(n,e){return n.length?e.length?n.concat(e):n:e}const vt=[],Jb=200;function vf(n,e){if(n.length){let t=n[n.length-1],i=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-Jb));return i.length&&i[i.length-1].eq(e)?n:(i.push(e),Ls(n,n.length-1,1e9,t.setSelAfter(i)))}else return[nt.selection([e])]}function Zb(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Fr(n,e){if(!n.length)return n;let t=n.length,i=vt;for(;t;){let o=e1(n[t-1],e,i);if(o.changes&&!o.changes.empty||o.effects.length){let s=n.slice(0,t);return s[t-1]=o,s}else e=o.mapped,t--,i=o.selectionsAfter}return i.length?[nt.selection(i)]:vt}function e1(n,e,t){let i=bf(n.selectionsAfter.length?n.selectionsAfter.map(l=>l.map(e)):vt,t);if(!n.changes)return nt.selection(i);let o=n.changes.map(e),s=e.mapDesc(n.changes,!0),r=n.mapped?n.mapped.composeDesc(s):s;return new nt(o,Te.mapEffects(n.effects,e),r,n.startSelection.map(s),i)}const t1=/^(input\.type|delete)($|\.)/;class Yt{constructor(e,t,i=0,o=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=o}isolate(){return this.prevTime?new Yt(this.done,this.undone):this}addChanges(e,t,i,o,s){let r=this.done,l=r[r.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!i||t1.test(i))&&(!l.selectionsAfter.length&&t-this.prevTime<o.newGroupDelay&&o.joinToEvent(s,Xb(l.changes,e.changes))||i=="input.type.compose")?r=Ls(r,r.length-1,o.minDepth,new nt(e.changes.compose(l.changes),bf(Te.mapEffects(e.effects,l.changes),l.effects),l.mapped,l.startSelection,vt)):r=Ls(r,r.length,o.minDepth,e),new Yt(r,vt,t,i)}addSelection(e,t,i,o){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:vt;return s.length>0&&t-this.prevTime<o&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&Gb(s[s.length-1],e)?this:new Yt(vf(this.done,e),this.undone,t,i)}addMapping(e){return new Yt(Fr(this.done,e),Fr(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let o=e==0?this.done:this.undone;if(o.length==0)return null;let s=o[o.length-1],r=s.selectionsAfter[0]||t.selection;if(i&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Hl.of({side:e,rest:Zb(o),selection:r}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let l=o.length==1?vt:o.slice(0,o.length-1);return s.mapped&&(l=Fr(l,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Hl.of({side:e,rest:l,selection:r}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}Yt.empty=new Yt(vt,vt);const n1=[{key:"Mod-z",run:xf,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Vl,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Vl,preventDefault:!0},{key:"Mod-u",run:Qb,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Yb,preventDefault:!0}],i1=wg.div`
  border: 1px solid ${Zr.colors.border.medium};
  border-radius: ${Zr.borderRadius.md};
  overflow: hidden;
  font-size: 0.9em;
  
  .cm-editor {
    min-height: 150px;
  }
  
  .cm-scroller {
    font-family: "Consolas, 'Source Code Pro', monospace";
  }
`,o1=["SELECT","FROM","WHERE","JOIN","INNER","LEFT","RIGHT","FULL","OUTER","ON","AND","OR","NOT","IN","LIKE","BETWEEN","IS","NULL","AS","ORDER","BY","GROUP","HAVING","LIMIT","OFFSET","DISTINCT","COUNT","SUM","AVG","MAX","MIN","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","TABLE","ALTER","DROP","INDEX","UNIQUE","PRIMARY","KEY","FOREIGN","REFERENCES","CONSTRAINT","DEFAULT","CHECK","UNION","ALL","EXCEPT","INTERSECT","CASE","WHEN","THEN","ELSE","END","CAST","CONVERT","EXISTS","ANY","SOME","EXTRACT","DATE","TIME","TIMESTAMP","INTERVAL"],s1=({value:n,onChange:e,placeholder:t="SELECT * FROM table_name WHERE condition...",schemas:i=[],tables:o=[],columns:s=[]})=>{const r=N.useRef(null),l=N.useRef(null);return N.useEffect(()=>{if(!r.current)return;const a=Kx({override:[u=>{var T;const p=u.matchBefore(/\w*/);if(!p)return null;const g=[],y=u.state.doc.toString(),m=u.pos,x=((T=y.substring(0,m).match(/(\w+\.)*\w*$/))==null?void 0:T[0])||"";if(x.includes(".")){const k=x.split(".");if(k.length===1)i.forEach(E=>{g.push({label:E,type:"schema",info:"Schema"})});else if(k.length===2){const E=k[0];o.forEach(M=>{g.push({label:`${E}.${M}`,type:"table",info:"Table"})})}else if(k.length===3){const E=k.slice(0,2).join(".");s.forEach(M=>{g.push({label:`${E}.${M}`,type:"column",info:"Column"})})}}else o1.forEach(k=>{k.toLowerCase().startsWith(p.text.toLowerCase())&&g.push({label:k,type:"keyword",info:"SQL Keyword"})}),i.forEach(k=>{k.toLowerCase().startsWith(p.text.toLowerCase())&&g.push({label:k,type:"schema",info:"Schema"})}),o.forEach(k=>{k.toLowerCase().startsWith(p.text.toLowerCase())&&g.push({label:k,type:"table",info:"Table"})}),s.forEach(k=>{k.toLowerCase().startsWith(p.text.toLowerCase())&&g.push({label:k,type:"column",info:"Column"})});return{from:p.from,options:g.slice(0,50)}}]}),c=we.create({doc:n,extensions:[ny(),Kb(),Uy(),Py(),ix(),Lb(),Ky(Xy),Ib(),a,wa.of([...n1]),re.updateListener.of(u=>{if(u.docChanged){const p=u.state.doc.toString();e(p)}}),re.theme({"&":{fontSize:"0.9em"},".cm-content":{minHeight:"150px",padding:"8px"},".cm-focused":{outline:`2px solid ${Zr.colors.primary.main}33`,outlineOffset:"-2px"}}),we.tabSize.of(2)]}),h=new re({state:c,parent:r.current});return l.current=h,()=>{h.destroy()}},[]),N.useEffect(()=>{l.current&&n!==l.current.state.doc.toString()&&l.current.dispatch({changes:{from:0,to:l.current.state.doc.length,insert:n}})},[n]),d.jsx(i1,{ref:r})};function Xe(n){if(typeof n=="string"||typeof n=="number")return""+n;let e="";if(Array.isArray(n))for(let t=0,i;t<n.length;t++)(i=Xe(n[t]))!==""&&(e+=(e&&" ")+i);else for(let t in n)n[t]&&(e+=(e&&" ")+t);return e}var wf={exports:{}},Sf={},kf={exports:{}},Cf={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oi=N;function r1(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var l1=typeof Object.is=="function"?Object.is:r1,a1=Oi.useState,c1=Oi.useEffect,h1=Oi.useLayoutEffect,u1=Oi.useDebugValue;function d1(n,e){var t=e(),i=a1({inst:{value:t,getSnapshot:e}}),o=i[0].inst,s=i[1];return h1(function(){o.value=t,o.getSnapshot=e,$r(o)&&s({inst:o})},[n,t,e]),c1(function(){return $r(o)&&s({inst:o}),n(function(){$r(o)&&s({inst:o})})},[n]),u1(t),t}function $r(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!l1(n,t)}catch{return!0}}function f1(n,e){return e()}var p1=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f1:d1;Cf.useSyncExternalStore=Oi.useSyncExternalStore!==void 0?Oi.useSyncExternalStore:p1;kf.exports=Cf;var g1=kf.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nr=N,m1=g1;function y1(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var x1=typeof Object.is=="function"?Object.is:y1,b1=m1.useSyncExternalStore,v1=nr.useRef,w1=nr.useEffect,S1=nr.useMemo,k1=nr.useDebugValue;Sf.useSyncExternalStoreWithSelector=function(n,e,t,i,o){var s=v1(null);if(s.current===null){var r={hasValue:!1,value:null};s.current=r}else r=s.current;s=S1(function(){function a(g){if(!c){if(c=!0,h=g,g=i(g),o!==void 0&&r.hasValue){var y=r.value;if(o(y,g))return u=y}return u=g}if(y=u,x1(h,g))return y;var m=i(g);return o!==void 0&&o(y,m)?(h=g,y):(h=g,u=m)}var c=!1,h,u,p=t===void 0?null:t;return[function(){return a(e())},p===null?void 0:function(){return a(p())}]},[e,t,i,o]);var l=b1(n,s[0],s[1]);return w1(function(){r.hasValue=!0,r.value=l},[l]),k1(l),l};wf.exports=Sf;var C1=wf.exports;const T1=Sg(C1),Ah=n=>{let e;const t=new Set,i=(h,u)=>{const p=typeof h=="function"?h(e):h;if(!Object.is(p,e)){const g=e;e=u??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(y=>y(e,g))}},o=()=>e,a={setState:i,getState:o,getInitialState:()=>c,subscribe:h=>(t.add(h),()=>t.delete(h)),destroy:()=>{t.clear()}},c=e=n(i,o,a);return a},E1=n=>n?Ah(n):Ah,{useDebugValue:A1}=H,{useSyncExternalStoreWithSelector:_1}=T1,M1=n=>n;function Tf(n,e=M1,t){const i=_1(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return A1(i),i}const _h=(n,e)=>{const t=E1(n),i=(o,s=e)=>Tf(t,o,s);return Object.assign(i,t),i},O1=(n,e)=>n?_h(n,e):_h;function qe(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(const[i,o]of n)if(!Object.is(o,e.get(i)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(const i of n)if(!e.has(i))return!1;return!0}const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(const i of t)if(!Object.prototype.hasOwnProperty.call(e,i)||!Object.is(n[i],e[i]))return!1;return!0}var N1={value:()=>{}};function ir(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new ps(t)}function ps(n){this._=n}function R1(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",o=t.indexOf(".");if(o>=0&&(i=t.slice(o+1),t=t.slice(0,o)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}ps.prototype=ir.prototype={constructor:ps,on:function(n,e){var t=this._,i=R1(n+"",t),o,s=-1,r=i.length;if(arguments.length<2){for(;++s<r;)if((o=(n=i[s]).type)&&(o=j1(t[o],n.name)))return o;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<r;)if(o=(n=i[s]).type)t[o]=Mh(t[o],n.name,e);else if(e==null)for(o in t)t[o]=Mh(t[o],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new ps(n)},call:function(n,e){if((o=arguments.length-2)>0)for(var t=new Array(o),i=0,o,s;i<o;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],i=0,o=s.length;i<o;++i)s[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],o=0,s=i.length;o<s;++o)i[o].value.apply(e,t)}};function j1(n,e){for(var t=0,i=n.length,o;t<i;++t)if((o=n[t]).name===e)return o.value}function Mh(n,e,t){for(var i=0,o=n.length;i<o;++i)if(n[i].name===e){n[i]=N1,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var Ul="http://www.w3.org/1999/xhtml";const Oh={svg:"http://www.w3.org/2000/svg",xhtml:Ul,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function or(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),Oh.hasOwnProperty(e)?{space:Oh[e],local:n}:n}function D1(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Ul&&e.documentElement.namespaceURI===Ul?e.createElement(n):e.createElementNS(t,n)}}function B1(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Ef(n){var e=or(n);return(e.local?B1:D1)(e)}function P1(){}function ja(n){return n==null?P1:function(){return this.querySelector(n)}}function I1(n){typeof n!="function"&&(n=ja(n));for(var e=this._groups,t=e.length,i=new Array(t),o=0;o<t;++o)for(var s=e[o],r=s.length,l=i[o]=new Array(r),a,c,h=0;h<r;++h)(a=s[h])&&(c=n.call(a,a.__data__,h,s))&&("__data__"in a&&(c.__data__=a.__data__),l[h]=c);return new ft(i,this._parents)}function z1(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function L1(){return[]}function Af(n){return n==null?L1:function(){return this.querySelectorAll(n)}}function F1(n){return function(){return z1(n.apply(this,arguments))}}function $1(n){typeof n=="function"?n=F1(n):n=Af(n);for(var e=this._groups,t=e.length,i=[],o=[],s=0;s<t;++s)for(var r=e[s],l=r.length,a,c=0;c<l;++c)(a=r[c])&&(i.push(n.call(a,a.__data__,c,r)),o.push(a));return new ft(i,o)}function _f(n){return function(){return this.matches(n)}}function Mf(n){return function(e){return e.matches(n)}}var W1=Array.prototype.find;function H1(n){return function(){return W1.call(this.children,n)}}function V1(){return this.firstElementChild}function U1(n){return this.select(n==null?V1:H1(typeof n=="function"?n:Mf(n)))}var q1=Array.prototype.filter;function K1(){return Array.from(this.children)}function Q1(n){return function(){return q1.call(this.children,n)}}function Y1(n){return this.selectAll(n==null?K1:Q1(typeof n=="function"?n:Mf(n)))}function X1(n){typeof n!="function"&&(n=_f(n));for(var e=this._groups,t=e.length,i=new Array(t),o=0;o<t;++o)for(var s=e[o],r=s.length,l=i[o]=[],a,c=0;c<r;++c)(a=s[c])&&n.call(a,a.__data__,c,s)&&l.push(a);return new ft(i,this._parents)}function Of(n){return new Array(n.length)}function G1(){return new ft(this._enter||this._groups.map(Of),this._parents)}function Fs(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Fs.prototype={constructor:Fs,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function J1(n){return function(){return n}}function Z1(n,e,t,i,o,s){for(var r=0,l,a=e.length,c=s.length;r<c;++r)(l=e[r])?(l.__data__=s[r],i[r]=l):t[r]=new Fs(n,s[r]);for(;r<a;++r)(l=e[r])&&(o[r]=l)}function ev(n,e,t,i,o,s,r){var l,a,c=new Map,h=e.length,u=s.length,p=new Array(h),g;for(l=0;l<h;++l)(a=e[l])&&(p[l]=g=r.call(a,a.__data__,l,e)+"",c.has(g)?o[l]=a:c.set(g,a));for(l=0;l<u;++l)g=r.call(n,s[l],l,s)+"",(a=c.get(g))?(i[l]=a,a.__data__=s[l],c.delete(g)):t[l]=new Fs(n,s[l]);for(l=0;l<h;++l)(a=e[l])&&c.get(p[l])===a&&(o[l]=a)}function tv(n){return n.__data__}function nv(n,e){if(!arguments.length)return Array.from(this,tv);var t=e?ev:Z1,i=this._parents,o=this._groups;typeof n!="function"&&(n=J1(n));for(var s=o.length,r=new Array(s),l=new Array(s),a=new Array(s),c=0;c<s;++c){var h=i[c],u=o[c],p=u.length,g=iv(n.call(h,h&&h.__data__,c,i)),y=g.length,m=l[c]=new Array(y),b=r[c]=new Array(y),x=a[c]=new Array(p);t(h,u,m,b,x,g,e);for(var T=0,k=0,E,M;T<y;++T)if(E=m[T]){for(T>=k&&(k=T+1);!(M=b[k])&&++k<y;);E._next=M||null}}return r=new ft(r,i),r._enter=l,r._exit=a,r}function iv(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function ov(){return new ft(this._exit||this._groups.map(Of),this._parents)}function sv(n,e,t){var i=this.enter(),o=this,s=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(o=e(o),o&&(o=o.selection())),t==null?s.remove():t(s),i&&o?i.merge(o).order():o}function rv(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,o=t.length,s=i.length,r=Math.min(o,s),l=new Array(o),a=0;a<r;++a)for(var c=t[a],h=i[a],u=c.length,p=l[a]=new Array(u),g,y=0;y<u;++y)(g=c[y]||h[y])&&(p[y]=g);for(;a<o;++a)l[a]=t[a];return new ft(l,this._parents)}function lv(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],o=i.length-1,s=i[o],r;--o>=0;)(r=i[o])&&(s&&r.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(r,s),s=r);return this}function av(n){n||(n=cv);function e(u,p){return u&&p?n(u.__data__,p.__data__):!u-!p}for(var t=this._groups,i=t.length,o=new Array(i),s=0;s<i;++s){for(var r=t[s],l=r.length,a=o[s]=new Array(l),c,h=0;h<l;++h)(c=r[h])&&(a[h]=c);a.sort(e)}return new ft(o,this._parents).order()}function cv(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function hv(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function uv(){return Array.from(this)}function dv(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],o=0,s=i.length;o<s;++o){var r=i[o];if(r)return r}return null}function fv(){let n=0;for(const e of this)++n;return n}function pv(){return!this.node()}function gv(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var o=e[t],s=0,r=o.length,l;s<r;++s)(l=o[s])&&n.call(l,l.__data__,s,o);return this}function mv(n){return function(){this.removeAttribute(n)}}function yv(n){return function(){this.removeAttributeNS(n.space,n.local)}}function xv(n,e){return function(){this.setAttribute(n,e)}}function bv(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function vv(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function wv(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function Sv(n,e){var t=or(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?yv:mv:typeof e=="function"?t.local?wv:vv:t.local?bv:xv)(t,e))}function Nf(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function kv(n){return function(){this.style.removeProperty(n)}}function Cv(n,e,t){return function(){this.style.setProperty(n,e,t)}}function Tv(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function Ev(n,e,t){return arguments.length>1?this.each((e==null?kv:typeof e=="function"?Tv:Cv)(n,e,t??"")):Ni(this.node(),n)}function Ni(n,e){return n.style.getPropertyValue(e)||Nf(n).getComputedStyle(n,null).getPropertyValue(e)}function Av(n){return function(){delete this[n]}}function _v(n,e){return function(){this[n]=e}}function Mv(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function Ov(n,e){return arguments.length>1?this.each((e==null?Av:typeof e=="function"?Mv:_v)(n,e)):this.node()[n]}function Rf(n){return n.trim().split(/^|\s+/)}function Da(n){return n.classList||new jf(n)}function jf(n){this._node=n,this._names=Rf(n.getAttribute("class")||"")}jf.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function Df(n,e){for(var t=Da(n),i=-1,o=e.length;++i<o;)t.add(e[i])}function Bf(n,e){for(var t=Da(n),i=-1,o=e.length;++i<o;)t.remove(e[i])}function Nv(n){return function(){Df(this,n)}}function Rv(n){return function(){Bf(this,n)}}function jv(n,e){return function(){(e.apply(this,arguments)?Df:Bf)(this,n)}}function Dv(n,e){var t=Rf(n+"");if(arguments.length<2){for(var i=Da(this.node()),o=-1,s=t.length;++o<s;)if(!i.contains(t[o]))return!1;return!0}return this.each((typeof e=="function"?jv:e?Nv:Rv)(t,e))}function Bv(){this.textContent=""}function Pv(n){return function(){this.textContent=n}}function Iv(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function zv(n){return arguments.length?this.each(n==null?Bv:(typeof n=="function"?Iv:Pv)(n)):this.node().textContent}function Lv(){this.innerHTML=""}function Fv(n){return function(){this.innerHTML=n}}function $v(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Wv(n){return arguments.length?this.each(n==null?Lv:(typeof n=="function"?$v:Fv)(n)):this.node().innerHTML}function Hv(){this.nextSibling&&this.parentNode.appendChild(this)}function Vv(){return this.each(Hv)}function Uv(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qv(){return this.each(Uv)}function Kv(n){var e=typeof n=="function"?n:Ef(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Qv(){return null}function Yv(n,e){var t=typeof n=="function"?n:Ef(n),i=e==null?Qv:typeof e=="function"?e:ja(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function Xv(){var n=this.parentNode;n&&n.removeChild(this)}function Gv(){return this.each(Xv)}function Jv(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Zv(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function ew(n){return this.select(n?Zv:Jv)}function tw(n){return arguments.length?this.property("__data__",n):this.node().__data__}function nw(n){return function(e){n.call(this,e,this.__data__)}}function iw(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function ow(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,o=e.length,s;t<o;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function sw(n,e,t){return function(){var i=this.__on,o,s=nw(e);if(i){for(var r=0,l=i.length;r<l;++r)if((o=i[r]).type===n.type&&o.name===n.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=s,o.options=t),o.value=e;return}}this.addEventListener(n.type,s,t),o={type:n.type,name:n.name,value:e,listener:s,options:t},i?i.push(o):this.__on=[o]}}function rw(n,e,t){var i=iw(n+""),o,s=i.length,r;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,h;a<c;++a)for(o=0,h=l[a];o<s;++o)if((r=i[o]).type===h.type&&r.name===h.name)return h.value}return}for(l=e?sw:ow,o=0;o<s;++o)this.each(l(i[o],e,t));return this}function Pf(n,e,t){var i=Nf(n),o=i.CustomEvent;typeof o=="function"?o=new o(e,t):(o=i.document.createEvent("Event"),t?(o.initEvent(e,t.bubbles,t.cancelable),o.detail=t.detail):o.initEvent(e,!1,!1)),n.dispatchEvent(o)}function lw(n,e){return function(){return Pf(this,n,e)}}function aw(n,e){return function(){return Pf(this,n,e.apply(this,arguments))}}function cw(n,e){return this.each((typeof e=="function"?aw:lw)(n,e))}function*hw(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],o=0,s=i.length,r;o<s;++o)(r=i[o])&&(yield r)}var If=[null];function ft(n,e){this._groups=n,this._parents=e}function Ao(){return new ft([[document.documentElement]],If)}function uw(){return this}ft.prototype=Ao.prototype={constructor:ft,select:I1,selectAll:$1,selectChild:U1,selectChildren:Y1,filter:X1,data:nv,enter:G1,exit:ov,join:sv,merge:rv,selection:uw,order:lv,sort:av,call:hv,nodes:uv,node:dv,size:fv,empty:pv,each:gv,attr:Sv,style:Ev,property:Ov,classed:Dv,text:zv,html:Wv,raise:Vv,lower:qv,append:Kv,insert:Yv,remove:Gv,clone:ew,datum:tw,on:rw,dispatch:cw,[Symbol.iterator]:hw};function mt(n){return typeof n=="string"?new ft([[document.querySelector(n)]],[document.documentElement]):new ft([[n]],If)}function dw(n){let e;for(;e=n.sourceEvent;)n=e;return n}function _t(n,e){if(n=dw(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var i=t.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var o=e.getBoundingClientRect();return[n.clientX-o.left-e.clientLeft,n.clientY-o.top-e.clientTop]}}return[n.pageX,n.pageY]}const fw={passive:!1},go={capture:!0,passive:!1};function Wr(n){n.stopImmediatePropagation()}function vi(n){n.preventDefault(),n.stopImmediatePropagation()}function zf(n){var e=n.document.documentElement,t=mt(n).on("dragstart.drag",vi,go);"onselectstart"in e?t.on("selectstart.drag",vi,go):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Lf(n,e){var t=n.document.documentElement,i=mt(n).on("dragstart.drag",null);e&&(i.on("click.drag",vi,go),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in t?i.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const Jo=n=>()=>n;function ql(n,{sourceEvent:e,subject:t,target:i,identifier:o,active:s,x:r,y:l,dx:a,dy:c,dispatch:h}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:r,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:h}})}ql.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function pw(n){return!n.ctrlKey&&!n.button}function gw(){return this.parentNode}function mw(n,e){return e??{x:n.x,y:n.y}}function yw(){return navigator.maxTouchPoints||"ontouchstart"in this}function xw(){var n=pw,e=gw,t=mw,i=yw,o={},s=ir("start","drag","end"),r=0,l,a,c,h,u=0;function p(E){E.on("mousedown.drag",g).filter(i).on("touchstart.drag",b).on("touchmove.drag",x,fw).on("touchend.drag touchcancel.drag",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(E,M){if(!(h||!n.call(this,E,M))){var _=k(this,e.call(this,E,M),E,M,"mouse");_&&(mt(E.view).on("mousemove.drag",y,go).on("mouseup.drag",m,go),zf(E.view),Wr(E),c=!1,l=E.clientX,a=E.clientY,_("start",E))}}function y(E){if(vi(E),!c){var M=E.clientX-l,_=E.clientY-a;c=M*M+_*_>u}o.mouse("drag",E)}function m(E){mt(E.view).on("mousemove.drag mouseup.drag",null),Lf(E.view,c),vi(E),o.mouse("end",E)}function b(E,M){if(n.call(this,E,M)){var _=E.changedTouches,C=e.call(this,E,M),P=_.length,R,$;for(R=0;R<P;++R)($=k(this,C,E,M,_[R].identifier,_[R]))&&(Wr(E),$("start",E,_[R]))}}function x(E){var M=E.changedTouches,_=M.length,C,P;for(C=0;C<_;++C)(P=o[M[C].identifier])&&(vi(E),P("drag",E,M[C]))}function T(E){var M=E.changedTouches,_=M.length,C,P;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),C=0;C<_;++C)(P=o[M[C].identifier])&&(Wr(E),P("end",E,M[C]))}function k(E,M,_,C,P,R){var $=s.copy(),F=_t(R||_,M),L,W,w;if((w=t.call(E,new ql("beforestart",{sourceEvent:_,target:p,identifier:P,active:r,x:F[0],y:F[1],dx:0,dy:0,dispatch:$}),C))!=null)return L=w.x-F[0]||0,W=w.y-F[1]||0,function O(S,z,j){var v=F,D;switch(S){case"start":o[P]=O,D=r++;break;case"end":delete o[P],--r;case"drag":F=_t(j||z,M),D=r;break}$.call(S,E,new ql(S,{sourceEvent:z,subject:w,target:p,identifier:P,active:D,x:F[0]+L,y:F[1]+W,dx:F[0]-v[0],dy:F[1]-v[1],dispatch:$}),C)}}return p.filter=function(E){return arguments.length?(n=typeof E=="function"?E:Jo(!!E),p):n},p.container=function(E){return arguments.length?(e=typeof E=="function"?E:Jo(E),p):e},p.subject=function(E){return arguments.length?(t=typeof E=="function"?E:Jo(E),p):t},p.touchable=function(E){return arguments.length?(i=typeof E=="function"?E:Jo(!!E),p):i},p.on=function(){var E=s.on.apply(s,arguments);return E===s?p:E},p.clickDistance=function(E){return arguments.length?(u=(E=+E)*E,p):Math.sqrt(u)},p}function Ba(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function Ff(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function _o(){}var mo=.7,$s=1/mo,wi="\\s*([+-]?\\d+)\\s*",yo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",bw=/^#([0-9a-f]{3,8})$/,vw=new RegExp(`^rgb\\(${wi},${wi},${wi}\\)$`),ww=new RegExp(`^rgb\\(${Gt},${Gt},${Gt}\\)$`),Sw=new RegExp(`^rgba\\(${wi},${wi},${wi},${yo}\\)$`),kw=new RegExp(`^rgba\\(${Gt},${Gt},${Gt},${yo}\\)$`),Cw=new RegExp(`^hsl\\(${yo},${Gt},${Gt}\\)$`),Tw=new RegExp(`^hsla\\(${yo},${Gt},${Gt},${yo}\\)$`),Nh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ba(_o,xo,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Rh,formatHex:Rh,formatHex8:Ew,formatHsl:Aw,formatRgb:jh,toString:jh});function Rh(){return this.rgb().formatHex()}function Ew(){return this.rgb().formatHex8()}function Aw(){return $f(this).formatHsl()}function jh(){return this.rgb().formatRgb()}function xo(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=bw.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?Dh(e):t===3?new it(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Zo(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Zo(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=vw.exec(n))?new it(e[1],e[2],e[3],1):(e=ww.exec(n))?new it(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Sw.exec(n))?Zo(e[1],e[2],e[3],e[4]):(e=kw.exec(n))?Zo(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Cw.exec(n))?Ih(e[1],e[2]/100,e[3]/100,1):(e=Tw.exec(n))?Ih(e[1],e[2]/100,e[3]/100,e[4]):Nh.hasOwnProperty(n)?Dh(Nh[n]):n==="transparent"?new it(NaN,NaN,NaN,0):null}function Dh(n){return new it(n>>16&255,n>>8&255,n&255,1)}function Zo(n,e,t,i){return i<=0&&(n=e=t=NaN),new it(n,e,t,i)}function _w(n){return n instanceof _o||(n=xo(n)),n?(n=n.rgb(),new it(n.r,n.g,n.b,n.opacity)):new it}function Kl(n,e,t,i){return arguments.length===1?_w(n):new it(n,e,t,i??1)}function it(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}Ba(it,Kl,Ff(_o,{brighter(n){return n=n==null?$s:Math.pow($s,n),new it(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?mo:Math.pow(mo,n),new it(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new it(Jn(this.r),Jn(this.g),Jn(this.b),Ws(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Bh,formatHex:Bh,formatHex8:Mw,formatRgb:Ph,toString:Ph}));function Bh(){return`#${Qn(this.r)}${Qn(this.g)}${Qn(this.b)}`}function Mw(){return`#${Qn(this.r)}${Qn(this.g)}${Qn(this.b)}${Qn((isNaN(this.opacity)?1:this.opacity)*255)}`}function Ph(){const n=Ws(this.opacity);return`${n===1?"rgb(":"rgba("}${Jn(this.r)}, ${Jn(this.g)}, ${Jn(this.b)}${n===1?")":`, ${n})`}`}function Ws(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Jn(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Qn(n){return n=Jn(n),(n<16?"0":"")+n.toString(16)}function Ih(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Ot(n,e,t,i)}function $f(n){if(n instanceof Ot)return new Ot(n.h,n.s,n.l,n.opacity);if(n instanceof _o||(n=xo(n)),!n)return new Ot;if(n instanceof Ot)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,o=Math.min(e,t,i),s=Math.max(e,t,i),r=NaN,l=s-o,a=(s+o)/2;return l?(e===s?r=(t-i)/l+(t<i)*6:t===s?r=(i-e)/l+2:r=(e-t)/l+4,l/=a<.5?s+o:2-s-o,r*=60):l=a>0&&a<1?0:r,new Ot(r,l,a,n.opacity)}function Ow(n,e,t,i){return arguments.length===1?$f(n):new Ot(n,e,t,i??1)}function Ot(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}Ba(Ot,Ow,Ff(_o,{brighter(n){return n=n==null?$s:Math.pow($s,n),new Ot(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?mo:Math.pow(mo,n),new Ot(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,o=2*t-i;return new it(Hr(n>=240?n-240:n+120,o,i),Hr(n,o,i),Hr(n<120?n+240:n-120,o,i),this.opacity)},clamp(){return new Ot(zh(this.h),es(this.s),es(this.l),Ws(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Ws(this.opacity);return`${n===1?"hsl(":"hsla("}${zh(this.h)}, ${es(this.s)*100}%, ${es(this.l)*100}%${n===1?")":`, ${n})`}`}}));function zh(n){return n=(n||0)%360,n<0?n+360:n}function es(n){return Math.max(0,Math.min(1,n||0))}function Hr(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const Wf=n=>()=>n;function Nw(n,e){return function(t){return n+t*e}}function Rw(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function jw(n){return(n=+n)==1?Hf:function(e,t){return t-e?Rw(e,t,n):Wf(isNaN(e)?t:e)}}function Hf(n,e){var t=e-n;return t?Nw(n,t):Wf(isNaN(n)?e:n)}const Lh=function n(e){var t=jw(e);function i(o,s){var r=t((o=Kl(o)).r,(s=Kl(s)).r),l=t(o.g,s.g),a=t(o.b,s.b),c=Hf(o.opacity,s.opacity);return function(h){return o.r=r(h),o.g=l(h),o.b=a(h),o.opacity=c(h),o+""}}return i.gamma=n,i}(1);function wn(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var Ql=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vr=new RegExp(Ql.source,"g");function Dw(n){return function(){return n}}function Bw(n){return function(e){return n(e)+""}}function Pw(n,e){var t=Ql.lastIndex=Vr.lastIndex=0,i,o,s,r=-1,l=[],a=[];for(n=n+"",e=e+"";(i=Ql.exec(n))&&(o=Vr.exec(e));)(s=o.index)>t&&(s=e.slice(t,s),l[r]?l[r]+=s:l[++r]=s),(i=i[0])===(o=o[0])?l[r]?l[r]+=o:l[++r]=o:(l[++r]=null,a.push({i:r,x:wn(i,o)})),t=Vr.lastIndex;return t<e.length&&(s=e.slice(t),l[r]?l[r]+=s:l[++r]=s),l.length<2?a[0]?Bw(a[0].x):Dw(e):(e=a.length,function(c){for(var h=0,u;h<e;++h)l[(u=a[h]).i]=u.x(c);return l.join("")})}var Fh=180/Math.PI,Yl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vf(n,e,t,i,o,s){var r,l,a;return(r=Math.sqrt(n*n+e*e))&&(n/=r,e/=r),(a=n*t+e*i)&&(t-=n*a,i-=e*a),(l=Math.sqrt(t*t+i*i))&&(t/=l,i/=l,a/=l),n*i<e*t&&(n=-n,e=-e,a=-a,r=-r),{translateX:o,translateY:s,rotate:Math.atan2(e,n)*Fh,skewX:Math.atan(a)*Fh,scaleX:r,scaleY:l}}var ts;function Iw(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?Yl:Vf(e.a,e.b,e.c,e.d,e.e,e.f)}function zw(n){return n==null||(ts||(ts=document.createElementNS("http://www.w3.org/2000/svg","g")),ts.setAttribute("transform",n),!(n=ts.transform.baseVal.consolidate()))?Yl:(n=n.matrix,Vf(n.a,n.b,n.c,n.d,n.e,n.f))}function Uf(n,e,t,i){function o(c){return c.length?c.pop()+" ":""}function s(c,h,u,p,g,y){if(c!==u||h!==p){var m=g.push("translate(",null,e,null,t);y.push({i:m-4,x:wn(c,u)},{i:m-2,x:wn(h,p)})}else(u||p)&&g.push("translate("+u+e+p+t)}function r(c,h,u,p){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),p.push({i:u.push(o(u)+"rotate(",null,i)-2,x:wn(c,h)})):h&&u.push(o(u)+"rotate("+h+i)}function l(c,h,u,p){c!==h?p.push({i:u.push(o(u)+"skewX(",null,i)-2,x:wn(c,h)}):h&&u.push(o(u)+"skewX("+h+i)}function a(c,h,u,p,g,y){if(c!==u||h!==p){var m=g.push(o(g)+"scale(",null,",",null,")");y.push({i:m-4,x:wn(c,u)},{i:m-2,x:wn(h,p)})}else(u!==1||p!==1)&&g.push(o(g)+"scale("+u+","+p+")")}return function(c,h){var u=[],p=[];return c=n(c),h=n(h),s(c.translateX,c.translateY,h.translateX,h.translateY,u,p),r(c.rotate,h.rotate,u,p),l(c.skewX,h.skewX,u,p),a(c.scaleX,c.scaleY,h.scaleX,h.scaleY,u,p),c=h=null,function(g){for(var y=-1,m=p.length,b;++y<m;)u[(b=p[y]).i]=b.x(g);return u.join("")}}}var Lw=Uf(Iw,"px, ","px)","deg)"),Fw=Uf(zw,", ",")",")"),$w=1e-12;function $h(n){return((n=Math.exp(n))+1/n)/2}function Ww(n){return((n=Math.exp(n))-1/n)/2}function Hw(n){return((n=Math.exp(2*n))-1)/(n+1)}const Vw=function n(e,t,i){function o(s,r){var l=s[0],a=s[1],c=s[2],h=r[0],u=r[1],p=r[2],g=h-l,y=u-a,m=g*g+y*y,b,x;if(m<$w)x=Math.log(p/c)/e,b=function(C){return[l+C*g,a+C*y,c*Math.exp(e*C*x)]};else{var T=Math.sqrt(m),k=(p*p-c*c+i*m)/(2*c*t*T),E=(p*p-c*c-i*m)/(2*p*t*T),M=Math.log(Math.sqrt(k*k+1)-k),_=Math.log(Math.sqrt(E*E+1)-E);x=(_-M)/e,b=function(C){var P=C*x,R=$h(M),$=c/(t*T)*(R*Hw(e*P+M)-Ww(M));return[l+$*g,a+$*y,c*R/$h(e*P+M)]}}return b.duration=x*1e3*e/Math.SQRT2,b}return o.rho=function(s){var r=Math.max(.001,+s),l=r*r,a=l*l;return n(r,l,a)},o}(Math.SQRT2,2,4);var Ri=0,Qi=0,Fi=0,qf=1e3,Hs,Yi,Vs=0,ni=0,sr=0,bo=typeof performance=="object"&&performance.now?performance:Date,Kf=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Pa(){return ni||(Kf(Uw),ni=bo.now()+sr)}function Uw(){ni=0}function Us(){this._call=this._time=this._next=null}Us.prototype=Qf.prototype={constructor:Us,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?Pa():+t)+(e==null?0:+e),!this._next&&Yi!==this&&(Yi?Yi._next=this:Hs=this,Yi=this),this._call=n,this._time=t,Xl()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xl())}};function Qf(n,e,t){var i=new Us;return i.restart(n,e,t),i}function qw(){Pa(),++Ri;for(var n=Hs,e;n;)(e=ni-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Ri}function Wh(){ni=(Vs=bo.now())+sr,Ri=Qi=0;try{qw()}finally{Ri=0,Qw(),ni=0}}function Kw(){var n=bo.now(),e=n-Vs;e>qf&&(sr-=e,Vs=n)}function Qw(){for(var n,e=Hs,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Hs=t);Yi=n,Xl(i)}function Xl(n){if(!Ri){Qi&&(Qi=clearTimeout(Qi));var e=n-ni;e>24?(n<1/0&&(Qi=setTimeout(Wh,n-bo.now()-sr)),Fi&&(Fi=clearInterval(Fi))):(Fi||(Vs=bo.now(),Fi=setInterval(Kw,qf)),Ri=1,Kf(Wh))}}function Hh(n,e,t){var i=new Us;return e=e==null?0:+e,i.restart(o=>{i.stop(),n(o+e)},e,t),i}var Yw=ir("start","end","cancel","interrupt"),Xw=[],Yf=0,Vh=1,Gl=2,gs=3,Uh=4,Jl=5,ms=6;function rr(n,e,t,i,o,s){var r=n.__transition;if(!r)n.__transition={};else if(t in r)return;Gw(n,t,{name:e,index:i,group:o,on:Yw,tween:Xw,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Yf})}function Ia(n,e){var t=Bt(n,e);if(t.state>Yf)throw new Error("too late; already scheduled");return t}function Jt(n,e){var t=Bt(n,e);if(t.state>gs)throw new Error("too late; already running");return t}function Bt(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function Gw(n,e,t){var i=n.__transition,o;i[e]=t,t.timer=Qf(s,0,t.time);function s(c){t.state=Vh,t.timer.restart(r,t.delay,t.time),t.delay<=c&&r(c-t.delay)}function r(c){var h,u,p,g;if(t.state!==Vh)return a();for(h in i)if(g=i[h],g.name===t.name){if(g.state===gs)return Hh(r);g.state===Uh?(g.state=ms,g.timer.stop(),g.on.call("interrupt",n,n.__data__,g.index,g.group),delete i[h]):+h<e&&(g.state=ms,g.timer.stop(),g.on.call("cancel",n,n.__data__,g.index,g.group),delete i[h])}if(Hh(function(){t.state===gs&&(t.state=Uh,t.timer.restart(l,t.delay,t.time),l(c))}),t.state=Gl,t.on.call("start",n,n.__data__,t.index,t.group),t.state===Gl){for(t.state=gs,o=new Array(p=t.tween.length),h=0,u=-1;h<p;++h)(g=t.tween[h].value.call(n,n.__data__,t.index,t.group))&&(o[++u]=g);o.length=u+1}}function l(c){for(var h=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(a),t.state=Jl,1),u=-1,p=o.length;++u<p;)o[u].call(n,h);t.state===Jl&&(t.on.call("end",n,n.__data__,t.index,t.group),a())}function a(){t.state=ms,t.timer.stop(),delete i[e];for(var c in i)return;delete n.__transition}}function ys(n,e){var t=n.__transition,i,o,s=!0,r;if(t){e=e==null?null:e+"";for(r in t){if((i=t[r]).name!==e){s=!1;continue}o=i.state>Gl&&i.state<Jl,i.state=ms,i.timer.stop(),i.on.call(o?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[r]}s&&delete n.__transition}}function Jw(n){return this.each(function(){ys(this,n)})}function Zw(n,e){var t,i;return function(){var o=Jt(this,n),s=o.tween;if(s!==t){i=t=s;for(var r=0,l=i.length;r<l;++r)if(i[r].name===e){i=i.slice(),i.splice(r,1);break}}o.tween=i}}function eS(n,e,t){var i,o;if(typeof t!="function")throw new Error;return function(){var s=Jt(this,n),r=s.tween;if(r!==i){o=(i=r).slice();for(var l={name:e,value:t},a=0,c=o.length;a<c;++a)if(o[a].name===e){o[a]=l;break}a===c&&o.push(l)}s.tween=o}}function tS(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=Bt(this.node(),t).tween,o=0,s=i.length,r;o<s;++o)if((r=i[o]).name===n)return r.value;return null}return this.each((e==null?Zw:eS)(t,n,e))}function za(n,e,t){var i=n._id;return n.each(function(){var o=Jt(this,i);(o.value||(o.value={}))[e]=t.apply(this,arguments)}),function(o){return Bt(o,i).value[e]}}function Xf(n,e){var t;return(typeof e=="number"?wn:e instanceof xo?Lh:(t=xo(e))?(e=t,Lh):Pw)(n,e)}function nS(n){return function(){this.removeAttribute(n)}}function iS(n){return function(){this.removeAttributeNS(n.space,n.local)}}function oS(n,e,t){var i,o=t+"",s;return function(){var r=this.getAttribute(n);return r===o?null:r===i?s:s=e(i=r,t)}}function sS(n,e,t){var i,o=t+"",s;return function(){var r=this.getAttributeNS(n.space,n.local);return r===o?null:r===i?s:s=e(i=r,t)}}function rS(n,e,t){var i,o,s;return function(){var r,l=t(this),a;return l==null?void this.removeAttribute(n):(r=this.getAttribute(n),a=l+"",r===a?null:r===i&&a===o?s:(o=a,s=e(i=r,l)))}}function lS(n,e,t){var i,o,s;return function(){var r,l=t(this),a;return l==null?void this.removeAttributeNS(n.space,n.local):(r=this.getAttributeNS(n.space,n.local),a=l+"",r===a?null:r===i&&a===o?s:(o=a,s=e(i=r,l)))}}function aS(n,e){var t=or(n),i=t==="transform"?Fw:Xf;return this.attrTween(n,typeof e=="function"?(t.local?lS:rS)(t,i,za(this,"attr."+n,e)):e==null?(t.local?iS:nS)(t):(t.local?sS:oS)(t,i,e))}function cS(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function hS(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function uS(n,e){var t,i;function o(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&hS(n,s)),t}return o._value=e,o}function dS(n,e){var t,i;function o(){var s=e.apply(this,arguments);return s!==i&&(t=(i=s)&&cS(n,s)),t}return o._value=e,o}function fS(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=or(n);return this.tween(t,(i.local?uS:dS)(i,e))}function pS(n,e){return function(){Ia(this,n).delay=+e.apply(this,arguments)}}function gS(n,e){return e=+e,function(){Ia(this,n).delay=e}}function mS(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?pS:gS)(e,n)):Bt(this.node(),e).delay}function yS(n,e){return function(){Jt(this,n).duration=+e.apply(this,arguments)}}function xS(n,e){return e=+e,function(){Jt(this,n).duration=e}}function bS(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?yS:xS)(e,n)):Bt(this.node(),e).duration}function vS(n,e){if(typeof e!="function")throw new Error;return function(){Jt(this,n).ease=e}}function wS(n){var e=this._id;return arguments.length?this.each(vS(e,n)):Bt(this.node(),e).ease}function SS(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Jt(this,n).ease=t}}function kS(n){if(typeof n!="function")throw new Error;return this.each(SS(this._id,n))}function CS(n){typeof n!="function"&&(n=_f(n));for(var e=this._groups,t=e.length,i=new Array(t),o=0;o<t;++o)for(var s=e[o],r=s.length,l=i[o]=[],a,c=0;c<r;++c)(a=s[c])&&n.call(a,a.__data__,c,s)&&l.push(a);return new un(i,this._parents,this._name,this._id)}function TS(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,o=t.length,s=Math.min(i,o),r=new Array(i),l=0;l<s;++l)for(var a=e[l],c=t[l],h=a.length,u=r[l]=new Array(h),p,g=0;g<h;++g)(p=a[g]||c[g])&&(u[g]=p);for(;l<i;++l)r[l]=e[l];return new un(r,this._parents,this._name,this._id)}function ES(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function AS(n,e,t){var i,o,s=ES(e)?Ia:Jt;return function(){var r=s(this,n),l=r.on;l!==i&&(o=(i=l).copy()).on(e,t),r.on=o}}function _S(n,e){var t=this._id;return arguments.length<2?Bt(this.node(),t).on.on(n):this.each(AS(t,n,e))}function MS(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function OS(){return this.on("end.remove",MS(this._id))}function NS(n){var e=this._name,t=this._id;typeof n!="function"&&(n=ja(n));for(var i=this._groups,o=i.length,s=new Array(o),r=0;r<o;++r)for(var l=i[r],a=l.length,c=s[r]=new Array(a),h,u,p=0;p<a;++p)(h=l[p])&&(u=n.call(h,h.__data__,p,l))&&("__data__"in h&&(u.__data__=h.__data__),c[p]=u,rr(c[p],e,t,p,c,Bt(h,t)));return new un(s,this._parents,e,t)}function RS(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Af(n));for(var i=this._groups,o=i.length,s=[],r=[],l=0;l<o;++l)for(var a=i[l],c=a.length,h,u=0;u<c;++u)if(h=a[u]){for(var p=n.call(h,h.__data__,u,a),g,y=Bt(h,t),m=0,b=p.length;m<b;++m)(g=p[m])&&rr(g,e,t,m,p,y);s.push(p),r.push(h)}return new un(s,r,e,t)}var jS=Ao.prototype.constructor;function DS(){return new jS(this._groups,this._parents)}function BS(n,e){var t,i,o;return function(){var s=Ni(this,n),r=(this.style.removeProperty(n),Ni(this,n));return s===r?null:s===t&&r===i?o:o=e(t=s,i=r)}}function Gf(n){return function(){this.style.removeProperty(n)}}function PS(n,e,t){var i,o=t+"",s;return function(){var r=Ni(this,n);return r===o?null:r===i?s:s=e(i=r,t)}}function IS(n,e,t){var i,o,s;return function(){var r=Ni(this,n),l=t(this),a=l+"";return l==null&&(a=l=(this.style.removeProperty(n),Ni(this,n))),r===a?null:r===i&&a===o?s:(o=a,s=e(i=r,l))}}function zS(n,e){var t,i,o,s="style."+e,r="end."+s,l;return function(){var a=Jt(this,n),c=a.on,h=a.value[s]==null?l||(l=Gf(e)):void 0;(c!==t||o!==h)&&(i=(t=c).copy()).on(r,o=h),a.on=i}}function LS(n,e,t){var i=(n+="")=="transform"?Lw:Xf;return e==null?this.styleTween(n,BS(n,i)).on("end.style."+n,Gf(n)):typeof e=="function"?this.styleTween(n,IS(n,i,za(this,"style."+n,e))).each(zS(this._id,n)):this.styleTween(n,PS(n,i,e),t).on("end.style."+n,null)}function FS(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function $S(n,e,t){var i,o;function s(){var r=e.apply(this,arguments);return r!==o&&(i=(o=r)&&FS(n,r,t)),i}return s._value=e,s}function WS(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,$S(n,e,t??""))}function HS(n){return function(){this.textContent=n}}function VS(n){return function(){var e=n(this);this.textContent=e??""}}function US(n){return this.tween("text",typeof n=="function"?VS(za(this,"text",n)):HS(n==null?"":n+""))}function qS(n){return function(e){this.textContent=n.call(this,e)}}function KS(n){var e,t;function i(){var o=n.apply(this,arguments);return o!==t&&(e=(t=o)&&qS(o)),e}return i._value=n,i}function QS(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,KS(n))}function YS(){for(var n=this._name,e=this._id,t=Jf(),i=this._groups,o=i.length,s=0;s<o;++s)for(var r=i[s],l=r.length,a,c=0;c<l;++c)if(a=r[c]){var h=Bt(a,e);rr(a,n,t,c,r,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new un(i,this._parents,n,t)}function XS(){var n,e,t=this,i=t._id,o=t.size();return new Promise(function(s,r){var l={value:r},a={value:function(){--o===0&&s()}};t.each(function(){var c=Jt(this,i),h=c.on;h!==n&&(e=(n=h).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(a)),c.on=e}),o===0&&s()})}var GS=0;function un(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function Jf(){return++GS}var on=Ao.prototype;un.prototype={constructor:un,select:NS,selectAll:RS,selectChild:on.selectChild,selectChildren:on.selectChildren,filter:CS,merge:TS,selection:DS,transition:YS,call:on.call,nodes:on.nodes,node:on.node,size:on.size,empty:on.empty,each:on.each,on:_S,attr:aS,attrTween:fS,style:LS,styleTween:WS,text:US,textTween:QS,remove:OS,tween:tS,delay:mS,duration:bS,ease:wS,easeVarying:kS,end:XS,[Symbol.iterator]:on[Symbol.iterator]};function JS(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var ZS={time:null,delay:0,duration:250,ease:JS};function ek(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function tk(n){var e,t;n instanceof un?(e=n._id,n=n._name):(e=Jf(),(t=ZS).time=Pa(),n=n==null?null:n+"");for(var i=this._groups,o=i.length,s=0;s<o;++s)for(var r=i[s],l=r.length,a,c=0;c<l;++c)(a=r[c])&&rr(a,n,e,c,r,t||ek(a,e));return new un(i,this._parents,n,e)}Ao.prototype.interrupt=Jw;Ao.prototype.transition=tk;const ns=n=>()=>n;function nk(n,{sourceEvent:e,target:t,transform:i,dispatch:o}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:o}})}function an(n,e,t){this.k=n,this.x=e,this.y=t}an.prototype={constructor:an,scale:function(n){return n===1?this:new an(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new an(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var cn=new an(1,0,0);an.prototype;function Ur(n){n.stopImmediatePropagation()}function $i(n){n.preventDefault(),n.stopImmediatePropagation()}function ik(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function ok(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function qh(){return this.__zoom||cn}function sk(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function rk(){return navigator.maxTouchPoints||"ontouchstart"in this}function lk(n,e,t){var i=n.invertX(e[0][0])-t[0][0],o=n.invertX(e[1][0])-t[1][0],s=n.invertY(e[0][1])-t[0][1],r=n.invertY(e[1][1])-t[1][1];return n.translate(o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o),r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r))}function Zf(){var n=ik,e=ok,t=lk,i=sk,o=rk,s=[0,1/0],r=[[-1/0,-1/0],[1/0,1/0]],l=250,a=Vw,c=ir("start","zoom","end"),h,u,p,g=500,y=150,m=0,b=10;function x(w){w.property("__zoom",qh).on("wheel.zoom",P,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",$).filter(o).on("touchstart.zoom",F).on("touchmove.zoom",L).on("touchend.zoom touchcancel.zoom",W).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(w,O,S,z){var j=w.selection?w.selection():w;j.property("__zoom",qh),w!==j?M(w,O,S,z):j.interrupt().each(function(){_(this,arguments).event(z).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},x.scaleBy=function(w,O,S,z){x.scaleTo(w,function(){var j=this.__zoom.k,v=typeof O=="function"?O.apply(this,arguments):O;return j*v},S,z)},x.scaleTo=function(w,O,S,z){x.transform(w,function(){var j=e.apply(this,arguments),v=this.__zoom,D=S==null?E(j):typeof S=="function"?S.apply(this,arguments):S,B=v.invert(D),I=typeof O=="function"?O.apply(this,arguments):O;return t(k(T(v,I),D,B),j,r)},S,z)},x.translateBy=function(w,O,S,z){x.transform(w,function(){return t(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof S=="function"?S.apply(this,arguments):S),e.apply(this,arguments),r)},null,z)},x.translateTo=function(w,O,S,z,j){x.transform(w,function(){var v=e.apply(this,arguments),D=this.__zoom,B=z==null?E(v):typeof z=="function"?z.apply(this,arguments):z;return t(cn.translate(B[0],B[1]).scale(D.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof S=="function"?-S.apply(this,arguments):-S),v,r)},z,j)};function T(w,O){return O=Math.max(s[0],Math.min(s[1],O)),O===w.k?w:new an(O,w.x,w.y)}function k(w,O,S){var z=O[0]-S[0]*w.k,j=O[1]-S[1]*w.k;return z===w.x&&j===w.y?w:new an(w.k,z,j)}function E(w){return[(+w[0][0]+ +w[1][0])/2,(+w[0][1]+ +w[1][1])/2]}function M(w,O,S,z){w.on("start.zoom",function(){_(this,arguments).event(z).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(z).end()}).tween("zoom",function(){var j=this,v=arguments,D=_(j,v).event(z),B=e.apply(j,v),I=S==null?E(B):typeof S=="function"?S.apply(j,v):S,V=Math.max(B[1][0]-B[0][0],B[1][1]-B[0][1]),Q=j.__zoom,J=typeof O=="function"?O.apply(j,v):O,se=a(Q.invert(I).concat(V/Q.k),J.invert(I).concat(V/J.k));return function(le){if(le===1)le=J;else{var xe=se(le),ge=V/xe[2];le=new an(ge,I[0]-xe[0]*ge,I[1]-xe[1]*ge)}D.zoom(null,le)}})}function _(w,O,S){return!S&&w.__zooming||new C(w,O)}function C(w,O){this.that=w,this.args=O,this.active=0,this.sourceEvent=null,this.extent=e.apply(w,O),this.taps=0}C.prototype={event:function(w){return w&&(this.sourceEvent=w),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(w,O){return this.mouse&&w!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&w!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&w!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(w){var O=mt(this.that).datum();c.call(w,this.that,new nk(w,{sourceEvent:this.sourceEvent,target:x,type:w,transform:this.that.__zoom,dispatch:c}),O)}};function P(w,...O){if(!n.apply(this,arguments))return;var S=_(this,O).event(w),z=this.__zoom,j=Math.max(s[0],Math.min(s[1],z.k*Math.pow(2,i.apply(this,arguments)))),v=_t(w);if(S.wheel)(S.mouse[0][0]!==v[0]||S.mouse[0][1]!==v[1])&&(S.mouse[1]=z.invert(S.mouse[0]=v)),clearTimeout(S.wheel);else{if(z.k===j)return;S.mouse=[v,z.invert(v)],ys(this),S.start()}$i(w),S.wheel=setTimeout(D,y),S.zoom("mouse",t(k(T(z,j),S.mouse[0],S.mouse[1]),S.extent,r));function D(){S.wheel=null,S.end()}}function R(w,...O){if(p||!n.apply(this,arguments))return;var S=w.currentTarget,z=_(this,O,!0).event(w),j=mt(w.view).on("mousemove.zoom",I,!0).on("mouseup.zoom",V,!0),v=_t(w,S),D=w.clientX,B=w.clientY;zf(w.view),Ur(w),z.mouse=[v,this.__zoom.invert(v)],ys(this),z.start();function I(Q){if($i(Q),!z.moved){var J=Q.clientX-D,se=Q.clientY-B;z.moved=J*J+se*se>m}z.event(Q).zoom("mouse",t(k(z.that.__zoom,z.mouse[0]=_t(Q,S),z.mouse[1]),z.extent,r))}function V(Q){j.on("mousemove.zoom mouseup.zoom",null),Lf(Q.view,z.moved),$i(Q),z.event(Q).end()}}function $(w,...O){if(n.apply(this,arguments)){var S=this.__zoom,z=_t(w.changedTouches?w.changedTouches[0]:w,this),j=S.invert(z),v=S.k*(w.shiftKey?.5:2),D=t(k(T(S,v),z,j),e.apply(this,O),r);$i(w),l>0?mt(this).transition().duration(l).call(M,D,z,w):mt(this).call(x.transform,D,z,w)}}function F(w,...O){if(n.apply(this,arguments)){var S=w.touches,z=S.length,j=_(this,O,w.changedTouches.length===z).event(w),v,D,B,I;for(Ur(w),D=0;D<z;++D)B=S[D],I=_t(B,this),I=[I,this.__zoom.invert(I),B.identifier],j.touch0?!j.touch1&&j.touch0[2]!==I[2]&&(j.touch1=I,j.taps=0):(j.touch0=I,v=!0,j.taps=1+!!h);h&&(h=clearTimeout(h)),v&&(j.taps<2&&(u=I[0],h=setTimeout(function(){h=null},g)),ys(this),j.start())}}function L(w,...O){if(this.__zooming){var S=_(this,O).event(w),z=w.changedTouches,j=z.length,v,D,B,I;for($i(w),v=0;v<j;++v)D=z[v],B=_t(D,this),S.touch0&&S.touch0[2]===D.identifier?S.touch0[0]=B:S.touch1&&S.touch1[2]===D.identifier&&(S.touch1[0]=B);if(D=S.that.__zoom,S.touch1){var V=S.touch0[0],Q=S.touch0[1],J=S.touch1[0],se=S.touch1[1],le=(le=J[0]-V[0])*le+(le=J[1]-V[1])*le,xe=(xe=se[0]-Q[0])*xe+(xe=se[1]-Q[1])*xe;D=T(D,Math.sqrt(le/xe)),B=[(V[0]+J[0])/2,(V[1]+J[1])/2],I=[(Q[0]+se[0])/2,(Q[1]+se[1])/2]}else if(S.touch0)B=S.touch0[0],I=S.touch0[1];else return;S.zoom("touch",t(k(D,B,I),S.extent,r))}}function W(w,...O){if(this.__zooming){var S=_(this,O).event(w),z=w.changedTouches,j=z.length,v,D;for(Ur(w),p&&clearTimeout(p),p=setTimeout(function(){p=null},g),v=0;v<j;++v)D=z[v],S.touch0&&S.touch0[2]===D.identifier?delete S.touch0:S.touch1&&S.touch1[2]===D.identifier&&delete S.touch1;if(S.touch1&&!S.touch0&&(S.touch0=S.touch1,delete S.touch1),S.touch0)S.touch0[1]=this.__zoom.invert(S.touch0[0]);else if(S.end(),S.taps===2&&(D=_t(D,this),Math.hypot(u[0]-D[0],u[1]-D[1])<b)){var B=mt(this).on("dblclick.zoom");B&&B.apply(this,arguments)}}}return x.wheelDelta=function(w){return arguments.length?(i=typeof w=="function"?w:ns(+w),x):i},x.filter=function(w){return arguments.length?(n=typeof w=="function"?w:ns(!!w),x):n},x.touchable=function(w){return arguments.length?(o=typeof w=="function"?w:ns(!!w),x):o},x.extent=function(w){return arguments.length?(e=typeof w=="function"?w:ns([[+w[0][0],+w[0][1]],[+w[1][0],+w[1][1]]]),x):e},x.scaleExtent=function(w){return arguments.length?(s[0]=+w[0],s[1]=+w[1],x):[s[0],s[1]]},x.translateExtent=function(w){return arguments.length?(r[0][0]=+w[0][0],r[1][0]=+w[1][0],r[0][1]=+w[0][1],r[1][1]=+w[1][1],x):[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},x.constrain=function(w){return arguments.length?(t=w,x):t},x.duration=function(w){return arguments.length?(l=+w,x):l},x.interpolate=function(w){return arguments.length?(a=w,x):a},x.on=function(){var w=c.on.apply(c,arguments);return w===c?x:w},x.clickDistance=function(w){return arguments.length?(m=(w=+w)*w,x):Math.sqrt(m)},x.tapDistance=function(w){return arguments.length?(b=+w,x):b},x}const lr=N.createContext(null),ak=lr.Provider,dn={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:n=>`Node type "${n}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:n=>`The old edge with id=${n} does not exist.`,error009:n=>`Marker type "${n}" doesn't exist.`,error008:(n,e)=>`Couldn't create edge for ${n?"target":"source"} handle id: "${n?e.targetHandle:e.sourceHandle}", edge id: ${e.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:n=>`Edge type "${n}" not found. Using fallback type "default".`,error012:n=>`Node with id "${n}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},ep=dn.error001();function Me(n,e){const t=N.useContext(lr);if(t===null)throw new Error(ep);return Tf(t,n,e)}const He=()=>{const n=N.useContext(lr);if(n===null)throw new Error(ep);return N.useMemo(()=>({getState:n.getState,setState:n.setState,subscribe:n.subscribe,destroy:n.destroy}),[n])},ck=n=>n.userSelectionActive?"none":"all";function La({position:n,children:e,className:t,style:i,...o}){const s=Me(ck),r=`${n}`.split("-");return H.createElement("div",{className:Xe(["react-flow__panel",t,...r]),style:{...i,pointerEvents:s},...o},e)}function hk({proOptions:n,position:e="bottom-right"}){return n!=null&&n.hideAttribution?null:H.createElement(La,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},H.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const uk=({x:n,y:e,label:t,labelStyle:i={},labelShowBg:o=!0,labelBgStyle:s={},labelBgPadding:r=[2,4],labelBgBorderRadius:l=2,children:a,className:c,...h})=>{const u=N.useRef(null),[p,g]=N.useState({x:0,y:0,width:0,height:0}),y=Xe(["react-flow__edge-textwrapper",c]);return N.useEffect(()=>{if(u.current){const m=u.current.getBBox();g({x:m.x,y:m.y,width:m.width,height:m.height})}},[t]),typeof t>"u"||!t?null:H.createElement("g",{transform:`translate(${n-p.width/2} ${e-p.height/2})`,className:y,visibility:p.width?"visible":"hidden",...h},o&&H.createElement("rect",{width:p.width+2*r[0],x:-r[0],y:-r[1],height:p.height+2*r[1],className:"react-flow__edge-textbg",style:s,rx:l,ry:l}),H.createElement("text",{className:"react-flow__edge-text",y:p.height/2,dy:"0.3em",ref:u,style:i},t),a)};var dk=N.memo(uk);const Fa=n=>({width:n.offsetWidth,height:n.offsetHeight}),ji=(n,e=0,t=1)=>Math.min(Math.max(n,e),t),$a=(n={x:0,y:0},e)=>({x:ji(n.x,e[0][0],e[1][0]),y:ji(n.y,e[0][1],e[1][1])}),Kh=(n,e,t)=>n<e?ji(Math.abs(n-e),1,50)/50:n>t?-ji(Math.abs(n-t),1,50)/50:0,tp=(n,e)=>{const t=Kh(n.x,35,e.width-35)*20,i=Kh(n.y,35,e.height-35)*20;return[t,i]},np=n=>{var e;return((e=n.getRootNode)==null?void 0:e.call(n))||(window==null?void 0:window.document)},ip=(n,e)=>({x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x2,e.x2),y2:Math.max(n.y2,e.y2)}),vo=({x:n,y:e,width:t,height:i})=>({x:n,y:e,x2:n+t,y2:e+i}),op=({x:n,y:e,x2:t,y2:i})=>({x:n,y:e,width:t-n,height:i-e}),Qh=n=>({...n.positionAbsolute||{x:0,y:0},width:n.width||0,height:n.height||0}),fk=(n,e)=>op(ip(vo(n),vo(e))),Zl=(n,e)=>{const t=Math.max(0,Math.min(n.x+n.width,e.x+e.width)-Math.max(n.x,e.x)),i=Math.max(0,Math.min(n.y+n.height,e.y+e.height)-Math.max(n.y,e.y));return Math.ceil(t*i)},pk=n=>wt(n.width)&&wt(n.height)&&wt(n.x)&&wt(n.y),wt=n=>!isNaN(n)&&isFinite(n),Pe=Symbol.for("internals"),sp=["Enter"," ","Escape"],gk=(n,e)=>{},mk=n=>"nativeEvent"in n;function ea(n){var o,s;const e=mk(n)?n.nativeEvent:n,t=((s=(o=e.composedPath)==null?void 0:o.call(e))==null?void 0:s[0])||n.target;return["INPUT","SELECT","TEXTAREA"].includes(t==null?void 0:t.nodeName)||(t==null?void 0:t.hasAttribute("contenteditable"))||!!(t!=null&&t.closest(".nokey"))}const rp=n=>"clientX"in n,_n=(n,e)=>{var s,r;const t=rp(n),i=t?n.clientX:(s=n.touches)==null?void 0:s[0].clientX,o=t?n.clientY:(r=n.touches)==null?void 0:r[0].clientY;return{x:i-((e==null?void 0:e.left)??0),y:o-((e==null?void 0:e.top)??0)}},qs=()=>{var n;return typeof navigator<"u"&&((n=navigator==null?void 0:navigator.userAgent)==null?void 0:n.indexOf("Mac"))>=0},Mo=({id:n,path:e,labelX:t,labelY:i,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:l,labelBgPadding:a,labelBgBorderRadius:c,style:h,markerEnd:u,markerStart:p,interactionWidth:g=20})=>H.createElement(H.Fragment,null,H.createElement("path",{id:n,style:h,d:e,fill:"none",className:"react-flow__edge-path",markerEnd:u,markerStart:p}),g&&H.createElement("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:g,className:"react-flow__edge-interaction"}),o&&wt(t)&&wt(i)?H.createElement(dk,{x:t,y:i,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:l,labelBgPadding:a,labelBgBorderRadius:c}):null);Mo.displayName="BaseEdge";function Wi(n,e,t){return t===void 0?t:i=>{const o=e().edges.find(s=>s.id===n);o&&t(i,{...o})}}function lp({sourceX:n,sourceY:e,targetX:t,targetY:i}){const o=Math.abs(t-n)/2,s=t<n?t+o:t-o,r=Math.abs(i-e)/2,l=i<e?i+r:i-r;return[s,l,o,r]}function ap({sourceX:n,sourceY:e,targetX:t,targetY:i,sourceControlX:o,sourceControlY:s,targetControlX:r,targetControlY:l}){const a=n*.125+o*.375+r*.375+t*.125,c=e*.125+s*.375+l*.375+i*.125,h=Math.abs(a-n),u=Math.abs(c-e);return[a,c,h,u]}var ii;(function(n){n.Strict="strict",n.Loose="loose"})(ii||(ii={}));var Yn;(function(n){n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal"})(Yn||(Yn={}));var wo;(function(n){n.Partial="partial",n.Full="full"})(wo||(wo={}));var Cn;(function(n){n.Bezier="default",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n.SimpleBezier="simplebezier"})(Cn||(Cn={}));var Ks;(function(n){n.Arrow="arrow",n.ArrowClosed="arrowclosed"})(Ks||(Ks={}));var ee;(function(n){n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom"})(ee||(ee={}));function Yh({pos:n,x1:e,y1:t,x2:i,y2:o}){return n===ee.Left||n===ee.Right?[.5*(e+i),t]:[e,.5*(t+o)]}function cp({sourceX:n,sourceY:e,sourcePosition:t=ee.Bottom,targetX:i,targetY:o,targetPosition:s=ee.Top}){const[r,l]=Yh({pos:t,x1:n,y1:e,x2:i,y2:o}),[a,c]=Yh({pos:s,x1:i,y1:o,x2:n,y2:e}),[h,u,p,g]=ap({sourceX:n,sourceY:e,targetX:i,targetY:o,sourceControlX:r,sourceControlY:l,targetControlX:a,targetControlY:c});return[`M${n},${e} C${r},${l} ${a},${c} ${i},${o}`,h,u,p,g]}const Wa=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:i,sourcePosition:o=ee.Bottom,targetPosition:s=ee.Top,label:r,labelStyle:l,labelShowBg:a,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:p,markerEnd:g,markerStart:y,interactionWidth:m})=>{const[b,x,T]=cp({sourceX:n,sourceY:e,sourcePosition:o,targetX:t,targetY:i,targetPosition:s});return H.createElement(Mo,{path:b,labelX:x,labelY:T,label:r,labelStyle:l,labelShowBg:a,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:p,markerEnd:g,markerStart:y,interactionWidth:m})});Wa.displayName="SimpleBezierEdge";const Xh={[ee.Left]:{x:-1,y:0},[ee.Right]:{x:1,y:0},[ee.Top]:{x:0,y:-1},[ee.Bottom]:{x:0,y:1}},yk=({source:n,sourcePosition:e=ee.Bottom,target:t})=>e===ee.Left||e===ee.Right?n.x<t.x?{x:1,y:0}:{x:-1,y:0}:n.y<t.y?{x:0,y:1}:{x:0,y:-1},Gh=(n,e)=>Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));function xk({source:n,sourcePosition:e=ee.Bottom,target:t,targetPosition:i=ee.Top,center:o,offset:s}){const r=Xh[e],l=Xh[i],a={x:n.x+r.x*s,y:n.y+r.y*s},c={x:t.x+l.x*s,y:t.y+l.y*s},h=yk({source:a,sourcePosition:e,target:c}),u=h.x!==0?"x":"y",p=h[u];let g=[],y,m;const b={x:0,y:0},x={x:0,y:0},[T,k,E,M]=lp({sourceX:n.x,sourceY:n.y,targetX:t.x,targetY:t.y});if(r[u]*l[u]===-1){y=o.x??T,m=o.y??k;const C=[{x:y,y:a.y},{x:y,y:c.y}],P=[{x:a.x,y:m},{x:c.x,y:m}];r[u]===p?g=u==="x"?C:P:g=u==="x"?P:C}else{const C=[{x:a.x,y:c.y}],P=[{x:c.x,y:a.y}];if(u==="x"?g=r.x===p?P:C:g=r.y===p?C:P,e===i){const W=Math.abs(n[u]-t[u]);if(W<=s){const w=Math.min(s-1,s-W);r[u]===p?b[u]=(a[u]>n[u]?-1:1)*w:x[u]=(c[u]>t[u]?-1:1)*w}}if(e!==i){const W=u==="x"?"y":"x",w=r[u]===l[W],O=a[W]>c[W],S=a[W]<c[W];(r[u]===1&&(!w&&O||w&&S)||r[u]!==1&&(!w&&S||w&&O))&&(g=u==="x"?C:P)}const R={x:a.x+b.x,y:a.y+b.y},$={x:c.x+x.x,y:c.y+x.y},F=Math.max(Math.abs(R.x-g[0].x),Math.abs($.x-g[0].x)),L=Math.max(Math.abs(R.y-g[0].y),Math.abs($.y-g[0].y));F>=L?(y=(R.x+$.x)/2,m=g[0].y):(y=g[0].x,m=(R.y+$.y)/2)}return[[n,{x:a.x+b.x,y:a.y+b.y},...g,{x:c.x+x.x,y:c.y+x.y},t],y,m,E,M]}function bk(n,e,t,i){const o=Math.min(Gh(n,e)/2,Gh(e,t)/2,i),{x:s,y:r}=e;if(n.x===s&&s===t.x||n.y===r&&r===t.y)return`L${s} ${r}`;if(n.y===r){const c=n.x<t.x?-1:1,h=n.y<t.y?1:-1;return`L ${s+o*c},${r}Q ${s},${r} ${s},${r+o*h}`}const l=n.x<t.x?1:-1,a=n.y<t.y?-1:1;return`L ${s},${r+o*a}Q ${s},${r} ${s+o*l},${r}`}function ta({sourceX:n,sourceY:e,sourcePosition:t=ee.Bottom,targetX:i,targetY:o,targetPosition:s=ee.Top,borderRadius:r=5,centerX:l,centerY:a,offset:c=20}){const[h,u,p,g,y]=xk({source:{x:n,y:e},sourcePosition:t,target:{x:i,y:o},targetPosition:s,center:{x:l,y:a},offset:c});return[h.reduce((b,x,T)=>{let k="";return T>0&&T<h.length-1?k=bk(h[T-1],x,h[T+1],r):k=`${T===0?"M":"L"}${x.x} ${x.y}`,b+=k,b},""),u,p,g,y]}const ar=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:i,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:l,labelBgPadding:a,labelBgBorderRadius:c,style:h,sourcePosition:u=ee.Bottom,targetPosition:p=ee.Top,markerEnd:g,markerStart:y,pathOptions:m,interactionWidth:b})=>{const[x,T,k]=ta({sourceX:n,sourceY:e,sourcePosition:u,targetX:t,targetY:i,targetPosition:p,borderRadius:m==null?void 0:m.borderRadius,offset:m==null?void 0:m.offset});return H.createElement(Mo,{path:x,labelX:T,labelY:k,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:l,labelBgPadding:a,labelBgBorderRadius:c,style:h,markerEnd:g,markerStart:y,interactionWidth:b})});ar.displayName="SmoothStepEdge";const Ha=N.memo(n=>{var e;return H.createElement(ar,{...n,pathOptions:N.useMemo(()=>{var t;return{borderRadius:0,offset:(t=n.pathOptions)==null?void 0:t.offset}},[(e=n.pathOptions)==null?void 0:e.offset])})});Ha.displayName="StepEdge";function vk({sourceX:n,sourceY:e,targetX:t,targetY:i}){const[o,s,r,l]=lp({sourceX:n,sourceY:e,targetX:t,targetY:i});return[`M ${n},${e}L ${t},${i}`,o,s,r,l]}const Va=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:i,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:l,labelBgPadding:a,labelBgBorderRadius:c,style:h,markerEnd:u,markerStart:p,interactionWidth:g})=>{const[y,m,b]=vk({sourceX:n,sourceY:e,targetX:t,targetY:i});return H.createElement(Mo,{path:y,labelX:m,labelY:b,label:o,labelStyle:s,labelShowBg:r,labelBgStyle:l,labelBgPadding:a,labelBgBorderRadius:c,style:h,markerEnd:u,markerStart:p,interactionWidth:g})});Va.displayName="StraightEdge";function is(n,e){return n>=0?.5*n:e*25*Math.sqrt(-n)}function Jh({pos:n,x1:e,y1:t,x2:i,y2:o,c:s}){switch(n){case ee.Left:return[e-is(e-i,s),t];case ee.Right:return[e+is(i-e,s),t];case ee.Top:return[e,t-is(t-o,s)];case ee.Bottom:return[e,t+is(o-t,s)]}}function hp({sourceX:n,sourceY:e,sourcePosition:t=ee.Bottom,targetX:i,targetY:o,targetPosition:s=ee.Top,curvature:r=.25}){const[l,a]=Jh({pos:t,x1:n,y1:e,x2:i,y2:o,c:r}),[c,h]=Jh({pos:s,x1:i,y1:o,x2:n,y2:e,c:r}),[u,p,g,y]=ap({sourceX:n,sourceY:e,targetX:i,targetY:o,sourceControlX:l,sourceControlY:a,targetControlX:c,targetControlY:h});return[`M${n},${e} C${l},${a} ${c},${h} ${i},${o}`,u,p,g,y]}const Qs=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:i,sourcePosition:o=ee.Bottom,targetPosition:s=ee.Top,label:r,labelStyle:l,labelShowBg:a,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:p,markerEnd:g,markerStart:y,pathOptions:m,interactionWidth:b})=>{const[x,T,k]=hp({sourceX:n,sourceY:e,sourcePosition:o,targetX:t,targetY:i,targetPosition:s,curvature:m==null?void 0:m.curvature});return H.createElement(Mo,{path:x,labelX:T,labelY:k,label:r,labelStyle:l,labelShowBg:a,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:u,style:p,markerEnd:g,markerStart:y,interactionWidth:b})});Qs.displayName="BezierEdge";const Ua=N.createContext(null),wk=Ua.Provider;Ua.Consumer;const Sk=()=>N.useContext(Ua),kk=n=>"id"in n&&"source"in n&&"target"in n,Ck=({source:n,sourceHandle:e,target:t,targetHandle:i})=>`reactflow__edge-${n}${e||""}-${t}${i||""}`,na=(n,e)=>typeof n>"u"?"":typeof n=="string"?n:`${e?`${e}__`:""}${Object.keys(n).sort().map(i=>`${i}=${n[i]}`).join("&")}`,Tk=(n,e)=>e.some(t=>t.source===n.source&&t.target===n.target&&(t.sourceHandle===n.sourceHandle||!t.sourceHandle&&!n.sourceHandle)&&(t.targetHandle===n.targetHandle||!t.targetHandle&&!n.targetHandle)),up=(n,e)=>{if(!n.source||!n.target)return e;let t;return kk(n)?t={...n}:t={...n,id:Ck(n)},Tk(t,e)?e:e.concat(t)},ia=({x:n,y:e},[t,i,o],s,[r,l])=>{const a={x:(n-t)/o,y:(e-i)/o};return s?{x:r*Math.round(a.x/r),y:l*Math.round(a.y/l)}:a},dp=({x:n,y:e},[t,i,o])=>({x:n*o+t,y:e*o+i}),Zn=(n,e=[0,0])=>{if(!n)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const t=(n.width??0)*e[0],i=(n.height??0)*e[1],o={x:n.position.x-t,y:n.position.y-i};return{...o,positionAbsolute:n.positionAbsolute?{x:n.positionAbsolute.x-t,y:n.positionAbsolute.y-i}:o}},cr=(n,e=[0,0])=>{if(n.length===0)return{x:0,y:0,width:0,height:0};const t=n.reduce((i,o)=>{const{x:s,y:r}=Zn(o,e).positionAbsolute;return ip(i,vo({x:s,y:r,width:o.width||0,height:o.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return op(t)},fp=(n,e,[t,i,o]=[0,0,1],s=!1,r=!1,l=[0,0])=>{const a={x:(e.x-t)/o,y:(e.y-i)/o,width:e.width/o,height:e.height/o},c=[];return n.forEach(h=>{const{width:u,height:p,selectable:g=!0,hidden:y=!1}=h;if(r&&!g||y)return!1;const{positionAbsolute:m}=Zn(h,l),b={x:m.x,y:m.y,width:u||0,height:p||0},x=Zl(a,b),T=typeof u>"u"||typeof p>"u"||u===null||p===null,k=s&&x>0,E=(u||0)*(p||0);(T||k||x>=E||h.dragging)&&c.push(h)}),c},pp=(n,e)=>{const t=n.map(i=>i.id);return e.filter(i=>t.includes(i.source)||t.includes(i.target))},gp=(n,e,t,i,o,s=.1)=>{const r=e/(n.width*(1+s)),l=t/(n.height*(1+s)),a=Math.min(r,l),c=ji(a,i,o),h=n.x+n.width/2,u=n.y+n.height/2,p=e/2-h*c,g=t/2-u*c;return{x:p,y:g,zoom:c}},Hn=(n,e=0)=>n.transition().duration(e);function Zh(n,e,t,i){return(e[t]||[]).reduce((o,s)=>{var r,l;return`${n.id}-${s.id}-${t}`!==i&&o.push({id:s.id||null,type:t,nodeId:n.id,x:(((r=n.positionAbsolute)==null?void 0:r.x)??0)+s.x+s.width/2,y:(((l=n.positionAbsolute)==null?void 0:l.y)??0)+s.y+s.height/2}),o},[])}function Ek(n,e,t,i,o,s){const{x:r,y:l}=_n(n),c=e.elementsFromPoint(r,l).find(y=>y.classList.contains("react-flow__handle"));if(c){const y=c.getAttribute("data-nodeid");if(y){const m=qa(void 0,c),b=c.getAttribute("data-handleid"),x=s({nodeId:y,id:b,type:m});if(x){const T=o.find(k=>k.nodeId===y&&k.type===m&&k.id===b);return{handle:{id:b,type:m,nodeId:y,x:(T==null?void 0:T.x)||t.x,y:(T==null?void 0:T.y)||t.y},validHandleResult:x}}}}let h=[],u=1/0;if(o.forEach(y=>{const m=Math.sqrt((y.x-t.x)**2+(y.y-t.y)**2);if(m<=i){const b=s(y);m<=u&&(m<u?h=[{handle:y,validHandleResult:b}]:m===u&&h.push({handle:y,validHandleResult:b}),u=m)}}),!h.length)return{handle:null,validHandleResult:mp()};if(h.length===1)return h[0];const p=h.some(({validHandleResult:y})=>y.isValid),g=h.some(({handle:y})=>y.type==="target");return h.find(({handle:y,validHandleResult:m})=>g?y.type==="target":p?m.isValid:!0)||h[0]}const Ak={source:null,target:null,sourceHandle:null,targetHandle:null},mp=()=>({handleDomNode:null,isValid:!1,connection:Ak,endHandle:null});function yp(n,e,t,i,o,s,r){const l=o==="target",a=r.querySelector(`.react-flow__handle[data-id="${n==null?void 0:n.nodeId}-${n==null?void 0:n.id}-${n==null?void 0:n.type}"]`),c={...mp(),handleDomNode:a};if(a){const h=qa(void 0,a),u=a.getAttribute("data-nodeid"),p=a.getAttribute("data-handleid"),g=a.classList.contains("connectable"),y=a.classList.contains("connectableend"),m={source:l?u:t,sourceHandle:l?p:i,target:l?t:u,targetHandle:l?i:p};c.connection=m,g&&y&&(e===ii.Strict?l&&h==="source"||!l&&h==="target":u!==t||p!==i)&&(c.endHandle={nodeId:u,handleId:p,type:h},c.isValid=s(m))}return c}function _k({nodes:n,nodeId:e,handleId:t,handleType:i}){return n.reduce((o,s)=>{if(s[Pe]){const{handleBounds:r}=s[Pe];let l=[],a=[];r&&(l=Zh(s,r,"source",`${e}-${t}-${i}`),a=Zh(s,r,"target",`${e}-${t}-${i}`)),o.push(...l,...a)}return o},[])}function qa(n,e){return n||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function qr(n){n==null||n.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function Mk(n,e){let t=null;return e?t="valid":n&&!e&&(t="invalid"),t}function xp({event:n,handleId:e,nodeId:t,onConnect:i,isTarget:o,getState:s,setState:r,isValidConnection:l,edgeUpdaterType:a,onReconnectEnd:c}){const h=np(n.target),{connectionMode:u,domNode:p,autoPanOnConnect:g,connectionRadius:y,onConnectStart:m,panBy:b,getNodes:x,cancelConnection:T}=s();let k=0,E;const{x:M,y:_}=_n(n),C=h==null?void 0:h.elementFromPoint(M,_),P=qa(a,C),R=p==null?void 0:p.getBoundingClientRect();if(!R||!P)return;let $,F=_n(n,R),L=!1,W=null,w=!1,O=null;const S=_k({nodes:x(),nodeId:t,handleId:e,handleType:P}),z=()=>{if(!g)return;const[D,B]=tp(F,R);b({x:D,y:B}),k=requestAnimationFrame(z)};r({connectionPosition:F,connectionStatus:null,connectionNodeId:t,connectionHandleId:e,connectionHandleType:P,connectionStartHandle:{nodeId:t,handleId:e,type:P},connectionEndHandle:null}),m==null||m(n,{nodeId:t,handleId:e,handleType:P});function j(D){const{transform:B}=s();F=_n(D,R);const{handle:I,validHandleResult:V}=Ek(D,h,ia(F,B,!1,[1,1]),y,S,Q=>yp(Q,u,t,e,o?"target":"source",l,h));if(E=I,L||(z(),L=!0),O=V.handleDomNode,W=V.connection,w=V.isValid,r({connectionPosition:E&&w?dp({x:E.x,y:E.y},B):F,connectionStatus:Mk(!!E,w),connectionEndHandle:V.endHandle}),!E&&!w&&!O)return qr($);W.source!==W.target&&O&&(qr($),$=O,O.classList.add("connecting","react-flow__handle-connecting"),O.classList.toggle("valid",w),O.classList.toggle("react-flow__handle-valid",w))}function v(D){var B,I;(E||O)&&W&&w&&(i==null||i(W)),(I=(B=s()).onConnectEnd)==null||I.call(B,D),a&&(c==null||c(D)),qr($),T(),cancelAnimationFrame(k),L=!1,w=!1,W=null,O=null,h.removeEventListener("mousemove",j),h.removeEventListener("mouseup",v),h.removeEventListener("touchmove",j),h.removeEventListener("touchend",v)}h.addEventListener("mousemove",j),h.addEventListener("mouseup",v),h.addEventListener("touchmove",j),h.addEventListener("touchend",v)}const eu=()=>!0,Ok=n=>({connectionStartHandle:n.connectionStartHandle,connectOnClick:n.connectOnClick,noPanClassName:n.noPanClassName}),Nk=(n,e,t)=>i=>{const{connectionStartHandle:o,connectionEndHandle:s,connectionClickStartHandle:r}=i;return{connecting:(o==null?void 0:o.nodeId)===n&&(o==null?void 0:o.handleId)===e&&(o==null?void 0:o.type)===t||(s==null?void 0:s.nodeId)===n&&(s==null?void 0:s.handleId)===e&&(s==null?void 0:s.type)===t,clickConnecting:(r==null?void 0:r.nodeId)===n&&(r==null?void 0:r.handleId)===e&&(r==null?void 0:r.type)===t}},bp=N.forwardRef(({type:n="source",position:e=ee.Top,isValidConnection:t,isConnectable:i=!0,isConnectableStart:o=!0,isConnectableEnd:s=!0,id:r,onConnect:l,children:a,className:c,onMouseDown:h,onTouchStart:u,...p},g)=>{var R,$;const y=r||null,m=n==="target",b=He(),x=Sk(),{connectOnClick:T,noPanClassName:k}=Me(Ok,qe),{connecting:E,clickConnecting:M}=Me(Nk(x,y,n),qe);x||($=(R=b.getState()).onError)==null||$.call(R,"010",dn.error010());const _=F=>{const{defaultEdgeOptions:L,onConnect:W,hasDefaultEdges:w}=b.getState(),O={...L,...F};if(w){const{edges:S,setEdges:z}=b.getState();z(up(O,S))}W==null||W(O),l==null||l(O)},C=F=>{if(!x)return;const L=rp(F);o&&(L&&F.button===0||!L)&&xp({event:F,handleId:y,nodeId:x,onConnect:_,isTarget:m,getState:b.getState,setState:b.setState,isValidConnection:t||b.getState().isValidConnection||eu}),L?h==null||h(F):u==null||u(F)},P=F=>{const{onClickConnectStart:L,onClickConnectEnd:W,connectionClickStartHandle:w,connectionMode:O,isValidConnection:S}=b.getState();if(!x||!w&&!o)return;if(!w){L==null||L(F,{nodeId:x,handleId:y,handleType:n}),b.setState({connectionClickStartHandle:{nodeId:x,type:n,handleId:y}});return}const z=np(F.target),j=t||S||eu,{connection:v,isValid:D}=yp({nodeId:x,id:y,type:n},O,w.nodeId,w.handleId||null,w.type,j,z);D&&_(v),W==null||W(F),b.setState({connectionClickStartHandle:null})};return H.createElement("div",{"data-handleid":y,"data-nodeid":x,"data-handlepos":e,"data-id":`${x}-${y}-${n}`,className:Xe(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",k,c,{source:!m,target:m,connectable:i,connectablestart:o,connectableend:s,connecting:M,connectionindicator:i&&(o&&!E||s&&E)}]),onMouseDown:C,onTouchStart:C,onClick:T?P:void 0,ref:g,...p},a)});bp.displayName="Handle";var Ye=N.memo(bp);const vp=({data:n,isConnectable:e,targetPosition:t=ee.Top,sourcePosition:i=ee.Bottom})=>H.createElement(H.Fragment,null,H.createElement(Ye,{type:"target",position:t,isConnectable:e}),n==null?void 0:n.label,H.createElement(Ye,{type:"source",position:i,isConnectable:e}));vp.displayName="DefaultNode";var oa=N.memo(vp);const wp=({data:n,isConnectable:e,sourcePosition:t=ee.Bottom})=>H.createElement(H.Fragment,null,n==null?void 0:n.label,H.createElement(Ye,{type:"source",position:t,isConnectable:e}));wp.displayName="InputNode";var Sp=N.memo(wp);const kp=({data:n,isConnectable:e,targetPosition:t=ee.Top})=>H.createElement(H.Fragment,null,H.createElement(Ye,{type:"target",position:t,isConnectable:e}),n==null?void 0:n.label);kp.displayName="OutputNode";var Cp=N.memo(kp);const Ka=()=>null;Ka.displayName="GroupNode";const Rk=n=>({selectedNodes:n.getNodes().filter(e=>e.selected),selectedEdges:n.edges.filter(e=>e.selected).map(e=>({...e}))}),os=n=>n.id;function jk(n,e){return qe(n.selectedNodes.map(os),e.selectedNodes.map(os))&&qe(n.selectedEdges.map(os),e.selectedEdges.map(os))}const Tp=N.memo(({onSelectionChange:n})=>{const e=He(),{selectedNodes:t,selectedEdges:i}=Me(Rk,jk);return N.useEffect(()=>{const o={nodes:t,edges:i};n==null||n(o),e.getState().onSelectionChange.forEach(s=>s(o))},[t,i,n]),null});Tp.displayName="SelectionListener";const Dk=n=>!!n.onSelectionChange;function Bk({onSelectionChange:n}){const e=Me(Dk);return n||e?H.createElement(Tp,{onSelectionChange:n}):null}const Pk=n=>({setNodes:n.setNodes,setEdges:n.setEdges,setDefaultNodesAndEdges:n.setDefaultNodesAndEdges,setMinZoom:n.setMinZoom,setMaxZoom:n.setMaxZoom,setTranslateExtent:n.setTranslateExtent,setNodeExtent:n.setNodeExtent,reset:n.reset});function si(n,e){N.useEffect(()=>{typeof n<"u"&&e(n)},[n])}function fe(n,e,t){N.useEffect(()=>{typeof e<"u"&&t({[n]:e})},[e])}const Ik=({nodes:n,edges:e,defaultNodes:t,defaultEdges:i,onConnect:o,onConnectStart:s,onConnectEnd:r,onClickConnectStart:l,onClickConnectEnd:a,nodesDraggable:c,nodesConnectable:h,nodesFocusable:u,edgesFocusable:p,edgesUpdatable:g,elevateNodesOnSelect:y,minZoom:m,maxZoom:b,nodeExtent:x,onNodesChange:T,onEdgesChange:k,elementsSelectable:E,connectionMode:M,snapGrid:_,snapToGrid:C,translateExtent:P,connectOnClick:R,defaultEdgeOptions:$,fitView:F,fitViewOptions:L,onNodesDelete:W,onEdgesDelete:w,onNodeDrag:O,onNodeDragStart:S,onNodeDragStop:z,onSelectionDrag:j,onSelectionDragStart:v,onSelectionDragStop:D,noPanClassName:B,nodeOrigin:I,rfId:V,autoPanOnConnect:Q,autoPanOnNodeDrag:J,onError:se,connectionRadius:le,isValidConnection:xe,nodeDragThreshold:ge})=>{const{setNodes:ue,setEdges:Ne,setDefaultNodesAndEdges:Oe,setMinZoom:Re,setMaxZoom:be,setTranslateExtent:de,setNodeExtent:Fe,reset:U}=Me(Pk,qe),q=He();return N.useEffect(()=>{const G=i==null?void 0:i.map(ae=>({...ae,...$}));return Oe(t,G),()=>{U()}},[]),fe("defaultEdgeOptions",$,q.setState),fe("connectionMode",M,q.setState),fe("onConnect",o,q.setState),fe("onConnectStart",s,q.setState),fe("onConnectEnd",r,q.setState),fe("onClickConnectStart",l,q.setState),fe("onClickConnectEnd",a,q.setState),fe("nodesDraggable",c,q.setState),fe("nodesConnectable",h,q.setState),fe("nodesFocusable",u,q.setState),fe("edgesFocusable",p,q.setState),fe("edgesUpdatable",g,q.setState),fe("elementsSelectable",E,q.setState),fe("elevateNodesOnSelect",y,q.setState),fe("snapToGrid",C,q.setState),fe("snapGrid",_,q.setState),fe("onNodesChange",T,q.setState),fe("onEdgesChange",k,q.setState),fe("connectOnClick",R,q.setState),fe("fitViewOnInit",F,q.setState),fe("fitViewOnInitOptions",L,q.setState),fe("onNodesDelete",W,q.setState),fe("onEdgesDelete",w,q.setState),fe("onNodeDrag",O,q.setState),fe("onNodeDragStart",S,q.setState),fe("onNodeDragStop",z,q.setState),fe("onSelectionDrag",j,q.setState),fe("onSelectionDragStart",v,q.setState),fe("onSelectionDragStop",D,q.setState),fe("noPanClassName",B,q.setState),fe("nodeOrigin",I,q.setState),fe("rfId",V,q.setState),fe("autoPanOnConnect",Q,q.setState),fe("autoPanOnNodeDrag",J,q.setState),fe("onError",se,q.setState),fe("connectionRadius",le,q.setState),fe("isValidConnection",xe,q.setState),fe("nodeDragThreshold",ge,q.setState),si(n,ue),si(e,Ne),si(m,Re),si(b,be),si(P,de),si(x,Fe),null},tu={display:"none"},zk={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ep="react-flow__node-desc",Ap="react-flow__edge-desc",Lk="react-flow__aria-live",Fk=n=>n.ariaLiveMessage;function $k({rfId:n}){const e=Me(Fk);return H.createElement("div",{id:`${Lk}-${n}`,"aria-live":"assertive","aria-atomic":"true",style:zk},e)}function Wk({rfId:n,disableKeyboardA11y:e}){return H.createElement(H.Fragment,null,H.createElement("div",{id:`${Ep}-${n}`,style:tu},"Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),H.createElement("div",{id:`${Ap}-${n}`,style:tu},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!e&&H.createElement($k,{rfId:n}))}var So=(n=null,e={actInsideInputWithModifier:!0})=>{const[t,i]=N.useState(!1),o=N.useRef(!1),s=N.useRef(new Set([])),[r,l]=N.useMemo(()=>{if(n!==null){const c=(Array.isArray(n)?n:[n]).filter(u=>typeof u=="string").map(u=>u.split("+")),h=c.reduce((u,p)=>u.concat(...p),[]);return[c,h]}return[[],[]]},[n]);return N.useEffect(()=>{const a=typeof document<"u"?document:null,c=(e==null?void 0:e.target)||a;if(n!==null){const h=g=>{if(o.current=g.ctrlKey||g.metaKey||g.shiftKey,(!o.current||o.current&&!e.actInsideInputWithModifier)&&ea(g))return!1;const m=iu(g.code,l);s.current.add(g[m]),nu(r,s.current,!1)&&(g.preventDefault(),i(!0))},u=g=>{if((!o.current||o.current&&!e.actInsideInputWithModifier)&&ea(g))return!1;const m=iu(g.code,l);nu(r,s.current,!0)?(i(!1),s.current.clear()):s.current.delete(g[m]),g.key==="Meta"&&s.current.clear(),o.current=!1},p=()=>{s.current.clear(),i(!1)};return c==null||c.addEventListener("keydown",h),c==null||c.addEventListener("keyup",u),window.addEventListener("blur",p),()=>{c==null||c.removeEventListener("keydown",h),c==null||c.removeEventListener("keyup",u),window.removeEventListener("blur",p)}}},[n,i]),t};function nu(n,e,t){return n.filter(i=>t||i.length===e.size).some(i=>i.every(o=>e.has(o)))}function iu(n,e){return e.includes(n)?"code":"key"}function _p(n,e,t,i){var l,a;const o=n.parentNode||n.parentId;if(!o)return t;const s=e.get(o),r=Zn(s,i);return _p(s,e,{x:(t.x??0)+r.x,y:(t.y??0)+r.y,z:(((l=s[Pe])==null?void 0:l.z)??0)>(t.z??0)?((a=s[Pe])==null?void 0:a.z)??0:t.z??0},i)}function Mp(n,e,t){n.forEach(i=>{var s;const o=i.parentNode||i.parentId;if(o&&!n.has(o))throw new Error(`Parent node ${o} not found`);if(o||t!=null&&t[i.id]){const{x:r,y:l,z:a}=_p(i,n,{...i.position,z:((s=i[Pe])==null?void 0:s.z)??0},e);i.positionAbsolute={x:r,y:l},i[Pe].z=a,t!=null&&t[i.id]&&(i[Pe].isParent=!0)}})}function Kr(n,e,t,i){const o=new Map,s={},r=i?1e3:0;return n.forEach(l=>{var g;const a=(wt(l.zIndex)?l.zIndex:0)+(l.selected?r:0),c=e.get(l.id),h={...l,positionAbsolute:{x:l.position.x,y:l.position.y}},u=l.parentNode||l.parentId;u&&(s[u]=!0);const p=(c==null?void 0:c.type)&&(c==null?void 0:c.type)!==l.type;Object.defineProperty(h,Pe,{enumerable:!1,value:{handleBounds:p||(g=c==null?void 0:c[Pe])==null?void 0:g.handleBounds,z:a}}),o.set(l.id,h)}),Mp(o,t,s),o}function Op(n,e={}){const{getNodes:t,width:i,height:o,minZoom:s,maxZoom:r,d3Zoom:l,d3Selection:a,fitViewOnInitDone:c,fitViewOnInit:h,nodeOrigin:u}=n(),p=e.initial&&!c&&h;if(l&&a&&(p||!e.initial)){const y=t().filter(b=>{var T;const x=e.includeHiddenNodes?b.width&&b.height:!b.hidden;return(T=e.nodes)!=null&&T.length?x&&e.nodes.some(k=>k.id===b.id):x}),m=y.every(b=>b.width&&b.height);if(y.length>0&&m){const b=cr(y,u),{x,y:T,zoom:k}=gp(b,i,o,e.minZoom??s,e.maxZoom??r,e.padding??.1),E=cn.translate(x,T).scale(k);return typeof e.duration=="number"&&e.duration>0?l.transform(Hn(a,e.duration),E):l.transform(a,E),!0}}return!1}function Hk(n,e){return n.forEach(t=>{const i=e.get(t.id);i&&e.set(i.id,{...i,[Pe]:i[Pe],selected:t.selected})}),new Map(e)}function Vk(n,e){return e.map(t=>{const i=n.find(o=>o.id===t.id);return i&&(t.selected=i.selected),t})}function ss({changedNodes:n,changedEdges:e,get:t,set:i}){const{nodeInternals:o,edges:s,onNodesChange:r,onEdgesChange:l,hasDefaultNodes:a,hasDefaultEdges:c}=t();n!=null&&n.length&&(a&&i({nodeInternals:Hk(n,o)}),r==null||r(n)),e!=null&&e.length&&(c&&i({edges:Vk(e,s)}),l==null||l(e))}const ri=()=>{},Uk={zoomIn:ri,zoomOut:ri,zoomTo:ri,getZoom:()=>1,setViewport:ri,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:ri,fitBounds:ri,project:n=>n,screenToFlowPosition:n=>n,flowToScreenPosition:n=>n,viewportInitialized:!1},qk=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection}),Kk=()=>{const n=He(),{d3Zoom:e,d3Selection:t}=Me(qk,qe);return N.useMemo(()=>t&&e?{zoomIn:o=>e.scaleBy(Hn(t,o==null?void 0:o.duration),1.2),zoomOut:o=>e.scaleBy(Hn(t,o==null?void 0:o.duration),1/1.2),zoomTo:(o,s)=>e.scaleTo(Hn(t,s==null?void 0:s.duration),o),getZoom:()=>n.getState().transform[2],setViewport:(o,s)=>{const[r,l,a]=n.getState().transform,c=cn.translate(o.x??r,o.y??l).scale(o.zoom??a);e.transform(Hn(t,s==null?void 0:s.duration),c)},getViewport:()=>{const[o,s,r]=n.getState().transform;return{x:o,y:s,zoom:r}},fitView:o=>Op(n.getState,o),setCenter:(o,s,r)=>{const{width:l,height:a,maxZoom:c}=n.getState(),h=typeof(r==null?void 0:r.zoom)<"u"?r.zoom:c,u=l/2-o*h,p=a/2-s*h,g=cn.translate(u,p).scale(h);e.transform(Hn(t,r==null?void 0:r.duration),g)},fitBounds:(o,s)=>{const{width:r,height:l,minZoom:a,maxZoom:c}=n.getState(),{x:h,y:u,zoom:p}=gp(o,r,l,a,c,(s==null?void 0:s.padding)??.1),g=cn.translate(h,u).scale(p);e.transform(Hn(t,s==null?void 0:s.duration),g)},project:o=>{const{transform:s,snapToGrid:r,snapGrid:l}=n.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),ia(o,s,r,l)},screenToFlowPosition:o=>{const{transform:s,snapToGrid:r,snapGrid:l,domNode:a}=n.getState();if(!a)return o;const{x:c,y:h}=a.getBoundingClientRect(),u={x:o.x-c,y:o.y-h};return ia(u,s,r,l)},flowToScreenPosition:o=>{const{transform:s,domNode:r}=n.getState();if(!r)return o;const{x:l,y:a}=r.getBoundingClientRect(),c=dp(o,s);return{x:c.x+l,y:c.y+a}},viewportInitialized:!0}:Uk,[e,t])};function Qa(){const n=Kk(),e=He(),t=N.useCallback(()=>e.getState().getNodes().map(m=>({...m})),[]),i=N.useCallback(m=>e.getState().nodeInternals.get(m),[]),o=N.useCallback(()=>{const{edges:m=[]}=e.getState();return m.map(b=>({...b}))},[]),s=N.useCallback(m=>{const{edges:b=[]}=e.getState();return b.find(x=>x.id===m)},[]),r=N.useCallback(m=>{const{getNodes:b,setNodes:x,hasDefaultNodes:T,onNodesChange:k}=e.getState(),E=b(),M=typeof m=="function"?m(E):m;if(T)x(M);else if(k){const _=M.length===0?E.map(C=>({type:"remove",id:C.id})):M.map(C=>({item:C,type:"reset"}));k(_)}},[]),l=N.useCallback(m=>{const{edges:b=[],setEdges:x,hasDefaultEdges:T,onEdgesChange:k}=e.getState(),E=typeof m=="function"?m(b):m;if(T)x(E);else if(k){const M=E.length===0?b.map(_=>({type:"remove",id:_.id})):E.map(_=>({item:_,type:"reset"}));k(M)}},[]),a=N.useCallback(m=>{const b=Array.isArray(m)?m:[m],{getNodes:x,setNodes:T,hasDefaultNodes:k,onNodesChange:E}=e.getState();if(k){const _=[...x(),...b];T(_)}else if(E){const M=b.map(_=>({item:_,type:"add"}));E(M)}},[]),c=N.useCallback(m=>{const b=Array.isArray(m)?m:[m],{edges:x=[],setEdges:T,hasDefaultEdges:k,onEdgesChange:E}=e.getState();if(k)T([...x,...b]);else if(E){const M=b.map(_=>({item:_,type:"add"}));E(M)}},[]),h=N.useCallback(()=>{const{getNodes:m,edges:b=[],transform:x}=e.getState(),[T,k,E]=x;return{nodes:m().map(M=>({...M})),edges:b.map(M=>({...M})),viewport:{x:T,y:k,zoom:E}}},[]),u=N.useCallback(({nodes:m,edges:b})=>{const{nodeInternals:x,getNodes:T,edges:k,hasDefaultNodes:E,hasDefaultEdges:M,onNodesDelete:_,onEdgesDelete:C,onNodesChange:P,onEdgesChange:R}=e.getState(),$=(m||[]).map(O=>O.id),F=(b||[]).map(O=>O.id),L=T().reduce((O,S)=>{const z=S.parentNode||S.parentId,j=!$.includes(S.id)&&z&&O.find(D=>D.id===z);return(typeof S.deletable=="boolean"?S.deletable:!0)&&($.includes(S.id)||j)&&O.push(S),O},[]),W=k.filter(O=>typeof O.deletable=="boolean"?O.deletable:!0),w=W.filter(O=>F.includes(O.id));if(L||w){const O=pp(L,W),S=[...w,...O],z=S.reduce((j,v)=>(j.includes(v.id)||j.push(v.id),j),[]);if((M||E)&&(M&&e.setState({edges:k.filter(j=>!z.includes(j.id))}),E&&(L.forEach(j=>{x.delete(j.id)}),e.setState({nodeInternals:new Map(x)}))),z.length>0&&(C==null||C(S),R&&R(z.map(j=>({id:j,type:"remove"})))),L.length>0&&(_==null||_(L),P)){const j=L.map(v=>({id:v.id,type:"remove"}));P(j)}}},[]),p=N.useCallback(m=>{const b=pk(m),x=b?null:e.getState().nodeInternals.get(m.id);return!b&&!x?[null,null,b]:[b?m:Qh(x),x,b]},[]),g=N.useCallback((m,b=!0,x)=>{const[T,k,E]=p(m);return T?(x||e.getState().getNodes()).filter(M=>{if(!E&&(M.id===k.id||!M.positionAbsolute))return!1;const _=Qh(M),C=Zl(_,T);return b&&C>0||C>=T.width*T.height}):[]},[]),y=N.useCallback((m,b,x=!0)=>{const[T]=p(m);if(!T)return!1;const k=Zl(T,b);return x&&k>0||k>=T.width*T.height},[]);return N.useMemo(()=>({...n,getNodes:t,getNode:i,getEdges:o,getEdge:s,setNodes:r,setEdges:l,addNodes:a,addEdges:c,toObject:h,deleteElements:u,getIntersectingNodes:g,isNodeIntersecting:y}),[n,t,i,o,s,r,l,a,c,h,u,g,y])}const Qk={actInsideInputWithModifier:!1};var Yk=({deleteKeyCode:n,multiSelectionKeyCode:e})=>{const t=He(),{deleteElements:i}=Qa(),o=So(n,Qk),s=So(e);N.useEffect(()=>{if(o){const{edges:r,getNodes:l}=t.getState(),a=l().filter(h=>h.selected),c=r.filter(h=>h.selected);i({nodes:a,edges:c}),t.setState({nodesSelectionActive:!1})}},[o]),N.useEffect(()=>{t.setState({multiSelectionActive:s})},[s])};function Xk(n){const e=He();N.useEffect(()=>{let t;const i=()=>{var s,r;if(!n.current)return;const o=Fa(n.current);(o.height===0||o.width===0)&&((r=(s=e.getState()).onError)==null||r.call(s,"004",dn.error004())),e.setState({width:o.width||500,height:o.height||500})};return i(),window.addEventListener("resize",i),n.current&&(t=new ResizeObserver(()=>i()),t.observe(n.current)),()=>{window.removeEventListener("resize",i),t&&n.current&&t.unobserve(n.current)}},[])}const Ya={position:"absolute",width:"100%",height:"100%",top:0,left:0},Gk=(n,e)=>n.x!==e.x||n.y!==e.y||n.zoom!==e.k,rs=n=>({x:n.x,y:n.y,zoom:n.k}),li=(n,e)=>n.target.closest(`.${e}`),ou=(n,e)=>e===2&&Array.isArray(n)&&n.includes(2),su=n=>{const e=n.ctrlKey&&qs()?10:1;return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*e},Jk=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection,d3ZoomHandler:n.d3ZoomHandler,userSelectionActive:n.userSelectionActive}),Zk=({onMove:n,onMoveStart:e,onMoveEnd:t,onPaneContextMenu:i,zoomOnScroll:o=!0,zoomOnPinch:s=!0,panOnScroll:r=!1,panOnScrollSpeed:l=.5,panOnScrollMode:a=Yn.Free,zoomOnDoubleClick:c=!0,elementsSelectable:h,panOnDrag:u=!0,defaultViewport:p,translateExtent:g,minZoom:y,maxZoom:m,zoomActivationKeyCode:b,preventScrolling:x=!0,children:T,noWheelClassName:k,noPanClassName:E})=>{const M=N.useRef(),_=He(),C=N.useRef(!1),P=N.useRef(!1),R=N.useRef(null),$=N.useRef({x:0,y:0,zoom:0}),{d3Zoom:F,d3Selection:L,d3ZoomHandler:W,userSelectionActive:w}=Me(Jk,qe),O=So(b),S=N.useRef(0),z=N.useRef(!1),j=N.useRef();return Xk(R),N.useEffect(()=>{if(R.current){const v=R.current.getBoundingClientRect(),D=Zf().scaleExtent([y,m]).translateExtent(g),B=mt(R.current).call(D),I=cn.translate(p.x,p.y).scale(ji(p.zoom,y,m)),V=[[0,0],[v.width,v.height]],Q=D.constrain()(I,V,g);D.transform(B,Q),D.wheelDelta(su),_.setState({d3Zoom:D,d3Selection:B,d3ZoomHandler:B.on("wheel.zoom"),transform:[Q.x,Q.y,Q.k],domNode:R.current.closest(".react-flow")})}},[]),N.useEffect(()=>{L&&F&&(r&&!O&&!w?L.on("wheel.zoom",v=>{if(li(v,k))return!1;v.preventDefault(),v.stopImmediatePropagation();const D=L.property("__zoom").k||1;if(v.ctrlKey&&s){const xe=_t(v),ge=su(v),ue=D*Math.pow(2,ge);F.scaleTo(L,ue,xe,v);return}const B=v.deltaMode===1?20:1;let I=a===Yn.Vertical?0:v.deltaX*B,V=a===Yn.Horizontal?0:v.deltaY*B;!qs()&&v.shiftKey&&a!==Yn.Vertical&&(I=v.deltaY*B,V=0),F.translateBy(L,-(I/D)*l,-(V/D)*l,{internal:!0});const Q=rs(L.property("__zoom")),{onViewportChangeStart:J,onViewportChange:se,onViewportChangeEnd:le}=_.getState();clearTimeout(j.current),z.current||(z.current=!0,e==null||e(v,Q),J==null||J(Q)),z.current&&(n==null||n(v,Q),se==null||se(Q),j.current=setTimeout(()=>{t==null||t(v,Q),le==null||le(Q),z.current=!1},150))},{passive:!1}):typeof W<"u"&&L.on("wheel.zoom",function(v,D){if(!x&&v.type==="wheel"&&!v.ctrlKey||li(v,k))return null;v.preventDefault(),W.call(this,v,D)},{passive:!1}))},[w,r,a,L,F,W,O,s,x,k,e,n,t]),N.useEffect(()=>{F&&F.on("start",v=>{var I,V;if(!v.sourceEvent||v.sourceEvent.internal)return null;S.current=(I=v.sourceEvent)==null?void 0:I.button;const{onViewportChangeStart:D}=_.getState(),B=rs(v.transform);C.current=!0,$.current=B,((V=v.sourceEvent)==null?void 0:V.type)==="mousedown"&&_.setState({paneDragging:!0}),D==null||D(B),e==null||e(v.sourceEvent,B)})},[F,e]),N.useEffect(()=>{F&&(w&&!C.current?F.on("zoom",null):w||F.on("zoom",v=>{var B;const{onViewportChange:D}=_.getState();if(_.setState({transform:[v.transform.x,v.transform.y,v.transform.k]}),P.current=!!(i&&ou(u,S.current??0)),(n||D)&&!((B=v.sourceEvent)!=null&&B.internal)){const I=rs(v.transform);D==null||D(I),n==null||n(v.sourceEvent,I)}}))},[w,F,n,u,i]),N.useEffect(()=>{F&&F.on("end",v=>{if(!v.sourceEvent||v.sourceEvent.internal)return null;const{onViewportChangeEnd:D}=_.getState();if(C.current=!1,_.setState({paneDragging:!1}),i&&ou(u,S.current??0)&&!P.current&&i(v.sourceEvent),P.current=!1,(t||D)&&Gk($.current,v.transform)){const B=rs(v.transform);$.current=B,clearTimeout(M.current),M.current=setTimeout(()=>{D==null||D(B),t==null||t(v.sourceEvent,B)},r?150:0)}})},[F,r,u,t,i]),N.useEffect(()=>{F&&F.filter(v=>{const D=O||o,B=s&&v.ctrlKey;if((u===!0||Array.isArray(u)&&u.includes(1))&&v.button===1&&v.type==="mousedown"&&(li(v,"react-flow__node")||li(v,"react-flow__edge")))return!0;if(!u&&!D&&!r&&!c&&!s||w||!c&&v.type==="dblclick"||li(v,k)&&v.type==="wheel"||li(v,E)&&(v.type!=="wheel"||r&&v.type==="wheel"&&!O)||!s&&v.ctrlKey&&v.type==="wheel"||!D&&!r&&!B&&v.type==="wheel"||!u&&(v.type==="mousedown"||v.type==="touchstart")||Array.isArray(u)&&!u.includes(v.button)&&v.type==="mousedown")return!1;const I=Array.isArray(u)&&u.includes(v.button)||!v.button||v.button<=1;return(!v.ctrlKey||v.type==="wheel")&&I})},[w,F,o,s,r,c,u,h,O]),H.createElement("div",{className:"react-flow__renderer",ref:R,style:Ya},T)},eC=n=>({userSelectionActive:n.userSelectionActive,userSelectionRect:n.userSelectionRect});function tC(){const{userSelectionActive:n,userSelectionRect:e}=Me(eC,qe);return n&&e?H.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}function ru(n,e){const t=e.parentNode||e.parentId,i=n.find(o=>o.id===t);if(i){const o=e.position.x+e.width-i.width,s=e.position.y+e.height-i.height;if(o>0||s>0||e.position.x<0||e.position.y<0){if(i.style={...i.style},i.style.width=i.style.width??i.width,i.style.height=i.style.height??i.height,o>0&&(i.style.width+=o),s>0&&(i.style.height+=s),e.position.x<0){const r=Math.abs(e.position.x);i.position.x=i.position.x-r,i.style.width+=r,e.position.x=0}if(e.position.y<0){const r=Math.abs(e.position.y);i.position.y=i.position.y-r,i.style.height+=r,e.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function Np(n,e){if(n.some(i=>i.type==="reset"))return n.filter(i=>i.type==="reset").map(i=>i.item);const t=n.filter(i=>i.type==="add").map(i=>i.item);return e.reduce((i,o)=>{const s=n.filter(l=>l.id===o.id);if(s.length===0)return i.push(o),i;const r={...o};for(const l of s)if(l)switch(l.type){case"select":{r.selected=l.selected;break}case"position":{typeof l.position<"u"&&(r.position=l.position),typeof l.positionAbsolute<"u"&&(r.positionAbsolute=l.positionAbsolute),typeof l.dragging<"u"&&(r.dragging=l.dragging),r.expandParent&&ru(i,r);break}case"dimensions":{typeof l.dimensions<"u"&&(r.width=l.dimensions.width,r.height=l.dimensions.height),typeof l.updateStyle<"u"&&(r.style={...r.style||{},...l.dimensions}),typeof l.resizing=="boolean"&&(r.resizing=l.resizing),r.expandParent&&ru(i,r);break}case"remove":return i}return i.push(r),i},t)}function Rp(n,e){return Np(n,e)}function nC(n,e){return Np(n,e)}const Sn=(n,e)=>({id:n,type:"select",selected:e});function fi(n,e){return n.reduce((t,i)=>{const o=e.includes(i.id);return!i.selected&&o?(i.selected=!0,t.push(Sn(i.id,!0))):i.selected&&!o&&(i.selected=!1,t.push(Sn(i.id,!1))),t},[])}const Qr=(n,e)=>t=>{t.target===e.current&&(n==null||n(t))},iC=n=>({userSelectionActive:n.userSelectionActive,elementsSelectable:n.elementsSelectable,dragging:n.paneDragging}),jp=N.memo(({isSelecting:n,selectionMode:e=wo.Full,panOnDrag:t,onSelectionStart:i,onSelectionEnd:o,onPaneClick:s,onPaneContextMenu:r,onPaneScroll:l,onPaneMouseEnter:a,onPaneMouseMove:c,onPaneMouseLeave:h,children:u})=>{const p=N.useRef(null),g=He(),y=N.useRef(0),m=N.useRef(0),b=N.useRef(),{userSelectionActive:x,elementsSelectable:T,dragging:k}=Me(iC,qe),E=()=>{g.setState({userSelectionActive:!1,userSelectionRect:null}),y.current=0,m.current=0},M=W=>{s==null||s(W),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1})},_=W=>{if(Array.isArray(t)&&(t!=null&&t.includes(2))){W.preventDefault();return}r==null||r(W)},C=l?W=>l(W):void 0,P=W=>{const{resetSelectedElements:w,domNode:O}=g.getState();if(b.current=O==null?void 0:O.getBoundingClientRect(),!T||!n||W.button!==0||W.target!==p.current||!b.current)return;const{x:S,y:z}=_n(W,b.current);w(),g.setState({userSelectionRect:{width:0,height:0,startX:S,startY:z,x:S,y:z}}),i==null||i(W)},R=W=>{const{userSelectionRect:w,nodeInternals:O,edges:S,transform:z,onNodesChange:j,onEdgesChange:v,nodeOrigin:D,getNodes:B}=g.getState();if(!n||!b.current||!w)return;g.setState({userSelectionActive:!0,nodesSelectionActive:!1});const I=_n(W,b.current),V=w.startX??0,Q=w.startY??0,J={...w,x:I.x<V?I.x:V,y:I.y<Q?I.y:Q,width:Math.abs(I.x-V),height:Math.abs(I.y-Q)},se=B(),le=fp(O,J,z,e===wo.Partial,!0,D),xe=pp(le,S).map(ue=>ue.id),ge=le.map(ue=>ue.id);if(y.current!==ge.length){y.current=ge.length;const ue=fi(se,ge);ue.length&&(j==null||j(ue))}if(m.current!==xe.length){m.current=xe.length;const ue=fi(S,xe);ue.length&&(v==null||v(ue))}g.setState({userSelectionRect:J})},$=W=>{if(W.button!==0)return;const{userSelectionRect:w}=g.getState();!x&&w&&W.target===p.current&&(M==null||M(W)),g.setState({nodesSelectionActive:y.current>0}),E(),o==null||o(W)},F=W=>{x&&(g.setState({nodesSelectionActive:y.current>0}),o==null||o(W)),E()},L=T&&(n||x);return H.createElement("div",{className:Xe(["react-flow__pane",{dragging:k,selection:n}]),onClick:L?void 0:Qr(M,p),onContextMenu:Qr(_,p),onWheel:Qr(C,p),onMouseEnter:L?void 0:a,onMouseDown:L?P:void 0,onMouseMove:L?R:c,onMouseUp:L?$:void 0,onMouseLeave:L?F:h,ref:p,style:Ya},u,H.createElement(tC,null))});jp.displayName="Pane";function Dp(n,e){const t=n.parentNode||n.parentId;if(!t)return!1;const i=e.get(t);return i?i.selected?!0:Dp(i,e):!1}function lu(n,e,t){let i=n;do{if(i!=null&&i.matches(e))return!0;if(i===t.current)return!1;i=i.parentElement}while(i);return!1}function oC(n,e,t,i){return Array.from(n.values()).filter(o=>(o.selected||o.id===i)&&(!o.parentNode||o.parentId||!Dp(o,n))&&(o.draggable||e&&typeof o.draggable>"u")).map(o=>{var s,r;return{id:o.id,position:o.position||{x:0,y:0},positionAbsolute:o.positionAbsolute||{x:0,y:0},distance:{x:t.x-(((s=o.positionAbsolute)==null?void 0:s.x)??0),y:t.y-(((r=o.positionAbsolute)==null?void 0:r.y)??0)},delta:{x:0,y:0},extent:o.extent,parentNode:o.parentNode||o.parentId,parentId:o.parentNode||o.parentId,width:o.width,height:o.height,expandParent:o.expandParent}})}function sC(n,e){return!e||e==="parent"?e:[e[0],[e[1][0]-(n.width||0),e[1][1]-(n.height||0)]]}function Bp(n,e,t,i,o=[0,0],s){const r=sC(n,n.extent||i);let l=r;const a=n.parentNode||n.parentId;if(n.extent==="parent"&&!n.expandParent)if(a&&n.width&&n.height){const u=t.get(a),{x:p,y:g}=Zn(u,o).positionAbsolute;l=u&&wt(p)&&wt(g)&&wt(u.width)&&wt(u.height)?[[p+n.width*o[0],g+n.height*o[1]],[p+u.width-n.width+n.width*o[0],g+u.height-n.height+n.height*o[1]]]:l}else s==null||s("005",dn.error005()),l=r;else if(n.extent&&a&&n.extent!=="parent"){const u=t.get(a),{x:p,y:g}=Zn(u,o).positionAbsolute;l=[[n.extent[0][0]+p,n.extent[0][1]+g],[n.extent[1][0]+p,n.extent[1][1]+g]]}let c={x:0,y:0};if(a){const u=t.get(a);c=Zn(u,o).positionAbsolute}const h=l&&l!=="parent"?$a(e,l):e;return{position:{x:h.x-c.x,y:h.y-c.y},positionAbsolute:h}}function Yr({nodeId:n,dragItems:e,nodeInternals:t}){const i=e.map(o=>({...t.get(o.id),position:o.position,positionAbsolute:o.positionAbsolute}));return[n?i.find(o=>o.id===n):i[0],i]}const au=(n,e,t,i)=>{const o=e.querySelectorAll(n);if(!o||!o.length)return null;const s=Array.from(o),r=e.getBoundingClientRect(),l={x:r.width*i[0],y:r.height*i[1]};return s.map(a=>{const c=a.getBoundingClientRect();return{id:a.getAttribute("data-handleid"),position:a.getAttribute("data-handlepos"),x:(c.left-r.left-l.x)/t,y:(c.top-r.top-l.y)/t,...Fa(a)}})};function Hi(n,e,t){return t===void 0?t:i=>{const o=e().nodeInternals.get(n);o&&t(i,{...o})}}function sa({id:n,store:e,unselect:t=!1,nodeRef:i}){const{addSelectedNodes:o,unselectNodesAndEdges:s,multiSelectionActive:r,nodeInternals:l,onError:a}=e.getState(),c=l.get(n);if(!c){a==null||a("012",dn.error012(n));return}e.setState({nodesSelectionActive:!1}),c.selected?(t||c.selected&&r)&&(s({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var h;return(h=i==null?void 0:i.current)==null?void 0:h.blur()})):o([n])}function rC(){const n=He();return N.useCallback(({sourceEvent:t})=>{const{transform:i,snapGrid:o,snapToGrid:s}=n.getState(),r=t.touches?t.touches[0].clientX:t.clientX,l=t.touches?t.touches[0].clientY:t.clientY,a={x:(r-i[0])/i[2],y:(l-i[1])/i[2]};return{xSnapped:s?o[0]*Math.round(a.x/o[0]):a.x,ySnapped:s?o[1]*Math.round(a.y/o[1]):a.y,...a}},[])}function Xr(n){return(e,t,i)=>n==null?void 0:n(e,i)}function Pp({nodeRef:n,disabled:e=!1,noDragClassName:t,handleSelector:i,nodeId:o,isSelectable:s,selectNodesOnDrag:r}){const l=He(),[a,c]=N.useState(!1),h=N.useRef([]),u=N.useRef({x:null,y:null}),p=N.useRef(0),g=N.useRef(null),y=N.useRef({x:0,y:0}),m=N.useRef(null),b=N.useRef(!1),x=N.useRef(!1),T=N.useRef(!1),k=rC();return N.useEffect(()=>{if(n!=null&&n.current){const E=mt(n.current),M=({x:P,y:R})=>{const{nodeInternals:$,onNodeDrag:F,onSelectionDrag:L,updateNodePositions:W,nodeExtent:w,snapGrid:O,snapToGrid:S,nodeOrigin:z,onError:j}=l.getState();u.current={x:P,y:R};let v=!1,D={x:0,y:0,x2:0,y2:0};if(h.current.length>1&&w){const I=cr(h.current,z);D=vo(I)}if(h.current=h.current.map(I=>{const V={x:P-I.distance.x,y:R-I.distance.y};S&&(V.x=O[0]*Math.round(V.x/O[0]),V.y=O[1]*Math.round(V.y/O[1]));const Q=[[w[0][0],w[0][1]],[w[1][0],w[1][1]]];h.current.length>1&&w&&!I.extent&&(Q[0][0]=I.positionAbsolute.x-D.x+w[0][0],Q[1][0]=I.positionAbsolute.x+(I.width??0)-D.x2+w[1][0],Q[0][1]=I.positionAbsolute.y-D.y+w[0][1],Q[1][1]=I.positionAbsolute.y+(I.height??0)-D.y2+w[1][1]);const J=Bp(I,V,$,Q,z,j);return v=v||I.position.x!==J.position.x||I.position.y!==J.position.y,I.position=J.position,I.positionAbsolute=J.positionAbsolute,I}),!v)return;W(h.current,!0,!0),c(!0);const B=o?F:Xr(L);if(B&&m.current){const[I,V]=Yr({nodeId:o,dragItems:h.current,nodeInternals:$});B(m.current,I,V)}},_=()=>{if(!g.current)return;const[P,R]=tp(y.current,g.current);if(P!==0||R!==0){const{transform:$,panBy:F}=l.getState();u.current.x=(u.current.x??0)-P/$[2],u.current.y=(u.current.y??0)-R/$[2],F({x:P,y:R})&&M(u.current)}p.current=requestAnimationFrame(_)},C=P=>{var z;const{nodeInternals:R,multiSelectionActive:$,nodesDraggable:F,unselectNodesAndEdges:L,onNodeDragStart:W,onSelectionDragStart:w}=l.getState();x.current=!0;const O=o?W:Xr(w);(!r||!s)&&!$&&o&&((z=R.get(o))!=null&&z.selected||L()),o&&s&&r&&sa({id:o,store:l,nodeRef:n});const S=k(P);if(u.current=S,h.current=oC(R,F,S,o),O&&h.current){const[j,v]=Yr({nodeId:o,dragItems:h.current,nodeInternals:R});O(P.sourceEvent,j,v)}};if(e)E.on(".drag",null);else{const P=xw().on("start",R=>{const{domNode:$,nodeDragThreshold:F}=l.getState();F===0&&C(R),T.current=!1;const L=k(R);u.current=L,g.current=($==null?void 0:$.getBoundingClientRect())||null,y.current=_n(R.sourceEvent,g.current)}).on("drag",R=>{var W,w;const $=k(R),{autoPanOnNodeDrag:F,nodeDragThreshold:L}=l.getState();if(R.sourceEvent.type==="touchmove"&&R.sourceEvent.touches.length>1&&(T.current=!0),!T.current){if(!b.current&&x.current&&F&&(b.current=!0,_()),!x.current){const O=$.xSnapped-(((W=u==null?void 0:u.current)==null?void 0:W.x)??0),S=$.ySnapped-(((w=u==null?void 0:u.current)==null?void 0:w.y)??0);Math.sqrt(O*O+S*S)>L&&C(R)}(u.current.x!==$.xSnapped||u.current.y!==$.ySnapped)&&h.current&&x.current&&(m.current=R.sourceEvent,y.current=_n(R.sourceEvent,g.current),M($))}}).on("end",R=>{if(!(!x.current||T.current)&&(c(!1),b.current=!1,x.current=!1,cancelAnimationFrame(p.current),h.current)){const{updateNodePositions:$,nodeInternals:F,onNodeDragStop:L,onSelectionDragStop:W}=l.getState(),w=o?L:Xr(W);if($(h.current,!1,!1),w){const[O,S]=Yr({nodeId:o,dragItems:h.current,nodeInternals:F});w(R.sourceEvent,O,S)}}}).filter(R=>{const $=R.target;return!R.button&&(!t||!lu($,`.${t}`,n))&&(!i||lu($,i,n))});return E.call(P),()=>{E.on(".drag",null)}}}},[n,e,t,i,s,l,o,r,k]),a}function Ip(){const n=He();return N.useCallback(t=>{const{nodeInternals:i,nodeExtent:o,updateNodePositions:s,getNodes:r,snapToGrid:l,snapGrid:a,onError:c,nodesDraggable:h}=n.getState(),u=r().filter(T=>T.selected&&(T.draggable||h&&typeof T.draggable>"u")),p=l?a[0]:5,g=l?a[1]:5,y=t.isShiftPressed?4:1,m=t.x*p*y,b=t.y*g*y,x=u.map(T=>{if(T.positionAbsolute){const k={x:T.positionAbsolute.x+m,y:T.positionAbsolute.y+b};l&&(k.x=a[0]*Math.round(k.x/a[0]),k.y=a[1]*Math.round(k.y/a[1]));const{positionAbsolute:E,position:M}=Bp(T,k,i,o,void 0,c);T.position=M,T.positionAbsolute=E}return T});s(x,!0,!1)},[])}const Si={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Vi=n=>{const e=({id:t,type:i,data:o,xPos:s,yPos:r,xPosOrigin:l,yPosOrigin:a,selected:c,onClick:h,onMouseEnter:u,onMouseMove:p,onMouseLeave:g,onContextMenu:y,onDoubleClick:m,style:b,className:x,isDraggable:T,isSelectable:k,isConnectable:E,isFocusable:M,selectNodesOnDrag:_,sourcePosition:C,targetPosition:P,hidden:R,resizeObserver:$,dragHandle:F,zIndex:L,isParent:W,noDragClassName:w,noPanClassName:O,initialized:S,disableKeyboardA11y:z,ariaLabel:j,rfId:v,hasHandleBounds:D})=>{const B=He(),I=N.useRef(null),V=N.useRef(null),Q=N.useRef(C),J=N.useRef(P),se=N.useRef(i),le=k||T||h||u||p||g,xe=Ip(),ge=Hi(t,B.getState,u),ue=Hi(t,B.getState,p),Ne=Hi(t,B.getState,g),Oe=Hi(t,B.getState,y),Re=Hi(t,B.getState,m),be=U=>{const{nodeDragThreshold:q}=B.getState();if(k&&(!_||!T||q>0)&&sa({id:t,store:B,nodeRef:I}),h){const G=B.getState().nodeInternals.get(t);G&&h(U,{...G})}},de=U=>{if(!ea(U)&&!z)if(sp.includes(U.key)&&k){const q=U.key==="Escape";sa({id:t,store:B,unselect:q,nodeRef:I})}else T&&c&&Object.prototype.hasOwnProperty.call(Si,U.key)&&(B.setState({ariaLiveMessage:`Moved selected node ${U.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~s}, y: ${~~r}`}),xe({x:Si[U.key].x,y:Si[U.key].y,isShiftPressed:U.shiftKey}))};N.useEffect(()=>()=>{V.current&&($==null||$.unobserve(V.current),V.current=null)},[]),N.useEffect(()=>{if(I.current&&!R){const U=I.current;(!S||!D||V.current!==U)&&(V.current&&($==null||$.unobserve(V.current)),$==null||$.observe(U),V.current=U)}},[R,S,D]),N.useEffect(()=>{const U=se.current!==i,q=Q.current!==C,G=J.current!==P;I.current&&(U||q||G)&&(U&&(se.current=i),q&&(Q.current=C),G&&(J.current=P),B.getState().updateNodeDimensions([{id:t,nodeElement:I.current,forceUpdate:!0}]))},[t,i,C,P]);const Fe=Pp({nodeRef:I,disabled:R||!T,noDragClassName:w,handleSelector:F,nodeId:t,isSelectable:k,selectNodesOnDrag:_});return R?null:H.createElement("div",{className:Xe(["react-flow__node",`react-flow__node-${i}`,{[O]:T},x,{selected:c,selectable:k,parent:W,dragging:Fe}]),ref:I,style:{zIndex:L,transform:`translate(${l}px,${a}px)`,pointerEvents:le?"all":"none",visibility:S?"visible":"hidden",...b},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:ge,onMouseMove:ue,onMouseLeave:Ne,onContextMenu:Oe,onClick:be,onDoubleClick:Re,onKeyDown:M?de:void 0,tabIndex:M?0:void 0,role:M?"button":void 0,"aria-describedby":z?void 0:`${Ep}-${v}`,"aria-label":j},H.createElement(wk,{value:t},H.createElement(n,{id:t,data:o,type:i,xPos:s,yPos:r,selected:c,isConnectable:E,sourcePosition:C,targetPosition:P,dragging:Fe,dragHandle:F,zIndex:L})))};return e.displayName="NodeWrapper",N.memo(e)};const lC=n=>{const e=n.getNodes().filter(t=>t.selected);return{...cr(e,n.nodeOrigin),transformString:`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`,userSelectionActive:n.userSelectionActive}};function aC({onSelectionContextMenu:n,noPanClassName:e,disableKeyboardA11y:t}){const i=He(),{width:o,height:s,x:r,y:l,transformString:a,userSelectionActive:c}=Me(lC,qe),h=Ip(),u=N.useRef(null);if(N.useEffect(()=>{var y;t||(y=u.current)==null||y.focus({preventScroll:!0})},[t]),Pp({nodeRef:u}),c||!o||!s)return null;const p=n?y=>{const m=i.getState().getNodes().filter(b=>b.selected);n(y,m)}:void 0,g=y=>{Object.prototype.hasOwnProperty.call(Si,y.key)&&h({x:Si[y.key].x,y:Si[y.key].y,isShiftPressed:y.shiftKey})};return H.createElement("div",{className:Xe(["react-flow__nodesselection","react-flow__container",e]),style:{transform:a}},H.createElement("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:t?void 0:-1,onKeyDown:t?void 0:g,style:{width:o,height:s,top:l,left:r}}))}var cC=N.memo(aC);const hC=n=>n.nodesSelectionActive,zp=({children:n,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:i,onPaneMouseLeave:o,onPaneContextMenu:s,onPaneScroll:r,deleteKeyCode:l,onMove:a,onMoveStart:c,onMoveEnd:h,selectionKeyCode:u,selectionOnDrag:p,selectionMode:g,onSelectionStart:y,onSelectionEnd:m,multiSelectionKeyCode:b,panActivationKeyCode:x,zoomActivationKeyCode:T,elementsSelectable:k,zoomOnScroll:E,zoomOnPinch:M,panOnScroll:_,panOnScrollSpeed:C,panOnScrollMode:P,zoomOnDoubleClick:R,panOnDrag:$,defaultViewport:F,translateExtent:L,minZoom:W,maxZoom:w,preventScrolling:O,onSelectionContextMenu:S,noWheelClassName:z,noPanClassName:j,disableKeyboardA11y:v})=>{const D=Me(hC),B=So(u),I=So(x),V=I||$,Q=I||_,J=B||p&&V!==!0;return Yk({deleteKeyCode:l,multiSelectionKeyCode:b}),H.createElement(Zk,{onMove:a,onMoveStart:c,onMoveEnd:h,onPaneContextMenu:s,elementsSelectable:k,zoomOnScroll:E,zoomOnPinch:M,panOnScroll:Q,panOnScrollSpeed:C,panOnScrollMode:P,zoomOnDoubleClick:R,panOnDrag:!B&&V,defaultViewport:F,translateExtent:L,minZoom:W,maxZoom:w,zoomActivationKeyCode:T,preventScrolling:O,noWheelClassName:z,noPanClassName:j},H.createElement(jp,{onSelectionStart:y,onSelectionEnd:m,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:i,onPaneMouseLeave:o,onPaneContextMenu:s,onPaneScroll:r,panOnDrag:V,isSelecting:!!J,selectionMode:g},n,D&&H.createElement(cC,{onSelectionContextMenu:S,noPanClassName:j,disableKeyboardA11y:v})))};zp.displayName="FlowRenderer";var uC=N.memo(zp);function dC(n){return Me(N.useCallback(t=>n?fp(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes(),[n]))}function fC(n){const e={input:Vi(n.input||Sp),default:Vi(n.default||oa),output:Vi(n.output||Cp),group:Vi(n.group||Ka)},t={},i=Object.keys(n).filter(o=>!["input","default","output","group"].includes(o)).reduce((o,s)=>(o[s]=Vi(n[s]||oa),o),t);return{...e,...i}}const pC=({x:n,y:e,width:t,height:i,origin:o})=>!t||!i?{x:n,y:e}:o[0]<0||o[1]<0||o[0]>1||o[1]>1?{x:n,y:e}:{x:n-t*o[0],y:e-i*o[1]},gC=n=>({nodesDraggable:n.nodesDraggable,nodesConnectable:n.nodesConnectable,nodesFocusable:n.nodesFocusable,elementsSelectable:n.elementsSelectable,updateNodeDimensions:n.updateNodeDimensions,onError:n.onError}),Lp=n=>{const{nodesDraggable:e,nodesConnectable:t,nodesFocusable:i,elementsSelectable:o,updateNodeDimensions:s,onError:r}=Me(gC,qe),l=dC(n.onlyRenderVisibleElements),a=N.useRef(),c=N.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const h=new ResizeObserver(u=>{const p=u.map(g=>({id:g.target.getAttribute("data-id"),nodeElement:g.target,forceUpdate:!0}));s(p)});return a.current=h,h},[]);return N.useEffect(()=>()=>{var h;(h=a==null?void 0:a.current)==null||h.disconnect()},[]),H.createElement("div",{className:"react-flow__nodes",style:Ya},l.map(h=>{var M,_,C;let u=h.type||"default";n.nodeTypes[u]||(r==null||r("003",dn.error003(u)),u="default");const p=n.nodeTypes[u]||n.nodeTypes.default,g=!!(h.draggable||e&&typeof h.draggable>"u"),y=!!(h.selectable||o&&typeof h.selectable>"u"),m=!!(h.connectable||t&&typeof h.connectable>"u"),b=!!(h.focusable||i&&typeof h.focusable>"u"),x=n.nodeExtent?$a(h.positionAbsolute,n.nodeExtent):h.positionAbsolute,T=(x==null?void 0:x.x)??0,k=(x==null?void 0:x.y)??0,E=pC({x:T,y:k,width:h.width??0,height:h.height??0,origin:n.nodeOrigin});return H.createElement(p,{key:h.id,id:h.id,className:h.className,style:h.style,type:u,data:h.data,sourcePosition:h.sourcePosition||ee.Bottom,targetPosition:h.targetPosition||ee.Top,hidden:h.hidden,xPos:T,yPos:k,xPosOrigin:E.x,yPosOrigin:E.y,selectNodesOnDrag:n.selectNodesOnDrag,onClick:n.onNodeClick,onMouseEnter:n.onNodeMouseEnter,onMouseMove:n.onNodeMouseMove,onMouseLeave:n.onNodeMouseLeave,onContextMenu:n.onNodeContextMenu,onDoubleClick:n.onNodeDoubleClick,selected:!!h.selected,isDraggable:g,isSelectable:y,isConnectable:m,isFocusable:b,resizeObserver:c,dragHandle:h.dragHandle,zIndex:((M=h[Pe])==null?void 0:M.z)??0,isParent:!!((_=h[Pe])!=null&&_.isParent),noDragClassName:n.noDragClassName,noPanClassName:n.noPanClassName,initialized:!!h.width&&!!h.height,rfId:n.rfId,disableKeyboardA11y:n.disableKeyboardA11y,ariaLabel:h.ariaLabel,hasHandleBounds:!!((C=h[Pe])!=null&&C.handleBounds)})}))};Lp.displayName="NodeRenderer";var mC=N.memo(Lp);const yC=(n,e,t)=>t===ee.Left?n-e:t===ee.Right?n+e:n,xC=(n,e,t)=>t===ee.Top?n-e:t===ee.Bottom?n+e:n,cu="react-flow__edgeupdater",hu=({position:n,centerX:e,centerY:t,radius:i=10,onMouseDown:o,onMouseEnter:s,onMouseOut:r,type:l})=>H.createElement("circle",{onMouseDown:o,onMouseEnter:s,onMouseOut:r,className:Xe([cu,`${cu}-${l}`]),cx:yC(e,i,n),cy:xC(t,i,n),r:i,stroke:"transparent",fill:"transparent"}),bC=()=>!0;var ai=n=>{const e=({id:t,className:i,type:o,data:s,onClick:r,onEdgeDoubleClick:l,selected:a,animated:c,label:h,labelStyle:u,labelShowBg:p,labelBgStyle:g,labelBgPadding:y,labelBgBorderRadius:m,style:b,source:x,target:T,sourceX:k,sourceY:E,targetX:M,targetY:_,sourcePosition:C,targetPosition:P,elementsSelectable:R,hidden:$,sourceHandleId:F,targetHandleId:L,onContextMenu:W,onMouseEnter:w,onMouseMove:O,onMouseLeave:S,reconnectRadius:z,onReconnect:j,onReconnectStart:v,onReconnectEnd:D,markerEnd:B,markerStart:I,rfId:V,ariaLabel:Q,isFocusable:J,isReconnectable:se,pathOptions:le,interactionWidth:xe,disableKeyboardA11y:ge})=>{const ue=N.useRef(null),[Ne,Oe]=N.useState(!1),[Re,be]=N.useState(!1),de=He(),Fe=N.useMemo(()=>`url('#${na(I,V)}')`,[I,V]),U=N.useMemo(()=>`url('#${na(B,V)}')`,[B,V]);if($)return null;const q=Ve=>{var pt;const{edges:rt,addSelectedEdges:en,unselectNodesAndEdges:tn,multiSelectionActive:zt}=de.getState(),Et=rt.find(Pn=>Pn.id===t);Et&&(R&&(de.setState({nodesSelectionActive:!1}),Et.selected&&zt?(tn({nodes:[],edges:[Et]}),(pt=ue.current)==null||pt.blur()):en([t])),r&&r(Ve,Et))},G=Wi(t,de.getState,l),ae=Wi(t,de.getState,W),ce=Wi(t,de.getState,w),oe=Wi(t,de.getState,O),Ee=Wi(t,de.getState,S),je=(Ve,rt)=>{if(Ve.button!==0)return;const{edges:en,isValidConnection:tn}=de.getState(),zt=rt?T:x,Et=(rt?L:F)||null,pt=rt?"target":"source",Pn=tn||bC,gn=rt,In=en.find(nn=>nn.id===t);be(!0),v==null||v(Ve,In,pt);const Lt=nn=>{be(!1),D==null||D(nn,In,pt)};xp({event:Ve,handleId:Et,nodeId:zt,onConnect:nn=>j==null?void 0:j(In,nn),isTarget:gn,getState:de.getState,setState:de.setState,isValidConnection:Pn,edgeUpdaterType:pt,onReconnectEnd:Lt})},Ae=Ve=>je(Ve,!0),Se=Ve=>je(Ve,!1),Pt=()=>Oe(!0),Zt=()=>Oe(!1),pn=!R&&!r,It=Ve=>{var rt;if(!ge&&sp.includes(Ve.key)&&R){const{unselectNodesAndEdges:en,addSelectedEdges:tn,edges:zt}=de.getState();Ve.key==="Escape"?((rt=ue.current)==null||rt.blur(),en({edges:[zt.find(pt=>pt.id===t)]})):tn([t])}};return H.createElement("g",{className:Xe(["react-flow__edge",`react-flow__edge-${o}`,i,{selected:a,animated:c,inactive:pn,updating:Ne}]),onClick:q,onDoubleClick:G,onContextMenu:ae,onMouseEnter:ce,onMouseMove:oe,onMouseLeave:Ee,onKeyDown:J?It:void 0,tabIndex:J?0:void 0,role:J?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":Q===null?void 0:Q||`Edge from ${x} to ${T}`,"aria-describedby":J?`${Ap}-${V}`:void 0,ref:ue},!Re&&H.createElement(n,{id:t,source:x,target:T,selected:a,animated:c,label:h,labelStyle:u,labelShowBg:p,labelBgStyle:g,labelBgPadding:y,labelBgBorderRadius:m,data:s,style:b,sourceX:k,sourceY:E,targetX:M,targetY:_,sourcePosition:C,targetPosition:P,sourceHandleId:F,targetHandleId:L,markerStart:Fe,markerEnd:U,pathOptions:le,interactionWidth:xe}),se&&H.createElement(H.Fragment,null,(se==="source"||se===!0)&&H.createElement(hu,{position:C,centerX:k,centerY:E,radius:z,onMouseDown:Ae,onMouseEnter:Pt,onMouseOut:Zt,type:"source"}),(se==="target"||se===!0)&&H.createElement(hu,{position:P,centerX:M,centerY:_,radius:z,onMouseDown:Se,onMouseEnter:Pt,onMouseOut:Zt,type:"target"})))};return e.displayName="EdgeWrapper",N.memo(e)};function vC(n){const e={default:ai(n.default||Qs),straight:ai(n.bezier||Va),step:ai(n.step||Ha),smoothstep:ai(n.step||ar),simplebezier:ai(n.simplebezier||Wa)},t={},i=Object.keys(n).filter(o=>!["default","bezier"].includes(o)).reduce((o,s)=>(o[s]=ai(n[s]||Qs),o),t);return{...e,...i}}function uu(n,e,t=null){const i=((t==null?void 0:t.x)||0)+e.x,o=((t==null?void 0:t.y)||0)+e.y,s=(t==null?void 0:t.width)||e.width,r=(t==null?void 0:t.height)||e.height;switch(n){case ee.Top:return{x:i+s/2,y:o};case ee.Right:return{x:i+s,y:o+r/2};case ee.Bottom:return{x:i+s/2,y:o+r};case ee.Left:return{x:i,y:o+r/2}}}function du(n,e){return n?n.length===1||!e?n[0]:e&&n.find(t=>t.id===e)||null:null}const wC=(n,e,t,i,o,s)=>{const r=uu(t,n,e),l=uu(s,i,o);return{sourceX:r.x,sourceY:r.y,targetX:l.x,targetY:l.y}};function SC({sourcePos:n,targetPos:e,sourceWidth:t,sourceHeight:i,targetWidth:o,targetHeight:s,width:r,height:l,transform:a}){const c={x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x+t,e.x+o),y2:Math.max(n.y+i,e.y+s)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);const h=vo({x:(0-a[0])/a[2],y:(0-a[1])/a[2],width:r/a[2],height:l/a[2]}),u=Math.max(0,Math.min(h.x2,c.x2)-Math.max(h.x,c.x)),p=Math.max(0,Math.min(h.y2,c.y2)-Math.max(h.y,c.y));return Math.ceil(u*p)>0}function fu(n){var i,o,s,r,l;const e=((i=n==null?void 0:n[Pe])==null?void 0:i.handleBounds)||null,t=e&&(n==null?void 0:n.width)&&(n==null?void 0:n.height)&&typeof((o=n==null?void 0:n.positionAbsolute)==null?void 0:o.x)<"u"&&typeof((s=n==null?void 0:n.positionAbsolute)==null?void 0:s.y)<"u";return[{x:((r=n==null?void 0:n.positionAbsolute)==null?void 0:r.x)||0,y:((l=n==null?void 0:n.positionAbsolute)==null?void 0:l.y)||0,width:(n==null?void 0:n.width)||0,height:(n==null?void 0:n.height)||0},e,!!t]}const kC=[{level:0,isMaxLevel:!0,edges:[]}];function CC(n,e,t=!1){let i=-1;const o=n.reduce((r,l)=>{var h,u;const a=wt(l.zIndex);let c=a?l.zIndex:0;if(t){const p=e.get(l.target),g=e.get(l.source),y=l.selected||(p==null?void 0:p.selected)||(g==null?void 0:g.selected),m=Math.max(((h=g==null?void 0:g[Pe])==null?void 0:h.z)||0,((u=p==null?void 0:p[Pe])==null?void 0:u.z)||0,1e3);c=(a?l.zIndex:0)+(y?m:0)}return r[c]?r[c].push(l):r[c]=[l],i=c>i?c:i,r},{}),s=Object.entries(o).map(([r,l])=>{const a=+r;return{edges:l,level:a,isMaxLevel:a===i}});return s.length===0?kC:s}function TC(n,e,t){const i=Me(N.useCallback(o=>n?o.edges.filter(s=>{const r=e.get(s.source),l=e.get(s.target);return(r==null?void 0:r.width)&&(r==null?void 0:r.height)&&(l==null?void 0:l.width)&&(l==null?void 0:l.height)&&SC({sourcePos:r.positionAbsolute||{x:0,y:0},targetPos:l.positionAbsolute||{x:0,y:0},sourceWidth:r.width,sourceHeight:r.height,targetWidth:l.width,targetHeight:l.height,width:o.width,height:o.height,transform:o.transform})}):o.edges,[n,e]));return CC(i,e,t)}const EC=({color:n="none",strokeWidth:e=1})=>H.createElement("polyline",{style:{stroke:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),AC=({color:n="none",strokeWidth:e=1})=>H.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),pu={[Ks.Arrow]:EC,[Ks.ArrowClosed]:AC};function _C(n){const e=He();return N.useMemo(()=>{var o,s;return Object.prototype.hasOwnProperty.call(pu,n)?pu[n]:((s=(o=e.getState()).onError)==null||s.call(o,"009",dn.error009(n)),null)},[n])}const MC=({id:n,type:e,color:t,width:i=12.5,height:o=12.5,markerUnits:s="strokeWidth",strokeWidth:r,orient:l="auto-start-reverse"})=>{const a=_C(e);return a?H.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${i}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:l,refX:"0",refY:"0"},H.createElement(a,{color:t,strokeWidth:r})):null},OC=({defaultColor:n,rfId:e})=>t=>{const i=[];return t.edges.reduce((o,s)=>([s.markerStart,s.markerEnd].forEach(r=>{if(r&&typeof r=="object"){const l=na(r,e);i.includes(l)||(o.push({id:l,color:r.color||n,...r}),i.push(l))}}),o),[]).sort((o,s)=>o.id.localeCompare(s.id))},Fp=({defaultColor:n,rfId:e})=>{const t=Me(N.useCallback(OC({defaultColor:n,rfId:e}),[n,e]),(i,o)=>!(i.length!==o.length||i.some((s,r)=>s.id!==o[r].id)));return H.createElement("defs",null,t.map(i=>H.createElement(MC,{id:i.id,key:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient})))};Fp.displayName="MarkerDefinitions";var NC=N.memo(Fp);const RC=n=>({nodesConnectable:n.nodesConnectable,edgesFocusable:n.edgesFocusable,edgesUpdatable:n.edgesUpdatable,elementsSelectable:n.elementsSelectable,width:n.width,height:n.height,connectionMode:n.connectionMode,nodeInternals:n.nodeInternals,onError:n.onError}),$p=({defaultMarkerColor:n,onlyRenderVisibleElements:e,elevateEdgesOnSelect:t,rfId:i,edgeTypes:o,noPanClassName:s,onEdgeContextMenu:r,onEdgeMouseEnter:l,onEdgeMouseMove:a,onEdgeMouseLeave:c,onEdgeClick:h,onEdgeDoubleClick:u,onReconnect:p,onReconnectStart:g,onReconnectEnd:y,reconnectRadius:m,children:b,disableKeyboardA11y:x})=>{const{edgesFocusable:T,edgesUpdatable:k,elementsSelectable:E,width:M,height:_,connectionMode:C,nodeInternals:P,onError:R}=Me(RC,qe),$=TC(e,P,t);return M?H.createElement(H.Fragment,null,$.map(({level:F,edges:L,isMaxLevel:W})=>H.createElement("svg",{key:F,style:{zIndex:F},width:M,height:_,className:"react-flow__edges react-flow__container"},W&&H.createElement(NC,{defaultColor:n,rfId:i}),H.createElement("g",null,L.map(w=>{const[O,S,z]=fu(P.get(w.source)),[j,v,D]=fu(P.get(w.target));if(!z||!D)return null;let B=w.type||"default";o[B]||(R==null||R("011",dn.error011(B)),B="default");const I=o[B]||o.default,V=C===ii.Strict?v.target:(v.target??[]).concat(v.source??[]),Q=du(S.source,w.sourceHandle),J=du(V,w.targetHandle),se=(Q==null?void 0:Q.position)||ee.Bottom,le=(J==null?void 0:J.position)||ee.Top,xe=!!(w.focusable||T&&typeof w.focusable>"u"),ge=w.reconnectable||w.updatable,ue=typeof p<"u"&&(ge||k&&typeof ge>"u");if(!Q||!J)return R==null||R("008",dn.error008(Q,w)),null;const{sourceX:Ne,sourceY:Oe,targetX:Re,targetY:be}=wC(O,Q,se,j,J,le);return H.createElement(I,{key:w.id,id:w.id,className:Xe([w.className,s]),type:B,data:w.data,selected:!!w.selected,animated:!!w.animated,hidden:!!w.hidden,label:w.label,labelStyle:w.labelStyle,labelShowBg:w.labelShowBg,labelBgStyle:w.labelBgStyle,labelBgPadding:w.labelBgPadding,labelBgBorderRadius:w.labelBgBorderRadius,style:w.style,source:w.source,target:w.target,sourceHandleId:w.sourceHandle,targetHandleId:w.targetHandle,markerEnd:w.markerEnd,markerStart:w.markerStart,sourceX:Ne,sourceY:Oe,targetX:Re,targetY:be,sourcePosition:se,targetPosition:le,elementsSelectable:E,onContextMenu:r,onMouseEnter:l,onMouseMove:a,onMouseLeave:c,onClick:h,onEdgeDoubleClick:u,onReconnect:p,onReconnectStart:g,onReconnectEnd:y,reconnectRadius:m,rfId:i,ariaLabel:w.ariaLabel,isFocusable:xe,isReconnectable:ue,pathOptions:"pathOptions"in w?w.pathOptions:void 0,interactionWidth:w.interactionWidth,disableKeyboardA11y:x})})))),b):null};$p.displayName="EdgeRenderer";var jC=N.memo($p);const DC=n=>`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`;function BC({children:n}){const e=Me(DC);return H.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:e}},n)}function PC(n){const e=Qa(),t=N.useRef(!1);N.useEffect(()=>{!t.current&&e.viewportInitialized&&n&&(setTimeout(()=>n(e),1),t.current=!0)},[n,e.viewportInitialized])}const IC={[ee.Left]:ee.Right,[ee.Right]:ee.Left,[ee.Top]:ee.Bottom,[ee.Bottom]:ee.Top},Wp=({nodeId:n,handleType:e,style:t,type:i=Cn.Bezier,CustomComponent:o,connectionStatus:s})=>{var _,C,P;const{fromNode:r,handleId:l,toX:a,toY:c,connectionMode:h}=Me(N.useCallback(R=>({fromNode:R.nodeInternals.get(n),handleId:R.connectionHandleId,toX:(R.connectionPosition.x-R.transform[0])/R.transform[2],toY:(R.connectionPosition.y-R.transform[1])/R.transform[2],connectionMode:R.connectionMode}),[n]),qe),u=(_=r==null?void 0:r[Pe])==null?void 0:_.handleBounds;let p=u==null?void 0:u[e];if(h===ii.Loose&&(p=p||(u==null?void 0:u[e==="source"?"target":"source"])),!r||!p)return null;const g=l?p.find(R=>R.id===l):p[0],y=g?g.x+g.width/2:(r.width??0)/2,m=g?g.y+g.height/2:r.height??0,b=(((C=r.positionAbsolute)==null?void 0:C.x)??0)+y,x=(((P=r.positionAbsolute)==null?void 0:P.y)??0)+m,T=g==null?void 0:g.position,k=T?IC[T]:null;if(!T||!k)return null;if(o)return H.createElement(o,{connectionLineType:i,connectionLineStyle:t,fromNode:r,fromHandle:g,fromX:b,fromY:x,toX:a,toY:c,fromPosition:T,toPosition:k,connectionStatus:s});let E="";const M={sourceX:b,sourceY:x,sourcePosition:T,targetX:a,targetY:c,targetPosition:k};return i===Cn.Bezier?[E]=hp(M):i===Cn.Step?[E]=ta({...M,borderRadius:0}):i===Cn.SmoothStep?[E]=ta(M):i===Cn.SimpleBezier?[E]=cp(M):E=`M${b},${x} ${a},${c}`,H.createElement("path",{d:E,fill:"none",className:"react-flow__connection-path",style:t})};Wp.displayName="ConnectionLine";const zC=n=>({nodeId:n.connectionNodeId,handleType:n.connectionHandleType,nodesConnectable:n.nodesConnectable,connectionStatus:n.connectionStatus,width:n.width,height:n.height});function LC({containerStyle:n,style:e,type:t,component:i}){const{nodeId:o,handleType:s,nodesConnectable:r,width:l,height:a,connectionStatus:c}=Me(zC,qe);return!(o&&s&&l&&r)?null:H.createElement("svg",{style:n,width:l,height:a,className:"react-flow__edges react-flow__connectionline react-flow__container"},H.createElement("g",{className:Xe(["react-flow__connection",c])},H.createElement(Wp,{nodeId:o,handleType:s,style:e,type:t,CustomComponent:i,connectionStatus:c})))}function gu(n,e){return N.useRef(null),He(),N.useMemo(()=>e(n),[n])}const Hp=({nodeTypes:n,edgeTypes:e,onMove:t,onMoveStart:i,onMoveEnd:o,onInit:s,onNodeClick:r,onEdgeClick:l,onNodeDoubleClick:a,onEdgeDoubleClick:c,onNodeMouseEnter:h,onNodeMouseMove:u,onNodeMouseLeave:p,onNodeContextMenu:g,onSelectionContextMenu:y,onSelectionStart:m,onSelectionEnd:b,connectionLineType:x,connectionLineStyle:T,connectionLineComponent:k,connectionLineContainerStyle:E,selectionKeyCode:M,selectionOnDrag:_,selectionMode:C,multiSelectionKeyCode:P,panActivationKeyCode:R,zoomActivationKeyCode:$,deleteKeyCode:F,onlyRenderVisibleElements:L,elementsSelectable:W,selectNodesOnDrag:w,defaultViewport:O,translateExtent:S,minZoom:z,maxZoom:j,preventScrolling:v,defaultMarkerColor:D,zoomOnScroll:B,zoomOnPinch:I,panOnScroll:V,panOnScrollSpeed:Q,panOnScrollMode:J,zoomOnDoubleClick:se,panOnDrag:le,onPaneClick:xe,onPaneMouseEnter:ge,onPaneMouseMove:ue,onPaneMouseLeave:Ne,onPaneScroll:Oe,onPaneContextMenu:Re,onEdgeContextMenu:be,onEdgeMouseEnter:de,onEdgeMouseMove:Fe,onEdgeMouseLeave:U,onReconnect:q,onReconnectStart:G,onReconnectEnd:ae,reconnectRadius:ce,noDragClassName:oe,noWheelClassName:Ee,noPanClassName:je,elevateEdgesOnSelect:Ae,disableKeyboardA11y:Se,nodeOrigin:Pt,nodeExtent:Zt,rfId:pn})=>{const It=gu(n,fC),Ve=gu(e,vC);return PC(s),H.createElement(uC,{onPaneClick:xe,onPaneMouseEnter:ge,onPaneMouseMove:ue,onPaneMouseLeave:Ne,onPaneContextMenu:Re,onPaneScroll:Oe,deleteKeyCode:F,selectionKeyCode:M,selectionOnDrag:_,selectionMode:C,onSelectionStart:m,onSelectionEnd:b,multiSelectionKeyCode:P,panActivationKeyCode:R,zoomActivationKeyCode:$,elementsSelectable:W,onMove:t,onMoveStart:i,onMoveEnd:o,zoomOnScroll:B,zoomOnPinch:I,zoomOnDoubleClick:se,panOnScroll:V,panOnScrollSpeed:Q,panOnScrollMode:J,panOnDrag:le,defaultViewport:O,translateExtent:S,minZoom:z,maxZoom:j,onSelectionContextMenu:y,preventScrolling:v,noDragClassName:oe,noWheelClassName:Ee,noPanClassName:je,disableKeyboardA11y:Se},H.createElement(BC,null,H.createElement(jC,{edgeTypes:Ve,onEdgeClick:l,onEdgeDoubleClick:c,onlyRenderVisibleElements:L,onEdgeContextMenu:be,onEdgeMouseEnter:de,onEdgeMouseMove:Fe,onEdgeMouseLeave:U,onReconnect:q,onReconnectStart:G,onReconnectEnd:ae,reconnectRadius:ce,defaultMarkerColor:D,noPanClassName:je,elevateEdgesOnSelect:!!Ae,disableKeyboardA11y:Se,rfId:pn},H.createElement(LC,{style:T,type:x,component:k,containerStyle:E})),H.createElement("div",{className:"react-flow__edgelabel-renderer"}),H.createElement(mC,{nodeTypes:It,onNodeClick:r,onNodeDoubleClick:a,onNodeMouseEnter:h,onNodeMouseMove:u,onNodeMouseLeave:p,onNodeContextMenu:g,selectNodesOnDrag:w,onlyRenderVisibleElements:L,noPanClassName:je,noDragClassName:oe,disableKeyboardA11y:Se,nodeOrigin:Pt,nodeExtent:Zt,rfId:pn})))};Hp.displayName="GraphView";var FC=N.memo(Hp);const ra=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],yn={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:ra,nodeExtent:ra,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:ii.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:gk,isValidConnection:void 0},$C=()=>O1((n,e)=>({...yn,setNodes:t=>{const{nodeInternals:i,nodeOrigin:o,elevateNodesOnSelect:s}=e();n({nodeInternals:Kr(t,i,o,s)})},getNodes:()=>Array.from(e().nodeInternals.values()),setEdges:t=>{const{defaultEdgeOptions:i={}}=e();n({edges:t.map(o=>({...i,...o}))})},setDefaultNodesAndEdges:(t,i)=>{const o=typeof t<"u",s=typeof i<"u",r=o?Kr(t,new Map,e().nodeOrigin,e().elevateNodesOnSelect):new Map;n({nodeInternals:r,edges:s?i:[],hasDefaultNodes:o,hasDefaultEdges:s})},updateNodeDimensions:t=>{const{onNodesChange:i,nodeInternals:o,fitViewOnInit:s,fitViewOnInitDone:r,fitViewOnInitOptions:l,domNode:a,nodeOrigin:c}=e(),h=a==null?void 0:a.querySelector(".react-flow__viewport");if(!h)return;const u=window.getComputedStyle(h),{m22:p}=new window.DOMMatrixReadOnly(u.transform),g=t.reduce((m,b)=>{const x=o.get(b.id);if(x!=null&&x.hidden)o.set(x.id,{...x,[Pe]:{...x[Pe],handleBounds:void 0}});else if(x){const T=Fa(b.nodeElement);!!(T.width&&T.height&&(x.width!==T.width||x.height!==T.height||b.forceUpdate))&&(o.set(x.id,{...x,[Pe]:{...x[Pe],handleBounds:{source:au(".source",b.nodeElement,p,c),target:au(".target",b.nodeElement,p,c)}},...T}),m.push({id:x.id,type:"dimensions",dimensions:T}))}return m},[]);Mp(o,c);const y=r||s&&!r&&Op(e,{initial:!0,...l});n({nodeInternals:new Map(o),fitViewOnInitDone:y}),(g==null?void 0:g.length)>0&&(i==null||i(g))},updateNodePositions:(t,i=!0,o=!1)=>{const{triggerNodeChanges:s}=e(),r=t.map(l=>{const a={id:l.id,type:"position",dragging:o};return i&&(a.positionAbsolute=l.positionAbsolute,a.position=l.position),a});s(r)},triggerNodeChanges:t=>{const{onNodesChange:i,nodeInternals:o,hasDefaultNodes:s,nodeOrigin:r,getNodes:l,elevateNodesOnSelect:a}=e();if(t!=null&&t.length){if(s){const c=Rp(t,l()),h=Kr(c,o,r,a);n({nodeInternals:h})}i==null||i(t)}},addSelectedNodes:t=>{const{multiSelectionActive:i,edges:o,getNodes:s}=e();let r,l=null;i?r=t.map(a=>Sn(a,!0)):(r=fi(s(),t),l=fi(o,[])),ss({changedNodes:r,changedEdges:l,get:e,set:n})},addSelectedEdges:t=>{const{multiSelectionActive:i,edges:o,getNodes:s}=e();let r,l=null;i?r=t.map(a=>Sn(a,!0)):(r=fi(o,t),l=fi(s(),[])),ss({changedNodes:l,changedEdges:r,get:e,set:n})},unselectNodesAndEdges:({nodes:t,edges:i}={})=>{const{edges:o,getNodes:s}=e(),r=t||s(),l=i||o,a=r.map(h=>(h.selected=!1,Sn(h.id,!1))),c=l.map(h=>Sn(h.id,!1));ss({changedNodes:a,changedEdges:c,get:e,set:n})},setMinZoom:t=>{const{d3Zoom:i,maxZoom:o}=e();i==null||i.scaleExtent([t,o]),n({minZoom:t})},setMaxZoom:t=>{const{d3Zoom:i,minZoom:o}=e();i==null||i.scaleExtent([o,t]),n({maxZoom:t})},setTranslateExtent:t=>{var i;(i=e().d3Zoom)==null||i.translateExtent(t),n({translateExtent:t})},resetSelectedElements:()=>{const{edges:t,getNodes:i}=e(),s=i().filter(l=>l.selected).map(l=>Sn(l.id,!1)),r=t.filter(l=>l.selected).map(l=>Sn(l.id,!1));ss({changedNodes:s,changedEdges:r,get:e,set:n})},setNodeExtent:t=>{const{nodeInternals:i}=e();i.forEach(o=>{o.positionAbsolute=$a(o.position,t)}),n({nodeExtent:t,nodeInternals:new Map(i)})},panBy:t=>{const{transform:i,width:o,height:s,d3Zoom:r,d3Selection:l,translateExtent:a}=e();if(!r||!l||!t.x&&!t.y)return!1;const c=cn.translate(i[0]+t.x,i[1]+t.y).scale(i[2]),h=[[0,0],[o,s]],u=r==null?void 0:r.constrain()(c,h,a);return r.transform(l,u),i[0]!==u.x||i[1]!==u.y||i[2]!==u.k},cancelConnection:()=>n({connectionNodeId:yn.connectionNodeId,connectionHandleId:yn.connectionHandleId,connectionHandleType:yn.connectionHandleType,connectionStatus:yn.connectionStatus,connectionStartHandle:yn.connectionStartHandle,connectionEndHandle:yn.connectionEndHandle}),reset:()=>n({...yn})}),Object.is),Vp=({children:n})=>{const e=N.useRef(null);return e.current||(e.current=$C()),H.createElement(ak,{value:e.current},n)};Vp.displayName="ReactFlowProvider";const Up=({children:n})=>N.useContext(lr)?H.createElement(H.Fragment,null,n):H.createElement(Vp,null,n);Up.displayName="ReactFlowWrapper";const WC={input:Sp,default:oa,output:Cp,group:Ka},HC={default:Qs,straight:Va,step:Ha,smoothstep:ar,simplebezier:Wa},VC=[0,0],UC=[15,15],qC={x:0,y:0,zoom:1},KC={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},qp=N.forwardRef(({nodes:n,edges:e,defaultNodes:t,defaultEdges:i,className:o,nodeTypes:s=WC,edgeTypes:r=HC,onNodeClick:l,onEdgeClick:a,onInit:c,onMove:h,onMoveStart:u,onMoveEnd:p,onConnect:g,onConnectStart:y,onConnectEnd:m,onClickConnectStart:b,onClickConnectEnd:x,onNodeMouseEnter:T,onNodeMouseMove:k,onNodeMouseLeave:E,onNodeContextMenu:M,onNodeDoubleClick:_,onNodeDragStart:C,onNodeDrag:P,onNodeDragStop:R,onNodesDelete:$,onEdgesDelete:F,onSelectionChange:L,onSelectionDragStart:W,onSelectionDrag:w,onSelectionDragStop:O,onSelectionContextMenu:S,onSelectionStart:z,onSelectionEnd:j,connectionMode:v=ii.Strict,connectionLineType:D=Cn.Bezier,connectionLineStyle:B,connectionLineComponent:I,connectionLineContainerStyle:V,deleteKeyCode:Q="Backspace",selectionKeyCode:J="Shift",selectionOnDrag:se=!1,selectionMode:le=wo.Full,panActivationKeyCode:xe="Space",multiSelectionKeyCode:ge=qs()?"Meta":"Control",zoomActivationKeyCode:ue=qs()?"Meta":"Control",snapToGrid:Ne=!1,snapGrid:Oe=UC,onlyRenderVisibleElements:Re=!1,selectNodesOnDrag:be=!0,nodesDraggable:de,nodesConnectable:Fe,nodesFocusable:U,nodeOrigin:q=VC,edgesFocusable:G,edgesUpdatable:ae,elementsSelectable:ce,defaultViewport:oe=qC,minZoom:Ee=.5,maxZoom:je=2,translateExtent:Ae=ra,preventScrolling:Se=!0,nodeExtent:Pt,defaultMarkerColor:Zt="#b1b1b7",zoomOnScroll:pn=!0,zoomOnPinch:It=!0,panOnScroll:Ve=!1,panOnScrollSpeed:rt=.5,panOnScrollMode:en=Yn.Free,zoomOnDoubleClick:tn=!0,panOnDrag:zt=!0,onPaneClick:Et,onPaneMouseEnter:pt,onPaneMouseMove:Pn,onPaneMouseLeave:gn,onPaneScroll:In,onPaneContextMenu:Lt,children:Oo,onEdgeContextMenu:nn,onEdgeDoubleClick:No,onEdgeMouseEnter:Ro,onEdgeMouseMove:A,onEdgeMouseLeave:Y,onEdgeUpdate:ie,onEdgeUpdateStart:me,onEdgeUpdateEnd:Ft,onReconnect:mn,onReconnectStart:hr,onReconnectEnd:ur,reconnectRadius:Jp=10,edgeUpdaterRadius:Zp=10,onNodesChange:eg,onEdgesChange:tg,noDragClassName:ng="nodrag",noWheelClassName:ig="nowheel",noPanClassName:Xa="nopan",fitView:og=!1,fitViewOptions:sg,connectOnClick:rg=!0,attributionPosition:lg,proOptions:ag,defaultEdgeOptions:cg,elevateNodesOnSelect:hg=!0,elevateEdgesOnSelect:ug=!1,disableKeyboardA11y:Ga=!1,autoPanOnConnect:dg=!0,autoPanOnNodeDrag:fg=!0,connectionRadius:pg=20,isValidConnection:gg,onError:mg,style:yg,id:Ja,nodeDragThreshold:xg,...bg},vg)=>{const dr=Ja||"1";return H.createElement("div",{...bg,style:{...yg,...KC},ref:vg,className:Xe(["react-flow",o]),"data-testid":"rf__wrapper",id:Ja},H.createElement(Up,null,H.createElement(FC,{onInit:c,onMove:h,onMoveStart:u,onMoveEnd:p,onNodeClick:l,onEdgeClick:a,onNodeMouseEnter:T,onNodeMouseMove:k,onNodeMouseLeave:E,onNodeContextMenu:M,onNodeDoubleClick:_,nodeTypes:s,edgeTypes:r,connectionLineType:D,connectionLineStyle:B,connectionLineComponent:I,connectionLineContainerStyle:V,selectionKeyCode:J,selectionOnDrag:se,selectionMode:le,deleteKeyCode:Q,multiSelectionKeyCode:ge,panActivationKeyCode:xe,zoomActivationKeyCode:ue,onlyRenderVisibleElements:Re,selectNodesOnDrag:be,defaultViewport:oe,translateExtent:Ae,minZoom:Ee,maxZoom:je,preventScrolling:Se,zoomOnScroll:pn,zoomOnPinch:It,zoomOnDoubleClick:tn,panOnScroll:Ve,panOnScrollSpeed:rt,panOnScrollMode:en,panOnDrag:zt,onPaneClick:Et,onPaneMouseEnter:pt,onPaneMouseMove:Pn,onPaneMouseLeave:gn,onPaneScroll:In,onPaneContextMenu:Lt,onSelectionContextMenu:S,onSelectionStart:z,onSelectionEnd:j,onEdgeContextMenu:nn,onEdgeDoubleClick:No,onEdgeMouseEnter:Ro,onEdgeMouseMove:A,onEdgeMouseLeave:Y,onReconnect:mn??ie,onReconnectStart:hr??me,onReconnectEnd:ur??Ft,reconnectRadius:Jp??Zp,defaultMarkerColor:Zt,noDragClassName:ng,noWheelClassName:ig,noPanClassName:Xa,elevateEdgesOnSelect:ug,rfId:dr,disableKeyboardA11y:Ga,nodeOrigin:q,nodeExtent:Pt}),H.createElement(Ik,{nodes:n,edges:e,defaultNodes:t,defaultEdges:i,onConnect:g,onConnectStart:y,onConnectEnd:m,onClickConnectStart:b,onClickConnectEnd:x,nodesDraggable:de,nodesConnectable:Fe,nodesFocusable:U,edgesFocusable:G,edgesUpdatable:ae,elementsSelectable:ce,elevateNodesOnSelect:hg,minZoom:Ee,maxZoom:je,nodeExtent:Pt,onNodesChange:eg,onEdgesChange:tg,snapToGrid:Ne,snapGrid:Oe,connectionMode:v,translateExtent:Ae,connectOnClick:rg,defaultEdgeOptions:cg,fitView:og,fitViewOptions:sg,onNodesDelete:$,onEdgesDelete:F,onNodeDragStart:C,onNodeDrag:P,onNodeDragStop:R,onSelectionDrag:w,onSelectionDragStart:W,onSelectionDragStop:O,noPanClassName:Xa,nodeOrigin:q,rfId:dr,autoPanOnConnect:dg,autoPanOnNodeDrag:fg,onError:mg,connectionRadius:pg,isValidConnection:gg,nodeDragThreshold:xg}),H.createElement(Bk,{onSelectionChange:L}),Oo,H.createElement(hk,{proOptions:ag,position:lg}),H.createElement(Wk,{rfId:dr,disableKeyboardA11y:Ga})))});qp.displayName="ReactFlow";function Kp(n){return e=>{const[t,i]=N.useState(e),o=N.useCallback(s=>i(r=>n(s,r)),[]);return[t,i,o]}}const QC=Kp(Rp),YC=Kp(nC),Qp=({id:n,x:e,y:t,width:i,height:o,style:s,color:r,strokeColor:l,strokeWidth:a,className:c,borderRadius:h,shapeRendering:u,onClick:p,selected:g})=>{const{background:y,backgroundColor:m}=s||{},b=r||y||m;return H.createElement("rect",{className:Xe(["react-flow__minimap-node",{selected:g},c]),x:e,y:t,rx:h,ry:h,width:i,height:o,fill:b,stroke:l,strokeWidth:a,shapeRendering:u,onClick:p?x=>p(x,n):void 0})};Qp.displayName="MiniMapNode";var XC=N.memo(Qp);const GC=n=>n.nodeOrigin,JC=n=>n.getNodes().filter(e=>!e.hidden&&e.width&&e.height),Gr=n=>n instanceof Function?n:()=>n;function ZC({nodeStrokeColor:n="transparent",nodeColor:e="#e2e2e2",nodeClassName:t="",nodeBorderRadius:i=5,nodeStrokeWidth:o=2,nodeComponent:s=XC,onClick:r}){const l=Me(JC,qe),a=Me(GC),c=Gr(e),h=Gr(n),u=Gr(t),p=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return H.createElement(H.Fragment,null,l.map(g=>{const{x:y,y:m}=Zn(g,a).positionAbsolute;return H.createElement(s,{key:g.id,x:y,y:m,width:g.width,height:g.height,style:g.style,selected:g.selected,className:u(g),color:c(g),borderRadius:i,strokeColor:h(g),strokeWidth:o,shapeRendering:p,onClick:r,id:g.id})}))}var e2=N.memo(ZC);const t2=200,n2=150,i2=n=>{const e=n.getNodes(),t={x:-n.transform[0]/n.transform[2],y:-n.transform[1]/n.transform[2],width:n.width/n.transform[2],height:n.height/n.transform[2]};return{viewBB:t,boundingRect:e.length>0?fk(cr(e,n.nodeOrigin),t):t,rfId:n.rfId}},o2="react-flow__minimap-desc";function Yp({style:n,className:e,nodeStrokeColor:t="transparent",nodeColor:i="#e2e2e2",nodeClassName:o="",nodeBorderRadius:s=5,nodeStrokeWidth:r=2,nodeComponent:l,maskColor:a="rgb(240, 240, 240, 0.6)",maskStrokeColor:c="none",maskStrokeWidth:h=1,position:u="bottom-right",onClick:p,onNodeClick:g,pannable:y=!1,zoomable:m=!1,ariaLabel:b="React Flow mini map",inversePan:x=!1,zoomStep:T=10,offsetScale:k=5}){const E=He(),M=N.useRef(null),{boundingRect:_,viewBB:C,rfId:P}=Me(i2,qe),R=(n==null?void 0:n.width)??t2,$=(n==null?void 0:n.height)??n2,F=_.width/R,L=_.height/$,W=Math.max(F,L),w=W*R,O=W*$,S=k*W,z=_.x-(w-_.width)/2-S,j=_.y-(O-_.height)/2-S,v=w+S*2,D=O+S*2,B=`${o2}-${P}`,I=N.useRef(0);I.current=W,N.useEffect(()=>{if(M.current){const J=mt(M.current),se=ge=>{const{transform:ue,d3Selection:Ne,d3Zoom:Oe}=E.getState();if(ge.sourceEvent.type!=="wheel"||!Ne||!Oe)return;const Re=-ge.sourceEvent.deltaY*(ge.sourceEvent.deltaMode===1?.05:ge.sourceEvent.deltaMode?1:.002)*T,be=ue[2]*Math.pow(2,Re);Oe.scaleTo(Ne,be)},le=ge=>{const{transform:ue,d3Selection:Ne,d3Zoom:Oe,translateExtent:Re,width:be,height:de}=E.getState();if(ge.sourceEvent.type!=="mousemove"||!Ne||!Oe)return;const Fe=I.current*Math.max(1,ue[2])*(x?-1:1),U={x:ue[0]-ge.sourceEvent.movementX*Fe,y:ue[1]-ge.sourceEvent.movementY*Fe},q=[[0,0],[be,de]],G=cn.translate(U.x,U.y).scale(ue[2]),ae=Oe.constrain()(G,q,Re);Oe.transform(Ne,ae)},xe=Zf().on("zoom",y?le:null).on("zoom.wheel",m?se:null);return J.call(xe),()=>{J.on("zoom",null)}}},[y,m,x,T]);const V=p?J=>{const se=_t(J);p(J,{x:se[0],y:se[1]})}:void 0,Q=g?(J,se)=>{const le=E.getState().nodeInternals.get(se);g(J,le)}:void 0;return H.createElement(La,{position:u,style:n,className:Xe(["react-flow__minimap",e]),"data-testid":"rf__minimap"},H.createElement("svg",{width:R,height:$,viewBox:`${z} ${j} ${v} ${D}`,role:"img","aria-labelledby":B,ref:M,onClick:V},b&&H.createElement("title",{id:B},b),H.createElement(e2,{onClick:Q,nodeColor:i,nodeStrokeColor:t,nodeBorderRadius:s,nodeClassName:o,nodeStrokeWidth:r,nodeComponent:l}),H.createElement("path",{className:"react-flow__minimap-mask",d:`M${z-S},${j-S}h${v+S*2}v${D+S*2}h${-v-S*2}z
        M${C.x},${C.y}h${C.width}v${C.height}h${-C.width}z`,fill:a,fillRule:"evenodd",stroke:c,strokeWidth:h,pointerEvents:"none"})))}Yp.displayName="MiniMap";var s2=N.memo(Yp);function r2(){return H.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},H.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function l2(){return H.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},H.createElement("path",{d:"M0 0h32v4.2H0z"}))}function a2(){return H.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},H.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function c2(){return H.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},H.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function h2(){return H.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},H.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Xi=({children:n,className:e,...t})=>H.createElement("button",{type:"button",className:Xe(["react-flow__controls-button",e]),...t},n);Xi.displayName="ControlButton";const u2=n=>({isInteractive:n.nodesDraggable||n.nodesConnectable||n.elementsSelectable,minZoomReached:n.transform[2]<=n.minZoom,maxZoomReached:n.transform[2]>=n.maxZoom}),Xp=({style:n,showZoom:e=!0,showFitView:t=!0,showInteractive:i=!0,fitViewOptions:o,onZoomIn:s,onZoomOut:r,onFitView:l,onInteractiveChange:a,className:c,children:h,position:u="bottom-left"})=>{const p=He(),[g,y]=N.useState(!1),{isInteractive:m,minZoomReached:b,maxZoomReached:x}=Me(u2,qe),{zoomIn:T,zoomOut:k,fitView:E}=Qa();if(N.useEffect(()=>{y(!0)},[]),!g)return null;const M=()=>{T(),s==null||s()},_=()=>{k(),r==null||r()},C=()=>{E(o),l==null||l()},P=()=>{p.setState({nodesDraggable:!m,nodesConnectable:!m,elementsSelectable:!m}),a==null||a(!m)};return H.createElement(La,{className:Xe(["react-flow__controls",c]),position:u,style:n,"data-testid":"rf__controls"},e&&H.createElement(H.Fragment,null,H.createElement(Xi,{onClick:M,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:x},H.createElement(r2,null)),H.createElement(Xi,{onClick:_,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:b},H.createElement(l2,null))),t&&H.createElement(Xi,{className:"react-flow__controls-fitview",onClick:C,title:"fit view","aria-label":"fit view"},H.createElement(a2,null)),i&&H.createElement(Xi,{className:"react-flow__controls-interactive",onClick:P,title:"toggle interactivity","aria-label":"toggle interactivity"},m?H.createElement(h2,null):H.createElement(c2,null)),h)};Xp.displayName="Controls";var d2=N.memo(Xp),kt;(function(n){n.Lines="lines",n.Dots="dots",n.Cross="cross"})(kt||(kt={}));function f2({color:n,dimensions:e,lineWidth:t}){return H.createElement("path",{stroke:n,strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})}function p2({color:n,radius:e}){return H.createElement("circle",{cx:e,cy:e,r:e,fill:n})}const g2={[kt.Dots]:"#91919a",[kt.Lines]:"#eee",[kt.Cross]:"#e2e2e2"},m2={[kt.Dots]:1,[kt.Lines]:1,[kt.Cross]:6},y2=n=>({transform:n.transform,patternId:`pattern-${n.rfId}`});function Gp({id:n,variant:e=kt.Dots,gap:t=20,size:i,lineWidth:o=1,offset:s=2,color:r,style:l,className:a}){const c=N.useRef(null),{transform:h,patternId:u}=Me(y2,qe),p=r||g2[e],g=i||m2[e],y=e===kt.Dots,m=e===kt.Cross,b=Array.isArray(t)?t:[t,t],x=[b[0]*h[2]||1,b[1]*h[2]||1],T=g*h[2],k=m?[T,T]:x,E=y?[T/s,T/s]:[k[0]/s,k[1]/s];return H.createElement("svg",{className:Xe(["react-flow__background",a]),style:{...l,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},H.createElement("pattern",{id:u+n,x:h[0]%x[0],y:h[1]%x[1],width:x[0],height:x[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`},y?H.createElement(p2,{color:p,radius:T/s}):H.createElement(f2,{dimensions:k,color:p,lineWidth:o})),H.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${u+n})`}))}Gp.displayName="Background";var x2=N.memo(Gp);const b2=({data:n,selected:e})=>d.jsxs("div",{style:{padding:"12px 16px",background:e?f.accent+"20":f.backgroundSoft,border:`2px solid ${e?f.accent:f.border}`,borderRadius:4,minWidth:200,fontFamily:"Consolas",fontSize:11},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:f.accent,fontWeight:600},children:[d.jsx("span",{children:he.blockFull}),d.jsx("span",{children:"SOURCE"})]}),n.table?d.jsxs("div",{style:{color:f.foreground},children:[d.jsx("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:"Table:"}),d.jsxs("div",{style:{fontWeight:600},children:[n.schema?`${n.schema}.`:"",n.table]})]}):n.query?d.jsxs("div",{style:{color:f.foreground},children:[d.jsx("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:"Custom Query:"}),d.jsxs("div",{style:{fontSize:9,maxHeight:60,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[n.query.substring(0,50),"..."]})]}):d.jsx("div",{style:{color:f.muted,fontSize:10},children:"Configure source"}),d.jsx(Ye,{type:"source",position:ee.Right,style:{background:f.accent,width:10,height:10}})]}),v2=({data:n,selected:e})=>{const t={inner:"INNER JOIN",left:"LEFT JOIN",right:"RIGHT JOIN",full:"FULL OUTER JOIN"};return d.jsxs("div",{style:{padding:"12px 16px",background:e?f.accent+"20":f.backgroundSoft,border:`2px solid ${e?f.accent:f.border}`,borderRadius:4,minWidth:200,fontFamily:"Consolas",fontSize:11},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:f.accent,fontWeight:600},children:[d.jsx("span",{children:he.blockSemi}),d.jsx("span",{children:"JOIN"})]}),d.jsxs("div",{style:{color:f.foreground},children:[d.jsx("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:"Type:"}),d.jsx("div",{style:{fontWeight:600,marginBottom:8},children:t[n.joinType]||"INNER JOIN"}),n.leftTable&&n.rightTable?d.jsx(d.Fragment,{children:d.jsxs("div",{style:{fontSize:10,color:f.muted,marginBottom:2},children:[n.leftTable,".",n.leftColumn," = ",n.rightTable,".",n.rightColumn]})}):d.jsx("div",{style:{color:f.muted,fontSize:10},children:"Configure join"})]}),d.jsx(Ye,{type:"target",position:ee.Left,style:{background:f.accent,width:10,height:10}}),d.jsx(Ye,{type:"target",position:ee.Top,id:"right",style:{background:f.success,width:10,height:10}}),d.jsx(Ye,{type:"source",position:ee.Right,style:{background:f.accent,width:10,height:10}})]})},w2=({data:n,selected:e})=>d.jsxs("div",{style:{padding:"12px 16px",background:e?f.accent+"20":f.backgroundSoft,border:`2px solid ${e?f.accent:f.border}`,borderRadius:4,minWidth:200,fontFamily:"Consolas",fontSize:11},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:f.accent,fontWeight:600},children:[d.jsx("span",{children:he.blockSemi}),d.jsx("span",{children:"FILTER"})]}),d.jsx("div",{style:{color:f.foreground},children:n.conditions&&n.conditions.length>0?d.jsxs("div",{children:[d.jsxs("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:["Conditions (",n.conditions.length,"):"]}),n.conditions.slice(0,2).map((t,i)=>d.jsxs("div",{style:{fontSize:9,marginBottom:2},children:[t.column," ",t.op," ",String(t.value).substring(0,20)]},i)),n.conditions.length>2&&d.jsxs("div",{style:{fontSize:9,color:f.muted},children:["+",n.conditions.length-2," more"]})]}):d.jsx("div",{style:{color:f.muted,fontSize:10},children:"Add filter conditions"})}),d.jsx(Ye,{type:"target",position:ee.Left,style:{background:f.accent,width:10,height:10}}),d.jsx(Ye,{type:"source",position:ee.Right,style:{background:f.accent,width:10,height:10}})]}),S2=({data:n,selected:e})=>d.jsxs("div",{style:{padding:"12px 16px",background:e?f.accent+"20":f.backgroundSoft,border:`2px solid ${e?f.accent:f.border}`,borderRadius:4,minWidth:200,fontFamily:"Consolas",fontSize:11},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:f.accent,fontWeight:600},children:[d.jsx("span",{children:he.blockSemi}),d.jsx("span",{children:"AGGREGATE"})]}),d.jsxs("div",{style:{color:f.foreground},children:[n.groupBy&&n.groupBy.length>0&&d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:"GROUP BY:"}),d.jsx("div",{style:{fontSize:9},children:n.groupBy.join(", ")})]}),n.aggregations&&n.aggregations.length>0?d.jsxs("div",{children:[d.jsxs("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:["Functions (",n.aggregations.length,"):"]}),n.aggregations.slice(0,2).map((t,i)=>d.jsxs("div",{style:{fontSize:9,marginBottom:2},children:[t.function.toUpperCase(),"(",t.column,")"]},i)),n.aggregations.length>2&&d.jsxs("div",{style:{fontSize:9,color:f.muted},children:["+",n.aggregations.length-2," more"]})]}):d.jsx("div",{style:{color:f.muted,fontSize:10},children:"Add aggregations"})]}),d.jsx(Ye,{type:"target",position:ee.Left,style:{background:f.accent,width:10,height:10}}),d.jsx(Ye,{type:"source",position:ee.Right,style:{background:f.accent,width:10,height:10}})]}),k2=({data:n,selected:e})=>d.jsxs("div",{style:{padding:"12px 16px",background:e?f.accent+"20":f.backgroundSoft,border:`2px solid ${e?f.accent:f.border}`,borderRadius:4,minWidth:200,fontFamily:"Consolas",fontSize:11},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:f.accent,fontWeight:600},children:[d.jsx("span",{children:he.blockSemi}),d.jsx("span",{children:"TRANSFORM"})]}),d.jsx("div",{style:{color:f.foreground},children:n.transforms&&n.transforms.length>0?d.jsxs("div",{children:[d.jsxs("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:["Transforms (",n.transforms.length,"):"]}),n.transforms.slice(0,2).map((t,i)=>d.jsxs("div",{style:{fontSize:9,marginBottom:2},children:[t.target_column," = ",t.expression.substring(0,30),"..."]},i)),n.transforms.length>2&&d.jsxs("div",{style:{fontSize:9,color:f.muted},children:["+",n.transforms.length-2," more"]})]}):d.jsx("div",{style:{color:f.muted,fontSize:10},children:"Add transformations"})}),d.jsx(Ye,{type:"target",position:ee.Left,style:{background:f.accent,width:10,height:10}}),d.jsx(Ye,{type:"source",position:ee.Right,style:{background:f.accent,width:10,height:10}})]}),C2=({data:n,selected:e})=>d.jsxs("div",{style:{padding:"12px 16px",background:e?f.accent+"20":f.backgroundSoft,border:`2px solid ${e?f.accent:f.border}`,borderRadius:4,minWidth:200,fontFamily:"Consolas",fontSize:11},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:f.accent,fontWeight:600},children:[d.jsx("span",{children:he.blockSemi}),d.jsx("span",{children:"LOOKUP"})]}),d.jsx("div",{style:{color:f.foreground},children:n.lookupTable?d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:"Table:"}),d.jsxs("div",{style:{fontWeight:600,marginBottom:8},children:[n.lookupSchema?`${n.lookupSchema}.`:"",n.lookupTable]}),n.sourceColumns.length>0&&d.jsxs("div",{style:{fontSize:9,color:f.muted},children:[n.sourceColumns.length," source columns"]})]}):d.jsx("div",{style:{color:f.muted,fontSize:10},children:"Configure lookup"})}),d.jsx(Ye,{type:"target",position:ee.Left,style:{background:f.accent,width:10,height:10}}),d.jsx(Ye,{type:"source",position:ee.Right,style:{background:f.accent,width:10,height:10}})]}),T2=({data:n,selected:e})=>d.jsxs("div",{style:{padding:"12px 16px",background:e?f.accent+"20":f.backgroundSoft,border:`2px solid ${e?f.accent:f.border}`,borderRadius:4,minWidth:200,fontFamily:"Consolas",fontSize:11},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:f.accent,fontWeight:600},children:[d.jsx("span",{children:he.blockFull}),d.jsx("span",{children:"TARGET"})]}),d.jsx("div",{style:{color:f.foreground},children:n.table?d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{fontSize:10,color:f.muted,marginBottom:4},children:"Table:"}),d.jsxs("div",{style:{fontWeight:600,marginBottom:8},children:[n.schema?`${n.schema}.`:"",n.table]}),n.loadStrategy&&d.jsxs("div",{style:{fontSize:9,color:f.muted},children:["Strategy: ",n.loadStrategy]})]}):d.jsx("div",{style:{color:f.muted,fontSize:10},children:"Configure target"})}),d.jsx(Ye,{type:"target",position:ee.Left,style:{background:f.accent,width:10,height:10}})]}),E2=({nodeId:n,nodeType:e,nodeData:t,onClose:i,onSave:o,onDelete:s,targetSchema:r,targetTable:l})=>{const[a,c]=N.useState(t);N.useEffect(()=>{c(t)},[t]);const h=()=>{o(n,a),i()},u=()=>{const O=a;return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Schema (optional)"}),d.jsx("input",{type:"text",value:O.schema||"",onChange:S=>c({...a,schema:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Table *"}),d.jsx("input",{type:"text",value:O.table||"",onChange:S=>c({...a,table:S.target.value}),placeholder:"table_name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsx("div",{style:{fontSize:10,color:f.muted,fontFamily:"Consolas"},children:"OR"}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Custom Query"}),d.jsx("textarea",{value:O.query||"",onChange:S=>c({...a,query:S.target.value}),placeholder:"SELECT * FROM ...",rows:4,style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11,resize:"vertical"}})]})]})},p=()=>{const O=a;return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Join Type *"}),d.jsxs("select",{value:O.joinType||"inner",onChange:S=>c({...a,joinType:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"inner",children:"INNER JOIN"}),d.jsx("option",{value:"left",children:"LEFT JOIN"}),d.jsx("option",{value:"right",children:"RIGHT JOIN"}),d.jsx("option",{value:"full",children:"FULL OUTER JOIN"})]})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Left Table"}),d.jsx("input",{type:"text",value:O.leftTable||"",onChange:S=>c({...a,leftTable:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Left Column"}),d.jsx("input",{type:"text",value:O.leftColumn||"",onChange:S=>c({...a,leftColumn:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Right Table"}),d.jsx("input",{type:"text",value:O.rightTable||"",onChange:S=>c({...a,rightTable:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Right Column"}),d.jsx("input",{type:"text",value:O.rightColumn||"",onChange:S=>c({...a,rightColumn:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Custom Join Condition (optional)"}),d.jsx("input",{type:"text",value:O.joinCondition||"",onChange:S=>c({...a,joinCondition:S.target.value}),placeholder:"table1.col1 = table2.col2",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})},g=()=>{const S=a.conditions||[];return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"Filter Conditions"}),d.jsx("button",{onClick:()=>c({...a,conditions:[...S,{column:"",op:"=",value:""}]}),style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"+ Add Condition"})]}),S.map((z,j)=>d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 2fr auto",gap:8,alignItems:"center"},children:[d.jsx("input",{type:"text",value:z.column||"",onChange:v=>{const D=[...S];D[j]={...D[j],column:v.target.value},c({...a,conditions:D})},placeholder:"column_name",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),d.jsxs("select",{value:z.op||"=",onChange:v=>{const D=[...S];D[j]={...D[j],op:v.target.value},c({...a,conditions:D})},style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"=",children:"="}),d.jsx("option",{value:"!=",children:"!="}),d.jsx("option",{value:">",children:">"}),d.jsx("option",{value:"<",children:"<"}),d.jsx("option",{value:">=",children:">="}),d.jsx("option",{value:"<=",children:"<="}),d.jsx("option",{value:"LIKE",children:"LIKE"}),d.jsx("option",{value:"IN",children:"IN"}),d.jsx("option",{value:"NOT IN",children:"NOT IN"}),d.jsx("option",{value:"IS NULL",children:"IS NULL"}),d.jsx("option",{value:"IS NOT NULL",children:"IS NOT NULL"})]}),d.jsx("input",{type:"text",value:z.value!==null&&z.value!==void 0?String(z.value):"",onChange:v=>{const D=[...S];D[j]={...D[j],value:v.target.value},c({...a,conditions:D})},placeholder:"value",disabled:z.op==="IS NULL"||z.op==="IS NOT NULL",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11,opacity:z.op==="IS NULL"||z.op==="IS NOT NULL"?.5:1}}),d.jsx("button",{onClick:()=>{const v=S.filter((D,B)=>B!==j);c({...a,conditions:v})},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"Ã—"})]},j)),S.length===0&&d.jsx("div",{style:{fontSize:10,color:f.muted,fontFamily:"Consolas",fontStyle:"italic"},children:'No conditions added. Click "Add Condition" to add filters.'})]})},y=()=>{var z;const O=a,S=O.aggregations||[];return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"GROUP BY Columns (comma-separated)"}),d.jsx("input",{type:"text",value:((z=O.groupBy)==null?void 0:z.join(", "))||"",onChange:j=>c({...a,groupBy:j.target.value.split(",").map(v=>v.trim()).filter(Boolean)}),placeholder:"column1, column2",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"Aggregations"}),d.jsx("button",{onClick:()=>c({...a,aggregations:[...S,{column:"",function:"sum"}]}),style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"+ Add Aggregation"})]}),S.map((j,v)=>d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr auto",gap:8,alignItems:"center"},children:[d.jsxs("select",{value:j.function||"sum",onChange:D=>{const B=[...S];B[v]={...B[v],function:D.target.value},c({...a,aggregations:B})},style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"sum",children:"SUM"}),d.jsx("option",{value:"count",children:"COUNT"}),d.jsx("option",{value:"avg",children:"AVG"}),d.jsx("option",{value:"min",children:"MIN"}),d.jsx("option",{value:"max",children:"MAX"})]}),d.jsx("input",{type:"text",value:j.column||"",onChange:D=>{const B=[...S];B[v]={...B[v],column:D.target.value},c({...a,aggregations:B})},placeholder:"column_name",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),d.jsx("button",{onClick:()=>{const D=S.filter((B,I)=>I!==v);c({...a,aggregations:D})},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"Ã—"})]},v))]})},m=(O,S)=>{const v=[...a.transforms||[]];v[O]={...v[O],config:{...v[O].config,...S}},c({...a,transforms:v})},b=(O,S,z)=>{const v=(O.config||{}).sort_columns||[];return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"Sort Columns"}),v.map((D,B)=>d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr auto",gap:8},children:[d.jsx("input",{type:"text",value:D.column||"",onChange:I=>{const V=[...v];V[B]={...V[B],column:I.target.value},m(S,{sort_columns:V})},placeholder:"column_name",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),d.jsxs("select",{value:D.order||"asc",onChange:I=>{const V=[...v];V[B]={...V[B],order:I.target.value},m(S,{sort_columns:V})},style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"asc",children:"ASC"}),d.jsx("option",{value:"desc",children:"DESC"})]}),d.jsx("button",{onClick:()=>{const I=v.filter((V,Q)=>Q!==B);m(S,{sort_columns:I})},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas"},children:"Ã—"})]},B)),d.jsx("button",{onClick:()=>m(S,{sort_columns:[...v,{column:"",order:"asc"}]}),style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"+ Add Sort Column"})]})},x=(O,S,z)=>{const v=(O.config||{}).expressions||[];return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"Expressions"}),v.map((D,B)=>d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:8,border:`1px solid ${f.border}`,borderRadius:2},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr auto",gap:8},children:[d.jsx("input",{type:"text",value:D.target_column||"",onChange:I=>{const V=[...v];V[B]={...V[B],target_column:I.target.value},m(S,{expressions:V})},placeholder:"target_column",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),d.jsxs("select",{value:D.type||"auto",onChange:I=>{const V=[...v];V[B]={...V[B],type:I.target.value},m(S,{expressions:V})},style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"auto",children:"Auto"}),d.jsx("option",{value:"math",children:"Math"}),d.jsx("option",{value:"string",children:"String"}),d.jsx("option",{value:"date",children:"Date"})]}),d.jsx("button",{onClick:()=>{const I=v.filter((V,Q)=>Q!==B);m(S,{expressions:I})},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas"},children:"Ã—"})]}),d.jsx("textarea",{value:D.expression||"",onChange:I=>{const V=[...v];V[B]={...V[B],expression:I.target.value},m(S,{expressions:V})},placeholder:"UPPER({column1}), {column1} + {column2}, DATEADD({date}, 7)",rows:2,style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11,resize:"vertical"}})]},B)),d.jsx("button",{onClick:()=>m(S,{expressions:[...v,{target_column:"",expression:"",type:"auto"}]}),style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"+ Add Expression"})]})},T=(O,S,z)=>{const v=(O.config||{}).rules||[];return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"Cleansing Rules"}),v.map((D,B)=>d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:8,border:`1px solid ${f.border}`,borderRadius:2},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[d.jsx("input",{type:"text",value:D.column||"",onChange:I=>{const V=[...v];V[B]={...V[B],column:I.target.value},m(S,{rules:V})},placeholder:"column_name",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),d.jsx("button",{onClick:()=>{const I=v.filter((V,Q)=>Q!==B);m(S,{rules:I})},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas"},children:"Ã—"})]}),d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:["trim","uppercase","lowercase","remove_special","remove_whitespace","normalize_whitespace"].map(I=>d.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:10,fontFamily:"Consolas"},children:[d.jsx("input",{type:"checkbox",checked:(D.operations||[]).includes(I),onChange:V=>{const Q=[...v],J=Q[B].operations||[];V.target.checked?Q[B]={...Q[B],operations:[...J,I]}:Q[B]={...Q[B],operations:J.filter(se=>se!==I)},m(S,{rules:Q})}}),I]},I))})]},B)),d.jsx("button",{onClick:()=>m(S,{rules:[...v,{column:"",operations:[]}]}),style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"+ Add Rule"})]})},k=(O,S,z)=>{const j=O.config||{};return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Rank Type"}),d.jsxs("select",{value:j.rank_type||"top_n",onChange:v=>m(S,{rank_type:v.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"top_n",children:"TOP N"}),d.jsx("option",{value:"bottom_n",children:"BOTTOM N"}),d.jsx("option",{value:"rank",children:"RANK"}),d.jsx("option",{value:"dense_rank",children:"DENSE RANK"}),d.jsx("option",{value:"row_number",children:"ROW NUMBER"})]})]}),(j.rank_type==="top_n"||j.rank_type==="bottom_n")&&d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"N"}),d.jsx("input",{type:"number",value:j.n||10,onChange:v=>m(S,{n:parseInt(v.target.value)||10}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Order Column"}),d.jsx("input",{type:"text",value:j.order_column||"",onChange:v=>m(S,{order_column:v.target.value}),placeholder:"column_name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Partition By (optional)"}),d.jsx("input",{type:"text",value:(j.partition_by||[]).join(", "),onChange:v=>m(S,{partition_by:v.target.value.split(",").map(D=>D.trim()).filter(D=>D)}),placeholder:"col1, col2, col3",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})},E=(O,S,z)=>{const j=O.config||{};return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Target Column"}),d.jsx("input",{type:"text",value:j.target_column||"",onChange:v=>m(S,{target_column:v.target.value}),placeholder:"id, sequence_id, etc.",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Start Value"}),d.jsx("input",{type:"number",value:j.start_value||1,onChange:v=>m(S,{start_value:parseInt(v.target.value)||1}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Increment"}),d.jsx("input",{type:"number",value:j.increment||1,onChange:v=>m(S,{increment:parseInt(v.target.value)||1}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})},M=(O,S,z)=>{const v=(O.config||{}).windows||[];return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"Window Functions"}),v.map((D,B)=>d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:8,border:`1px solid ${f.border}`,borderRadius:2},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[d.jsxs("select",{value:D.function||"row_number",onChange:I=>{const V=[...v];V[B]={...V[B],function:I.target.value},m(S,{windows:V})},style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"row_number",children:"ROW_NUMBER"}),d.jsx("option",{value:"lag",children:"LAG"}),d.jsx("option",{value:"lead",children:"LEAD"}),d.jsx("option",{value:"first_value",children:"FIRST_VALUE"}),d.jsx("option",{value:"last_value",children:"LAST_VALUE"}),d.jsx("option",{value:"rank",children:"RANK"}),d.jsx("option",{value:"dense_rank",children:"DENSE_RANK"})]}),d.jsx("button",{onClick:()=>{const I=v.filter((V,Q)=>Q!==B);m(S,{windows:I})},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas"},children:"Ã—"})]}),d.jsx("input",{type:"text",value:D.target_column||"",onChange:I=>{const V=[...v];V[B]={...V[B],target_column:I.target.value},m(S,{windows:V})},placeholder:"target_column",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),d.jsx("input",{type:"text",value:D.source_column||"",onChange:I=>{const V=[...v];V[B]={...V[B],source_column:I.target.value},m(S,{windows:V})},placeholder:"source_column",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),(D.function==="lag"||D.function==="lead")&&d.jsx("input",{type:"number",value:D.offset||1,onChange:I=>{const V=[...v];V[B]={...V[B],offset:parseInt(I.target.value)||1},m(S,{windows:V})},placeholder:"offset",style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]},B)),d.jsx("button",{onClick:()=>m(S,{windows:[...v,{function:"row_number",target_column:"",source_column:""}]}),style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"+ Add Window Function"})]})},_=(O,S,z)=>{const j=O.config||{};return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Columns to Denormalize"}),d.jsx("input",{type:"text",value:(j.columns_to_denormalize||[]).join(", "),onChange:v=>m(S,{columns_to_denormalize:v.target.value.split(",").map(D=>D.trim()).filter(D=>D)}),placeholder:"col1, col2, col3",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Key Column Name"}),d.jsx("input",{type:"text",value:j.key_column_name||"key",onChange:v=>m(S,{key_column_name:v.target.value}),placeholder:"key",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Value Column Name"}),d.jsx("input",{type:"text",value:j.value_column_name||"value",onChange:v=>m(S,{value_column_name:v.target.value}),placeholder:"value",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})},C=(O,S,z)=>{const j=O.config||{};return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Source Column"}),d.jsx("input",{type:"text",value:j.source_column||"",onChange:v=>m(S,{source_column:v.target.value}),placeholder:"json_column",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Format"}),d.jsxs("select",{value:j.format||"json",onChange:v=>m(S,{format:v.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"json",children:"JSON"}),d.jsx("option",{value:"xml",children:"XML"})]})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Fields to Extract (optional, leave empty for all)"}),d.jsx("input",{type:"text",value:(j.fields_to_extract||[]).join(", "),onChange:v=>m(S,{fields_to_extract:v.target.value.split(",").map(D=>D.trim()).filter(D=>D)}),placeholder:"user.name, user.address.city (use dot notation for nested)",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})},P=(O,S,z)=>{const j=O.config||{};return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Operation"}),d.jsxs("select",{value:j.operation||"distance",onChange:v=>m(S,{operation:v.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"distance",children:"Distance"}),d.jsx("option",{value:"point_in_polygon",children:"Point in Polygon"})]})]}),j.operation==="distance"&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Point 1 Column"}),d.jsx("input",{type:"text",value:j.point1_column||"",onChange:v=>m(S,{point1_column:v.target.value}),placeholder:"point1_column",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Point 2 Column"}),d.jsx("input",{type:"text",value:j.point2_column||"",onChange:v=>m(S,{point2_column:v.target.value}),placeholder:"point2_column",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]}),j.operation==="point_in_polygon"&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Point Column"}),d.jsx("input",{type:"text",value:j.point_column||"",onChange:v=>m(S,{point_column:v.target.value}),placeholder:"point_column",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsxs("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:["Polygon (JSON array of ",(lat,lng)," objects)"]}),d.jsx("textarea",{value:typeof j.polygon=="string"?j.polygon:JSON.stringify(j.polygon||[],null,2),onChange:v=>{try{const D=JSON.parse(v.target.value);m(S,{polygon:D})}catch{m(S,{polygon:v.target.value})}},placeholder:'[{"latitude": 40.7128, "longitude": -74.0060}, ...]',rows:4,style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11,resize:"vertical"}})]})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Target Column"}),d.jsx("input",{type:"text",value:j.target_column||"geolocation_result",onChange:v=>m(S,{target_column:v.target.value}),placeholder:"geolocation_result",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})},R=(O,S,z)=>{const j=O.config||{};return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Validation Type"}),d.jsxs("select",{value:j.validation_type||"email",onChange:v=>m(S,{validation_type:v.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"address",children:"Address"}),d.jsx("option",{value:"phone",children:"Phone"}),d.jsx("option",{value:"email",children:"Email"})]})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Source Column"}),d.jsx("input",{type:"text",value:j.source_column||"",onChange:v=>m(S,{source_column:v.target.value}),placeholder:"column_name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Target Column"}),d.jsx("input",{type:"text",value:j.target_column||(j.source_column?`${j.source_column}_validated`:""),onChange:v=>m(S,{target_column:v.target.value}),placeholder:"column_validated",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Is Valid Column"}),d.jsx("input",{type:"text",value:j.is_valid_column||(j.source_column?`${j.source_column}_is_valid`:""),onChange:v=>m(S,{is_valid_column:v.target.value}),placeholder:"column_is_valid",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})},$=(O,S,z)=>{const j=O.config||{};return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Method"}),d.jsxs("select",{value:j.method||"exact",onChange:v=>m(S,{method:v.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"exact",children:"Exact Match"}),d.jsx("option",{value:"fuzzy",children:"Fuzzy Match"}),d.jsx("option",{value:"similarity",children:"Similarity Match"})]})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Key Columns"}),d.jsx("input",{type:"text",value:(j.key_columns||[]).join(", "),onChange:v=>m(S,{key_columns:v.target.value.split(",").map(D=>D.trim()).filter(D=>D)}),placeholder:"col1, col2, col3",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),(j.method==="fuzzy"||j.method==="similarity")&&d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Similarity Threshold (0.0 - 1.0)"}),d.jsx("input",{type:"number",min:"0",max:"1",step:"0.1",value:j.similarity_threshold||.8,onChange:v=>m(S,{similarity_threshold:parseFloat(v.target.value)||.8}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas",display:"block",marginBottom:4},children:"Keep Strategy"}),d.jsxs("select",{value:j.keep_strategy||"first",onChange:v=>m(S,{keep_strategy:v.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"first",children:"Keep First"}),d.jsx("option",{value:"last",children:"Keep Last"})]})]})]})},F=()=>{const S=a.transforms||[],z=[{value:"basic",label:"Basic (Expression)"},{value:"sorter",label:"Sorter (Sort)"},{value:"expression",label:"Expression (Advanced)"},{value:"data_cleansing",label:"Data Cleansing"},{value:"rank",label:"Rank (TOP N/BOTTOM N)"},{value:"sequence_generator",label:"Sequence Generator"},{value:"window_functions",label:"Window Functions"},{value:"normalizer",label:"Normalizer (Unpivot)"},{value:"json_parser",label:"JSON/XML Parser"},{value:"geolocation",label:"Geolocation"},{value:"data_validation",label:"Data Validation"},{value:"deduplication",label:"Deduplication"}];return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("label",{style:{fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"Transformations"}),d.jsx("button",{onClick:()=>c({...a,transforms:[...S,{target_column:"",expression:"",transformationType:"basic"}]}),style:{padding:"4px 8px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"+ Add Transform"})]}),S.map((j,v)=>{const D=j.transformationType||"basic";return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:12,border:`1px solid ${f.border}`,borderRadius:2},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[d.jsx("select",{value:D,onChange:B=>{const I=[...S];I[v]={...I[v],transformationType:B.target.value,config:{}},c({...a,transforms:I})},style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:z.map(B=>d.jsx("option",{value:B.value,children:B.label},B.value))}),d.jsx("button",{onClick:()=>{const B=S.filter((I,V)=>V!==v);c({...a,transforms:B})},style:{padding:"4px 8px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:10,fontFamily:"Consolas",fontWeight:600},children:"Ã—"})]}),D==="basic"&&d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",value:j.target_column||"",onChange:B=>{const I=[...S];I[v]={...I[v],target_column:B.target.value},c({...a,transforms:I})},placeholder:"target_column_name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}}),d.jsx("textarea",{value:j.expression||"",onChange:B=>{const I=[...S];I[v]={...I[v],expression:B.target.value},c({...a,transforms:I})},placeholder:"column1 + column2, UPPER(column3), etc.",rows:2,style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11,resize:"vertical"}})]}),D==="sorter"&&b(j,v),D==="expression"&&x(j,v),D==="data_cleansing"&&T(j,v),D==="rank"&&k(j,v),D==="sequence_generator"&&E(j,v),D==="window_functions"&&M(j,v),D==="normalizer"&&_(j,v),D==="json_parser"&&C(j,v),D==="geolocation"&&P(j,v),D==="data_validation"&&R(j,v),D==="deduplication"&&$(j,v)]},v)})]})},L=()=>{const O=a;return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Schema"}),d.jsx("input",{type:"text",value:O.schema||r||"",onChange:S=>c({...a,schema:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Table *"}),d.jsx("input",{type:"text",value:O.table||l||"",onChange:S=>c({...a,table:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Load Strategy"}),d.jsxs("select",{value:O.loadStrategy||"TRUNCATE",onChange:S=>c({...a,loadStrategy:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11},children:[d.jsx("option",{value:"TRUNCATE",children:"TRUNCATE (Delete all, then insert)"}),d.jsx("option",{value:"APPEND",children:"APPEND (Insert new rows only)"}),d.jsx("option",{value:"UPSERT",children:"UPSERT (Update or insert)"})]})]})]})},W=()=>{switch(e){case"source":return u();case"join":return p();case"filter":return g();case"aggregate":return y();case"transform":return F();case"lookup":return w();case"target":return L();default:return d.jsx("div",{style:{color:f.muted,fontSize:11,fontFamily:"Consolas"},children:"No configuration available"})}},w=()=>{const O=a;return d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Lookup Schema (optional)"}),d.jsx("input",{type:"text",value:O.lookupSchema||"",onChange:S=>c({...a,lookupSchema:S.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Lookup Table *"}),d.jsx("input",{type:"text",value:O.lookupTable||"",onChange:S=>c({...a,lookupTable:S.target.value}),placeholder:"table_name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Source Columns (comma-separated) *"}),d.jsx("input",{type:"text",value:(O.sourceColumns||[]).join(", "),onChange:S=>c({...a,sourceColumns:S.target.value.split(",").map(z=>z.trim()).filter(z=>z)}),placeholder:"id, name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Lookup Columns (comma-separated) *"}),d.jsx("input",{type:"text",value:(O.lookupColumns||[]).join(", "),onChange:S=>c({...a,lookupColumns:S.target.value.split(",").map(z=>z.trim()).filter(z=>z)}),placeholder:"id, name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",fontSize:11,color:f.muted,marginBottom:4,fontFamily:"Consolas"},children:"Return Columns (comma-separated) *"}),d.jsx("input",{type:"text",value:(O.returnColumns||[]).join(", "),onChange:S=>c({...a,returnColumns:S.target.value.split(",").map(z=>z.trim()).filter(z=>z)}),placeholder:"department, location",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,fontFamily:"Consolas",fontSize:11}})]})]})};return d.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:d.jsxs("div",{style:{background:f.background,padding:24,borderRadius:2,width:"90%",maxWidth:600,maxHeight:"90vh",overflowY:"auto",border:`2px solid ${f.accent}`,fontFamily:"Consolas"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,paddingBottom:12,borderBottom:`2px solid ${f.border}`},children:[d.jsxs("h3",{style:{fontSize:14,fontWeight:600,color:f.accent,margin:0,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.blockFull," CONFIGURE ",e.toUpperCase()," NODE"]}),d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",color:f.foreground,fontSize:20,cursor:"pointer",padding:"0 8px"},children:"Ã—"})]}),W(),d.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"space-between",marginTop:20,paddingTop:12,borderTop:`1px solid ${f.border}`},children:[s&&d.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this node?")&&(s(n),i())},style:{padding:"8px 16px",border:`1px solid ${f.danger}`,borderRadius:2,background:f.danger,color:f.background,cursor:"pointer",fontSize:12,fontFamily:"Consolas",fontWeight:600},children:"DELETE"}),d.jsxs("div",{style:{display:"flex",gap:12,marginLeft:"auto"},children:[d.jsx("button",{onClick:i,style:{padding:"8px 16px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,cursor:"pointer",fontSize:12,fontFamily:"Consolas",fontWeight:600},children:"CANCEL"}),d.jsx("button",{onClick:h,style:{padding:"8px 16px",border:`1px solid ${f.accent}`,borderRadius:2,background:f.accent,color:f.background,cursor:"pointer",fontSize:12,fontFamily:"Consolas",fontWeight:600},children:"SAVE"})]})]})]})})},A2={source:b2,join:v2,filter:w2,aggregate:S2,transform:k2,lookup:C2,target:T2},mu=({initialGraph:n,onGraphChange:e,sourceConnectionString:t,sourceDbEngine:i,targetConnectionString:o,targetDbEngine:s,targetSchema:r,targetTable:l})=>{const a=N.useMemo(()=>n!=null&&n.nodes?n.nodes.map(R=>({id:R.id,type:R.type,data:R.data,position:R.position})):[],[n]),c=N.useMemo(()=>n!=null&&n.edges?n.edges.map(R=>({id:R.id,source:R.source,target:R.target,sourceHandle:R.sourceHandle,targetHandle:R.targetHandle})):[],[n]),[h,u,p]=QC(a),[g,y,m]=YC(c),[b,x]=N.useState(null),[T,k]=N.useState(!1),E=N.useCallback(R=>{const $=up(R,g);y($),e&&e({nodes:h.map(F=>({id:F.id,type:F.type,data:F.data,position:F.position})),edges:$.map(F=>({id:F.id,source:F.source,target:F.target,sourceHandle:F.sourceHandle||void 0,targetHandle:F.targetHandle||void 0}))})},[g,h,e,y]),M=N.useCallback((R,$)=>{x($),k(!0)},[]),_=N.useCallback(()=>{x(null),k(!1)},[]),C=N.useCallback((R,$)=>{const F={id:`${R}-${Date.now()}`,type:R,position:$,data:{type:R,...R==="source"&&{connectionString:t,dbEngine:i},...R==="target"&&{schema:r,table:l,connectionString:o,dbEngine:s,loadStrategy:"TRUNCATE"},...R==="join"&&{joinType:"inner"},...R==="filter"&&{conditions:[]},...R==="aggregate"&&{aggregations:[]},...R==="transform"&&{transforms:[]},...R==="lookup"&&{sourceColumns:[],lookupColumns:[],returnColumns:[]}}};u(L=>{const W=[...L,F];return e&&e({nodes:W.map(w=>({id:w.id,type:w.type,data:w.data,position:w.position})),edges:g.map(w=>({id:w.id,source:w.source,target:w.target,sourceHandle:w.sourceHandle||void 0,targetHandle:w.targetHandle||void 0}))}),W})},[t,i,o,s,r,l,g,e,u]),P=N.useCallback(R=>{if(u($=>$.filter(F=>F.id!==R)),y($=>$.filter(F=>F.source!==R&&F.target!==R)),e){const $=h.filter(L=>L.id!==R),F=g.filter(L=>L.source!==R&&L.target!==R);e({nodes:$.map(L=>({id:L.id,type:L.type,data:L.data,position:L.position})),edges:F.map(L=>({id:L.id,source:L.source,target:L.target,sourceHandle:L.sourceHandle||void 0,targetHandle:L.targetHandle||void 0}))})}},[h,g,e,u,y]);return d.jsxs("div",{style:{width:"100%",height:"600px",position:"relative"},children:[d.jsxs("div",{style:{position:"absolute",top:10,left:10,zIndex:10,display:"flex",flexDirection:"column",gap:8,background:f.background,border:`1px solid ${f.border}`,borderRadius:4,padding:12,fontFamily:"Consolas",fontSize:11},children:[d.jsx("div",{style:{fontWeight:600,color:f.accent,marginBottom:4},children:"Add Component"}),["source","join","filter","aggregate","transform","lookup","target"].map(R=>d.jsxs("button",{onClick:()=>C(R,{x:Math.random()*400+100,y:Math.random()*300+100}),style:{padding:"6px 12px",border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,color:f.foreground,cursor:"pointer",fontSize:10,textTransform:"uppercase",fontFamily:"Consolas"},onMouseEnter:$=>{$.currentTarget.style.background=f.accent,$.currentTarget.style.color=f.background},onMouseLeave:$=>{$.currentTarget.style.background=f.backgroundSoft,$.currentTarget.style.color=f.foreground},children:["+ ",R]},R))]}),d.jsxs(qp,{nodes:h,edges:g,onNodesChange:p,onEdgesChange:m,onConnect:E,onNodeClick:M,onPaneClick:_,nodeTypes:A2,fitView:!0,style:{background:f.background},children:[d.jsx(d2,{style:{background:f.backgroundSoft,border:`1px solid ${f.border}`}}),d.jsx(s2,{style:{background:f.backgroundSoft,border:`1px solid ${f.border}`},nodeColor:f.accent}),d.jsx(x2,{variant:kt.Dots,gap:12,size:1,color:f.border})]}),T&&b&&d.jsx(E2,{nodeId:b.id,nodeType:b.type,nodeData:b.data,onClose:()=>{k(!1),x(null)},onSave:(R,$)=>{u(F=>{const L=F.map(W=>W.id===R?{...W,data:$}:W);return e&&e({nodes:L.map(W=>({id:W.id,type:W.type,data:W.data,position:W.position})),edges:g.map(W=>({id:W.id,source:W.source,target:W.target,sourceHandle:W.sourceHandle||void 0,targetHandle:W.targetHandle||void 0}))}),L}),k(!1),x(null)},onDelete:R=>{P(R),k(!1),x(null)},targetSchema:r,targetTable:l})]})};function _2(n){const{nodes:e,edges:t}=n,i=e.find(g=>g.type==="source");if(!i)throw new Error("Pipeline must have a source node");const o=i.data;let s="";if(o.query)s=`(${o.query}) AS source`;else if(o.table)s=o.schema?`"${o.schema}"."${o.table}"`:`"${o.table}"`;else throw new Error("Source node must have either a table or query");let l=`SELECT * FROM ${s} AS source`;const a=new Set([i.id]),c=new Map(e.map(g=>[g.id,g]));function h(g){return t.filter(y=>y.source===g).map(y=>c.get(y.target)).filter(y=>y!==void 0&&!a.has(y.id))}function u(g){if(a.has(g.id))return;switch(a.add(g.id),g.type){case"join":{const m=g.data,b=m.joinType.toUpperCase().replace("FULL","FULL OUTER"),x=m.leftTable||"source",T=m.rightTable||"",k=m.joinCondition||(m.leftColumn&&m.rightColumn?`${x}.${m.leftColumn} = ${T}.${m.rightColumn}`:"1=1");l+=` ${b} JOIN ${T} ON ${k}`;break}case"filter":{const m=g.data;if(m.conditions&&m.conditions.length>0){const b=m.conditions.map(x=>{const T=typeof x.value=="string"?`'${x.value.replace(/'/g,"''")}'`:x.value;return x.op==="IS NULL"||x.op==="IS NOT NULL"?`${x.column} ${x.op}`:`${x.column} ${x.op} ${T}`}).join(" AND ");l+=` WHERE ${b}`}break}case"aggregate":{const m=g.data,b=[];m.groupBy&&m.groupBy.length>0&&b.push(...m.groupBy.map(x=>`${x}`)),m.aggregations&&m.aggregations.length>0&&m.aggregations.forEach(x=>{const T=x.alias||`${x.function}_${x.column}`;b.push(`${x.function.toUpperCase()}(${x.column}) AS ${T}`)}),b.length>0&&(l=l.replace("SELECT *",`SELECT ${b.join(", ")}`)),m.groupBy&&m.groupBy.length>0&&(l+=` GROUP BY ${m.groupBy.join(", ")}`);break}}h(g.id).forEach(u)}return h(i.id).forEach(u),l}function M2(n){const{nodes:e}=n,t={transformations:[]};return e.forEach(i=>{switch(i.type){case"transform":{const o=i.data;o.transforms&&o.transforms.length>0&&o.transforms.forEach(s=>{const r=s.transformationType||"basic";if(r==="basic")t.transformations.push({type:"transform",config:{target_column:s.target_column,expression:s.expression,columns:s.columns,separator:s.separator}});else{const l=s.config||{};switch(r){case"sorter":t.transformations.push({type:"sorter",config:{sort_columns:l.sort_columns||[]}});break;case"expression":t.transformations.push({type:"expression",config:{expressions:l.expressions||[]}});break;case"data_cleansing":t.transformations.push({type:"data_cleansing",config:{rules:l.rules||[]}});break;case"rank":t.transformations.push({type:"rank",config:{rank_type:l.rank_type||"top_n",order_column:l.order_column||"",n:l.n||10,partition_by:l.partition_by||[]}});break;case"sequence_generator":t.transformations.push({type:"sequence_generator",config:{target_column:l.target_column||"",start_value:l.start_value||1,increment:l.increment||1}});break;case"window_functions":t.transformations.push({type:"window_functions",config:{windows:l.windows||[]}});break;case"normalizer":t.transformations.push({type:"normalizer",config:{columns_to_denormalize:l.columns_to_denormalize||[],key_column_name:l.key_column_name||"key",value_column_name:l.value_column_name||"value"}});break;case"json_parser":t.transformations.push({type:"json_parser",config:{source_column:l.source_column||"",format:l.format||"json",fields_to_extract:l.fields_to_extract||[]}});break;case"geolocation":t.transformations.push({type:"geolocation",config:{operation:l.operation||"distance",target_column:l.target_column||"geolocation_result",...l.operation==="distance"?{point1_column:l.point1_column||"",point2_column:l.point2_column||""}:{},...l.operation==="point_in_polygon"?{point_column:l.point_column||"",polygon:l.polygon||[]}:{}}});break;case"data_validation":t.transformations.push({type:"data_validation",config:{validation_type:l.validation_type||"email",source_column:l.source_column||"",target_column:l.target_column||"",is_valid_column:l.is_valid_column||""}});break;case"deduplication":t.transformations.push({type:"deduplication",config:{key_columns:l.key_columns||[],method:l.method||"exact",similarity_threshold:l.similarity_threshold||.8,keep_strategy:l.keep_strategy||"first"}});break}}});break}case"filter":{const o=i.data;o.conditions&&o.conditions.length>0&&t.transformations.push({type:"filter",config:{conditions:o.conditions.map(s=>({column:s.column,op:s.op,value:s.value}))}});break}case"aggregate":{const o=i.data;o.aggregations&&o.aggregations.length>0&&t.transformations.push({type:"aggregate",config:{group_by:o.groupBy||[],aggregations:o.aggregations.map(s=>({column:s.column,function:s.function,alias:s.alias||`${s.column}_${s.function}`}))}});break}case"join":{const o=i.data;o.leftColumn&&o.rightColumn&&t.transformations.push({type:"join",config:{join_type:o.joinType||"inner",left_columns:o.leftColumn?[o.leftColumn]:[],right_columns:o.rightColumn?[o.rightColumn]:[]}});break}case"lookup":{const o=i.data;o.lookupTable&&o.sourceColumns.length>0&&t.transformations.push({type:"lookup",config:{lookup_table:o.lookupTable,lookup_schema:o.lookupSchema||"",source_columns:o.sourceColumns,lookup_columns:o.lookupColumns,return_columns:o.returnColumns}});break}case"router":break;case"union":break;case"sorter":{const o=i.data;o.sortColumns&&o.sortColumns.length>0&&t.transformations.push({type:"sorter",config:{sort_columns:o.sortColumns.map(s=>({column:s.column,order:s.order||"asc"}))}});break}case"expression":{const o=i.data;o.expressions&&o.expressions.length>0&&t.transformations.push({type:"expression",config:{expressions:o.expressions.map(s=>({target_column:s.target_column,expression:s.expression,type:s.type||"auto"}))}});break}case"data_cleansing":{const o=i.data;o.rules&&o.rules.length>0&&t.transformations.push({type:"data_cleansing",config:{rules:o.rules.map(s=>({column:s.column,operations:s.operations||[]}))}});break}case"rank":{const o=i.data;o.orderColumn&&t.transformations.push({type:"rank",config:{rank_type:o.rankType||"top_n",order_column:o.orderColumn,n:o.n||10,partition_by:o.partitionBy||[]}});break}case"sequence_generator":{const o=i.data;o.targetColumn&&t.transformations.push({type:"sequence_generator",config:{target_column:o.targetColumn,start_value:o.startValue||1,increment:o.increment||1}});break}case"window_functions":{const o=i.data;o.windows&&o.windows.length>0&&t.transformations.push({type:"window_functions",config:{windows:o.windows.map(s=>({function:s.function,target_column:s.targetColumn,source_column:s.sourceColumn,partition_by:s.partitionBy||[],order_by:s.orderBy||[],offset:s.offset||1,default_value:s.defaultValue||null}))}});break}case"normalizer":{const o=i.data;o.columnsToDenormalize&&o.columnsToDenormalize.length>0&&t.transformations.push({type:"normalizer",config:{columns_to_denormalize:o.columnsToDenormalize,key_column_name:o.keyColumnName||"key",value_column_name:o.valueColumnName||"value"}});break}case"json_parser":{const o=i.data;o.sourceColumn&&o.fieldsToExtract&&t.transformations.push({type:"json_parser",config:{source_column:o.sourceColumn,format:o.format||"json",fields_to_extract:o.fieldsToExtract||[]}});break}case"geolocation":{const o=i.data;if(o.operation){const s={operation:o.operation,target_column:o.targetColumn||"geolocation_result"};o.operation==="distance"?(s.point1_column=o.point1Column,s.point2_column=o.point2Column):o.operation==="point_in_polygon"&&(s.point_column=o.pointColumn,s.polygon=o.polygon),t.transformations.push({type:"geolocation",config:s})}break}case"data_validation":{const o=i.data;o.validationType&&o.sourceColumn&&t.transformations.push({type:"data_validation",config:{validation_type:o.validationType,source_column:o.sourceColumn,target_column:o.targetColumn||o.sourceColumn+"_validated",is_valid_column:o.isValidColumn||o.sourceColumn+"_is_valid"}});break}case"deduplication":{const o=i.data;o.keyColumns&&o.keyColumns.length>0&&t.transformations.push({type:"deduplication",config:{key_columns:o.keyColumns,method:o.method||"exact",similarity_threshold:o.similarityThreshold||.8,keep_strategy:o.keepStrategy||"first"}});break}}}),t}function O2(n){const e=[],t=[];let i=0;const o=n,s=o.match(/FROM\s+([^\s(]+(?:\.[^\s(]+)?)/i);if(s){const l=s[1].trim().replace(/"/g,"").replace(/'/g,"").split("."),a={id:`source-${i++}`,type:"source",data:{type:"source",schema:l.length>1?l[0]:void 0,table:l[l.length-1],query:o.includes("(")&&o.includes(")")?o:void 0},position:{x:100,y:200}};e.push(a);let c=a.id;const h=o.match(/WHERE\s+(.+?)(?:\s+GROUP\s+BY|\s+ORDER\s+BY|\s+HAVING|$)/is);if(h){const y=h[1].trim(),m=N2(y);if(m.length>0){const b={id:`filter-${i++}`,type:"filter",data:{type:"filter",conditions:m},position:{x:400,y:200}};e.push(b),t.push({id:`edge-${t.length}`,source:c,target:b.id}),c=b.id}}const u=o.match(/GROUP\s+BY\s+(.+?)(?:\s+ORDER\s+BY|\s+HAVING|$)/is),p=o.match(/SELECT\s+(.+?)\s+FROM/is);if(u||p&&R2(p[1])){const y=u?u[1].split(",").map(x=>x.trim().replace(/"/g,"")):[],m=j2(p?p[1]:""),b={id:`aggregate-${i++}`,type:"aggregate",data:{type:"aggregate",groupBy:y.length>0?y:void 0,aggregations:m},position:{x:700,y:200}};e.push(b),t.push({id:`edge-${t.length}`,source:c,target:b.id}),c=b.id}const g={id:`target-${i++}`,type:"target",data:{type:"target",loadStrategy:"TRUNCATE"},position:{x:1e3,y:200}};e.push(g),t.push({id:`edge-${t.length}`,source:c,target:g.id})}return{nodes:e,edges:t}}function N2(n){const e=[],t=["!=",">=","<=","=",">","<","LIKE","IN","NOT IN","IS NULL","IS NOT NULL"],i=n.split(/\s+(?:AND|OR)\s+/i);for(const o of i){const s=o.trim();if(s){for(const r of t)if(s.toUpperCase().includes(r)){const l=s.toUpperCase().indexOf(r),a=s.substring(0,l).trim().replace(/"/g,""),c=s.substring(l+r.length).trim();let h=c;c.startsWith("'")&&c.endsWith("'")?h=c.slice(1,-1):isNaN(Number(c))?c.toUpperCase()==="TRUE"||c.toUpperCase()==="FALSE"?h=c.toUpperCase()==="TRUE":r==="IN"||r==="NOT IN"?h=c.replace(/[()]/g,"").split(",").map(u=>u.trim().replace(/['"]/g,"")):(r==="IS NULL"||r==="IS NOT NULL")&&(h=null):h=Number(c),e.push({column:a,op:r,value:h});break}}}return e}function R2(n){return["SUM","COUNT","AVG","MIN","MAX"].some(t=>n.toUpperCase().includes(t+"("))}function j2(n){var o;const e=[],t=/(SUM|COUNT|AVG|MIN|MAX)\s*\(\s*([^)]+)\s*\)(?:\s+AS\s+(\w+))?/gi;let i;for(;(i=t.exec(n))!==null;){const s=i[1].toLowerCase(),r=i[2].trim().replace(/"/g,""),l=(o=i[3])==null?void 0:o.trim();e.push({column:r,function:s,alias:l})}return e}const Jr={MariaDB:"host=localhost;user=myuser;password=mypassword;db=mydatabase;port=3306",MSSQL:"DRIVER={ODBC Driver 17 for SQL Server};SERVER=localhost,1433;DATABASE=mydatabase;UID=myuser;PWD=mypassword",Oracle:"host=localhost;user=myuser;password=mypassword;db=mydatabase;port=1521",PostgreSQL:"postgresql://myuser:mypassword@localhost:5432/mydatabase",MongoDB:"mongodb://myuser:mypassword@localhost:27017/mydatabase"},q2=()=>{var No,Ro;const{setPage:n}=Cg(1,20),{filters:e,setFilter:t}=Tg({source_db_engine:"",target_db_engine:"",active:"",enabled:""}),[i,o]=N.useState(""),[s,r]=N.useState(""),[l,a]=N.useState(null),[c,h]=N.useState([]),[u,p]=N.useState(!0),[g,y]=N.useState(!1),[m,b]=N.useState(null),[x,T]=N.useState(null),[k,E]=N.useState([]),[M,_]=N.useState(""),[C,P]=N.useState({job_name:"",description:"",source_db_engine:"PostgreSQL",source_connection_string:"",query_sql:"",target_db_engine:"PostgreSQL",target_connection_string:"",target_schema:"",target_table:"",schedule_cron:"",active:!0,enabled:!0,transform_config:{column_mapping:{},filters:[],column_transforms:[],validations:[]},metadata:{load_strategy:"TRUNCATE"}}),[R,$]=N.useState(!1),[F,L]=N.useState(!1),[W,w]=N.useState(null),[O,S]=N.useState(!1),[z,j]=N.useState(null),[v,D]=N.useState(null),[B,I]=N.useState(null),[V,Q]=N.useState(!1),[J,se]=N.useState([]),[le,xe]=N.useState([]),[ge,ue]=N.useState([]),[Ne,Oe]=N.useState(!1),[Re,be]=N.useState(null),[de,Fe]=N.useState(""),[U,q]=N.useState(!1),[G,ae]=N.useState("sql"),[ce,oe]=N.useState({nodes:[],edges:[]}),[Ee,je]=N.useState(!1),Ae=N.useRef(!0),Se=N.useCallback(async()=>{if(!Ae.current)return;const A=Date.now(),Y=300;try{p(!0),a(null);const me={page:1,limit:1e4,search:Eg(s,100)};e.source_db_engine&&(me.source_db_engine=e.source_db_engine),e.target_db_engine&&(me.target_db_engine=e.target_db_engine),e.active&&(me.active=e.active),e.enabled&&(me.enabled=e.enabled);const Ft=await $t.getJobs(me),mn=Date.now()-A,hr=Math.max(0,Y-mn);await new Promise(ur=>setTimeout(ur,hr)),Ae.current&&h(Ft.data||[])}catch(ie){Ae.current&&a(zn(ie))}finally{Ae.current&&p(!1)}},[e.source_db_engine,e.target_db_engine,e.active,e.enabled,s]),Pt=N.useCallback(async()=>{try{const A=localStorage.getItem("authToken"),Y=await fetch("/api/datalake-connection",{headers:{...A&&{Authorization:`Bearer ${A}`}}});if(Y.ok){const ie=await Y.json();ie.success&&ie.connection_string&&(Fe(ie.connection_string),g&&!C.source_connection_string&&C.source_db_engine==="PostgreSQL"&&!m&&(P(me=>({...me,source_connection_string:ie.connection_string})),q(!0)))}}catch(A){console.error("Error loading DataLake connection:",A)}},[g,C.source_connection_string,C.source_db_engine,m]);N.useEffect(()=>{Ae.current=!0,Pt(),Se();const A=setInterval(()=>{Ae.current&&Se()},3e4);return()=>{Ae.current=!1,clearInterval(A)}},[Se,Pt]);const Zt=N.useCallback(()=>{r(i),n(1)},[i,n]),pn=N.useCallback(()=>{o(""),r(""),n(1)},[n]),It=N.useCallback((A,Y)=>{t(A,Y),n(1)},[t,n]),Ve=N.useCallback(async(A,Y)=>{try{await $t.updateActive(A,!Y),Se()}catch(ie){Ae.current&&a(zn(ie))}},[Se]),rt=N.useCallback(async A=>{try{await $t.executeJob(A),alert(`Job "${A}" execution triggered. Check process_log for results.`),Se()}catch(Y){Ae.current&&a(zn(Y))}},[Se]),en=N.useCallback(async A=>{if(confirm(`Are you sure you want to delete job "${A}"?`))try{await $t.deleteJob(A),Se()}catch(Y){Ae.current&&a(zn(Y))}},[Se]),tn=N.useCallback(async A=>{const Y=c.find(me=>me.job_name===A);if(!Y)return;const ie=`âš ï¸ WARNING: This will DROP the table "${Y.target_schema}.${Y.target_table}" and ALL its data will be PERMANENTLY DELETED!

The table will be automatically recreated on the next job execution.

Are you absolutely sure you want to continue?`;if(confirm(ie))try{const me=await $t.rebootTable(A);alert(`âœ… ${me.message||"Table dropped successfully. It will be recreated on next execution."}`),Se()}catch(me){Ae.current&&a(zn(me))}},[c,Se]),zt=N.useCallback(async()=>{try{const A=await $t.getScripts();E(A)}catch(A){console.error("Error loading scripts:",A)}},[]),Et=N.useCallback(async()=>{if(!C.source_db_engine){be({success:!1,message:"Please select a source database engine first"});return}const A=U&&de?de:C.source_connection_string.trim();if(!A){be({success:!1,message:U?"DataLake connection not loaded yet. Please wait...":"Please enter a source connection string"});return}Oe(!0),be(null);try{const Y=localStorage.getItem("authToken"),ie=await fetch("/api/test-connection",{method:"POST",headers:{"Content-Type":"application/json",...Y&&{Authorization:`Bearer ${Y}`}},body:JSON.stringify({db_engine:C.source_db_engine,connection_string:A})});if(!ie.ok){if(ie.status===401){be({success:!1,message:"Authentication required. Please log in again."});return}if(ie.status===0||ie.status>=500){be({success:!1,message:"Server error. Please check if the server is running."});return}}let me;try{me=await ie.json()}catch{be({success:!1,message:"Invalid response from server"});return}ie.ok&&me.success?(be({success:!0,message:"Connection successful!"}),L(!0)):(be({success:!1,message:me.error||me.message||"Connection failed"}),L(!1))}catch(Y){be({success:!1,message:Y.message||"Error testing connection"}),L(!1)}finally{Oe(!1)}},[C.source_db_engine,C.source_connection_string,U,de]),pt=N.useCallback(async()=>{if(!C.source_db_engine||!C.source_connection_string.trim()||!C.query_sql.trim()){j("Please fill in source DB engine, connection string, and SQL query");return}S(!0),j(null),w(null);try{const A=U&&de?de:C.source_connection_string.trim(),Y=await $t.previewQuery({db_engine:C.source_db_engine,connection_string:A,query_sql:C.query_sql.trim(),limit:100});Y.success?(w({columns:Y.columns||[],rows:Y.rows||[],rowCount:Y.rowCount||0}),ue(Y.columns||[]),j(null)):j(Y.error||"Failed to preview query")}catch(A){j(A.message||"Error previewing query")}finally{S(!1)}},[C.source_db_engine,C.source_connection_string,C.query_sql,U,de]),Pn=N.useCallback(async A=>{D(A),I(null),Q(!0);try{const Y=await $t.getTableStructure(A.job_name);I(Y)}catch(Y){a(zn(Y))}finally{Q(!1)}},[]),gn=N.useCallback((A,Y)=>{if(A){const ie=A.transform_config||{},me=A.metadata||{},Ft=!!(de&&A.source_connection_string===de);Y?(b(null),T(A),q(Ft),P({job_name:`${A.job_name} (Copy)`,description:A.description||"",source_db_engine:A.source_db_engine,source_connection_string:A.source_connection_string||"",query_sql:A.query_sql||"",target_db_engine:A.target_db_engine,target_connection_string:A.target_connection_string||"",target_schema:A.target_schema||"",target_table:A.target_table||"",schedule_cron:A.schedule_cron||"",active:A.active,enabled:A.enabled,transform_config:{column_mapping:ie.column_mapping||{},filters:Array.isArray(ie.filters)?ie.filters:[],column_transforms:Array.isArray(ie.column_transforms)?ie.column_transforms:[],validations:Array.isArray(ie.validations)?ie.validations:[]},metadata:{load_strategy:me.load_strategy||"TRUNCATE"}})):(b(A),T(null),q(Ft),P({job_name:A.job_name,description:A.description||"",source_db_engine:A.source_db_engine,source_connection_string:A.source_connection_string||"",query_sql:A.query_sql||"",target_db_engine:A.target_db_engine,target_connection_string:A.target_connection_string||"",target_schema:A.target_schema||"",target_table:A.target_table||"",schedule_cron:A.schedule_cron||"",active:A.active,enabled:A.enabled,transform_config:{column_mapping:ie.column_mapping||{},filters:Array.isArray(ie.filters)?ie.filters:[],column_transforms:Array.isArray(ie.column_transforms)?ie.column_transforms:[],validations:Array.isArray(ie.validations)?ie.validations:[]},metadata:{load_strategy:me.load_strategy||"TRUNCATE"}}))}else{b(null),T(null);const ie=de||"";q(!!ie),P({job_name:"",description:"",source_db_engine:"PostgreSQL",source_connection_string:ie,query_sql:"",target_db_engine:"PostgreSQL",target_connection_string:"",target_schema:"",target_table:"",schedule_cron:"",active:!0,enabled:!0,transform_config:{column_mapping:{},filters:[],column_transforms:[],validations:[]},metadata:{load_strategy:"TRUNCATE"}})}_(""),$(!1),L(!1),be(null),w(null),j(null),se([]),xe([]),ue([]),y(!0)},[de]),In=N.useCallback(A=>{gn(A,!0)},[gn]),Lt=N.useCallback(()=>{y(!1),b(null),T(null),_(""),L(!1),be(null),q(!1),w(null),j(null)},[]),Oo=N.useCallback(A=>{_(A);const Y=k.find(ie=>ie.name===A);Y&&P(ie=>({...ie,query_sql:Y.content}))},[k]),nn=N.useCallback(async()=>{try{if(!C.job_name||!C.target_schema||!C.target_table){alert("Please fill in all required fields");return}let A=C.query_sql,Y=C.transform_config;if(G==="visual"){if(ce.nodes.length===0){alert("Please add at least one component to the visual pipeline");return}try{A=_2(ce),Y={...C.transform_config,...M2(ce)}}catch(me){alert(`Error generating SQL from pipeline: ${me.message}`);return}}else{if(C.source_db_engine==="Python"&&!C.query_sql.trim()){alert("Please select a Python script or enter script content");return}if(C.source_db_engine!=="Python"&&!C.query_sql.trim()){alert("Please enter SQL query");return}}const ie={...C,query_sql:A,transform_config:Y};m?await $t.updateJob(m.job_name,ie):await $t.createJob(ie),await Se(),Lt()}catch(A){Ae.current&&a(zn(A))}},[C,m,Se,Lt,G,ce]);return N.useEffect(()=>{g&&C.source_db_engine==="Python"&&zt()},[g,C.source_db_engine,zt]),u&&c.length===0?d.jsx(Ag,{variant:"table"}):d.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[d.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:f.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[d.jsx("span",{style:{color:f.accent,marginRight:8},children:he.blockFull}),"PIPELINE ORCHESTRATION"]}),d.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[d.jsx(At,{label:"Custom Jobs Info",onClick:()=>je(!0),variant:"ghost"}),d.jsx(At,{label:"+ Add Pipeline",onClick:()=>gn(),variant:"primary"})]})]}),l&&d.jsx("div",{style:{marginBottom:20},children:d.jsx(qt,{title:"ERROR",children:d.jsx("div",{style:{padding:"12px",color:f.danger,fontSize:12,fontFamily:"Consolas"},children:l})})}),d.jsx(qt,{title:"SEARCH",children:d.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"8px 0"},children:[d.jsx("input",{type:"text",placeholder:"Search by pipeline name, description, target schema/table...",value:i,onChange:A=>o(A.target.value),onKeyPress:A=>A.key==="Enter"&&Zt(),style:{flex:1,padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border}}),d.jsx(At,{label:"Search",onClick:Zt,variant:"primary"}),s&&d.jsx(At,{label:"Clear",onClick:pn,variant:"ghost"})]})}),d.jsx("div",{style:{marginTop:20},children:d.jsx(qt,{title:"FILTERS",children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12,padding:"8px 0"},children:[d.jsxs("select",{value:e.source_db_engine,onChange:A=>It("source_db_engine",A.target.value),style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:[d.jsx("option",{value:"",children:"All Source Engines"}),d.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),d.jsx("option",{value:"MariaDB",children:"MariaDB"}),d.jsx("option",{value:"MSSQL",children:"MSSQL"}),d.jsx("option",{value:"MongoDB",children:"MongoDB"}),d.jsx("option",{value:"Oracle",children:"Oracle"}),d.jsx("option",{value:"Python",children:"Python"})]}),d.jsxs("select",{value:e.target_db_engine,onChange:A=>It("target_db_engine",A.target.value),style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:[d.jsx("option",{value:"",children:"All Target Engines"}),d.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),d.jsx("option",{value:"MariaDB",children:"MariaDB"}),d.jsx("option",{value:"MSSQL",children:"MSSQL"}),d.jsx("option",{value:"MongoDB",children:"MongoDB"}),d.jsx("option",{value:"Oracle",children:"Oracle"})]}),d.jsxs("select",{value:e.active,onChange:A=>It("active",A.target.value),style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:[d.jsx("option",{value:"",children:"All Active States"}),d.jsx("option",{value:"true",children:"Active"}),d.jsx("option",{value:"false",children:"Inactive"})]}),d.jsxs("select",{value:e.enabled,onChange:A=>It("enabled",A.target.value),style:{padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:[d.jsx("option",{value:"",children:"All Enabled States"}),d.jsx("option",{value:"true",children:"Enabled"}),d.jsx("option",{value:"false",children:"Disabled"})]})]})})}),u?d.jsx("div",{style:{marginTop:20},children:d.jsx(qt,{title:"LOADING",children:d.jsxs("div",{style:{padding:"40px",textAlign:"center",fontSize:12,fontFamily:"Consolas",color:f.muted},children:[he.blockFull," Loading tree view..."]})})}):d.jsx("div",{style:{marginTop:20},children:d.jsx(_g,{jobs:c,onJobClick:Pn,onJobEdit:A=>gn(A),onJobExecute:rt,onJobToggleActive:Ve,onJobDelete:en,onJobDuplicate:In,onJobReboot:tn})}),g&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backdropFilter:"blur(5px)",background:"rgba(0, 0, 0, 0.3)",zIndex:999,animation:"fadeIn 0.15s ease-in"},onClick:Lt}),d.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,animation:"fadeIn 0.15s ease-in"},onClick:A=>{A.target===A.currentTarget&&Lt()},children:d.jsxs("div",{style:{background:f.background,padding:"24px",borderRadius:2,width:"90vw",height:"90vh",maxHeight:"90vh",overflowY:"auto",fontFamily:"Consolas",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",animation:"slideUp 0.2s ease-out",border:`2px solid ${f.border}`},onClick:A=>A.stopPropagation(),children:[d.jsxs("div",{style:{borderBottom:`2px solid ${f.border}`,paddingBottom:"8px",marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("h2",{style:{fontSize:14,fontWeight:600,margin:0,fontFamily:"Consolas",color:f.foreground,textTransform:"uppercase"},children:[d.jsx("span",{style:{color:f.accent,marginRight:8},children:he.blockFull}),m?"EDIT PIPELINE":x?"DUPLICATE PIPELINE":"CREATE NEW PIPELINE"]}),d.jsx("button",{onClick:Lt,style:{background:"none",border:"none",fontSize:20,cursor:"pointer",color:f.muted,padding:0,width:30,height:30,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Consolas"},onMouseEnter:A=>{A.currentTarget.style.color=f.foreground},onMouseLeave:A=>{A.currentTarget.style.color=f.muted},children:"Ã—"})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," PIPELINE NAME *"]}),d.jsx("input",{value:C.job_name,onChange:A=>P(Y=>({...Y,job_name:A.target.value})),placeholder:"Enter unique pipeline name",disabled:!!m,style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:m?f.backgroundSoft:f.background,color:f.foreground,outline:"none",cursor:m?"not-allowed":"text"},onFocus:A=>{m||(A.currentTarget.style.borderColor=f.accent)},onBlur:A=>{A.currentTarget.style.borderColor=f.border}})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," DESCRIPTION"]}),d.jsx("input",{value:C.description,onChange:A=>P(Y=>({...Y,description:A.target.value})),placeholder:"Pipeline description",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border}})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," SOURCE DB ENGINE *"]}),d.jsxs("select",{value:U?"DataLake":C.source_db_engine,onChange:async A=>{const Y=A.target.value;if(Y==="DataLake"){let ie=de;if(!ie)try{const me=localStorage.getItem("authToken"),Ft=await fetch("/api/datalake-connection",{headers:{...me&&{Authorization:`Bearer ${me}`}}});if(Ft.ok){const mn=await Ft.json();mn.success&&mn.connection_string&&(Fe(mn.connection_string),ie=mn.connection_string)}}catch(me){console.error("Error loading DataLake connection:",me)}q(!0),P(me=>({...me,source_db_engine:"PostgreSQL",source_connection_string:ie||me.source_connection_string,query_sql:me.query_sql})),be(null),L(!1)}else q(!1),P(ie=>({...ie,source_db_engine:Y,source_connection_string:Y==="Python"?ie.source_connection_string:"",query_sql:Y==="Python"?ie.query_sql:""})),_(""),be(null),L(!1)},style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:[d.jsx("option",{value:"DataLake",children:"DataLake (Default)"}),d.jsx("option",{value:"PostgreSQL",children:"PostgreSQL (External)"}),d.jsx("option",{value:"MariaDB",children:"MariaDB"}),d.jsx("option",{value:"MSSQL",children:"MSSQL"}),d.jsx("option",{value:"MongoDB",children:"MongoDB"}),d.jsx("option",{value:"Oracle",children:"Oracle"}),d.jsx("option",{value:"Python",children:"Python"})]})]}),C.source_db_engine!=="Python"&&G==="sql"&&d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[d.jsxs("label",{style:{fontSize:12,fontWeight:600,color:f.foreground,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," SOURCE CONNECTION STRING",U&&d.jsx("span",{style:{marginLeft:8,fontSize:11,color:f.muted,fontFamily:"Consolas"},children:"(DataLake - Auto-filled)"})]}),d.jsx(At,{label:Ne?"Testing...":"Test Connection",onClick:Et,variant:"ghost",disabled:Ne||!C.source_db_engine||!U&&!C.source_connection_string.trim()||U&&!de})]}),d.jsxs("div",{style:{position:"relative"},children:[d.jsx("input",{value:C.source_connection_string,onChange:A=>{P(Y=>({...Y,source_connection_string:A.target.value})),be(null),L(!1),U&&A.target.value!==de&&q(!1)},placeholder:U?"DataLake connection (auto-filled)":"host=localhost port=5432 dbname=...",readOnly:U,style:{width:"100%",padding:"6px 10px",paddingRight:U?"80px":"10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:U?f.backgroundSoft:f.background,color:f.foreground,outline:"none",cursor:U?"not-allowed":"text"},onFocus:A=>{U||(A.currentTarget.style.borderColor=f.accent)},onBlur:A=>{A.currentTarget.style.borderColor=f.border}}),U&&d.jsx("button",{type:"button",onClick:()=>{q(!1),P(A=>({...A,source_connection_string:""}))},style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",padding:"4px 8px",fontSize:11,border:`1px solid ${f.border}`,borderRadius:2,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onMouseEnter:A=>{A.currentTarget.style.backgroundColor=f.backgroundSoft},onMouseLeave:A=>{A.currentTarget.style.backgroundColor=f.background},children:"Edit"})]}),Re&&d.jsxs("div",{style:{marginTop:8,padding:"8px 12px",borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:Re.success?f.success:f.danger,color:f.background},children:[Re.success?"âœ“ ":"âœ— ",Re.message]}),F&&d.jsx("div",{style:{marginTop:8,padding:"8px 12px",background:f.accentSoft+"20",color:f.accent,borderRadius:2,fontSize:12,fontFamily:"Consolas",border:`1px solid ${f.accent}`},children:"Connection successful! You can now write your SQL query and preview the results."})]}),C.source_db_engine==="Python"&&d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," SELECT PYTHON SCRIPT"]}),d.jsxs("select",{value:M,onChange:A=>Oo(A.target.value),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none",marginBottom:12},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:[d.jsx("option",{value:"",children:"-- Select a script or write custom --"}),k.map(A=>d.jsx("option",{value:A.name,children:A.name},A.name))]})]}),C.source_db_engine!=="Python"&&d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[d.jsxs("label",{style:{fontSize:12,fontWeight:600,color:f.foreground,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," ",G==="visual"?"VISUAL PIPELINE":"SQL QUERY"," *"]}),d.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",gap:4,border:`1px solid ${f.border}`,borderRadius:2,padding:2},children:[d.jsx("button",{onClick:()=>ae("sql"),style:{padding:"4px 12px",border:"none",borderRadius:2,background:G==="sql"?f.accent:"transparent",color:G==="sql"?f.background:f.foreground,cursor:"pointer",fontSize:11,fontFamily:"Consolas",fontWeight:G==="sql"?600:400},children:"SQL"}),d.jsx("button",{onClick:()=>ae("visual"),style:{padding:"4px 12px",border:"none",borderRadius:2,background:G==="visual"?f.accent:"transparent",color:G==="visual"?f.background:f.foreground,cursor:"pointer",fontSize:11,fontFamily:"Consolas",fontWeight:G==="visual"?600:400},children:"VISUAL"})]}),G==="sql"&&d.jsx(At,{label:O?"Previewing...":"Preview Query",onClick:pt,variant:"ghost",disabled:O||!C.source_db_engine||!C.source_connection_string.trim()||!C.query_sql.trim()})]})]}),G==="sql"?d.jsxs(d.Fragment,{children:[d.jsx(s1,{value:C.query_sql,onChange:A=>{if(P(Y=>({...Y,query_sql:A})),w(null),j(null),A.trim())try{const Y=O2(A);oe(Y)}catch(Y){console.error("Error parsing SQL to graph:",Y)}},placeholder:"SELECT * FROM table_name WHERE condition...",schemas:J,tables:le,columns:ge}),W&&d.jsx("div",{style:{marginTop:16},children:d.jsxs("div",{style:{border:`1px solid ${f.border}`,borderRadius:2,overflow:"auto",maxHeight:"400px",fontFamily:"Consolas"},children:[d.jsxs("div",{style:{padding:"8px 12px",background:f.backgroundSoft,borderBottom:`1px solid ${f.border}`,fontSize:12,fontWeight:600,fontFamily:"Consolas",color:f.foreground},children:["Preview Results (",W.rowCount," rows)"]}),d.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12,fontFamily:"Consolas"},children:[d.jsx("thead",{children:d.jsx("tr",{style:{background:f.backgroundSoft},children:W.columns.map((A,Y)=>d.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:`1px solid ${f.border}`,fontWeight:600,fontFamily:"Consolas",color:f.foreground},children:A},Y))})}),d.jsx("tbody",{children:W.rows.map((A,Y)=>d.jsx("tr",{style:{borderBottom:`1px solid ${f.border}`},children:W.columns.map((ie,me)=>d.jsx("td",{style:{padding:"8px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:"Consolas",fontSize:11,color:f.foreground},children:A[ie]!==null&&A[ie]!==void 0?String(A[ie]):"NULL"},me))},Y))})]})]})}),!W&&C.query_sql.trim()&&ce.nodes.length>0&&d.jsx("div",{style:{marginTop:16},children:d.jsxs("div",{style:{padding:12,background:f.backgroundSoft,border:`1px solid ${f.border}`,borderRadius:2,maxHeight:"400px",overflow:"hidden",display:"flex",flexDirection:"column"},children:[d.jsxs("div",{style:{fontSize:11,fontWeight:600,color:f.accent,marginBottom:8,fontFamily:"Consolas",flexShrink:0},children:[he.blockSemi," VISUAL PREVIEW (Auto-generated from SQL)"]}),d.jsx("div",{style:{border:`1px solid ${f.border}`,borderRadius:2,background:f.background,height:300,minHeight:300,maxHeight:300,overflow:"hidden",position:"relative",flexShrink:0},children:d.jsx(mu,{initialGraph:ce,onGraphChange:oe,sourceConnectionString:C.source_connection_string,sourceDbEngine:C.source_db_engine,targetConnectionString:C.target_connection_string,targetDbEngine:C.target_db_engine,targetSchema:C.target_schema,targetTable:C.target_table})}),d.jsx("div",{style:{marginTop:8,fontSize:10,color:f.muted,fontFamily:"Consolas",fontStyle:"italic",flexShrink:0},children:"Note: This is a read-only preview. Switch to VISUAL mode to edit the pipeline."})]})})]}):d.jsx("div",{style:{border:`1px solid ${f.border}`,borderRadius:2,background:f.backgroundSoft,minHeight:500},children:d.jsx(mu,{initialGraph:ce,onGraphChange:oe,sourceConnectionString:C.source_connection_string,sourceDbEngine:C.source_db_engine,targetConnectionString:C.target_connection_string,targetDbEngine:C.target_db_engine,targetSchema:C.target_schema,targetTable:C.target_table})}),z&&d.jsx("div",{style:{marginTop:8,padding:12,color:f.danger,background:f.danger+"20",borderRadius:2,fontSize:12,fontFamily:"Consolas",border:`1px solid ${f.danger}`},children:z})]}),C.source_db_engine==="Python"&&d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," PYTHON SCRIPT *"]}),d.jsx("textarea",{value:C.query_sql,onChange:A=>P(Y=>({...Y,query_sql:A.target.value})),placeholder:"import json\\n\\ndata = [...]\\nprint(json.dumps(data))",style:{width:"100%",minHeight:150,padding:"8px 12px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,outline:"none",resize:"vertical"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border}})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," TARGET DB ENGINE *"]}),d.jsxs("select",{value:C.target_db_engine,onChange:A=>P(Y=>({...Y,target_db_engine:A.target.value})),style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:[d.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),d.jsx("option",{value:"MariaDB",children:"MariaDB"}),d.jsx("option",{value:"MSSQL",children:"MSSQL"}),d.jsx("option",{value:"MongoDB",children:"MongoDB"}),d.jsx("option",{value:"Oracle",children:"Oracle"})]})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsx(kg,{value:C.target_connection_string,onChange:A=>P(Y=>({...Y,target_connection_string:A})),dbEngine:C.target_db_engine,label:"Target Connection String",required:!0,placeholder:Jr[C.target_db_engine]||"host=localhost port=5432 dbname=..."}),C.target_db_engine&&Jr[C.target_db_engine]&&d.jsxs("div",{style:{marginTop:8,padding:8,background:f.backgroundSoft,borderRadius:2,borderLeft:`3px solid ${f.accent}`,fontFamily:"Consolas",fontSize:11,color:f.muted,whiteSpace:"pre-wrap",wordBreak:"break-all"},children:["Example: ",Jr[C.target_db_engine]]})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," TARGET SCHEMA *"]}),d.jsx("input",{value:C.target_schema,onChange:A=>P(Y=>({...Y,target_schema:A.target.value})),placeholder:"public",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border}})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," TARGET TABLE *"]}),d.jsx("input",{value:C.target_table,onChange:A=>P(Y=>({...Y,target_table:A.target.value})),placeholder:"table_name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border}})]}),d.jsxs("div",{style:{marginBottom:16},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," EXECUTION MODE"]}),d.jsx("input",{value:C.schedule_cron,onChange:A=>P(Y=>({...Y,schedule_cron:A.target.value})),placeholder:"Leave empty for Manual execution, or enter Cron: * * * * *",style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border}}),d.jsx("div",{style:{marginTop:8,padding:"8px 12px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:C.schedule_cron?f.accentSoft+"20":f.backgroundSoft,border:`1px solid ${C.schedule_cron?f.accent:f.border}`,color:C.schedule_cron?f.accent:f.muted},children:C.schedule_cron?d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{color:f.accent,fontWeight:600},children:"âœ“ AUTOMATIC:"})," This job will run automatically on schedule (",C.schedule_cron,")"]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{color:f.muted,fontWeight:600},children:"â„¹ MANUAL:"})," This job will only run when manually triggered via the Execute button"]})}),C.schedule_cron&&d.jsx("div",{style:{marginTop:6,padding:"6px 10px",borderRadius:2,fontSize:10,fontFamily:"Consolas",backgroundColor:f.backgroundSoft,color:f.muted,borderLeft:`3px solid ${f.accent}`},children:'Cron format: minute hour day month day-of-week (e.g., "0 2 * * *" = daily at 2 AM)'})]}),d.jsx("div",{style:{marginBottom:16},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[d.jsx("input",{type:"checkbox",checked:C.active,onChange:A=>P(Y=>({...Y,active:A.target.checked})),style:{width:18,height:18,cursor:"pointer"}}),d.jsx("label",{style:{margin:0,cursor:"pointer",fontSize:12,fontFamily:"Consolas",color:f.foreground},children:"Active"})]})}),d.jsx("div",{style:{marginBottom:16},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[d.jsx("input",{type:"checkbox",checked:C.enabled,onChange:A=>P(Y=>({...Y,enabled:A.target.checked})),style:{width:18,height:18,cursor:"pointer"}}),d.jsx("label",{style:{margin:0,cursor:"pointer",fontSize:12,fontFamily:"Consolas",color:f.foreground},children:"Enabled"})]})}),d.jsxs("div",{style:{marginTop:20,border:`1px solid ${f.border}`,borderRadius:2,overflow:"hidden",fontFamily:"Consolas"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:12,background:f.backgroundSoft,cursor:"pointer",userSelect:"none"},onClick:()=>$(!R),onMouseEnter:A=>{A.currentTarget.style.background=f.background},onMouseLeave:A=>{A.currentTarget.style.background=f.backgroundSoft},children:[d.jsxs("h4",{style:{margin:0,fontSize:12,color:f.foreground,fontFamily:"Consolas",fontWeight:600},children:[he.blockFull," LOAD STRATEGY (DATA WAREHOUSE)"]}),d.jsx("span",{style:{color:f.muted,fontFamily:"Consolas"},children:R?"â–¼":"â–¶"})]}),R&&d.jsx("div",{style:{padding:12,background:f.background},children:d.jsxs("div",{style:{marginTop:12,padding:12,background:f.backgroundSoft,borderRadius:2},children:[d.jsxs("label",{style:{display:"block",fontSize:12,fontWeight:600,color:f.foreground,marginBottom:6,fontFamily:"Consolas",textTransform:"uppercase"},children:[he.v," LOAD STRATEGY"]}),d.jsx("select",{value:C.metadata.load_strategy,onChange:A=>{P(Y=>({...Y,metadata:{...Y.metadata,load_strategy:A.target.value}}))},style:{width:"100%",padding:"6px 10px",border:`1px solid ${f.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.background,color:f.foreground,cursor:"pointer",outline:"none"},onFocus:A=>{A.currentTarget.style.borderColor=f.accent},onBlur:A=>{A.currentTarget.style.borderColor=f.border},children:d.jsx("option",{value:"TRUNCATE",children:"TRUNCATE (Full Load - Data Lake)"})})]})})]}),d.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:20,paddingTop:16,borderTop:`1px solid ${f.border}`},children:[d.jsx(At,{label:"Cancel",onClick:Lt,variant:"ghost"}),d.jsx("button",{type:"button",onClick:nn,style:{padding:"6px 16px",border:`1px solid ${f.accent}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:f.accent,color:f.background,cursor:"pointer",fontWeight:600,outline:"none"},onMouseEnter:A=>{A.currentTarget.style.backgroundColor=f.accentSoft},onMouseLeave:A=>{A.currentTarget.style.backgroundColor=f.accent},children:m?"Update":"Create"})]})]})}),d.jsx("style",{children:`
            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }
            @keyframes slideUp {
              from {
                opacity: 0;
                transform: translateY(20px);
              }
              to {
                opacity: 1;
                transform: translateY(0);
              }
            }
          `})]}),v&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backdropFilter:"blur(5px)",background:"rgba(0, 0, 0, 0.3)",zIndex:999,animation:"fadeIn 0.2s ease-in"},onClick:()=>D(null)}),d.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"fadeIn 0.2s ease-in"},onClick:A=>{A.target===A.currentTarget&&D(null)},children:d.jsxs("div",{style:{background:f.background,borderRadius:2,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",width:"90%",maxWidth:1400,maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",animation:"slideIn 0.3s ease-out",border:`2px solid ${f.border}`},onClick:A=>A.stopPropagation(),children:[d.jsxs("div",{style:{padding:"16px 20px",borderBottom:`2px solid ${f.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:f.backgroundSoft},children:[d.jsxs("h2",{style:{margin:0,fontSize:14,fontFamily:"Consolas",fontWeight:600,color:f.foreground,textTransform:"uppercase"},children:[d.jsx("span",{style:{color:f.accent,marginRight:8},children:he.blockFull}),"DATA FLOW: ",v.job_name]}),d.jsx(At,{label:"Close",onClick:()=>D(null),variant:"ghost"})]}),d.jsx("div",{style:{padding:"20px",overflowY:"auto",flex:1,fontFamily:"Consolas",fontSize:12},children:d.jsx(Mg,{sourceTitle:"Source: SQL Query",sourceType:"Pipeline Orchestration",sourceInfo:[{label:"Pipeline Name",value:v.job_name},{label:"Source DB Engine",value:v.source_db_engine},{label:"Query",value:((No=v.query_sql)==null?void 0:No.substring(0,150))+(((Ro=v.query_sql)==null?void 0:Ro.length)>150?"...":"")||"N/A"}],tableStructure:B,loading:V,job:v})})]})}),d.jsx("style",{children:`
            @keyframes fadeIn {
              from { opacity: 0; }
              to { opacity: 1; }
            }
            @keyframes slideIn {
              from {
                transform: translateY(20px);
                opacity: 0;
              }
              to {
                transform: translateY(0);
                opacity: 1;
              }
            }
          `})]}),Ee&&d.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>je(!1),children:d.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:A=>A.stopPropagation(),children:d.jsx(qt,{title:"CUSTOM JOBS PLAYBOOK",children:d.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[d.jsxs("div",{style:{marginBottom:24},children:[d.jsxs("div",{style:{fontSize:14,fontWeight:600,color:f.accent,marginBottom:12},children:[he.blockFull," OVERVIEW"]}),d.jsx("div",{style:{color:f.foreground,marginLeft:16},children:"Custom Jobs execute SQL queries from source databases and load results into target databases. They support complex ETL workflows with custom transformations, column mappings, filters, and validations. Jobs can be scheduled using cron expressions."})]}),d.jsxs("div",{style:{marginBottom:24},children:[d.jsxs("div",{style:{fontSize:14,fontWeight:600,color:f.accent,marginBottom:12},children:[he.blockFull," SUPPORTED ENGINES"]}),d.jsxs("div",{style:{color:f.foreground,marginLeft:16},children:[d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â”œâ”€"})," ",d.jsx("strong",{children:"Source:"})," PostgreSQL, MariaDB, MSSQL, MongoDB, Oracle, DB2"]}),d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â””â”€"})," ",d.jsx("strong",{children:"Target:"})," PostgreSQL, MariaDB, MSSQL, MongoDB, Oracle, DB2"]})]})]}),d.jsxs("div",{style:{marginBottom:24},children:[d.jsxs("div",{style:{fontSize:14,fontWeight:600,color:f.accent,marginBottom:12},children:[he.blockFull," EXECUTION MODES"]}),d.jsxs("div",{style:{color:f.foreground,marginLeft:16},children:[d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â”œâ”€"})," ",d.jsx("strong",{children:"SQL Editor:"})," Write custom SQL queries for data extraction"]}),d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â””â”€"})," ",d.jsx("strong",{children:"Visual Pipeline:"})," Build ETL pipelines using drag-and-drop components"]})]})]}),d.jsxs("div",{style:{marginBottom:24},children:[d.jsxs("div",{style:{fontSize:14,fontWeight:600,color:f.accent,marginBottom:12},children:[he.blockFull," TRANSFORMATION FEATURES"]}),d.jsxs("div",{style:{color:f.foreground,marginLeft:16},children:[d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â”œâ”€"})," ",d.jsx("strong",{children:"Column Mapping:"})," Map source columns to target columns"]}),d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â”œâ”€"})," ",d.jsx("strong",{children:"Filters:"})," Apply WHERE conditions to filter source data"]}),d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â”œâ”€"})," ",d.jsx("strong",{children:"Column Transforms:"})," Apply expressions and transformations to columns"]}),d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â””â”€"})," ",d.jsx("strong",{children:"Validations:"})," Validate data quality before loading"]})]})]}),d.jsxs("div",{style:{marginBottom:24},children:[d.jsxs("div",{style:{fontSize:14,fontWeight:600,color:f.accent,marginBottom:12},children:[he.blockFull," LOAD STRATEGIES"]}),d.jsxs("div",{style:{color:f.foreground,marginLeft:16},children:[d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â”œâ”€"})," ",d.jsx("strong",{children:"TRUNCATE:"})," Delete all existing data before loading new data"]}),d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â”œâ”€"})," ",d.jsx("strong",{children:"APPEND:"})," Add new data to existing data without deleting"]}),d.jsxs("div",{style:{marginBottom:8},children:[d.jsx("span",{style:{color:f.muted},children:"â””â”€"})," ",d.jsx("strong",{children:"UPSERT:"})," Update existing records or insert new ones based on keys"]})]})]}),d.jsxs("div",{style:{marginBottom:24},children:[d.jsxs("div",{style:{fontSize:14,fontWeight:600,color:f.accent,marginBottom:12},children:[he.blockFull," CRON SCHEDULING"]}),d.jsx("div",{style:{color:f.foreground,marginLeft:16},children:'Jobs can be scheduled using standard cron expressions. Examples: "0 * * * *" (every hour), "0 0 * * *" (daily at midnight), "0 0 * * 0" (weekly on Sunday).'})]}),d.jsxs("div",{style:{marginTop:16,padding:12,background:f.backgroundSoft,borderRadius:2,border:`1px solid ${f.border}`},children:[d.jsxs("div",{style:{fontSize:11,fontWeight:600,color:f.muted,marginBottom:4},children:[he.blockSemi," Best Practices"]}),d.jsxs("div",{style:{fontSize:11,color:f.foreground},children:["â€¢ Test SQL queries using the preview feature before saving",d.jsx("br",{}),"â€¢ Use connection testing to verify database connectivity",d.jsx("br",{}),"â€¢ Choose appropriate load strategies based on your use case",d.jsx("br",{}),"â€¢ Set up cron schedules for regular data synchronization",d.jsx("br",{}),"â€¢ Monitor execution history for job failures",d.jsx("br",{}),"â€¢ Use visual pipeline editor for complex transformations",d.jsx("br",{}),"â€¢ Review target table structures to ensure compatibility"]})]}),d.jsx("div",{style:{marginTop:16,textAlign:"right"},children:d.jsx(At,{label:"Close",onClick:()=>je(!1),variant:"ghost"})})]})})})})]})};export{q2 as default};
