import{m as qe,f as q,t as c,r as s,j as e,F as Z,L as te,I as he,S as uo,B as Ue,b as o,e as R,C as Ge}from"./index-b1fa964d.js";import{A as ce}from"./AsciiPanel-3399d5be.js";import{A as F}from"./AsciiButton-3fcfdd9b.js";import{S as go}from"./SkeletonLoader-09c12074.js";import{e as re}from"./errorHandler-5ea9ae85.js";import{f as Qe}from"./index-c4405eea.js";const Ve=qe`
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,po=qe`
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,ho=q.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  backdrop-filter: blur(5px);
  background: rgba(0, 0, 0, 0.3);
  z-index: 999;
  animation: ${Ve} 0.15s ease-in;
`,mo=q.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  animation: ${Ve} 0.15s ease-in;
`,fo=q.div`
  background: ${c.colors.background.main};
  padding: ${c.spacing.xxl};
  border-radius: ${c.borderRadius.lg};
  min-width: 600px;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
  font-family: ${c.fonts.primary};
  box-shadow: ${c.shadows.lg};
  animation: ${po} 0.2s ease-out;
  border: 1px solid ${c.colors.border.light};
`,xo=q.div`
  border-bottom: 2px solid ${c.colors.border.dark};
  padding-bottom: ${c.spacing.sm};
  margin-bottom: ${c.spacing.lg};
  font-size: 1.2em;
  font-weight: bold;
  position: relative;
  
  &::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, ${c.colors.primary.main}, ${c.colors.primary.dark});
  }
`,yo=q.div`
  display: flex;
  justify-content: flex-end;
  gap: ${c.spacing.sm};
  margin-top: ${c.spacing.lg};
`,He=q.div`
  display: flex;
  flex-direction: column;
  gap: ${c.spacing.xs};
  margin-top: ${c.spacing.xs};
`,Te=q.label`
  display: flex;
  align-items: center;
  gap: ${c.spacing.xs};
  cursor: pointer;
  font-size: 14px;
`,Re=q.input`
  cursor: pointer;
`,ie=q.div`
  font-size: 12px;
  color: ${c.colors.text.secondary};
  margin-top: 4px;
  padding: 8px;
  background: ${c.colors.background.secondary};
  border-radius: ${c.borderRadius.sm};
  border-left: 3px solid ${c.colors.primary.main};
`,bo=q.div`
  margin-top: ${c.spacing.md};
  padding: ${c.spacing.md};
  background: ${c.colors.background.secondary};
  border-radius: ${c.borderRadius.md};
  border: 1px solid ${c.colors.border.light};
`,vo=q.div`
  font-weight: 600;
  margin-bottom: ${c.spacing.sm};
  color: ${c.colors.primary.main};
`,jo=q.ul`
  margin: 0;
  padding-left: 20px;
  font-size: 12px;
  line-height: 1.6;
`,me=q.li`
  margin-bottom: 4px;
`,So=({isOpen:C,onClose:M,onSave:N,initialData:l})=>{const[U,z]=s.useState(""),[j,B]=s.useState("HTTP"),[$,y]=s.useState(""),[g,S]=s.useState(""),[p,P]=s.useState(""),[a,d]=s.useState(""),[u,w]=s.useState(""),[i,G]=s.useState([]),[O,n]=s.useState([]),[I,f]=s.useState(!0),[b,v]=s.useState(!1),L=["DEBUG","INFO","WARNING","ERROR","CRITICAL"],_=["SYSTEM","DATABASE","TRANSFER","CUSTOM_JOB","API","QUALITY","GOVERNANCE"];s.useEffect(()=>{l?(z(l.name||""),B(l.webhook_type||"HTTP"),y(l.url||""),S(l.api_key||""),P(l.bot_token||""),d(l.chat_id||""),w(l.email_address||""),G(Array.isArray(l.log_levels)?l.log_levels:[]),n(Array.isArray(l.log_categories)?l.log_categories:[]),f(l.enabled!==void 0?l.enabled:!0)):(z(""),B("HTTP"),y(""),S(""),P(""),d(""),w(""),G([]),n([]),f(!0))},[l,C]);const W=x=>{G(A=>A.includes(x)?A.filter(ee=>ee!==x):[...A,x])},Y=x=>{n(A=>A.includes(x)?A.filter(ee=>ee!==x):[...A,x])},ge=async x=>{x.preventDefault(),v(!0);try{await N({name:U,webhook_type:j,url:j!=="EMAIL"&&j!=="TELEGRAM"?$:void 0,api_key:g||void 0,bot_token:j==="TELEGRAM"?p:void 0,chat_id:j==="TELEGRAM"?a:void 0,email_address:j==="EMAIL"?u:void 0,log_levels:i,log_categories:O,enabled:I}),M()}catch(A){console.error("Error saving webhook:",A)}finally{v(!1)}};return C?e.jsxs(e.Fragment,{children:[e.jsx(ho,{onClick:M}),e.jsx(mo,{children:e.jsxs(fo,{onClick:x=>x.stopPropagation(),children:[e.jsx(xo,{children:l?"Edit Webhook":"Add Webhook"}),e.jsxs("form",{onSubmit:ge,children:[e.jsxs(Z,{children:[e.jsx(te,{children:"Name *"}),e.jsx(he,{value:U,onChange:x=>z(x.target.value),required:!0,placeholder:"My Webhook"})]}),e.jsxs(Z,{children:[e.jsx(te,{children:"Webhook Type *"}),e.jsxs(uo,{value:j,onChange:x=>B(x.target.value),required:!0,children:[e.jsx("option",{value:"HTTP",children:"HTTP Webhook"}),e.jsx("option",{value:"SLACK",children:"Slack"}),e.jsx("option",{value:"TEAMS",children:"Microsoft Teams"}),e.jsx("option",{value:"TELEGRAM",children:"Telegram"}),e.jsx("option",{value:"EMAIL",children:"Email"})]}),e.jsx(ie,{children:"Select the notification channel. Telegram is recommended for real-time alerts."})]}),j!=="EMAIL"&&j!=="TELEGRAM"&&e.jsxs(Z,{children:[e.jsx(te,{children:"URL *"}),e.jsx(he,{value:$,onChange:x=>y(x.target.value),required:j!=="EMAIL"&&j!=="TELEGRAM",placeholder:j==="SLACK"?"https://hooks.slack.com/services/...":j==="TEAMS"?"https://outlook.office.com/webhook/...":"https://example.com/webhook"}),j==="SLACK"&&e.jsx(ie,{children:"Get your webhook URL from: Slack App â†’ Incoming Webhooks â†’ Add New Webhook"}),j==="TEAMS"&&e.jsx(ie,{children:"Get your webhook URL from: Teams Channel â†’ Connectors â†’ Incoming Webhook"})]}),j==="TELEGRAM"&&e.jsxs(e.Fragment,{children:[e.jsxs(bo,{children:[e.jsx(vo,{children:"ðŸ“± Telegram Setup Guide"}),e.jsxs(jo,{children:[e.jsx(me,{children:"1. Open Telegram and search for @BotFather"}),e.jsx(me,{children:"2. Send /newbot and follow instructions"}),e.jsx(me,{children:"3. Copy the bot token (format: 123456789:ABCdef...)"}),e.jsx(me,{children:"4. Add your bot as admin to your channel"}),e.jsx(me,{children:"5. For public channels: use @channelname (with @)"}),e.jsx(me,{children:"6. For private channels: get Chat ID from @userinfobot"})]})]}),e.jsxs(Z,{children:[e.jsx(te,{children:"Bot Token *"}),e.jsx(he,{type:"text",value:p,onChange:x=>P(x.target.value),required:!0,placeholder:"8509149857:AAFdtO2jEB0otxj5h50Z-v9NMvtnPsWFPoY"}),e.jsxs(ie,{children:["Format: numbers:letters (e.g., 123456789:ABCdefGHIjklMNOpqrsTUVwxyz)",e.jsx("br",{}),"Get this from @BotFather after creating your bot"]})]}),e.jsxs(Z,{children:[e.jsx(te,{children:"Chat ID *"}),e.jsx(he,{value:a,onChange:x=>d(x.target.value),required:!0,placeholder:"@something45436 or -1001234567890"}),e.jsxs(ie,{children:["For public channels: Use @channelname (e.g., @something45436)",e.jsx("br",{}),"For private channels: Use numeric ID (e.g., -1001234567890)",e.jsx("br",{}),"Get Chat ID by adding @userinfobot to your channel"]})]})]}),j==="EMAIL"&&e.jsxs(Z,{children:[e.jsx(te,{children:"Email Address *"}),e.jsx(he,{type:"email",value:u,onChange:x=>w(x.target.value),required:!0,placeholder:"alerts@example.com"})]}),(j==="HTTP"||j==="SLACK"||j==="TEAMS")&&e.jsxs(Z,{children:[e.jsx(te,{children:"API Key (Optional)"}),e.jsx(he,{type:"password",value:g,onChange:x=>S(x.target.value),placeholder:"Bearer token or API key"}),e.jsx(ie,{children:"Optional authentication header. Format: Bearer token or API key"})]}),e.jsxs(Z,{children:[e.jsx(te,{children:"Log Levels (Leave empty for all) *"}),e.jsx(He,{children:L.map(x=>e.jsxs(Te,{children:[e.jsx(Re,{type:"checkbox",checked:i.includes(x),onChange:()=>W(x)}),x]},x))}),e.jsx(ie,{children:"Select which log levels to receive. Leave all unchecked to receive all levels. Recommended: ERROR, CRITICAL, WARNING"})]}),e.jsxs(Z,{children:[e.jsx(te,{children:"Log Categories (Leave empty for all) *"}),e.jsx(He,{children:_.map(x=>e.jsxs(Te,{children:[e.jsx(Re,{type:"checkbox",checked:O.includes(x),onChange:()=>Y(x)}),x.replace(/_/g," ")]},x))}),e.jsx(ie,{children:"Select which log categories to receive. Leave all unchecked to receive all categories. Recommended: TRANSFER, SYSTEM, ERROR"})]}),e.jsx(Z,{children:e.jsxs(Te,{children:[e.jsx(Re,{type:"checkbox",checked:I,onChange:x=>f(x.target.checked)}),"Enabled"]})}),e.jsxs(yo,{children:[e.jsx(Ue,{type:"button",onClick:M,children:"Cancel"}),e.jsx(Ue,{type:"submit",disabled:b||!U,children:b?"Saving...":l?"Update":"Create"})]})]})]})})]}):null},wo={MariaDB:"host=localhost;user=myuser;password=mypassword;db=mydatabase;port=3306",MSSQL:"DRIVER={ODBC Driver 17 for SQL Server};SERVER=localhost,1433;DATABASE=mydatabase;UID=myuser;PWD=mypassword",PostgreSQL:"postgresql://myuser:mypassword@localhost:5432/mydatabase",MongoDB:"mongodb://myuser:mypassword@localhost:27017/mydatabase"},ko={MariaDB:`Format: host=server;user=username;password=password;db=database;port=3306

Example:
host=localhost;user=admin;password=secret123;db=production;port=3306`,MSSQL:`Format: DRIVER={ODBC Driver 17 for SQL Server};SERVER=server,port;DATABASE=database;UID=username;PWD=password

Example:
DRIVER={ODBC Driver 17 for SQL Server};SERVER=sqlserver.example.com,1433;DATABASE=MyDB;UID=sa;PWD=MyPassword123`,PostgreSQL:`Format: postgresql://user:password@host:port/database

Example:
postgresql://postgres:postgres123@postgres.example.com:5432/mydb

Leave empty to use DataLake connection`,MongoDB:`Format: mongodb://username:password@host:port/database

For MongoDB Atlas (cloud): mongodb+srv://username:password@cluster.mongodb.net/database

Without authentication:
mongodb://host:port/database

Examples:
mongodb://admin:secret123@localhost:27017/mydb
mongodb://localhost:27017/mydb (no auth)
mongodb+srv://admin:secret123@cluster0.xxxxx.mongodb.net/mydb`},Co=({isOpen:C,onClose:M,onSave:N,initialData:l})=>{var De;const[U,z]=s.useState(""),[j,B]=s.useState("SYSTEM"),[$,y]=s.useState("WARNING"),[g,S]=s.useState("TEXT"),[p,P]=s.useState(""),[a,d]=s.useState(""),[u,w]=s.useState(""),[i,G]=s.useState(""),[O,n]=s.useState(""),[I,f]=s.useState(""),[b,v]=s.useState(""),[L,_]=s.useState(60),[W,Y]=s.useState([]),[ge,x]=s.useState(!0),[A,ee]=s.useState(""),[Ee,Ye]=s.useState([]),[Ae,Le]=s.useState(!1),[$e,ve]=s.useState(!1),[Be,Ie]=s.useState(!1),[ye,H]=s.useState(null),[Ke,K]=s.useState(!1),pe=s.useRef(null),[m,se]=s.useState(null),fe=t=>{pe.current=t,se(t)};s.useEffect(()=>{m&&(pe.current=m)},[m]);const[ze,J]=s.useState(null),[Fe,_e]=s.useState(!1),[je,Se]=s.useState(!1),[we,Me]=s.useState(!1),[ke,ne]=s.useState([]),[Ce,ae]=s.useState(null),[de,xe]=s.useState(0),Q=s.useRef(null);s.useEffect(()=>{C?Je():(K(!1),se(null),pe.current=null,H(null),J(null),ne([]),ae(null),Se(!1),xe(0))},[C]),s.useEffect(()=>{H(null)},[i]),s.useEffect(()=>{ne([]),ae(null),J(null)},[g]),s.useEffect(()=>{C&&(l?(z(l.rule_name||""),B(l.alert_type||"SYSTEM"),y(l.severity||"WARNING"),S(l.evaluation_type||"TEXT"),P(l.threshold_low?l.threshold_low.toString():""),d(l.threshold_warning?l.threshold_warning.toString():""),w(l.threshold_critical?l.threshold_critical.toString():""),G(l.db_engine||""),n(l.connection_string||""),f(l.condition_expression||""),v(l.threshold_value||""),_(l.check_interval||60),Y(Array.isArray(l.webhook_ids)?l.webhook_ids:[]),x(l.enabled!==void 0?l.enabled:!0),ee(l.custom_message||"")):We())},[l]);const We=()=>{z(""),B("SYSTEM"),y("WARNING"),S("TEXT"),P(""),d(""),w(""),G(""),n(""),f(""),v(""),_(60),Y([]),x(!0),ee(""),J(null),ne([]),ae(null),Se(!1),Me(!1),H(null),K(!1)},Je=async()=>{try{const t=await fetch("/api/webhooks",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(t.ok){const r=await t.json();Ye(r||[])}}catch(t){console.error("Error fetching webhooks:",t)}},Xe=s.useMemo(()=>i&&wo[i]||"",[i]),Ze=s.useMemo(()=>i&&ko[i]||"",[i]),eo=async()=>{if(!i){H({success:!1,message:"Please select a database engine first"});return}if(!O.trim()){H({success:!1,message:"Please enter a connection string"});return}Ie(!0),H(null);try{const t=localStorage.getItem("authToken"),r=await fetch("/api/test-connection",{method:"POST",headers:{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}},body:JSON.stringify({db_engine:i,connection_string:O.trim()})});if(!r.ok){if(r.status===401){H({success:!1,message:"Authentication required. Please log in again."});return}if(r.status===0||r.status>=500){H({success:!1,message:"Server error. Please check if the server is running."});return}}let h;try{h=await r.json()}catch{H({success:!1,message:"Invalid response from server"});return}r.ok&&h.success?H({success:!0,message:h.message||"Connection successful!"}):H({success:!1,message:h.error||h.message||"Connection failed"})}catch(t){H({success:!1,message:t.message||"Failed to test connection"})}finally{Ie(!1)}},oo=async()=>{if(!I){alert("Please enter a query to test");return}ve(!0),fe(null);try{if(i==="PostgreSQL"||!i){const t=await fetch("/api/alert-rules/test-query",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({query:I,db_engine:i||"PostgreSQL",connection_string:O||null})});if(t.ok){const r=await t.json();if(!r.success){fe({success:!1,rowCount:0,sampleRows:[],message:r.error||r.message||"Query test failed",error:r.error||r.details}),K(!0),ve(!1);return}if(g==="NUMERIC"){if(r.rowCount!==1){fe({success:!1,rowCount:r.rowCount,sampleRows:r.sampleRows||[],message:`NUMERIC evaluation requires query to return exactly 1 row with 1 numeric value. Got ${r.rowCount} row(s).`,error:"Invalid result format for NUMERIC evaluation"}),K(!0);return}const h=r.sampleRows[0],T=h[Object.keys(h)[0]],k=parseFloat(T);if(isNaN(k)){fe({success:!1,rowCount:r.rowCount,sampleRows:r.sampleRows||[],message:`Query returned a non-numeric value: ${T}`,error:"Value must be numeric for NUMERIC evaluation"}),K(!0);return}let E="INFO";u&&k>parseFloat(u)?E="CRITICAL":a&&k>parseFloat(a)?E="WARNING":p&&k>parseFloat(p)&&(E="INFO");const D={success:!0,rowCount:1,sampleRows:r.sampleRows||[],message:`Value: ${k} â†’ Would trigger ${E} alert${p&&a&&u?` (Low: ${p}, Warning: ${a}, Critical: ${u})`:""}`};if(se(D),A){const le=be(A,{success:!0,rowCount:1,sampleRows:r.sampleRows||[]},de),X=`[${E}] ${j}: ${le}`;J(X)}xe(0)}else{const h={success:r.success===!0,rowCount:r.rowCount||0,sampleRows:r.sampleRows||[],message:r.message||`Query returned ${r.rowCount||0} row(s)`};if(!h.success&&h.sampleRows.length>0&&(h.success=!0),se(h),A){const T=be(A,{success:!0,rowCount:r.rowCount||0,sampleRows:r.sampleRows||[]},de),k=`[${$}] ${j}: ${T}`;J(k)}xe(0)}xe(0)}else{const r=await t.json();fe({success:!1,rowCount:0,sampleRows:[],message:r.error||"Failed to test query",error:r.details||r.error})}K(!0)}else se({success:!1,rowCount:0,sampleRows:[],message:`Testing queries for ${i} is not yet supported. Only PostgreSQL is supported.`}),K(!0)}catch(t){se({success:!1,rowCount:0,sampleRows:[],message:`Error testing query: ${t.message}`,error:t.message}),K(!0)}finally{ve(!1)}},Pe=s.useMemo(()=>{if(g==="NUMERIC")return[{placeholder:"{value}",description:"Numeric value from query"}];{const t=[{placeholder:"{row_count}",description:"Number of rows returned"},{placeholder:"{first_row}",description:"First row as JSON"}],r=pe.current||m;if(r&&r.success&&r.sampleRows&&r.sampleRows.length>0){const h=r.sampleRows[0],T=Object.keys(h).map(k=>({placeholder:`{${k}}`,description:`Column: ${k}`}));return[...t,...T]}return[...t,{placeholder:"{schema_name}",description:"Schema name"},{placeholder:"{table_name}",description:"Table name"},{placeholder:"{db_engine}",description:"Database engine"},{placeholder:"{status}",description:"Status (e.g., LISTENING_CHANGES)"},{placeholder:"{cluster_name}",description:"Cluster name"},{placeholder:"{updated_at}",description:"Last updated timestamp"},{placeholder:"{pk_columns}",description:"Primary key columns"},{placeholder:"{pk_strategy}",description:"Primary key strategy"},{placeholder:"{table_size}",description:"Table size"},{placeholder:"{active}",description:"Active status"},{placeholder:"{connection_string}",description:"Connection string"},{placeholder:"{notes}",description:"Notes"},{placeholder:"{mongo_last_sync_time}",description:"Mongo last sync time"},{placeholder:"{cron_schedule}",description:"Cron schedule"},{placeholder:"{next_sync_time}",description:"Next sync time"}]}},[g,m,m==null?void 0:m.success,(De=m==null?void 0:m.sampleRows)==null?void 0:De.length,m==null?void 0:m.sampleRows]),be=(t,r,h=0)=>{var k;if(!t||!r)return t;let T=t;if(g==="NUMERIC"){if(r.sampleRows&&r.sampleRows.length>0){const E=r.sampleRows[0][Object.keys(r.sampleRows[0])[0]];T=T.replace(/\{value\}/g,String(E))}}else if(T=T.replace(/\{row_count\}/g,((k=r.rowCount)==null?void 0:k.toString())||"0"),r.sampleRows&&r.sampleRows.length>0){Object.keys(r.sampleRows[0]).forEach(D=>{const le=new RegExp(`\\{${D.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\[(\\d+)\\]\\}`,"g");T=T.replace(le,(X,oe)=>{const V=parseInt(oe);if(V>=0&&V<r.sampleRows.length){const ue=r.sampleRows[V][D];return ue==null?"null":typeof ue=="object"?JSON.stringify(ue):String(ue)}return X})});const E=r.sampleRows[h]||r.sampleRows[0];T=T.replace(/\{first_row\}/g,JSON.stringify(E,null,2)),Object.keys(E).forEach(D=>{const le=D.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),X=new RegExp(`\\{${le}\\}(?!\\[)`,"g"),oe=E[D];let V="";oe==null?V="null":typeof oe=="object"?V=JSON.stringify(oe):V=String(oe),T=T.replace(X,V)})}return T};s.useEffect(()=>{if(A&&m&&m.success){const t=be(A,m,de),r=`[${$}] ${j}: ${t}`;J(r)}else J(null)},[A,m,$,j,g,de]);const to=async()=>{const t=pe.current;if(!A||!A.trim()){alert("Please enter a custom message");return}if(!t){alert(`Please test the query first to see the message preview with actual data.

Click "Test Query" button to execute the query and get results.`);return}if(!t.success){alert(`Query test failed: ${t.error||t.message||"Unknown error"}

Please fix the query and test it again.`);return}if(!t.sampleRows||t.sampleRows.length===0){alert("No data available from query results. Please test the query again.");return}_e(!0);try{const r=be(A,t,de),h=`[${$}] ${j}: ${r}`;J(h)}catch(r){console.error("Error generating preview:",r),J(`ERROR: ${r.message}`)}finally{_e(!1)}},Oe=t=>{if(!Q.current)return;const r=Q.current,h=r.selectionStart,T=r.selectionEnd,k=A,E=k.substring(0,h)+t+k.substring(T);ee(E),setTimeout(()=>{if(Q.current){const D=h+t.length;Q.current.setSelectionRange(D,D),Q.current.focus()}},0)},ro=t=>{const r=t.target.value;ee(r),J(null);const h=t.target,T=h.selectionStart,k=r.substring(0,T),E=k.lastIndexOf("{");if(E!==-1&&T>E){const D=k.substring(E+1);if(D.includes("}"))ne([]),ae(null);else{const le=Pe.filter(X=>X.placeholder.toLowerCase().includes(D.toLowerCase()));if(le.length>0){ne(le.map(co=>co.placeholder));const X=h.getBoundingClientRect(),oe=20,V=k.split(`
`),ue=V.length-1,io=V[V.length-1].length;ae({top:X.top+ue*oe+25,left:X.left+io*7+8})}else ne([]),ae(null)}}else ne([]),ae(null)},so=t=>{if(!Q.current)return;const h=Q.current.selectionStart,T=A.substring(0,h),k=T.lastIndexOf("{");if(k!==-1){T.substring(k+1);const E=A.substring(0,k)+t+A.substring(h);ee(E),setTimeout(()=>{if(Q.current){const D=k+t.length;Q.current.setSelectionRange(D,D),Q.current.focus()}},0)}ne([]),ae(null)},no=(t,r)=>{t.dataTransfer.setData("text/plain",r),t.dataTransfer.effectAllowed="copy"},ao=t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"},lo=t=>{t.preventDefault();const r=t.dataTransfer.getData("text/plain");r&&Q.current&&Oe(r)},Ne=async t=>{t.preventDefault(),Le(!0);try{await N({rule_name:U,alert_type:j,severity:$,evaluation_type:g,threshold_low:g==="NUMERIC"&&p?parseFloat(p):null,threshold_warning:g==="NUMERIC"&&a?parseFloat(a):null,threshold_critical:g==="NUMERIC"&&u?parseFloat(u):null,condition_expression:I,threshold_value:b||null,db_engine:i,connection_string:O||null,query_type:"CUSTOM_SQL",check_interval:L,webhook_ids:W,enabled:ge,custom_message:A||null}),We()}catch(r){console.error("Error saving alert rule:",r)}finally{Le(!1)}};return C?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:M,children:e.jsx("div",{style:{width:"90%",maxWidth:900,maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:e.jsx(ce,{title:l?"EDIT ALERT RULE":"CREATE ALERT RULE",children:e.jsxs("form",{onSubmit:Ne,style:{padding:16},children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Rule Name *"}),e.jsx("input",{type:"text",value:U,onChange:t=>z(t.target.value),required:!0,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Database Engine *"}),e.jsxs("select",{value:i,onChange:t=>G(t.target.value),required:!0,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12},children:[e.jsx("option",{value:"",children:"-- Select Engine --"}),e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"MSSQL",children:"MSSQL"}),e.jsx("option",{value:"MariaDB",children:"MariaDB"}),e.jsx("option",{value:"MongoDB",children:"MongoDB"})]}),e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:"Select the database engine where the query will be executed"})]}),i&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Connection String Format"}),e.jsx("div",{style:{marginTop:4,padding:"8px",background:o.backgroundSoft,borderRadius:2,borderLeft:`3px solid ${o.accent}`,fontFamily:"Consolas, monospace",fontSize:10,color:o.muted,whiteSpace:"pre-wrap"},children:Ze})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsxs("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:0},children:["Connection String ",i?"*":"(Optional - leave empty for DataLake)"]}),i&&e.jsx(F,{label:Be?"Testing...":"Test Connection",onClick:eo,variant:"ghost",disabled:Be||!i||!O.trim()})]}),e.jsx("textarea",{value:O,onChange:t=>{n(t.target.value),H(null)},placeholder:Xe||"Enter connection string... (leave empty for DataLake)",rows:3,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:11,resize:"vertical"}}),ye&&e.jsxs("div",{style:{marginTop:8,padding:"8px 12px",borderRadius:2,fontSize:10,backgroundColor:ye.success?o.success:o.danger,color:"#ffffff",fontFamily:"Consolas"},children:[ye.success?"âœ“ ":"âœ— ",ye.message]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"SQL Query / Condition Expression *"}),e.jsx("textarea",{value:I,onChange:t=>f(t.target.value),required:!0,rows:10,placeholder:`SELECT * FROM table WHERE condition...
Example: SELECT COUNT(*) FROM metadata.processing_log WHERE status = 'FAILED' AND processed_at > NOW() - INTERVAL '1 hour'`,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:11,resize:"vertical"}}),e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:"Alert will trigger if query returns any rows. Write SQL that returns rows when alert condition is met."}),e.jsx(F,{label:$e?"Testing...":"Test Query",onClick:oo,variant:"ghost",disabled:$e||!I,style:{marginTop:8}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Severity *"}),e.jsxs("select",{value:$,onChange:t=>y(t.target.value),required:!0,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12},children:[e.jsx("option",{value:"CRITICAL",children:"CRITICAL"}),e.jsx("option",{value:"WARNING",children:"WARNING"}),e.jsx("option",{value:"INFO",children:"INFO"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Check Interval (seconds) *"}),e.jsx("input",{type:"number",value:L,onChange:t=>_(parseInt(t.target.value)||60),min:10,required:!0,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12}})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Alert Type"}),e.jsx("input",{type:"text",value:j,onChange:t=>B(t.target.value),placeholder:"SYSTEM, DATABASE, etc.",style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Evaluation Type *"}),e.jsxs("select",{value:g,onChange:t=>S(t.target.value),required:!0,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12},children:[e.jsx("option",{value:"TEXT",children:"Text/Boolean (returns rows = alert triggered)"}),e.jsx("option",{value:"NUMERIC",children:"Numeric (compare value to thresholds)"})]}),e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:g==="TEXT"?"Alert triggers if query returns any rows":"Query must return a single numeric value to compare against thresholds"})]}),g==="NUMERIC"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Threshold - Low (INFO) *"}),e.jsx("input",{type:"number",step:"0.01",value:p,onChange:t=>P(t.target.value),required:!0,placeholder:"e.g., 50",style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12}}),e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:"Value <= Low â†’ INFO severity"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Threshold - Warning *"}),e.jsx("input",{type:"number",step:"0.01",value:a,onChange:t=>d(t.target.value),required:!0,placeholder:"e.g., 75",style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12}}),e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:"Low < Value <= Warning â†’ WARNING severity"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Threshold - Critical *"}),e.jsx("input",{type:"number",step:"0.01",value:u,onChange:t=>w(t.target.value),required:!0,placeholder:"e.g., 90",style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12}}),e.jsxs("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:["Warning < Value <= Critical â†’ WARNING severity",e.jsx("br",{}),"Value > Critical â†’ CRITICAL severity"]})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:"Webhooks to Trigger (Optional)"}),e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",border:`1px solid ${o.border}`,borderRadius:2,padding:8,background:o.backgroundSoft},children:Ee.length===0?e.jsx("div",{style:{fontSize:11,color:o.muted},children:"No webhooks available. Create webhooks first."}):Ee.map(t=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:W.includes(t.id),onChange:r=>{r.target.checked?Y([...W,t.id]):Y(W.filter(h=>h!==t.id))},style:{cursor:"pointer"}}),e.jsxs("span",{style:{fontSize:11,color:o.foreground},children:[t.name," (",t.webhook_type,")"]})]})},t.id))})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:ge,onChange:t=>x(t.target.checked),style:{cursor:"pointer"}}),e.jsx("span",{style:{fontSize:11,color:o.foreground},children:"Enabled"})]})}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:0},children:"Custom Alert Message (Optional)"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[g==="TEXT"&&e.jsx(F,{label:we?"Hide Guide":"Show Guide",onClick:()=>Me(!we),variant:"ghost",style:{fontSize:10,padding:"4px 8px"}}),e.jsx(F,{label:je?"Hide Placeholders":"Show Placeholders",onClick:()=>Se(!je),variant:"ghost",style:{fontSize:10,padding:"4px 8px"}})]})]}),je&&(()=>{let t=Pe;const r=pe.current||m;if(g==="TEXT"&&r&&r.success&&r.sampleRows&&r.sampleRows.length>0){const h=[{placeholder:"{row_count}",description:"Number of rows returned"},{placeholder:"{first_row}",description:"First row as JSON"}],T=r.sampleRows[0],k=Object.keys(T).map(E=>({placeholder:`{${E}}`,description:`Column: ${E}`}));t=[...h,...k]}return e.jsxs("div",{style:{marginBottom:8,padding:"8px",backgroundColor:o.backgroundSoft,border:`1px solid ${o.border}`,borderRadius:2,maxHeight:"150px",overflowY:"auto"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:o.accent,marginBottom:6},children:"Available Placeholders (Drag & Drop or Click):"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:t.map((h,T)=>e.jsx("div",{draggable:!0,onDragStart:k=>no(k,h.placeholder),onClick:()=>Oe(h.placeholder),style:{padding:"4px 8px",backgroundColor:o.accent+"20",border:`1px solid ${o.accent}`,borderRadius:2,fontSize:10,fontFamily:"Consolas, monospace",color:o.foreground,cursor:"grab",userSelect:"none",transition:"all 0.2s"},onMouseEnter:k=>{k.currentTarget.style.backgroundColor=o.accent+"40",k.currentTarget.style.cursor="grab"},onMouseLeave:k=>{k.currentTarget.style.backgroundColor=o.accent+"20"},title:h.description,children:h.placeholder},T))})]})})(),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("textarea",{ref:Q,value:A,onChange:ro,onDragOver:ao,onDrop:lo,rows:4,placeholder:g==="NUMERIC"?`Alert: {value} failed syncs detected

Type { to see autocomplete suggestions`:`Alert: Found {row_count} unprotected columns in {schema_name}.{table_name}

Type { to see autocomplete suggestions`,style:{width:"100%",padding:"8px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:11,resize:"vertical"}}),ke.length>0&&Ce&&e.jsx("div",{style:{position:"fixed",top:Ce.top,left:Ce.left,backgroundColor:o.background,border:`1px solid ${o.border}`,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:2e3,maxHeight:"200px",overflowY:"auto",minWidth:"200px"},children:ke.map((t,r)=>e.jsx("div",{onClick:()=>so(t),style:{padding:"6px 10px",cursor:"pointer",fontSize:11,fontFamily:"Consolas, monospace",color:o.foreground,borderBottom:r<ke.length-1?`1px solid ${o.border}`:"none"},onMouseEnter:h=>{h.currentTarget.style.backgroundColor=o.accent+"20"},onMouseLeave:h=>{h.currentTarget.style.backgroundColor="transparent"},children:t},r))})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{fontSize:10,color:o.muted,marginBottom:4},children:g==="NUMERIC"?"Available placeholders: {value} (the numeric value from query). Type { for autocomplete.":"Available placeholders: {row_count}, {first_row}, or column names. Type { for autocomplete or drag from list above."}),g==="TEXT"&&we&&e.jsxs("div",{style:{marginTop:8,padding:"12px",backgroundColor:o.backgroundSoft,border:`1px solid ${o.accent}`,borderRadius:2,fontSize:10,fontFamily:"Consolas, monospace"},children:[e.jsx("div",{style:{fontWeight:600,color:o.accent,marginBottom:8},children:"Guide: Using Placeholders with Multiple Rows"}),e.jsxs("div",{style:{color:o.foreground,lineHeight:1.6},children:[e.jsx("div",{style:{marginBottom:6},children:e.jsx("strong",{children:"When your query returns multiple rows, you can reference specific rows using indices:"})}),e.jsxs("div",{style:{marginBottom:4,paddingLeft:8},children:["â€¢ ",e.jsx("code",{style:{color:o.accent},children:"{table_name}"})," - Uses the row selected in the dropdown above"]}),e.jsxs("div",{style:{marginBottom:4,paddingLeft:8},children:["â€¢ ",e.jsx("code",{style:{color:o.accent},children:"{table_name[0]}"})," - Always uses row 0 (first row)"]}),e.jsxs("div",{style:{marginBottom:4,paddingLeft:8},children:["â€¢ ",e.jsx("code",{style:{color:o.accent},children:"{table_name[1]}"})," - Always uses row 1 (second row)"]}),e.jsxs("div",{style:{marginBottom:4,paddingLeft:8},children:["â€¢ ",e.jsx("code",{style:{color:o.accent},children:"{status[2]}"})," - Always uses row 2 (third row)"]}),e.jsx("div",{style:{marginTop:8,marginBottom:4},children:e.jsx("strong",{children:"Example:"})}),e.jsx("div",{style:{padding:"8px",backgroundColor:o.background,borderRadius:2,border:`1px solid ${o.border}`,marginTop:4,whiteSpace:"pre-wrap"},children:`Found {row_count} issues:
- {table_name[0]} has status {status[0]}
- {table_name[1]} has status {status[1]}
- Default: {table_name} (uses selected row)`}),e.jsx("div",{style:{marginTop:8,color:o.muted,fontStyle:"italic"},children:"You can mix indexed and non-indexed placeholders in the same message!"})]})]})]}),A&&m&&m.success&&m.sampleRows&&m.sampleRows.length>1&&e.jsxs("div",{style:{marginTop:8,marginBottom:8},children:[e.jsxs("label",{style:{color:o.muted,fontSize:11,display:"block",marginBottom:4},children:["Select Row for Preview (",m.sampleRows.length," rows available):"]}),e.jsx("select",{value:de,onChange:t=>{const r=parseInt(t.target.value);xe(r)},style:{width:"100%",padding:"6px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas, monospace",fontSize:11},children:m.sampleRows.map((t,r)=>{let h=`Row ${r+1}`;if(t.schema_name&&t.table_name)h=`Row ${r+1}: ${t.schema_name}.${t.table_name}`;else if(t.table_name)h=`Row ${r+1}: ${t.table_name}`;else{const T=Object.keys(t);if(T.length>0){const k=T[0],E=t[k];if(E&&typeof E=="string"&&E.length<50)h=`Row ${r+1}: ${k}=${E}`;else if(E!=null){const D=String(E).substring(0,30);h=`Row ${r+1}: ${k}=${D}${String(E).length>30?"...":""}`}}}return e.jsx("option",{value:r,children:h},r)})}),e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:"Placeholders will use values from the selected row. Preview updates automatically."})]}),A&&e.jsxs("div",{style:{marginTop:8},children:[ze&&e.jsxs("div",{style:{marginBottom:12,padding:"12px",borderRadius:2,backgroundColor:o.backgroundSoft,border:`1px solid ${o.border}`,fontFamily:"Consolas, monospace",fontSize:11,color:o.foreground,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.jsxs("div",{style:{marginBottom:8,fontSize:10,fontWeight:600,color:o.accent},children:["Preview (Final Alert Message)",m&&m.sampleRows&&m.sampleRows.length>1&&e.jsxs("span",{style:{marginLeft:8,color:o.muted,fontWeight:400},children:["(using row ",de+1," of ",m.sampleRows.length,")"]}),":"]}),e.jsx("div",{style:{padding:"8px",backgroundColor:$==="CRITICAL"?o.danger+"20":$==="WARNING"?o.warning+"20":o.accent+"20",borderLeft:`3px solid ${$==="CRITICAL"?o.danger:$==="WARNING"?o.warning:o.accent}`,borderRadius:2},children:ze})]}),e.jsx(F,{label:Fe?"Testing...":"Test Custom Alert Message",onClick:to,variant:"ghost",disabled:Fe,style:{fontSize:10,padding:"4px 8px"}}),!m&&e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:"Test the query first to see the preview with actual data"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[e.jsx(F,{label:"Save",onClick:Ne,variant:"primary",disabled:Ae}),e.jsx(F,{label:"Cancel",onClick:M,variant:"ghost",disabled:Ae})]})]})})})}),Ke&&m&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:()=>{K(!1),se(null)},children:e.jsx("div",{style:{width:"90%",maxWidth:800,maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:e.jsx(ce,{title:"QUERY TEST RESULTS",children:e.jsxs("div",{style:{padding:16},children:[e.jsxs("div",{style:{marginBottom:16,padding:"12px",borderRadius:2,backgroundColor:m.success?o.success:o.danger,color:"#ffffff",fontFamily:"Consolas",fontSize:12},children:[m.success?"âœ“ ":"âœ— ",e.jsx("strong",{children:m.message})]}),m.error&&e.jsxs("div",{style:{marginBottom:16,padding:"12px",borderRadius:2,backgroundColor:o.backgroundSoft,border:`1px solid ${o.danger}`,fontFamily:"Consolas, monospace",fontSize:11,color:o.danger,whiteSpace:"pre-wrap"},children:[e.jsx("strong",{children:"Error Details:"}),e.jsx("br",{}),m.error]}),m.success&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:12,padding:"8px 12px",backgroundColor:o.backgroundSoft,borderRadius:2,fontFamily:"Consolas",fontSize:11,color:o.foreground},children:[e.jsx("strong",{children:"Rows Returned:"})," ",m.rowCount]}),m.rowCount>0&&m.sampleRows&&m.sampleRows.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{marginBottom:8,fontSize:11,fontWeight:600,color:o.accent},children:"Sample Rows (showing up to 5):"}),e.jsx("div",{style:{maxHeight:"400px",overflow:"auto",border:`1px solid ${o.border}`,borderRadius:2,padding:"8px",backgroundColor:o.background,fontFamily:"Consolas, monospace",fontSize:10},children:e.jsx("pre",{style:{margin:0,color:o.foreground,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:JSON.stringify(m.sampleRows,null,2)})})]}),m.rowCount>0&&e.jsxs("div",{style:{padding:"12px",backgroundColor:o.warning+"20",borderRadius:2,border:`1px solid ${o.warning}`,fontSize:11,color:o.foreground,fontFamily:"Consolas"},children:[e.jsx("strong",{children:"âš  Alert Trigger:"})," This query returned ",m.rowCount," row(s).",m.rowCount>0?" The alert will be triggered when this rule is active.":" The alert will not be triggered."]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:20},children:e.jsx(F,{label:"Close",onClick:()=>{K(!1),se(null)},variant:"ghost"})})]})})})})]}):null},To=({rules:C,onTest:M,onToggle:N,onEdit:l,onDelete:U})=>{const[z,j]=s.useState(new Set),[B,$]=s.useState(new Set),y=s.useMemo(()=>{const a=new Map;return C.forEach(d=>{const u=d.severity||"UNKNOWN",w=d.db_engine||"ALL";a.has(u)||a.set(u,{severity:u,engines:new Map});const i=a.get(u);i.engines.has(w)||i.engines.set(w,{engine:w,rules:[]}),i.engines.get(w).rules.push(d)}),Array.from(a.values()).sort((d,u)=>{const w=["CRITICAL","WARNING","INFO","UNKNOWN"];return w.indexOf(d.severity)-w.indexOf(u.severity)})},[C]),g=a=>{j(d=>{const u=new Set(d);if(u.has(a)){u.delete(a);const w=y.find(i=>i.severity===a);w&&w.engines.forEach(i=>{const G=`${a}.${i.engine}`;$(O=>{const n=new Set(O);return n.delete(G),n})})}else u.add(a);return u})},S=(a,d)=>{const u=`${a}.${d}`;$(w=>{const i=new Set(w);return i.has(u)?i.delete(u):i.add(u),i})},p=(a,d)=>{if(a===0)return null;const u=[];for(let w=0;w<a-1;w++)u.push(`${R.v}  `);return d?u.push(`${R.bl}${R.h}${R.h} `):u.push(`${R.tRight}${R.h}${R.h} `),e.jsx("span",{style:{color:o.border,marginRight:6,fontFamily:"Consolas",fontSize:11},children:u.join("")})},P=a=>{switch(a){case"CRITICAL":return o.foreground;case"WARNING":return o.muted;case"INFO":return o.accent;default:return o.muted}};return C.length===0?e.jsxs("div",{style:{padding:c.spacing.lg,textAlign:"center",color:o.muted,fontFamily:"Consolas",fontSize:12},children:[R.blockEmpty," No alert rules configured"]}):e.jsx("div",{style:{fontFamily:"Consolas",fontSize:12,color:o.foreground},children:y.map((a,d)=>{const u=z.has(a.severity),w=Array.from(a.engines.values());return y.length-1,e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("div",{onClick:()=>g(a.severity),style:{display:"flex",alignItems:"center",padding:"10px 8px",cursor:"pointer",borderLeft:`2px solid ${P(a.severity)}`,backgroundColor:u?o.backgroundSoft:o.background,transition:"all 0.15s ease",marginBottom:2},onMouseEnter:i=>{i.currentTarget.style.backgroundColor=o.backgroundSoft},onMouseLeave:i=>{u||(i.currentTarget.style.backgroundColor=o.background)},children:[e.jsx("span",{style:{marginRight:8,color:u?o.accent:o.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:u?"rotate(90deg)":"rotate(0deg)"},children:R.arrowRight}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:10,fontWeight:600,border:`1px solid ${P(a.severity)}`,color:P(a.severity),backgroundColor:"transparent"},children:a.severity}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.border}`,backgroundColor:o.backgroundSoft,color:o.foreground,marginLeft:8},children:w.reduce((i,G)=>i+G.rules.length,0)})]}),u&&e.jsx("div",{style:{paddingLeft:24},children:w.map((i,G)=>{const O=`${a.severity}.${i.engine}`,n=B.has(O),I=G===w.length-1;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>S(a.severity,i.engine),style:{display:"flex",alignItems:"center",padding:"8px 8px",marginLeft:8,marginBottom:2,borderLeft:`2px solid ${o.border}`,backgroundColor:n?o.backgroundSoft:"transparent",transition:"all 0.15s ease",cursor:"pointer"},onMouseEnter:f=>{f.currentTarget.style.backgroundColor=o.backgroundSoft,f.currentTarget.style.borderLeftColor=o.accent},onMouseLeave:f=>{n||(f.currentTarget.style.backgroundColor="transparent",f.currentTarget.style.borderLeftColor=o.border)},children:[p(1,I),e.jsx("span",{style:{marginRight:8,color:n?o.accent:o.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:n?"rotate(90deg)":"rotate(0deg)"},children:R.arrowRight}),e.jsx("span",{style:{fontWeight:600,color:o.foreground,fontSize:11,flex:1},children:i.engine}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.border}`,backgroundColor:"transparent",color:o.muted},children:i.rules.length})]}),n&&e.jsx("div",{style:{paddingLeft:24},children:i.rules.map((f,b)=>{const v=b===i.rules.length-1;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:"10px 8px",marginLeft:8,marginBottom:2,borderLeft:`1px solid ${o.border}`,backgroundColor:"transparent",transition:"all 0.15s ease"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor=o.backgroundSoft,L.currentTarget.style.borderLeftColor=o.accent},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="transparent",L.currentTarget.style.borderLeftColor=o.border},children:[p(2,v),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:600,color:o.foreground,fontSize:11},children:f.rule_name}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.accent}`,color:o.accent,backgroundColor:"transparent"},children:f.query_type}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${f.enabled?o.accent:o.muted}`,color:f.enabled?o.accent:o.muted,backgroundColor:"transparent"},children:f.enabled?"ENABLED":"DISABLED"}),f.is_system_rule&&e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:600,border:`1px solid ${o.accent}`,color:o.accent,backgroundColor:"transparent"},children:"SYSTEM"})]}),e.jsxs("div",{style:{fontSize:10,color:o.muted,marginBottom:4},children:["Interval: ",f.check_interval,"s",f.threshold_value&&` | Threshold: ${f.threshold_value}`]}),f.condition_expression&&e.jsx("div",{style:{fontSize:10,color:o.foreground,fontFamily:"Consolas",padding:"4px 8px",backgroundColor:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`,marginBottom:4,maxHeight:"60px",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:f.condition_expression.length>150?f.condition_expression.substring(0,150)+"...":f.condition_expression}),e.jsxs("div",{style:{fontSize:10,color:o.muted},children:["Created: ",Qe(new Date(f.created_at),"yyyy-MM-dd HH:mm:ss")]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,marginLeft:8},children:[e.jsx(F,{label:"Test",onClick:L=>{L.stopPropagation(),M==null||M(f)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}}),!f.is_system_rule&&e.jsxs(e.Fragment,{children:[e.jsx(F,{label:f.enabled?"Disable":"Enable",onClick:L=>{L.stopPropagation(),N==null||N(f)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}}),e.jsx(F,{label:"Edit",onClick:L=>{L.stopPropagation(),l==null||l(f)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}}),e.jsx(F,{label:"Delete",onClick:L=>{L.stopPropagation(),U==null||U(f)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}})]})]})]},f.id)})})]},O)})})]},a.severity)})})},Ro=()=>{const[C,M]=s.useState([]),[N,l]=s.useState(!0),[U,z]=s.useState(null),[j,B]=s.useState(!1),[$,y]=s.useState(null),[g,S]=s.useState(1),[p,P]=s.useState(1),[a,d]=s.useState({query_type:"",db_engine:"",enabled:""}),u=s.useRef(!0),w=s.useCallback(async()=>{var L;if(!u.current)return;const b=Date.now(),v=300;try{z(null);const _=new URLSearchParams({page:g.toString(),limit:"20"});a.query_type&&_.append("query_type",a.query_type),a.db_engine&&_.append("db_engine",a.db_engine),a.enabled!==""&&_.append("enabled",a.enabled);const W=await fetch(`/api/alert-rules?${_}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!W.ok)throw new Error("Failed to fetch alert rules");const Y=await W.json(),ge=Date.now()-b,x=Math.max(0,v-ge);await new Promise(A=>setTimeout(A,x)),u.current&&(M(Y.rules||[]),P(((L=Y.pagination)==null?void 0:L.totalPages)||1),l(!1))}catch(_){u.current&&(z(re(_)),l(!1))}},[g,a]);s.useEffect(()=>{u.current=!0,w();const b=setInterval(()=>{u.current&&!j&&w()},3e4);return()=>{u.current=!1,clearInterval(b)}},[w,j]);const i=s.useCallback(()=>{y(null),B(!0)},[]),G=s.useCallback(b=>{y(b),B(!0)},[]),O=s.useCallback(async b=>{if(b.is_system_rule){alert("Cannot delete system rules");return}if(confirm(`Are you sure you want to delete alert rule "${b.rule_name}"?`))try{if(z(null),!(await fetch(`/api/alert-rules/${b.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).ok)throw new Error("Failed to delete alert rule");await w(),alert(`Alert rule "${b.rule_name}" deleted successfully.`)}catch(v){z(re(v))}},[w]),n=s.useCallback(async b=>{try{if(z(null),!(await fetch(`/api/alert-rules/${b.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({enabled:!b.enabled})})).ok)throw new Error("Failed to toggle alert rule");await w()}catch(v){z(re(v))}},[w]),I=s.useCallback(async b=>{try{z(null);const v=await fetch(`/api/alert-rules/${b.id}/test`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!v.ok){const _=await v.json();throw new Error(_.error||"Failed to test alert rule")}const L=await v.json();alert(L.message||`Query returned ${L.rowCount} row(s)`)}catch(v){alert(`Error testing query: ${v.message||re(v)}`)}},[]),f=s.useCallback(async b=>{try{z(null);const v=$?`/api/alert-rules/${$.id}`:"/api/alert-rules",_=await fetch(v,{method:$?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(b)});if(!_.ok){let W="Failed to save alert rule";try{W=(await _.json()).error||W}catch{W=await _.text()||W}throw new Error(W)}await w(),B(!1),y(null),alert(`Alert rule "${b.rule_name}" ${$?"updated":"created"} successfully.`)}catch(v){throw z(re(v)),v}},[$,w]);return N&&C.length===0?e.jsx(go,{variant:"table"}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h2",{style:{fontSize:13,fontWeight:600,margin:0,color:o.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:o.warning,marginRight:8},children:R.blockFull}),"ALERT RULES"]}),e.jsx("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:e.jsx(F,{label:"Create Alert Rule",onClick:i,variant:"primary"})})]}),U&&e.jsx(ce,{title:"ERROR",children:e.jsx("div",{style:{color:o.danger,padding:"10px"},children:U})}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px",flexWrap:"wrap"},children:[e.jsxs("select",{value:a.query_type,onChange:b=>d(v=>({...v,query_type:b.target.value})),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:11},children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"CUSTOM_SQL",children:"Custom SQL"})]}),e.jsxs("select",{value:a.db_engine,onChange:b=>d(v=>({...v,db_engine:b.target.value})),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:11},children:[e.jsx("option",{value:"",children:"All Engines"}),e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"MSSQL",children:"MSSQL"}),e.jsx("option",{value:"MariaDB",children:"MariaDB"}),e.jsx("option",{value:"MongoDB",children:"MongoDB"}),e.jsx("option",{value:"Oracle",children:"Oracle"}),e.jsx("option",{value:"DB2",children:"DB2"}),e.jsx("option",{value:"Salesforce",children:"Salesforce"}),e.jsx("option",{value:"SAP",children:"SAP"}),e.jsx("option",{value:"Teradata",children:"Teradata"}),e.jsx("option",{value:"Netezza",children:"Netezza"}),e.jsx("option",{value:"Hive",children:"Hive"}),e.jsx("option",{value:"Cassandra",children:"Cassandra"}),e.jsx("option",{value:"DynamoDB",children:"DynamoDB"}),e.jsx("option",{value:"AS400",children:"AS/400"}),e.jsx("option",{value:"S3",children:"S3"}),e.jsx("option",{value:"AzureBlob",children:"Azure Blob"}),e.jsx("option",{value:"GCS",children:"Google Cloud Storage"}),e.jsx("option",{value:"FTP",children:"FTP"}),e.jsx("option",{value:"SFTP",children:"SFTP"}),e.jsx("option",{value:"Email",children:"Email"}),e.jsx("option",{value:"SOAP",children:"SOAP"}),e.jsx("option",{value:"GraphQL",children:"GraphQL"}),e.jsx("option",{value:"Excel",children:"Excel"}),e.jsx("option",{value:"FixedWidth",children:"Fixed Width"}),e.jsx("option",{value:"EBCDIC",children:"EBCDIC"}),e.jsx("option",{value:"XML",children:"XML"}),e.jsx("option",{value:"Avro",children:"Avro"}),e.jsx("option",{value:"Parquet",children:"Parquet"}),e.jsx("option",{value:"ORC",children:"ORC"}),e.jsx("option",{value:"Compressed",children:"Compressed"})]}),e.jsxs("select",{value:a.enabled,onChange:b=>d(v=>({...v,enabled:b.target.value})),style:{padding:"6px 10px",border:`1px solid ${o.border}`,borderRadius:2,background:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:11},children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),C.length===0?e.jsx(ce,{title:"NO ALERT RULES",children:e.jsxs("div",{style:{padding:"40px",textAlign:"center",fontSize:12,fontFamily:"Consolas",color:o.muted},children:[R.blockEmpty," No alert rules configured",e.jsx("br",{}),e.jsx("br",{}),e.jsx(F,{label:"Create First Alert Rule",onClick:i,variant:"primary"})]})}):e.jsx(To,{rules:C,onTest:I,onToggle:n,onEdit:G,onDelete:O}),p>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",marginTop:"20px"},children:[e.jsx(F,{label:"Previous",onClick:()=>S(b=>Math.max(1,b-1)),variant:"ghost",disabled:g===1}),e.jsxs("span",{style:{color:o.muted,fontSize:11},children:["Page ",g," of ",p]}),e.jsx(F,{label:"Next",onClick:()=>S(b=>Math.min(p,b+1)),variant:"ghost",disabled:g>=p})]}),e.jsx(Co,{isOpen:j,onClose:()=>{B(!1),y(null)},onSave:f,initialData:$})]})},Eo=({webhooks:C,onEdit:M,onDelete:N,onToggle:l})=>{const[U,z]=s.useState(new Set),j=s.useMemo(()=>{const y=new Map;return C.forEach(g=>{const S=g.webhook_type||"OTHER";y.has(S)||y.set(S,{type:S,webhooks:[]}),y.get(S).webhooks.push(g)}),Array.from(y.values()).sort((g,S)=>g.type.localeCompare(S.type))},[C]),B=y=>{z(g=>{const S=new Set(g);return S.has(y)?S.delete(y):S.add(y),S})},$=(y,g)=>{if(y===0)return null;const S=[];for(let p=0;p<y-1;p++)S.push(`${R.v}  `);return g?S.push(`${R.bl}${R.h}${R.h} `):S.push(`${R.tRight}${R.h}${R.h} `),e.jsx("span",{style:{color:o.border,marginRight:6,fontFamily:"Consolas",fontSize:11},children:S.join("")})};return C.length===0?e.jsxs("div",{style:{padding:c.spacing.lg,textAlign:"center",color:o.muted,fontFamily:"Consolas",fontSize:12},children:[R.blockEmpty," No webhooks configured"]}):e.jsx("div",{style:{fontFamily:"Consolas",fontSize:12,color:o.foreground},children:j.map((y,g)=>{const S=U.has(y.type);return j.length-1,e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("div",{onClick:()=>B(y.type),style:{display:"flex",alignItems:"center",padding:"10px 8px",cursor:"pointer",borderLeft:`2px solid ${o.accent}`,backgroundColor:S?o.backgroundSoft:o.background,transition:"all 0.15s ease",marginBottom:2},onMouseEnter:p=>{p.currentTarget.style.backgroundColor=o.backgroundSoft},onMouseLeave:p=>{S||(p.currentTarget.style.backgroundColor=o.background)},children:[e.jsx("span",{style:{marginRight:8,color:S?o.accent:o.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:S?"rotate(90deg)":"rotate(0deg)"},children:R.arrowRight}),e.jsx("span",{style:{fontWeight:600,color:o.accent,fontSize:12,flex:1},children:y.type}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${o.border}`,backgroundColor:o.backgroundSoft,color:o.foreground},children:y.webhooks.length})]}),S&&e.jsx("div",{style:{paddingLeft:24},children:y.webhooks.map((p,P)=>{const a=P===y.webhooks.length-1;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:"10px 8px",marginLeft:8,marginBottom:2,borderLeft:`1px solid ${o.border}`,backgroundColor:"transparent",transition:"all 0.15s ease"},onMouseEnter:d=>{d.currentTarget.style.backgroundColor=o.backgroundSoft,d.currentTarget.style.borderLeftColor=o.accent},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="transparent",d.currentTarget.style.borderLeftColor=o.border},children:[$(1,a),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4,flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:600,color:o.foreground,fontSize:11},children:p.name}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${p.enabled?o.accent:o.muted}`,color:p.enabled?o.accent:o.muted,backgroundColor:"transparent"},children:p.enabled?"ENABLED":"DISABLED"})]}),p.url&&e.jsxs("div",{style:{fontSize:10,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:["URL: ",p.url.length>50?p.url.substring(0,50)+"...":p.url]}),p.email_address&&e.jsxs("div",{style:{fontSize:10,color:o.muted,marginBottom:4,fontFamily:"Consolas"},children:["Email: ",p.email_address]}),p.log_levels&&p.log_levels.length>0&&e.jsxs("div",{style:{fontSize:10,color:o.muted,marginBottom:4},children:["Levels: ",p.log_levels.map((d,u)=>e.jsx("span",{style:{display:"inline-block",padding:"2px 6px",margin:"0 4px",background:o.backgroundSoft,color:o.foreground,border:`1px solid ${o.border}`,borderRadius:2,fontSize:9,fontFamily:"Consolas"},children:d},u))]}),e.jsxs("div",{style:{fontSize:10,color:o.muted,fontFamily:"Consolas"},children:["Created: ",Qe(new Date(p.created_at),"yyyy-MM-dd HH:mm:ss")]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,marginLeft:8},children:[e.jsx(F,{label:p.enabled?"Disable":"Enable",onClick:d=>{d.stopPropagation(),l==null||l(p)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}}),e.jsx(F,{label:"Edit",onClick:d=>{d.stopPropagation(),M==null||M(p)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}}),e.jsx(F,{label:"Delete",onClick:d=>{d.stopPropagation(),N==null||N(p)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}})]})]},p.id)})})]},y.type)})})},Fo=()=>{const[C,M]=s.useState("webhooks"),[N,l]=s.useState([]),[U,z]=s.useState(!0),[j,B]=s.useState(null),[$,y]=s.useState(!1),[g,S]=s.useState(null),[p,P]=s.useState(!1),a=s.useRef(!0),d=s.useCallback(async()=>{if(!a.current)return;const n=Date.now(),I=300;try{B(null);const f=await fetch("/api/webhooks",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!f.ok)throw new Error("Failed to fetch webhooks");const b=await f.json(),v=Date.now()-n,L=Math.max(0,I-v);if(await new Promise(_=>setTimeout(_,L)),a.current){const _=b.map(W=>({...W,log_levels:Array.isArray(W.log_levels)?W.log_levels:[],log_categories:Array.isArray(W.log_categories)?W.log_categories:[]}));l(_)}}catch(f){a.current&&B(re(f))}finally{a.current&&z(!1)}},[]);s.useEffect(()=>(a.current=!0,d(),()=>{a.current=!1}),[d]);const u=s.useCallback(async n=>{try{B(null);const I=g?`/api/webhooks/${g.id}`:"/api/webhooks",b=await fetch(I,{method:g?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(n)});if(!b.ok){let v="Failed to save webhook";try{v=(await b.json()).error||v}catch{v=await b.text()||v}throw new Error(v)}await d(),y(!1),S(null),alert(`Webhook "${n.name}" ${g?"updated":"created"} successfully.`)}catch(I){throw B(re(I)),I}},[g,d]),w=s.useCallback(async n=>{if(confirm(`Are you sure you want to delete webhook "${n.name}"?`))try{if(B(null),!(await fetch(`/api/webhooks/${n.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).ok)throw new Error("Failed to delete webhook");await d(),alert(`Webhook "${n.name}" deleted successfully.`)}catch(I){B(re(I))}},[d]),i=s.useCallback(async n=>{try{if(B(null),!(await fetch(`/api/webhooks/${n.id}/enable`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({enabled:!n.enabled})})).ok)throw new Error("Failed to update webhook");await d()}catch(I){B(re(I))}},[d]),G=s.useCallback(n=>{S(n),y(!0)},[]),O=s.useCallback(()=>{S(null),y(!0)},[]);return U&&N.length===0?e.jsx(Ge,{children:e.jsxs("div",{style:{padding:c.spacing.lg,fontFamily:"Consolas",fontSize:12,background:o.background},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:`0 0 ${c.spacing.lg} 0`,color:o.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:o.accent,marginRight:c.spacing.sm},children:R.blockFull}),"WEBHOOKS & NOTIFICATIONS"]}),e.jsx(ce,{title:"LOADING",children:e.jsxs("div",{style:{padding:c.spacing.xl,textAlign:"center",fontSize:12,fontFamily:"Consolas",color:o.muted},children:[R.blockFull," Loading webhooks..."]})})]})}):e.jsx(Ge,{children:e.jsxs("div",{style:{padding:c.spacing.lg,fontFamily:"Consolas",fontSize:12,background:o.background},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:c.spacing.lg,paddingBottom:c.spacing.md,borderBottom:`2px solid ${o.accent}`},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:o.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:o.accent,marginRight:c.spacing.sm},children:R.blockFull}),"WEBHOOKS & ALERTS"]}),e.jsx("div",{style:{display:"flex",gap:c.spacing.sm,alignItems:"center"},children:C==="webhooks"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{label:"Webhooks Info",onClick:()=>P(!0),variant:"ghost"}),e.jsx(F,{label:"Add Webhook",onClick:O,variant:"primary"})]})})]}),e.jsxs("div",{style:{display:"flex",gap:c.spacing.sm,marginBottom:c.spacing.lg,borderBottom:`2px solid ${o.border}`},children:[e.jsxs("button",{onClick:()=>M("webhooks"),"aria-label":"Webhooks tab",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),M("webhooks"))},style:{padding:`${c.spacing.sm} ${c.spacing.md}`,border:C==="webhooks"?`2px solid ${o.accent}`:`1px solid ${o.border}`,background:C==="webhooks"?o.backgroundSoft:"transparent",color:C==="webhooks"?o.foreground:o.muted,fontFamily:"Consolas",fontSize:12,fontWeight:C==="webhooks"?600:400,cursor:"pointer",transition:"border-color 0.15s ease, background-color 0.15s ease",outline:"none",outlineOffset:0,borderRadius:2,display:"flex",alignItems:"center",gap:c.spacing.xs},onMouseDown:n=>{n.currentTarget.style.outline="none"},onFocus:n=>{C!=="webhooks"?(n.currentTarget.style.outline=`2px solid ${o.accent}`,n.currentTarget.style.outlineOffset="2px"):(n.currentTarget.style.outline="none",n.currentTarget.style.outlineOffset=0)},onBlur:n=>{n.currentTarget.style.outline="none",n.currentTarget.style.outlineOffset=0},children:[C==="webhooks"&&e.jsx("span",{style:{color:o.accent,fontSize:10},children:R.arrowRight}),"Webhooks (",N.length,")"]}),e.jsxs("button",{onClick:()=>M("alert-rules"),"aria-label":"Alert Rules tab",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),M("alert-rules"))},style:{padding:`${c.spacing.sm} ${c.spacing.md}`,border:C==="alert-rules"?`2px solid ${o.accent}`:`1px solid ${o.border}`,background:C==="alert-rules"?o.backgroundSoft:"transparent",color:C==="alert-rules"?o.foreground:o.muted,fontFamily:"Consolas",fontSize:12,fontWeight:C==="alert-rules"?600:400,cursor:"pointer",transition:"border-color 0.15s ease, background-color 0.15s ease",outline:"none",outlineOffset:0,borderRadius:2,display:"flex",alignItems:"center",gap:c.spacing.xs},onMouseDown:n=>{n.currentTarget.style.outline="none"},onFocus:n=>{C!=="alert-rules"?(n.currentTarget.style.outline=`2px solid ${o.accent}`,n.currentTarget.style.outlineOffset="2px"):(n.currentTarget.style.outline="none",n.currentTarget.style.outlineOffset=0)},onBlur:n=>{n.currentTarget.style.outline="none",n.currentTarget.style.outlineOffset=0},children:[C==="alert-rules"&&e.jsx("span",{style:{color:o.accent,fontSize:10},children:R.arrowRight}),"Alert Rules"]})]}),j&&e.jsx("div",{style:{marginBottom:c.spacing.lg},children:e.jsx(ce,{title:"ERROR",children:e.jsx("div",{style:{color:o.foreground,padding:c.spacing.md,fontFamily:"Consolas",fontSize:12,background:o.backgroundSoft,borderRadius:2,border:`2px solid ${o.foreground}`},children:j})})}),p&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>P(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:n=>n.stopPropagation(),children:e.jsx(ce,{title:"WEBHOOKS & NOTIFICATIONS PLAYBOOK",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[R.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:o.foreground,marginLeft:16},children:"Webhooks & Notifications enable real-time alerts and integrations with external systems. Configure webhooks to receive notifications about system events, log entries, errors, and important data operations. Webhooks can be sent to HTTP endpoints, Slack, Microsoft Teams, Telegram, or email addresses."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[R.blockFull," WEBHOOK TYPES"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:o.foreground,marginBottom:4},children:"HTTP"}),e.jsx("div",{style:{color:o.foreground,marginLeft:16,fontSize:11},children:"Send POST requests to any HTTP/HTTPS endpoint. Ideal for custom integrations, APIs, or web services. Requires a valid URL endpoint that accepts JSON payloads."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:o.accent,marginBottom:4},children:"SLACK"}),e.jsx("div",{style:{color:o.foreground,marginLeft:16,fontSize:11,fontFamily:"Consolas"},children:"Send notifications to Slack channels via Incoming Webhooks. Requires a Slack webhook URL from your Slack workspace. Messages are formatted for Slack's rich message format."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:o.accent,marginBottom:4},children:"TEAMS"}),e.jsx("div",{style:{color:o.foreground,marginLeft:16,fontSize:11,fontFamily:"Consolas"},children:"Send notifications to Microsoft Teams channels via webhook connectors. Requires a Teams webhook URL from your Teams channel connector settings."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:o.accent,marginBottom:4},children:"TELEGRAM"}),e.jsx("div",{style:{color:o.foreground,marginLeft:16,fontSize:11,fontFamily:"Consolas"},children:"Send notifications to Telegram chats or channels. Requires a bot token (from @BotFather) and a chat ID (channel or user ID). Supports both private chats and public channels."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:o.accent,marginBottom:4},children:"EMAIL"}),e.jsx("div",{style:{color:o.foreground,marginLeft:16,fontSize:11},children:"Send email notifications to specified email addresses. Requires a valid email address. Email notifications are sent as plain text or HTML depending on system configuration."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[R.blockFull," LOG LEVELS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.foreground,fontWeight:600,fontFamily:"Consolas"},children:"ERROR"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11,fontFamily:"Consolas"},children:"Critical errors that require immediate attention"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.muted,fontWeight:600,fontFamily:"Consolas"},children:"WARNING"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11,fontFamily:"Consolas"},children:"Warnings about potential issues or unexpected conditions"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600,fontFamily:"Consolas"},children:"INFO"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11,fontFamily:"Consolas"},children:"Informational messages about system operations"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.muted,fontWeight:600,fontFamily:"Consolas"},children:"DEBUG"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11,fontFamily:"Consolas"},children:"Detailed debugging information for troubleshooting"})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[R.blockFull," LOG CATEGORIES"]}),e.jsx("div",{style:{marginLeft:16},children:e.jsx("div",{style:{marginBottom:8},children:e.jsx("span",{style:{color:o.foreground,fontSize:11},children:"Filter notifications by log category (e.g., GOVERNANCE, SYNC, CATALOG, etc.). When no categories are selected, all categories are included. Select specific categories to receive notifications only for relevant system components."})})})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:o.accent,marginBottom:12},children:[R.blockFull," WEBHOOK STATUS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.accent,fontWeight:600,fontFamily:"Consolas"},children:"ENABLED"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11,fontFamily:"Consolas"},children:"Webhook is active and will receive notifications based on configured filters"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:o.muted,fontWeight:600,fontFamily:"Consolas"},children:"DISABLED"}),e.jsx("span",{style:{color:o.foreground,marginLeft:8,fontSize:11,fontFamily:"Consolas"},children:"Webhook is temporarily disabled and will not receive notifications"})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:o.backgroundSoft,borderRadius:2,border:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:o.muted,marginBottom:4},children:[R.blockSemi," Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:o.foreground},children:["â€¢ Use specific log levels and categories to avoid notification fatigue",e.jsx("br",{}),"â€¢ Test webhook endpoints before enabling in production",e.jsx("br",{}),"â€¢ Monitor webhook delivery success rates",e.jsx("br",{}),"â€¢ Use different webhooks for different severity levels",e.jsx("br",{}),"â€¢ Secure webhook URLs and API keys appropriately",e.jsx("br",{}),"â€¢ Enable webhooks only for critical events in high-volume systems"]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(F,{label:"Close",onClick:()=>P(!1),variant:"ghost"})})]})})})}),C==="webhooks"&&e.jsx(e.Fragment,{children:N.length===0?e.jsx(ce,{title:"NO WEBHOOKS",children:e.jsxs("div",{style:{padding:c.spacing.xl,textAlign:"center",fontSize:12,fontFamily:"Consolas",color:o.muted},children:[R.blockEmpty," No webhooks configured",e.jsx("br",{}),e.jsx("br",{}),e.jsx(F,{label:"Create First Webhook",onClick:O,variant:"primary"})]})}):e.jsx(Eo,{webhooks:N,onEdit:G,onDelete:w,onToggle:i})}),C==="alert-rules"&&e.jsx(Ro,{}),e.jsx(So,{isOpen:$,onClose:()=>{y(!1),S(null)},onSave:u,initialData:g})]})})};export{Fo as default};
