import{f as v,t as i,b as o,r as a,a5 as j,j as e,a3 as O,a4 as U,e as Y}from"./index-75d7470b.js";import{S as V}from"./SkeletonLoader-530eacc4.js";import{e as k}from"./errorHandler-5ea9ae85.js";import{A as L}from"./AsciiPanel-9f053981.js";import{A as u}from"./AsciiButton-446d8430.js";const H=v.table`
  width: 100%;
  border-collapse: collapse;
  margin-top: ${i.spacing.lg};
  background: ${i.colors.background.main};
  box-shadow: ${i.shadows.md};
  border-radius: ${i.borderRadius.md};
  overflow: hidden;
`,g=v.th`
  padding: ${i.spacing.sm};
  text-align: left;
  border-bottom: 2px solid ${o.border};
  background: ${o.backgroundSoft};
  font-weight: bold;
  font-family: "Consolas";
  font-size: 13px;
  color: ${o.accent};
  position: sticky;
  top: 0;
  z-index: 10;
`,c=v.td`
  padding: ${i.spacing.sm};
  border-bottom: 1px solid ${o.border};
  font-family: "Consolas";
  font-size: 12px;
  transition: all ${i.transitions.normal};
  word-break: break-word;
`,Q=v.tr`
  transition: all ${i.transitions.normal};
  
  &:hover {
    background: linear-gradient(90deg, ${i.colors.background.main} 0%, ${i.colors.background.tertiary} 100%);
    transform: scale(1.001);
    box-shadow: ${i.shadows.sm};
    
    ${c} {
      border-bottom-color: rgba(10, 25, 41, 0.1);
    }
  }
`,Z=()=>{const d=a.useRef(!0),[R,_]=a.useState(!0),[E,p]=a.useState(null),[C,z]=a.useState([]),[$,h]=a.useState(!1),[r,s]=a.useState(null),[n,S]=a.useState({schema_name:"",table_name:"",active:""}),[b,w]=a.useState(1),[y,P]=a.useState(0),f=20,x=a.useCallback(async()=>{if(!d.current)return;const t=Date.now(),l=300;try{_(!0),p(null);const m={page:b,limit:f};n.schema_name&&(m.schema_name=n.schema_name),n.table_name&&(m.table_name=n.table_name),n.active!==""&&(m.active=n.active==="true");const T=await j.getAll(m),M=Date.now()-t,N=Math.max(0,l-M);await new Promise(W=>setTimeout(W,N)),d.current&&(z(T.policies||[]),P(T.total||0))}catch(m){d.current&&p(k(m))}finally{d.current&&_(!1)}},[b,n]);a.useEffect(()=>(d.current=!0,x(),()=>{d.current=!1}),[x]);const A=a.useCallback(()=>{s({policy_name:"",schema_name:"",table_name:"",policy_expression:"",policy_type:"SELECT",description:"",active:!0}),h(!0)},[]),B=a.useCallback(t=>{s({...t}),h(!0)},[]),I=a.useCallback(async t=>{if(confirm("Are you sure you want to delete this RLS policy?"))try{await j.delete(t),x()}catch(l){d.current&&p(k(l))}},[x]),F=a.useCallback(async()=>{if(r)try{p(null),r.policy_id?await j.update(r.policy_id,r):await j.create(r),h(!1),x()}catch(t){d.current&&p(k(t))}},[r,x]),D={SELECT:"user_id = current_setting('app.user_id')::integer",INSERT:"user_id = current_setting('app.user_id')::integer",UPDATE:"user_id = current_setting('app.user_id')::integer",DELETE:"user_id = current_setting('app.user_id')::integer",ALL:"user_id = current_setting('app.user_id')::integer"};return R&&C.length===0?e.jsx(V,{variant:"table"}):e.jsxs(O,{children:[E&&e.jsx(U,{message:E,onClose:()=>p(null)}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(L,{title:"ROW-LEVEL SECURITY (RLS)",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(u,{label:`${Y.blockFull} Create RLS Policy`,onClick:A})}),e.jsxs("div",{style:{marginBottom:16,display:"flex",gap:12,flexWrap:"wrap"},children:[e.jsx("input",{type:"text",placeholder:"Schema name",value:n.schema_name,onChange:t=>S(l=>({...l,schema_name:t.target.value})),style:{padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,flex:1,minWidth:150}}),e.jsx("input",{type:"text",placeholder:"Table name",value:n.table_name,onChange:t=>S(l=>({...l,table_name:t.target.value})),style:{padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,flex:1,minWidth:150}}),e.jsxs("select",{value:n.active,onChange:t=>S(l=>({...l,active:t.target.value})),style:{padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,minWidth:120},children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs("div",{style:{marginBottom:12,fontSize:11,color:o.muted},children:["RLS Policies (",y,")"]}),e.jsxs(H,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(g,{children:"Policy Name"}),e.jsx(g,{children:"Schema.Table"}),e.jsx(g,{children:"Type"}),e.jsx(g,{children:"Expression"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Actions"})]})}),e.jsx("tbody",{children:C.length===0?e.jsx("tr",{children:e.jsx(c,{colSpan:6,style:{textAlign:"center",padding:20,color:o.muted},children:"No RLS policies found. Create one to get started."})}):C.map(t=>e.jsxs(Q,{children:[e.jsx(c,{children:t.policy_name}),e.jsx(c,{children:e.jsxs("code",{style:{color:o.accent},children:[t.schema_name,".",t.table_name]})}),e.jsx(c,{children:e.jsx("span",{style:{color:o.accent,fontWeight:600},children:t.policy_type})}),e.jsx(c,{children:e.jsx("code",{style:{color:o.muted,fontSize:11,maxWidth:400,display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t.policy_expression,children:t.policy_expression})}),e.jsx(c,{children:e.jsx("span",{style:{color:t.active?o.success:o.danger,fontWeight:600},children:t.active?"ACTIVE":"INACTIVE"})}),e.jsx(c,{children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(u,{label:"âœŽ",onClick:()=>B(t),variant:"ghost"}),e.jsx(u,{label:"ðŸ—‘ï¸",onClick:()=>I(t.policy_id),variant:"ghost"})]})})]},t.policy_id))})]}),y>f&&e.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:o.muted},children:["Page ",b," of ",Math.ceil(y/f)]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(u,{label:"â—€ Previous",onClick:()=>w(t=>Math.max(1,t-1)),disabled:b===1,variant:"ghost"}),e.jsx(u,{label:"Next â–¶",onClick:()=>w(t=>Math.min(Math.ceil(y/f),t+1)),disabled:b>=Math.ceil(y/f),variant:"ghost"})]})]})]})})}),$&&r&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:t=>{t.target===t.currentTarget&&h(!1)},children:e.jsx("div",{style:{backgroundColor:o.background,border:`2px solid ${o.border}`,borderRadius:2,width:"90%",maxWidth:700,maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:e.jsx(L,{title:r.policy_id?"EDIT RLS POLICY":"CREATE RLS POLICY",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Policy Name *"}),e.jsx("input",{type:"text",value:r.policy_name,onChange:t=>s(l=>l?{...l,policy_name:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Schema Name *"}),e.jsx("input",{type:"text",value:r.schema_name,onChange:t=>s(l=>l?{...l,schema_name:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Table Name *"}),e.jsx("input",{type:"text",value:r.table_name,onChange:t=>s(l=>l?{...l,table_name:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Policy Type *"}),e.jsxs("select",{value:r.policy_type,onChange:t=>s(l=>l?{...l,policy_type:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"SELECT",children:"SELECT"}),e.jsx("option",{value:"INSERT",children:"INSERT"}),e.jsx("option",{value:"UPDATE",children:"UPDATE"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"ALL",children:"ALL"})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Policy Expression (SQL) *"}),e.jsx("textarea",{value:r.policy_expression,onChange:t=>s(l=>l?{...l,policy_expression:t.target.value}:null),placeholder:D[r.policy_type],rows:4,style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,resize:"vertical"}}),e.jsx("div",{style:{marginTop:4,fontSize:10,color:o.muted},children:"Example: user_id = current_setting('app.user_id')::integer"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Description"}),e.jsx("textarea",{value:r.description||"",onChange:t=>s(l=>l?{...l,description:t.target.value}:null),rows:2,style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,resize:"vertical"}})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:t=>s(l=>l?{...l,active:t.target.checked}:null),style:{cursor:"pointer"}}),e.jsx("span",{style:{color:o.foreground,fontSize:12},children:"Active"})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:20},children:[e.jsx(u,{label:"Cancel",onClick:()=>h(!1),variant:"ghost"}),e.jsx(u,{label:"Save",onClick:F})]})]})})})})]})};export{Z as default};
