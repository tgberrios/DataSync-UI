import{r,i as y,j as e,t as s,b as t,e as a,k as C}from"./index-f6ac47b8.js";import{A as j}from"./AsciiPanel-5614714e.js";import{A as h}from"./AsciiButton-4907e65e.js";import{e as v}from"./errorHandler-5ea9ae85.js";import{S as W}from"./SkeletonLoader-792007e7.js";const I=()=>{const[l,b]=r.useState([]),[n,S]=r.useState(null),[m,k]=r.useState([]),[B,p]=r.useState(!0),[u,c]=r.useState(null),[d,w]=r.useState(""),[_,g]=r.useState(!1),f=r.useCallback(async()=>{try{p(!0),c(null);const i=await y.getTraces({service_name:d||void 0,limit:100});b(i.traces||i||[])}catch(i){c(v(i))}finally{p(!1)}},[d]),z=r.useCallback(async i=>{try{const o=await y.getTrace(i);S(o),k(o.spans||[])}catch(o){c(v(o))}},[]);r.useEffect(()=>{f()},[f]);const x=i=>i<1e3?`${i}μs`:i<1e6?`${(i/1e3).toFixed(2)}ms`:`${(i/1e6).toFixed(2)}s`;return B&&l.length===0?e.jsx(W,{}):e.jsx("div",{style:{padding:s.spacing.lg},children:e.jsx(j,{children:e.jsxs("div",{style:{marginBottom:s.spacing.lg},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:t.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:t.accent,marginRight:8},children:a.blockFull}),"DISTRIBUTED TRACING"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:s.spacing.lg,flexWrap:"wrap",gap:s.spacing.md},children:[e.jsx("p",{style:{color:t.muted,fontSize:12,margin:0},children:"View and analyze distributed traces across services"}),e.jsx(h,{label:"Playbook & How to use",onClick:()=>g(!0),variant:"ghost"})]}),e.jsxs("div",{style:{display:"flex",gap:s.spacing.md,marginBottom:s.spacing.lg,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Filter by service name",value:d,onChange:i=>w(i.target.value),style:{padding:`${s.spacing.sm} ${s.spacing.md}`,border:`1px solid ${t.border}`,background:t.background,color:t.foreground,fontFamily:"Consolas, monospace",fontSize:12,borderRadius:2}}),e.jsx(h,{label:"Refresh",onClick:f})]}),_&&C.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>g(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",minHeight:400,overflowY:"auto",flexShrink:0},onClick:i=>i.stopPropagation(),children:e.jsx(j,{title:"DISTRIBUTED TRACING - PLAYBOOK & HOW TO USE",animated:!1,children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Distributed Tracing lets you follow a single request as it flows across multiple services. Each trace is a full journey (e.g. API → ingestion → DB); each step is a span with name, service, duration, and status. Use this view to find slow or failed operations and understand where time is spent in your data pipelines."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," HOW TO USE"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"1. List traces"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:'Traces load automatically. Use "Refresh" to fetch the latest (up to 100).'})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"2. Filter by service"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Type a service name in the filter box and the list will show only traces for that service."})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"3. Select a trace"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Click a trace in the left column to load its spans in the right column."})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"4. Inspect spans"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Each span shows operation name, service, duration, status, and optional tags for debugging."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," KEY CONCEPTS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Trace"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"One end-to-end request; identified by trace_id. Contains one or more spans."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Span"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"A single operation (e.g. DB query, HTTP call). Has operation_name, service_name, duration, status, and optional tags."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Duration"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Shown in μs, ms, or s. Use it to spot slow steps in a trace."})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"Tags"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Key-value metadata on spans (e.g. query_id, batch_id) for filtering and debugging."})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.muted,marginBottom:4},children:[a.blockSemi," Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:t.foreground},children:["• Filter by service when investigating a specific component (e.g. ingestion or API).",e.jsx("br",{}),"• Focus on traces with high duration or many spans to find bottlenecks.",e.jsx("br",{}),"• Use span tags to correlate traces with batch_id, workflow_id, or query_id.",e.jsx("br",{}),"• Refresh after running pipelines to see new traces; keep the backend tracing enabled for data to appear."]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(h,{label:"Close",onClick:()=>g(!1),variant:"ghost"})})]})})})}),document.body),u&&e.jsx("div",{style:{padding:s.spacing.md,background:t.error,color:"#ffffff",marginBottom:s.spacing.md,borderRadius:2,fontSize:12},children:u}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:s.spacing.lg},children:[e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:14,fontWeight:600,color:t.foreground,marginBottom:s.spacing.md},children:["Traces (",l.length,")"]}),e.jsx("div",{style:{maxHeight:"600px",overflowY:"auto",border:`1px solid ${t.border}`,borderRadius:2},children:l.map(i=>e.jsxs("div",{onClick:()=>z(i.trace_id),style:{padding:s.spacing.md,borderBottom:`1px solid ${t.border}`,cursor:"pointer",background:(n==null?void 0:n.trace_id)===i.trace_id?t.accent:"transparent",color:(n==null?void 0:n.trace_id)===i.trace_id?"#ffffff":t.foreground,transition:"all 0.15s ease"},onMouseEnter:o=>{(n==null?void 0:n.trace_id)!==i.trace_id&&(o.currentTarget.style.background=t.backgroundSoft)},onMouseLeave:o=>{(n==null?void 0:n.trace_id)!==i.trace_id&&(o.currentTarget.style.background="transparent")},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:s.spacing.xs},children:i.service_name}),e.jsxs("div",{style:{fontSize:11,color:(n==null?void 0:n.trace_id)===i.trace_id?"#ffffff":t.muted},children:[i.trace_id.substring(0,8),"... | ",i.span_count," spans | ",x(i.duration_microseconds)]})]},i.trace_id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:14,fontWeight:600,color:t.foreground,marginBottom:s.spacing.md},children:["Spans ",n&&`(${m.length})`]}),n?e.jsx("div",{style:{maxHeight:"600px",overflowY:"auto",border:`1px solid ${t.border}`,borderRadius:2},children:m.map(i=>e.jsxs("div",{style:{padding:s.spacing.md,borderBottom:`1px solid ${t.border}`,marginLeft:i.parent_span_id?s.spacing.lg:0},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:s.spacing.xs},children:i.operation_name}),e.jsxs("div",{style:{fontSize:11,color:t.muted,marginBottom:s.spacing.xs},children:[i.service_name," | ",x(i.duration_microseconds)," | ",i.status]}),i.tags&&Object.keys(i.tags).length>0&&e.jsxs("div",{style:{fontSize:10,color:t.muted},children:["Tags: ",Object.entries(i.tags).map(([o,T])=>`${o}=${T}`).join(", ")]})]},i.span_id))}):e.jsx("div",{style:{padding:s.spacing.lg,textAlign:"center",color:t.muted},children:"Select a trace to view spans"})]})]})]})})})};export{I as default};
