import{r,j as e,t,b as s,e as m,f as oe,a as E,C as Le,o as Te}from"./index-f6ac47b8.js";import{S as we}from"./SkeletonLoader-792007e7.js";import{e as I}from"./errorHandler-5ea9ae85.js";import{A as W}from"./AsciiPanel-5614714e.js";import{A as F}from"./AsciiButton-4907e65e.js";const Re=({policies:w,onEdit:H,onDelete:N,onAnalyze:O})=>{const[v,G]=r.useState(new Set),[ae,X]=r.useState(new Set),[M,C]=r.useState(new Set),k=r.useMemo(()=>{const a=new Map;return w.forEach(b=>{const g=b.schema_name||"Other",p=b.table_name||"Other",d=b.column_name||"Other";a.has(g)||a.set(g,{name:g,tables:new Map});const f=a.get(g);f.tables.has(p)||f.tables.set(p,{name:p,columns:new Map});const y=f.tables.get(p);y.columns.has(d)||y.columns.set(d,{name:d,policies:[]}),y.columns.get(d).policies.push(b)}),Array.from(a.values()).sort((b,g)=>b.name.localeCompare(g.name))},[w]),_=a=>{G(b=>{const g=new Set(b);if(g.has(a)){g.delete(a);const p=k.find(d=>d.name===a);p&&p.tables.forEach(d=>{const f=`${a}.${d.name}`;X(y=>{const j=new Set(y);return j.delete(f),j}),d.columns.forEach(y=>{const j=`${a}.${d.name}.${y.name}`;C(S=>{const R=new Set(S);return R.delete(j),R})})})}else g.add(a);return g})},D=(a,b)=>{const g=`${a}.${b}`;X(p=>{const d=new Set(p);if(d.has(g)){d.delete(g);const f=k.find(y=>y.name===a);if(f){const y=f.tables.get(b);y&&y.columns.forEach(j=>{const S=`${a}.${b}.${j.name}`;C(R=>{const l=new Set(R);return l.delete(S),l})})}}else d.add(g);return d})},q=(a,b,g)=>{const p=`${a}.${b}.${g}`;C(d=>{const f=new Set(d);return f.has(p)?f.delete(p):f.add(p),f})},Z=(a,b)=>{if(a===0)return null;const g=[];for(let p=0;p<a-1;p++)g.push(`${m.v}  `);return b?g.push(`${m.bl}${m.h}${m.h} `):g.push(`${m.tRight}${m.h}${m.h} `),e.jsx("span",{style:{color:s.border,marginRight:6,fontFamily:"Consolas",fontSize:11},children:g.join("")})},re=a=>{switch(a){case"FULL":return s.foreground;case"PARTIAL":return s.muted;case"EMAIL":return s.accent;case"PHONE":return s.accent;case"HASH":return s.muted;case"TOKENIZE":return s.accent;default:return s.muted}},J=a=>a==="ACTIVE"?s.accent:a==="INACTIVE"?s.muted:s.muted,ie=a=>a?new Date(a).toLocaleString():"-";return w.length===0?e.jsx("div",{style:{padding:t.spacing.lg,textAlign:"center",color:s.muted,fontFamily:"Consolas",fontSize:12},children:"No masking policies found. Create one to get started."}):e.jsx("div",{style:{fontFamily:"Consolas",fontSize:12,color:s.foreground},children:k.map((a,b)=>{const g=v.has(a.name),p=Array.from(a.tables.values());return k.length-1,e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("div",{onClick:()=>_(a.name),style:{display:"flex",alignItems:"center",padding:"10px 8px",cursor:"pointer",borderLeft:`2px solid ${s.accent}`,backgroundColor:g?s.backgroundSoft:s.background,transition:"all 0.15s ease",marginBottom:2},onMouseEnter:d=>{d.currentTarget.style.backgroundColor=s.backgroundSoft},onMouseLeave:d=>{g||(d.currentTarget.style.backgroundColor=s.background)},children:[e.jsx("span",{style:{marginRight:8,color:g?s.accent:s.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:g?"rotate(90deg)":"rotate(0deg)"},children:m.arrowRight}),e.jsx("span",{style:{fontWeight:600,color:s.accent,fontSize:12,flex:1},children:a.name}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${s.border}`,backgroundColor:s.backgroundSoft,color:s.foreground},children:p.reduce((d,f)=>d+Array.from(f.columns.values()).reduce((y,j)=>y+j.policies.length,0),0)})]}),g&&e.jsx("div",{style:{paddingLeft:24},children:p.map((d,f)=>{const y=`${a.name}.${d.name}`,j=ae.has(y),S=Array.from(d.columns.values()),R=f===p.length-1;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>D(a.name,d.name),style:{display:"flex",alignItems:"center",padding:"8px 8px",marginLeft:8,marginBottom:2,borderLeft:`2px solid ${s.border}`,backgroundColor:j?s.backgroundSoft:"transparent",transition:"all 0.15s ease",cursor:"pointer"},onMouseEnter:l=>{l.currentTarget.style.backgroundColor=s.backgroundSoft,l.currentTarget.style.borderLeftColor=s.accent},onMouseLeave:l=>{j||(l.currentTarget.style.backgroundColor="transparent",l.currentTarget.style.borderLeftColor=s.border)},children:[Z(1,R),e.jsx("span",{style:{marginRight:8,color:j?s.accent:s.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:j?"rotate(90deg)":"rotate(0deg)"},children:m.arrowRight}),e.jsx("span",{style:{fontWeight:600,color:s.foreground,fontSize:11,flex:1},children:d.name}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${s.border}`,backgroundColor:"transparent",color:s.muted},children:S.reduce((l,z)=>l+z.policies.length,0)}),e.jsx(F,{label:"Analyze",onClick:l=>{l.stopPropagation(),O==null||O(a.name,d.name)},variant:"ghost",style:{marginLeft:8,fontSize:10,padding:"2px 6px"}})]}),j&&e.jsx("div",{style:{paddingLeft:24},children:S.map((l,z)=>{const Q=`${a.name}.${d.name}.${l.name}`,U=M.has(Q),le=z===S.length-1;return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>q(a.name,d.name,l.name),style:{display:"flex",alignItems:"center",padding:"6px 8px",marginLeft:8,marginBottom:2,borderLeft:`1px solid ${s.border}`,backgroundColor:U?s.backgroundSoft:"transparent",transition:"all 0.15s ease",cursor:"pointer"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor=s.backgroundSoft,u.currentTarget.style.borderLeftColor=s.accent},onMouseLeave:u=>{U||(u.currentTarget.style.backgroundColor="transparent",u.currentTarget.style.borderLeftColor=s.border)},children:[Z(2,le),e.jsx("span",{style:{marginRight:8,color:U?s.accent:s.muted,fontSize:10,transition:"transform 0.15s ease",display:"inline-block",transform:U?"rotate(90deg)":"rotate(0deg)"},children:m.arrowRight}),e.jsx("span",{style:{fontWeight:500,color:s.accent,fontSize:11,flex:1},children:l.name}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${s.border}`,backgroundColor:"transparent",color:s.muted},children:l.policies.length})]}),U&&e.jsx("div",{style:{paddingLeft:24},children:l.policies.map((u,h)=>{const Y=h===l.policies.length-1;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:"8px 8px",marginLeft:8,marginBottom:2,borderLeft:`1px solid ${s.border}`,backgroundColor:"transparent",transition:"all 0.15s ease"},onMouseEnter:x=>{x.currentTarget.style.backgroundColor=s.backgroundSoft,x.currentTarget.style.borderLeftColor=s.accent},onMouseLeave:x=>{x.currentTarget.style.backgroundColor="transparent",x.currentTarget.style.borderLeftColor=s.border},children:[Z(3,Y),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontWeight:600,color:s.foreground,fontSize:11},children:u.policy_name}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${re(u.masking_type)}`,color:re(u.masking_type),backgroundColor:"transparent"},children:u.masking_type}),e.jsx("span",{style:{padding:"2px 6px",borderRadius:2,fontSize:10,fontWeight:500,border:`1px solid ${J(u.active?"ACTIVE":"INACTIVE")}`,color:J(u.active?"ACTIVE":"INACTIVE"),backgroundColor:"transparent"},children:u.active?"ACTIVE":"INACTIVE"})]}),e.jsx("div",{style:{fontSize:10,color:s.muted,marginBottom:4},children:u.role_whitelist&&u.role_whitelist.length>0?`Roles: ${u.role_whitelist.join(", ")}`:"No role restrictions"}),e.jsxs("div",{style:{fontSize:10,color:s.muted},children:["Created: ",ie(u.created_at||"")]})]}),e.jsxs("div",{style:{display:"flex",gap:4,marginLeft:8},children:[e.jsx(F,{label:"Edit",onClick:x=>{x.stopPropagation(),H==null||H(u)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}}),u.policy_id&&e.jsx(F,{label:"Delete",onClick:x=>{x.stopPropagation(),N==null||N(u.policy_id)},variant:"ghost",style:{fontSize:10,padding:"2px 6px"}})]})]},u.policy_id||h)})})]},Q)})})]},y)})})]},a.name)})})},fe=oe.table`
  width: 100%;
  border-collapse: collapse;
  margin-top: ${t.spacing.lg};
  background: ${s.background};
  border-radius: 2;
  overflow: hidden;
  font-family: 'Consolas';
`,L=oe.th`
  padding: ${t.spacing.sm};
  text-align: left;
  border-bottom: 2px solid ${s.border};
  background: ${s.backgroundSoft};
  font-weight: 600;
  font-family: 'Consolas';
  font-size: 13px;
  color: ${s.accent};
  position: sticky;
  top: 0;
  z-index: 10;
`,T=oe.td`
  padding: ${t.spacing.sm};
  border-bottom: 1px solid ${s.border};
  font-family: 'Consolas';
  font-size: 12px;
  transition: background-color 0.15s ease;
`,ye=oe.tr`
  transition: background-color 0.15s ease;
`,xe=w=>{switch(w){case"FULL":return s.foreground;case"PARTIAL":return s.muted;case"EMAIL":return s.accent;case"PHONE":return s.accent;case"HASH":return s.muted;case"TOKENIZE":return s.accent;default:return s.muted}},Ne=()=>{const w=r.useRef(!0),[H,N]=r.useState(!0),[O,v]=r.useState(null),[G,ae]=r.useState([]),[X,M]=r.useState(!1),[C,k]=r.useState(null),[_,D]=r.useState({schema_name:"",table_name:"",masking_type:"",active:""}),[q,Z]=r.useState(1),[re,J]=r.useState(0),ie=20,[a,b]=r.useState(null),[g,p]=r.useState(!1),[d,f]=r.useState(!1),[y,j]=r.useState(!1),[S,R]=r.useState(null),[l,z]=r.useState({database_name:"",database_names:[],schema_name:"",masking_type:"FULL",auto_activate:!0,min_confidence:.75}),[Q,U]=r.useState([]),[le,u]=r.useState(!1),[h,Y]=r.useState("policies"),[x,ee]=r.useState([]),[$,se]=r.useState([]),[ue,te]=r.useState(!1),[pe,ne]=r.useState(!1),V=r.useRef(!1),K=r.useRef(!1),ce=r.useRef(null),de=r.useRef(null),[he,ge]=r.useState(!1),me=[{value:"FULL",label:"Full Mask (***MASKED***)"},{value:"PARTIAL",label:"Partial Mask (j***@email.com)"},{value:"EMAIL",label:"Email Mask (j***@email.com)"},{value:"PHONE",label:"Phone Mask (555-****)"},{value:"HASH",label:"Hash (SHA256)"},{value:"TOKENIZE",label:"Tokenize (TOKEN_xxx)"}],A=r.useCallback(async()=>{if(!w.current)return;const n=Date.now(),o=300;try{N(!0),v(null);const i={page:q,limit:ie};_.schema_name&&(i.schema_name=_.schema_name),_.table_name&&(i.table_name=_.table_name),_.masking_type&&(i.masking_type=_.masking_type),_.active!==""&&(i.active=_.active==="true");const c=await E.getAll(i),B=Date.now()-n,$e=Math.max(0,o-B);await new Promise(Ee=>setTimeout(Ee,$e)),w.current&&(ae(c.policies||[]),J(c.total||0))}catch(i){w.current&&v(I(i))}finally{w.current&&N(!1)}},[q,_]);r.useEffect(()=>(w.current=!0,A(),()=>{w.current=!1}),[A]);const be=r.useCallback(()=>{k({policy_name:"",schema_name:"",table_name:"",column_name:"",masking_type:"FULL",masking_algorithm:"random",preserve_format:!1,mask_char:"*",visible_chars:0,hash_algorithm:"SHA256",active:!0}),M(!0)},[]),ve=r.useCallback(n=>{k({...n}),M(!0)},[]),Ce=r.useCallback(async n=>{if(confirm("Are you sure you want to delete this masking policy?"))try{await E.delete(n),await A()}catch(o){v(I(o))}},[A]),je=r.useCallback(async()=>{if(C)try{C.policy_id?await E.update(C.policy_id,C):await E.create(C),M(!1),k(null),await A()}catch(n){v(I(n))}},[C,A]),Se=r.useCallback(async(n,o)=>{try{N(!0);const i=await E.analyzeSensitiveColumns(n,o);i.columns&&i.columns.length>0?alert(`Found ${i.columns.length} potentially sensitive columns:
${i.columns.map(c=>`- ${c.column_name} (${c.pii_category||"Unknown"})`).join(`
`)}`):alert("No sensitive columns detected.")}catch(i){v(I(i))}finally{N(!1)}},[]),P=r.useCallback(async()=>{try{p(!0);const n=await E.getStatus();b(n)}catch(n){v(I(n))}finally{p(!1)}},[]),ke=r.useCallback(async()=>{try{j(!0),v(null);const n={schema_name:l.schema_name,masking_type:l.masking_type,auto_activate:l.auto_activate,min_confidence:l.min_confidence};l.database_names&&l.database_names.length>0?n.database_names=l.database_names:l.database_name&&(n.database_name=l.database_name);const o=await E.batchAnalyze(n);R(o),await A(),await P()}catch(n){v(I(n))}finally{j(!1)}},[l,A,P]),_e=r.useCallback(async()=>{if(confirm("Are you sure you want to deactivate ALL masking policies? This will disable masking for all columns."))try{u(!0),v(null);const n=await E.deactivateAll();alert(`Successfully deactivated ${n.deactivated_count} masking policies.`),await A(),await P()}catch(n){v(I(n))}finally{u(!1)}},[A,P]);r.useEffect(()=>{h==="sensitive"&&ce.current!=="sensitive"&&!ue&&!V.current?(ce.current="sensitive",V.current=!0,(async()=>{try{te(!0),v(null);const o=await E.getSensitiveColumns();ee(o.columns||[])}catch(o){v(I(o)),ee([{_error:!0}])}finally{te(!1),V.current=!1}})()):h!=="sensitive"&&(ce.current=null)},[h]),r.useEffect(()=>{h==="unprotected"&&de.current!=="unprotected"&&!pe&&!K.current?(de.current="unprotected",K.current=!0,(async()=>{try{ne(!0),v(null);const o=await E.getUnprotectedColumns();se(o.columns||[])}catch(o){v(I(o)),se([{_error:!0}])}finally{ne(!1),K.current=!1}})()):h!=="unprotected"&&(de.current=null)},[h]),r.useEffect(()=>{P(),Fe(),(async()=>{if(!V.current){V.current=!0;try{te(!0);const o=await E.getSensitiveColumns();ee(o.columns||[])}catch(o){v(I(o)),ee([{_error:!0}])}finally{te(!1),V.current=!1}}if(!K.current){K.current=!0;try{ne(!0);const o=await E.getUnprotectedColumns();se(o.columns||[])}catch(o){v(I(o)),se([{_error:!0}])}finally{ne(!1),K.current=!1}}})()},[P]);const Fe=r.useCallback(async()=>{try{const n=await E.getAvailableDatabases();n.databases&&n.databases.length>0&&U(n.databases)}catch(n){console.error("Error fetching databases:",n)}},[]);return H&&G.length===0?e.jsx(we,{variant:"table"}):e.jsxs(Le,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:t.spacing.lg,paddingBottom:t.spacing.md,borderBottom:`2px solid ${s.accent}`},children:e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:s.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:s.accent,marginRight:t.spacing.sm},children:m.blockFull}),"DATA MASKING"]})}),O&&e.jsx("div",{style:{marginBottom:t.spacing.md},children:e.jsx(W,{title:"ERROR",children:e.jsx("div",{style:{padding:t.spacing.sm,color:s.foreground,fontSize:12,fontFamily:"Consolas",backgroundColor:s.backgroundSoft,borderRadius:2},children:O})})}),a&&a.overall_summary&&e.jsxs(W,{title:"MASKING STATUS OVERVIEW",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:t.spacing.md,padding:t.spacing.md,fontFamily:"Consolas",fontSize:11},children:[e.jsxs("div",{style:{padding:t.spacing.lg,minHeight:"100px",background:s.backgroundSoft,border:`1px solid ${s.border}`,borderLeft:`2px solid ${s.accent}`,borderRadius:2,transition:"background-color 0.15s ease",position:"relative",fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{fontSize:11,color:s.muted,marginBottom:t.spacing.sm,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Consolas",display:"flex",alignItems:"center",gap:t.spacing.xs},children:"Total Tables"}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:s.accent,fontFamily:"Consolas"},children:a.overall_summary.total_tables})]}),e.jsxs("div",{style:{padding:t.spacing.lg,minHeight:"100px",background:s.backgroundSoft,border:`1px solid ${s.border}`,borderLeft:`2px solid ${s.muted}`,borderRadius:2,transition:"background-color 0.15s ease",position:"relative",fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{fontSize:11,color:s.muted,marginBottom:t.spacing.sm,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Consolas",display:"flex",alignItems:"center",gap:t.spacing.xs},children:"Sensitive Columns"}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:s.muted,fontFamily:"Consolas"},children:(()=>x.filter(o=>!o._error).length||a.overall_summary.sensitive_columns)()})]}),e.jsxs("div",{style:{padding:t.spacing.lg,minHeight:"100px",background:s.backgroundSoft,border:`1px solid ${s.border}`,borderLeft:`2px solid ${s.accent}`,borderRadius:2,transition:"background-color 0.15s ease",position:"relative",fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{fontSize:11,color:s.muted,marginBottom:t.spacing.sm,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Consolas",display:"flex",alignItems:"center",gap:t.spacing.xs},children:"Protected"}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:s.accent,fontFamily:"Consolas"},children:(()=>{const n=x.filter(i=>!i._error).length,o=$.filter(i=>!i._error).length;return n>0?n-o:a.overall_summary.columns_with_policies})()})]}),e.jsxs("div",{style:{padding:t.spacing.lg,minHeight:"100px",background:s.backgroundSoft,border:`1px solid ${s.border}`,borderLeft:`2px solid ${s.foreground}`,borderRadius:2,transition:"background-color 0.15s ease",position:"relative",fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{fontSize:11,color:s.muted,marginBottom:t.spacing.sm,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Consolas",display:"flex",alignItems:"center",gap:t.spacing.xs},children:"Unprotected"}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:s.foreground,fontFamily:"Consolas"},children:$.filter(n=>!n._error).length})]}),e.jsxs("div",{style:{padding:t.spacing.lg,minHeight:"100px",background:s.backgroundSoft,border:`1px solid ${s.border}`,borderLeft:`2px solid ${(()=>{const n=x.filter(c=>!c._error).length,o=$.filter(c=>!c._error).length,i=n>0?(n-o)/n*100:a.overall_summary.coverage_percentage;return i>=90?s.accent:i>=70?s.muted:s.foreground})()}`,borderRadius:2,transition:"background-color 0.15s ease",position:"relative",fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{fontSize:11,color:s.muted,marginBottom:t.spacing.sm,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Consolas",display:"flex",alignItems:"center",gap:t.spacing.xs},children:"Coverage"}),e.jsxs("div",{style:{fontSize:18,fontWeight:700,color:(()=>{const n=x.filter(c=>!c._error).length,o=$.filter(c=>!c._error).length,i=n>0?(n-o)/n*100:a.overall_summary.coverage_percentage;return i>=90?s.accent:i>=70?s.muted:s.foreground})(),fontFamily:"Consolas"},children:[(()=>{const n=x.filter(c=>!c._error).length,o=$.filter(c=>!c._error).length;return(n>0?(n-o)/n*100:a.overall_summary.coverage_percentage).toFixed(1)})(),"%"]})]}),e.jsxs("div",{style:{padding:t.spacing.lg,minHeight:"100px",background:s.backgroundSoft,border:`1px solid ${s.border}`,borderLeft:`2px solid ${(()=>{const n=x.filter(B=>!B._error).length,o=$.filter(B=>!B._error).length,i=n>0?(n-o)/n*100:a.overall_summary.coverage_percentage,c=i>=90?"EXCELLENT":i>=70?"GOOD":i>=50?"FAIR":i>0?"POOR":"NONE";return c==="EXCELLENT"?s.accent:c==="GOOD"?s.muted:c==="FAIR"?s.muted:s.foreground})()}`,borderRadius:2,transition:"background-color 0.15s ease",position:"relative",fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{fontSize:11,color:s.muted,marginBottom:t.spacing.sm,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Consolas",display:"flex",alignItems:"center",gap:t.spacing.xs},children:"Status"}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:(()=>{const n=x.filter(B=>!B._error).length,o=$.filter(B=>!B._error).length,i=n>0?(n-o)/n*100:a.overall_summary.coverage_percentage,c=i>=90?"EXCELLENT":i>=70?"GOOD":i>=50?"FAIR":i>0?"POOR":"NONE";return c==="EXCELLENT"?s.accent:c==="GOOD"?s.muted:c==="FAIR"?s.muted:s.foreground})(),fontFamily:"Consolas"},children:(()=>{const n=x.filter(c=>!c._error).length,o=$.filter(c=>!c._error).length,i=n>0?(n-o)/n*100:a.overall_summary.coverage_percentage;return i>=90?"EXCELLENT":i>=70?"GOOD":i>=50?"FAIR":i>0?"POOR":"NONE"})()})]})]}),e.jsxs("div",{style:{marginTop:t.spacing.md,padding:t.spacing.sm,borderTop:`1px solid ${s.border}`,display:"flex",gap:t.spacing.sm,justifyContent:"flex-end"},children:[e.jsx(F,{label:"Masking Info",onClick:()=>ge(!0),variant:"ghost"}),e.jsx(F,{label:"Refresh Status",onClick:P,variant:"ghost",disabled:g})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:t.spacing.md,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",gap:t.spacing.sm},children:[e.jsx(F,{label:`${m.blockFull} Create Masking Policy`,onClick:be,variant:"primary"}),e.jsx(F,{label:`${m.blockFull} Batch Analyze & Create`,onClick:()=>f(!0),variant:"primary"}),e.jsx(F,{label:`${m.blockFull} Deactivate All Masking`,onClick:_e,variant:"ghost",disabled:le})]}),e.jsxs("div",{style:{display:"flex",gap:t.spacing.sm},children:[e.jsx("input",{type:"text",placeholder:"Schema...",value:_.schema_name,onChange:n=>D(o=>({...o,schema_name:n.target.value})),style:{padding:`${t.spacing.xs} ${t.spacing.sm}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:11,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}}),e.jsx("input",{type:"text",placeholder:"Table...",value:_.table_name,onChange:n=>D(o=>({...o,table_name:n.target.value})),style:{padding:`${t.spacing.xs} ${t.spacing.sm}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:11,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}}),e.jsxs("select",{value:_.masking_type,onChange:n=>D(o=>({...o,masking_type:n.target.value})),style:{padding:`${t.spacing.xs} ${t.spacing.sm}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:11,outline:"none",transition:"border-color 0.15s ease",cursor:"pointer"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"},children:[e.jsx("option",{value:"",children:"All Types"}),me.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]}),e.jsxs("select",{value:_.active,onChange:n=>D(o=>({...o,active:n.target.value})),style:{padding:`${t.spacing.xs} ${t.spacing.sm}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:11,outline:"none",transition:"border-color 0.15s ease",cursor:"pointer"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"},children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:t.spacing.sm,marginBottom:t.spacing.md,borderBottom:`2px solid ${s.border}`},children:[e.jsxs("button",{onClick:()=>Y("policies"),style:{padding:`${t.spacing.sm} ${t.spacing.md}`,border:"none",borderBottom:h==="policies"?`3px solid ${s.accent}`:"3px solid transparent",background:"transparent",color:h==="policies"?s.accent:s.muted,fontFamily:"Consolas",fontSize:12,fontWeight:h==="policies"?600:"normal",cursor:"pointer",transition:"border-color 0.15s ease, color 0.15s ease"},children:["Masking Policies (",G.length,")"]}),e.jsxs("button",{onClick:()=>Y("sensitive"),style:{padding:`${t.spacing.sm} ${t.spacing.md}`,border:"none",borderBottom:h==="sensitive"?`3px solid ${s.accent}`:"3px solid transparent",background:"transparent",color:h==="sensitive"?s.accent:s.muted,fontFamily:"Consolas",fontSize:12,fontWeight:h==="sensitive"?600:"normal",cursor:"pointer",transition:"border-color 0.15s ease, color 0.15s ease"},children:["Sensitive Columns (",x.filter(n=>!n._error).length,")"]}),e.jsxs("button",{onClick:()=>Y("unprotected"),style:{padding:`${t.spacing.sm} ${t.spacing.md}`,border:"none",borderBottom:h==="unprotected"?`3px solid ${s.foreground}`:"3px solid transparent",background:"transparent",color:h==="unprotected"?s.foreground:s.muted,fontFamily:"Consolas",fontSize:12,fontWeight:h==="unprotected"?600:"normal",cursor:"pointer",transition:"border-color 0.15s ease, color 0.15s ease"},children:["Unprotected (",$.filter(n=>!n._error).length,")"]})]}),h==="policies"&&e.jsxs(W,{title:"MASKING POLICIES",children:[H&&e.jsx(Te,{}),e.jsx(Re,{policies:G,onEdit:ve,onDelete:Ce,onAnalyze:Se})]}),h==="sensitive"&&e.jsx(W,{title:`SENSITIVE COLUMNS (${x.length})`,children:ue?e.jsx("div",{style:{textAlign:"center",padding:t.spacing.lg,color:s.muted},children:"Loading..."}):x.length===0?e.jsx("div",{style:{textAlign:"center",padding:t.spacing.lg,color:s.muted},children:"No sensitive columns found"}):e.jsxs("div",{style:{maxHeight:"600px",overflowY:"auto"},children:[e.jsx("style",{children:`
                div[style*="overflowY"]::-webkit-scrollbar {
                  width: 0px;
                  display: none;
                }
                div[style*="overflowY"] {
                  -ms-overflow-style: none;
                  scrollbar-width: none;
                }
              `}),e.jsxs(fe,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(L,{children:"Schema"}),e.jsx(L,{children:"Table"}),e.jsx(L,{children:"Column"}),e.jsx(L,{children:"Data Type"}),e.jsx(L,{children:"PII Category"}),e.jsx(L,{children:"Confidence"})]})}),e.jsx("tbody",{children:x.filter(n=>!n._error).map((n,o)=>e.jsxs(ye,{children:[e.jsx(T,{style:{fontFamily:"Consolas"},children:n.schema_name}),e.jsx(T,{style:{fontFamily:"Consolas"},children:n.table_name}),e.jsx(T,{style:{fontFamily:"Consolas"},children:n.column_name}),e.jsx(T,{style:{fontFamily:"Consolas"},children:n.data_type}),e.jsx(T,{children:e.jsx("span",{style:{color:xe(n.pii_category),fontFamily:"Consolas"},children:n.pii_category})}),e.jsxs(T,{style:{fontFamily:"Consolas"},children:[(n.confidence_score*100).toFixed(0),"%"]})]},o))})]})]})}),h==="unprotected"&&e.jsx(W,{title:`UNPROTECTED COLUMNS (${$.filter(n=>!n._error).length})`,children:pe?e.jsx("div",{style:{textAlign:"center",padding:t.spacing.lg,color:s.muted},children:"Loading..."}):$.length===0||$.length===1&&$[0]._error?e.jsx("div",{style:{textAlign:"center",padding:t.spacing.lg,color:O?s.foreground:s.accent,fontFamily:"Consolas"},children:O?`Error: ${O}`:"All sensitive columns are protected! ðŸŽ‰"}):e.jsx("div",{style:{maxHeight:"600px",overflowY:"auto"},children:e.jsxs(fe,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(L,{children:"Schema"}),e.jsx(L,{children:"Table"}),e.jsx(L,{children:"Column"}),e.jsx(L,{children:"Data Type"}),e.jsx(L,{children:"PII Category"}),e.jsx(L,{children:"Confidence"}),e.jsx(L,{children:"Action"})]})}),e.jsx("tbody",{children:$.filter(n=>!n._error).map((n,o)=>e.jsxs(ye,{children:[e.jsx(T,{style:{fontFamily:"Consolas"},children:n.schema_name}),e.jsx(T,{style:{fontFamily:"Consolas"},children:n.table_name}),e.jsx(T,{style:{fontFamily:"Consolas"},children:n.column_name}),e.jsx(T,{style:{fontFamily:"Consolas"},children:n.data_type}),e.jsx(T,{children:e.jsx("span",{style:{color:xe(n.pii_category),fontFamily:"Consolas"},children:n.pii_category})}),e.jsxs(T,{style:{fontFamily:"Consolas"},children:[(n.confidence_score*100).toFixed(0),"%"]}),e.jsx(T,{children:e.jsx(F,{label:"Create Policy",onClick:()=>{k({policy_name:`${n.schema_name}_${n.table_name}_${n.column_name}_mask`,schema_name:n.schema_name,table_name:n.table_name,column_name:n.column_name,masking_type:n.pii_category==="EMAIL"?"EMAIL":n.pii_category==="PHONE"?"PHONE":"FULL",active:!0}),Y("policies"),M(!0)},variant:"ghost"})})]},o))})]})})}),X&&C&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,fontFamily:"Consolas"},onClick:()=>M(!1),children:e.jsxs("div",{style:{backgroundColor:s.background,border:`2px solid ${s.border}`,borderRadius:2,padding:t.spacing.lg,maxWidth:"600px",width:"90%",maxHeight:"90vh",overflowY:"auto"},onClick:n=>n.stopPropagation(),children:[e.jsx("style",{children:`
              div[style*="overflowY"]::-webkit-scrollbar {
                width: 0px;
                display: none;
              }
              div[style*="overflowY"] {
                -ms-overflow-style: none;
                scrollbar-width: none;
              }
            `}),e.jsx(W,{title:C.policy_id?"EDIT POLICY":"CREATE POLICY",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:t.spacing.md,padding:t.spacing.md,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Policy Name *"}),e.jsx("input",{type:"text",value:C.policy_name,onChange:n=>k(o=>o?{...o,policy_name:n.target.value}:null),style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:t.spacing.sm},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Schema Name *"}),e.jsx("input",{type:"text",value:C.schema_name,onChange:n=>k(o=>o?{...o,schema_name:n.target.value}:null),style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Table Name *"}),e.jsx("input",{type:"text",value:C.table_name,onChange:n=>k(o=>o?{...o,table_name:n.target.value}:null),style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Column Name *"}),e.jsx("input",{type:"text",value:C.column_name,onChange:n=>k(o=>o?{...o,column_name:n.target.value}:null),style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Masking Type *"}),e.jsx("select",{value:C.masking_type,onChange:n=>k(o=>o?{...o,masking_type:n.target.value}:null),style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease",cursor:"pointer"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"},children:me.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Active"}),e.jsx("input",{type:"checkbox",checked:C.active,onChange:n=>k(o=>o?{...o,active:n.target.checked}:null),style:{width:"20px",height:"20px",cursor:"pointer"}})]}),e.jsxs("div",{style:{display:"flex",gap:t.spacing.sm,marginTop:t.spacing.md},children:[e.jsx(F,{label:"Save",onClick:je,variant:"primary"}),e.jsx(F,{label:"Cancel",onClick:()=>{M(!1),k(null)},variant:"ghost"})]})]})})]})}),d&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,fontFamily:"Consolas"},onClick:()=>{y||(f(!1),R(null))},children:e.jsxs("div",{style:{backgroundColor:s.background,border:`2px solid ${s.border}`,borderRadius:2,padding:t.spacing.lg,maxWidth:"700px",width:"90%",maxHeight:"90vh",overflowY:"auto"},onClick:n=>n.stopPropagation(),children:[e.jsx("style",{children:`
              div[style*="overflowY"]::-webkit-scrollbar {
                width: 0px;
                display: none;
              }
              div[style*="overflowY"] {
                -ms-overflow-style: none;
                scrollbar-width: none;
              }
            `}),e.jsx(W,{title:"BATCH ANALYZE & CREATE POLICIES",children:S?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:t.spacing.md},children:[e.jsxs("div",{style:{padding:t.spacing.md,background:s.backgroundSoft,borderRadius:2,fontSize:12,fontFamily:"Consolas"},children:[e.jsx("div",{style:{marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:e.jsx("strong",{children:"Batch Analysis Complete!"})}),e.jsxs("div",{style:{fontFamily:"Consolas"},children:["Total Analyzed: ",S.total_analyzed]}),e.jsxs("div",{style:{color:s.accent,fontFamily:"Consolas"},children:["Policies Created: ",S.policies_created]}),e.jsxs("div",{style:{color:s.muted,fontFamily:"Consolas"},children:["Policies Skipped: ",S.policies_skipped]})]}),S.results&&S.results.length>0&&e.jsxs("div",{style:{maxHeight:"300px",overflowY:"auto"},children:[e.jsx("style",{children:`
                        div[style*="overflowY"]::-webkit-scrollbar {
                          width: 0px;
                          display: none;
                        }
                        div[style*="overflowY"] {
                          -ms-overflow-style: none;
                          scrollbar-width: none;
                        }
                      `}),e.jsx("div",{style:{fontSize:11,color:s.muted,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:"Results:"}),S.results.slice(0,20).map((n,o)=>e.jsxs("div",{style:{padding:t.spacing.xs,marginBottom:t.spacing.xs,background:n.policy_created?s.backgroundSoft:s.background,borderRadius:2,fontSize:10,fontFamily:"Consolas",borderLeft:`3px solid ${n.policy_created?s.accent:s.foreground}`},children:[n.schema_name,".",n.table_name,".",n.column_name," - ",n.pii_category,n.policy_created?" âœ“":` âœ— (${n.message})`]},o)),S.results.length>20&&e.jsxs("div",{style:{fontSize:10,color:s.muted,marginTop:t.spacing.sm,fontFamily:"Consolas"},children:["... and ",S.results.length-20," more"]})]}),e.jsx("div",{style:{display:"flex",gap:t.spacing.sm,marginTop:t.spacing.md},children:e.jsx(F,{label:"Close",onClick:()=>{f(!1),R(null),A(),P()},variant:"primary"})})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:t.spacing.md},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:4},children:"Select Databases * (Multiple selection allowed)"}),Q.length>0?e.jsxs("div",{children:[e.jsxs("div",{style:{padding:t.spacing.xs,marginBottom:t.spacing.sm,background:s.backgroundSoft,borderRadius:2,fontSize:10,color:s.muted,fontFamily:"Consolas",border:`1px solid ${s.border}`},children:[e.jsx("strong",{children:"âš ï¸ Warning:"})," Avoid selecting system databases like 'postgres' unless you have application data there. System databases typically don't need masking."]}),e.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto",border:`1px solid ${s.border}`,borderRadius:2,padding:t.spacing.sm,background:s.background},children:[e.jsx("style",{children:`
                            div[style*="overflowY"]::-webkit-scrollbar {
                              width: 0px;
                              display: none;
                            }
                            div[style*="overflowY"] {
                              -ms-overflow-style: none;
                              scrollbar-width: none;
                            }
                          `}),Q.map(n=>{const o=n==="postgres"||n==="template0"||n==="template1";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t.spacing.xs,padding:t.spacing.xs,marginBottom:t.spacing.xs,opacity:o?.7:1},children:[e.jsx("input",{type:"checkbox",checked:l.database_names.includes(n),onChange:i=>{i.target.checked?z(c=>({...c,database_names:[...c.database_names,n],database_name:""})):z(c=>({...c,database_names:c.database_names.filter(B=>B!==n)}))},style:{width:"18px",height:"18px",cursor:"pointer"}}),e.jsxs("label",{style:{color:o?s.muted:s.foreground,fontSize:12,fontFamily:"Consolas",cursor:"pointer",flex:1},children:[n," ",o&&"(System DB)"]})]},n)})]})]}):e.jsx("input",{type:"text",value:l.database_name,onChange:n=>z(o=>({...o,database_name:n.target.value,database_names:[]})),placeholder:"DataLake, postgres, etc. (single database)",style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}}),l.database_names.length>0&&e.jsxs("div",{style:{marginTop:t.spacing.xs,fontSize:10,color:s.muted,fontFamily:"Consolas"},children:["Selected: ",l.database_names.join(", ")]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Schema Name (leave empty for all schemas in database)"}),e.jsx("input",{type:"text",value:l.schema_name,onChange:n=>z(o=>({...o,schema_name:n.target.value})),placeholder:"public (optional)",style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Default Masking Type"}),e.jsx("select",{value:l.masking_type,onChange:n=>z(o=>({...o,masking_type:n.target.value})),style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease",cursor:"pointer"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"},children:me.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Minimum Confidence Score (0.0 - 1.0)"}),e.jsx("input",{type:"number",min:"0",max:"1",step:"0.05",value:l.min_confidence,onChange:n=>z(o=>({...o,min_confidence:parseFloat(n.target.value)||.75})),style:{width:"100%",padding:`${t.spacing.sm} ${t.spacing.md}`,border:`1px solid ${s.border}`,borderRadius:2,background:s.background,color:s.foreground,fontFamily:"Consolas",fontSize:12,outline:"none",transition:"border-color 0.15s ease"},onFocus:n=>{n.target.style.borderColor=s.accent,n.target.style.outline=`2px solid ${s.accent}`,n.target.style.outlineOffset="2px"},onBlur:n=>{n.target.style.borderColor=s.border,n.target.style.outline="none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:s.muted,fontSize:11,display:"block",marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"Auto Activate Policies"}),e.jsx("input",{type:"checkbox",checked:l.auto_activate,onChange:n=>z(o=>({...o,auto_activate:n.target.checked})),style:{width:"20px",height:"20px",cursor:"pointer"}})]}),e.jsxs("div",{style:{padding:t.spacing.sm,background:s.backgroundSoft,borderRadius:2,fontSize:11,color:s.muted,fontFamily:"Consolas"},children:[e.jsx("strong",{children:"Note:"})," This will scan all tables in the specified database and schema (or all schemas if schema is empty), detect sensitive columns, and automatically create masking policies. Email and phone columns will use appropriate masking types automatically."]}),e.jsxs("div",{style:{display:"flex",gap:t.spacing.sm,marginTop:t.spacing.md},children:[e.jsx(F,{label:y?"Processing...":"Start Batch Analysis",onClick:ke,variant:"primary",disabled:y||l.database_names.length===0&&!l.database_name}),e.jsx(F,{label:"Cancel",onClick:()=>{f(!1),R(null)},variant:"ghost",disabled:y})]})]})})]})}),he&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>ge(!1),children:e.jsxs("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:n=>n.stopPropagation(),children:[e.jsx("style",{children:`
              div[style*="overflowY"]::-webkit-scrollbar {
                width: 0px;
                display: none;
              }
              div[style*="overflowY"] {
                -ms-overflow-style: none;
                scrollbar-width: none;
              }
            `}),e.jsx(W,{title:"DATA MASKING PLAYBOOK",children:e.jsxs("div",{style:{padding:t.spacing.md,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:t.spacing.lg},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:s.accent,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:[m.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:s.foreground,marginLeft:t.spacing.md,fontSize:11,fontFamily:"Consolas"},children:"Data Masking provides role-based column-level data protection at the database level. The system automatically redirects queries to masked views or original data based on user privileges, ensuring sensitive data is protected while maintaining seamless access for authorized users."})]}),e.jsxs("div",{style:{marginBottom:t.spacing.lg},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:s.accent,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:[m.blockFull," FLOW: USER CONNECTION â†’ ROLE MAPPING"]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:[e.jsxs("div",{style:{marginBottom:t.spacing.md},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:s.accent,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:[m.blockSemi," Step 1: PostgreSQL User Identification"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.md,fontSize:11,fontFamily:"Consolas"},children:["When you connect to PostgreSQL as a user (e.g., ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"tomy.berrios"}),"), PostgreSQL identifies the session user:"]}),e.jsx("pre",{style:{marginLeft:t.spacing.lg,marginTop:t.spacing.sm,padding:t.spacing.sm,background:s.backgroundSoft,border:`1px solid ${s.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",overflowX:"auto"},children:`-- PostgreSQL identifies your user
current_user = 'tomy.berrios'
session_user = 'tomy.berrios'`})]}),e.jsxs("div",{style:{marginBottom:t.spacing.md},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:s.accent,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:[m.blockSemi," Step 2: Role Mapping Function"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.md,fontSize:11,fontFamily:"Consolas"},children:["The function ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"metadata.get_user_role_from_db()"})," maps PostgreSQL users to application roles:"]}),e.jsx("pre",{style:{marginLeft:t.spacing.lg,marginTop:t.spacing.sm,padding:t.spacing.sm,background:s.backgroundSoft,border:`1px solid ${s.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",overflowX:"auto"},children:`-- 1. Gets current PostgreSQL user
v_db_user := current_user;  -- 'tomy.berrios'

-- 2. Looks up in metadata.users
SELECT role FROM metadata.users 
WHERE username = 'tomy.berrios';
-- Result: 'admin'

-- 3. Returns the role
RETURN 'admin';`}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.lg,marginTop:t.spacing.sm,fontSize:11,fontFamily:"Consolas"},children:[e.jsx("strong",{children:"Important:"})," The mapping is ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"username"})," in ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"metadata.users"})," = ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"session_user"})," of PostgreSQL"]})]})]})]}),e.jsxs("div",{style:{marginBottom:t.spacing.lg},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:s.accent,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:[m.blockFull," FLOW: POLICY VERIFICATION"]}),e.jsx("div",{style:{marginLeft:t.spacing.md},children:e.jsxs("div",{style:{marginBottom:t.spacing.md},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:s.accent,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:[m.blockSemi," Step 3: Column Masking Decision"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.md,fontSize:11,fontFamily:"Consolas"},children:["When querying a column, ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"metadata.should_mask_column()"})," verifies:"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.lg,marginTop:t.spacing.sm,fontSize:11,fontFamily:"Consolas"},children:[e.jsxs("div",{style:{marginBottom:t.spacing.xs},children:["1. ",e.jsx("strong",{children:"Is the user admin?"})]}),e.jsx("div",{style:{marginLeft:t.spacing.md,color:s.accent},children:"â†’ If YES: RETURN false (NO masking)"}),e.jsx("div",{style:{marginLeft:t.spacing.md,color:s.accent},children:"â†’ If NO: continue"}),e.jsxs("div",{style:{marginBottom:t.spacing.xs,marginTop:t.spacing.sm},children:["2. ",e.jsx("strong",{children:"Does an active policy exist for this column?"})]}),e.jsx("div",{style:{marginLeft:t.spacing.md,color:s.accent},children:"â†’ If NO: RETURN false (NO masking)"}),e.jsx("div",{style:{marginLeft:t.spacing.md,color:s.accent},children:"â†’ If YES: continue"}),e.jsxs("div",{style:{marginBottom:t.spacing.xs,marginTop:t.spacing.sm},children:["3. ",e.jsx("strong",{children:"Is the role in the whitelist?"})]}),e.jsx("div",{style:{marginLeft:t.spacing.md,color:s.accent},children:"â†’ If YES: RETURN false (NO masking)"}),e.jsx("div",{style:{marginLeft:t.spacing.md,color:s.accent},children:"â†’ If NO: RETURN true (YES masking)"})]})]})})]}),e.jsxs("div",{style:{marginBottom:t.spacing.lg},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:s.accent,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:[m.blockFull," FLOW: SMART VIEW - AUTOMATIC REDIRECTION"]}),e.jsx("div",{style:{marginLeft:t.spacing.md},children:e.jsxs("div",{style:{marginBottom:t.spacing.md},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:s.accent,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:[m.blockSemi," Step 4: Smart View Creation"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.md,fontSize:11,fontFamily:"Consolas"},children:["The view ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"saleslt_smart_customer"})," is created with dynamic masking:"]}),e.jsx("pre",{style:{marginLeft:t.spacing.lg,marginTop:t.spacing.sm,padding:t.spacing.sm,background:s.backgroundSoft,border:`1px solid ${s.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",overflowX:"auto"},children:`CREATE VIEW saleslt_smart_customer AS
SELECT 
  customerid,
  
  -- For emailaddress (has EMAIL policy)
  CASE 
    WHEN (SELECT role FROM metadata.users 
          WHERE username = session_user) = 'admin' 
    THEN emailaddress  -- Admin sees original
    ELSE metadata.mask_value(
      emailaddress::TEXT, 'EMAIL', '{}'::jsonb
    )  -- User sees masked
  END as emailaddress,
  
  -- For phone (has PHONE policy)
  CASE 
    WHEN (SELECT role FROM metadata.users 
          WHERE username = session_user) = 'admin' 
    THEN phone  -- Admin sees original
    ELSE metadata.mask_value(
      phone::TEXT, 'PHONE', '{}'::jsonb
    )  -- User sees masked
  END as phone
  
FROM saleslt.customer;`})]})})]}),e.jsxs("div",{style:{marginBottom:t.spacing.lg},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:s.accent,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:[m.blockFull," FLOW: EXECUTION EXAMPLES"]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:[e.jsxs("div",{style:{marginBottom:t.spacing.md},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:s.accent,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:[m.blockSemi," Admin User Query"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.md,fontSize:11,fontFamily:"Consolas"},children:["When ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"tomy.berrios"})," (admin) executes:"]}),e.jsx("pre",{style:{marginLeft:t.spacing.lg,marginTop:t.spacing.sm,padding:t.spacing.sm,background:s.backgroundSoft,border:`1px solid ${s.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",overflowX:"auto"},children:`SELECT emailaddress, phone 
FROM saleslt.saleslt_smart_customer;`}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.lg,marginTop:t.spacing.sm,fontSize:11,fontFamily:"Consolas"},children:["PostgreSQL evaluates CASE WHEN:",e.jsxs("div",{style:{marginLeft:t.spacing.md,marginTop:t.spacing.xs},children:["â€¢ ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"session_user = 'tomy.berrios'"})]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:["â€¢ Query: ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"SELECT role FROM metadata.users WHERE username = 'tomy.berrios'"})]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:["â€¢ Result: ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"'admin'"})]}),e.jsxs("div",{style:{marginLeft:t.spacing.md,color:s.accent,marginTop:t.spacing.xs},children:["â†’ Returns: ",e.jsx("strong",{children:"original values"})," (no masking)"]})]})]}),e.jsxs("div",{style:{marginBottom:t.spacing.md},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:s.muted,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:[m.blockSemi," Regular User Query"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:16,fontSize:11},children:["When ",e.jsx("code",{style:{background:s.backgroundSoft,padding:"2px 4px"},children:"testuser"})," (non-admin) executes the same query:"]}),e.jsxs("div",{style:{color:s.foreground,marginLeft:t.spacing.lg,marginTop:t.spacing.sm,fontSize:11,fontFamily:"Consolas"},children:["PostgreSQL evaluates CASE WHEN:",e.jsxs("div",{style:{marginLeft:t.spacing.md,marginTop:t.spacing.xs},children:["â€¢ ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"session_user = 'testuser'"})]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:["â€¢ Query: ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"SELECT role FROM metadata.users WHERE username = 'testuser'"})]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:["â€¢ Result: ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"'user'"})]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:["â€¢ Condition: ",e.jsx("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"'user' = 'admin'"})," â†’ FALSE"]}),e.jsxs("div",{style:{marginLeft:t.spacing.md,color:s.muted,marginTop:t.spacing.xs},children:["â†’ Executes: ",e.jsxs("code",{style:{background:s.backgroundSoft,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:["metadata.mask_value(emailaddress, 'EMAIL', '","')"]})]}),e.jsxs("div",{style:{marginLeft:t.spacing.md,color:s.muted},children:["â†’ Returns: ",e.jsx("strong",{children:"'orl***@adventure-works.com'"})," (masked)"]})]})]})]})]}),e.jsxs("div",{style:{marginBottom:t.spacing.lg},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:s.accent,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:[m.blockFull," REQUIREMENTS"]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:[e.jsxs("div",{style:{marginBottom:t.spacing.sm},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:s.foreground,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"1. PostgreSQL User Must Exist"}),e.jsx("pre",{style:{marginLeft:t.spacing.md,marginTop:t.spacing.xs,padding:t.spacing.sm,background:s.backgroundSoft,border:`1px solid ${s.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",overflowX:"auto"},children:"CREATE USER tomy.berrios WITH PASSWORD 'your_password';"})]}),e.jsxs("div",{style:{marginBottom:t.spacing.sm},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:s.foreground,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"2. User Must Be in metadata.users"}),e.jsx("pre",{style:{marginLeft:t.spacing.md,marginTop:t.spacing.xs,padding:t.spacing.sm,background:s.backgroundSoft,border:`1px solid ${s.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",overflowX:"auto"},children:`INSERT INTO metadata.users (username, email, password_hash, role, active)
VALUES ('tomy.berrios', 'your@email.com', 'hash', 'admin', true);`})]}),e.jsxs("div",{style:{marginBottom:t.spacing.sm},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:s.foreground,marginBottom:t.spacing.xs,fontFamily:"Consolas"},children:"3. Required Permissions"}),e.jsx("pre",{style:{marginLeft:t.spacing.md,marginTop:t.spacing.xs,padding:t.spacing.sm,background:s.backgroundSoft,border:`1px solid ${s.border}`,borderRadius:2,fontSize:11,fontFamily:"Consolas",overflowX:"auto"},children:`GRANT CONNECT ON DATABASE DataLake TO tomy.berrios;
GRANT USAGE ON SCHEMA saleslt TO tomy.berrios;
GRANT SELECT ON saleslt.saleslt_smart_customer TO tomy.berrios;
GRANT SELECT ON metadata.users TO tomy.berrios;`})]})]})]}),e.jsxs("div",{style:{marginBottom:t.spacing.lg},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:s.accent,marginBottom:t.spacing.sm,fontFamily:"Consolas"},children:[m.blockFull," MASKING TYPES"]}),e.jsxs("div",{style:{marginLeft:t.spacing.md},children:[e.jsxs("div",{style:{marginBottom:t.spacing.sm},children:[e.jsx("span",{style:{color:s.foreground,fontWeight:600,fontFamily:"Consolas"},children:"FULL"}),e.jsx("span",{style:{color:s.foreground,marginLeft:t.spacing.sm,fontFamily:"Consolas"},children:"Complete masking: ***MASKED***"})]}),e.jsxs("div",{style:{marginBottom:t.spacing.sm},children:[e.jsx("span",{style:{color:s.muted,fontWeight:600,fontFamily:"Consolas"},children:"PARTIAL"}),e.jsx("span",{style:{color:s.foreground,marginLeft:t.spacing.sm,fontFamily:"Consolas"},children:"Partial masking: Shows first/last characters"})]}),e.jsxs("div",{style:{marginBottom:t.spacing.sm},children:[e.jsx("span",{style:{color:s.accent,fontWeight:600,fontFamily:"Consolas"},children:"EMAIL"}),e.jsx("span",{style:{color:s.foreground,marginLeft:t.spacing.sm,fontFamily:"Consolas"},children:"Email masking: orl***@adventure-works.com"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:s.accent,fontWeight:600},children:"PHONE"}),e.jsx("span",{style:{color:s.foreground,marginLeft:8},children:"Phone masking: 245-****-0173"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:s.muted,fontWeight:600},children:"HASH"}),e.jsx("span",{style:{color:s.foreground,marginLeft:8},children:"Hash-based masking: Deterministic hash"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:s.success,fontWeight:600},children:"TOKENIZE"}),e.jsx("span",{style:{color:s.foreground,marginLeft:8},children:"Tokenization: Replaces with tokens"})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:s.backgroundSoft,borderRadius:2,border:`1px solid ${s.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:s.muted,marginBottom:4},children:[m.blockSemi," Important Notes"]}),e.jsxs("div",{style:{fontSize:11,color:s.foreground,fontFamily:"Consolas"},children:["â€¢ The view queries ",e.jsx("code",{style:{background:s.background,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"metadata.users"})," at ",e.jsx("strong",{children:"execution time"}),", not at creation time",e.jsx("br",{}),"â€¢ If a PostgreSQL user exists but is not in ",e.jsx("code",{style:{background:s.background,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"metadata.users"}),", the function returns 'admin' by default (hardcoded)",e.jsx("br",{}),"â€¢ If the user exists in ",e.jsx("code",{style:{background:s.background,padding:`${t.spacing.xs} ${t.spacing.xs}`,fontFamily:"Consolas"},children:"metadata.users"}),", it uses the role from that table",e.jsx("br",{}),"â€¢ Masking is applied at the database level, ensuring consistent protection across all applications"]})]}),e.jsx("div",{style:{marginTop:t.spacing.md,textAlign:"right"},children:e.jsx(F,{label:"Close",onClick:()=>ge(!1),variant:"ghost"})})]})})]})})]})};export{Ne as default};
