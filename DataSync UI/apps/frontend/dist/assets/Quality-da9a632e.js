import{m as te,f as L,b as t,r as d,j as e,e as a,i as ee}from"./index-75d7470b.js";import{u as ae}from"./useTableFilters-0b8dd77f.js";import{e as se}from"./errorHandler-5ea9ae85.js";import{A as P}from"./AsciiPanel-9f053981.js";import{A as O}from"./AsciiButton-446d8430.js";import{C as ce,a as de,L as ue,A as ge,p as me,b as fe,c as pe}from"./chart-a081329f.js";import{S as he}from"./SkeletonLoader-530eacc4.js";const U=te`
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,xe=te`
  from {
    opacity: 0;
    max-height: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    max-height: 10000px;
    transform: translateY(0);
  }
`,ye=te`
  from {
    opacity: 1;
    max-height: 10000px;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    max-height: 0;
    transform: translateY(-10px);
  }
`,oe=L.div`
  font-family: Consolas;
  font-size: 12px;
  background: ${t.background};
  border: 1px solid ${t.border};
  border-radius: 2px;
  padding: 16px;
  max-height: 800px;
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
  animation: ${U} 0.3s ease-out;
  
  &::-webkit-scrollbar {
    width: 8px;
  }
  
  &::-webkit-scrollbar-track {
    background: ${t.backgroundSoft};
    border-radius: 2px;
  }
  
  &::-webkit-scrollbar-thumb {
    background: ${t.border};
    border-radius: 2px;
    transition: background 0.2s ease;
    
    &:hover {
      background: ${t.accent};
    }
  }
`,be=L.div`
  user-select: none;
  margin: 4px 0;
  animation: ${U} 0.3s ease-out;
  animation-fill-mode: both;
  
  &:nth-child(1) { animation-delay: 0.05s; }
  &:nth-child(2) { animation-delay: 0.1s; }
  &:nth-child(3) { animation-delay: 0.15s; }
  &:nth-child(4) { animation-delay: 0.2s; }
  &:nth-child(5) { animation-delay: 0.25s; }
`,je=L.div`
  display: flex;
  align-items: center;
  padding: ${s=>s.$level===0?"8px":"6px 8px"};
  padding-left: ${s=>s.$level*24+8}px;
  border-radius: 2px;
  transition: all 0.2s ease;
  cursor: pointer;
  position: relative;
  margin: 2px 0;
  font-family: Consolas;
  font-size: 12px;
  background: transparent;
  
  ${s=>s.$nodeType==="schema"?`
        border-left: 3px solid ${t.accent};
        font-weight: 600;
      `:`
      border-left: 1px solid ${t.border};
    `}
  
  &:hover {
    background: ${t.backgroundSoft};
    transform: translateX(2px);
  }
`,ve=L.div`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  margin-right: 8px;
  border-radius: 2px;
  background: ${s=>s.$isExpanded?t.accent:t.backgroundSoft};
  color: ${s=>s.$isExpanded?"#ffffff":t.accent};
  font-size: 10px;
  font-weight: bold;
  font-family: Consolas;
  transition: all 0.2s ease;
  flex-shrink: 0;
  
  &:hover {
    transform: scale(1.1);
  }
`,Se=L.span`
  font-weight: ${s=>s.$isSchema?"700":"500"};
  font-size: ${s=>s.$isSchema?"13px":"12px"};
  font-family: Consolas;
  color: ${s=>s.$isSchema?t.accent:t.foreground};
  margin-right: 12px;
  transition: color 0.2s ease;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,Ce=L.span`
  padding: 2px 8px;
  border-radius: 2px;
  font-size: 11px;
  font-weight: 500;
  font-family: Consolas;
  background: ${t.backgroundSoft};
  color: ${t.foreground};
  border: 1px solid ${t.border};
  margin-left: auto;
  transition: all 0.2s ease;
  
  &:hover {
    background: ${t.accentLight};
    border-color: ${t.accent};
    color: ${t.accent};
    transform: translateY(-1px);
  }
`,_e=L.div`
  overflow: hidden;
  animation: ${s=>s.$isExpanded?xe:ye} 0.3s ease-out;
  padding-left: ${s=>s.$level*24+36}px;
`,we=L.span`
  color: ${t.muted};
  font-family: Consolas;
  margin-right: 4px;
  font-size: 12px;
`,ke=L.div`
  padding: 8px;
  padding-left: ${s=>s.$level*24+36}px;
  margin: 2px 0;
  border-radius: 2px;
  background: transparent;
  border: 1px solid ${t.border};
  transition: all 0.2s ease;
  cursor: pointer;
  animation: ${U} 0.3s ease-out;
  font-family: Consolas;
  font-size: 12px;
  
  &:hover {
    background: ${t.backgroundSoft};
    border-color: ${t.accent};
    transform: translateX(4px);
  }
`,X=s=>{if(!s)return t.muted;switch(s){case"PASSED":case"EXCELLENT":return t.success;case"WARNING":return t.warning;case"FAILED":case"CRITICAL":return t.danger;default:return t.muted}},J=s=>s>=90?t.success:s>=70?t.success:s>=50?t.warning:t.danger,Le=L.div`
  padding: 60px 40px;
  text-align: center;
  color: ${t.muted};
  animation: ${U} 0.5s ease-out;
  font-family: Consolas;
`,Te=L.div`
  font-size: 48px;
  margin-bottom: 16px;
  animation: ${U} 0.5s ease-out;
  font-family: Consolas;
  opacity: 0.5;
`,Ee=L.div`
  font-size: 13px;
  font-family: Consolas;
  font-weight: 600;
  margin-bottom: 8px;
  color: ${t.foreground};
`,ze=L.div`
  font-size: 12px;
  font-family: Consolas;
  opacity: 0.7;
  color: ${t.muted};
`,Be=({items:s,onItemClick:S})=>{const[M,C]=d.useState(new Set),E=d.useMemo(()=>{const o=new Map;return s.forEach(g=>{const c=g.schema_name||"default";o.has(c)||o.set(c,{name:c,tables:[]}),o.get(c).tables.push(g)}),Array.from(o.values()).sort((g,c)=>g.name.localeCompare(c.name))},[s]),b=o=>{C(g=>{const c=new Set(g);return c.has(o)?c.delete(o):c.add(o),c})},T=(o,g)=>{if(o===0)return null;const c=[];for(let j=0;j<o-1;j++)c.push("│  ");return c.push(g?"└─ ":"├─ "),e.jsx(we,{children:c.join("")})},z=o=>{if(o==null)return"N/A";const g=Number(o);return isNaN(g)?"N/A":g.toLocaleString()},D=o=>o?new Date(o).toLocaleString():"N/A",n=(o,g)=>{const c=M.has(o.name),j=!1;return e.jsxs(be,{children:[e.jsxs(je,{$level:g,$isExpanded:c,$nodeType:"schema",onClick:()=>b(o.name),children:[T(g,j),e.jsx(ve,{$isExpanded:c,children:c?a.arrowDown:a.arrowRight}),e.jsx("span",{style:{marginRight:"8px",color:t.accent,fontFamily:"Consolas"},children:a.blockFull}),e.jsx(Se,{$isSchema:!0,children:o.name}),e.jsx(Ce,{children:o.tables.length})]}),e.jsx(_e,{$isExpanded:c,$level:g,children:c&&o.tables.map((_,w)=>B(_,o.name,g+1,w===o.tables.length-1))})]},o.name)},B=(o,g,c,j)=>e.jsxs(ke,{$level:c,onClick:()=>S==null?void 0:S(o),children:[T(c,j),e.jsx("span",{style:{marginRight:"8px",color:t.muted,fontFamily:"Consolas"},children:a.blockFull}),e.jsx("span",{style:{marginRight:"8px",fontWeight:500,color:t.foreground,fontFamily:"Consolas"},children:o.table_name||"N/A"}),o.source_db_engine&&e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:t.backgroundSoft,color:t.foreground,border:`1px solid ${t.border}`,marginRight:4},children:o.source_db_engine}),o.validation_status&&e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:X(o.validation_status)+"20",color:X(o.validation_status),border:`1px solid ${X(o.validation_status)}`,marginRight:4},children:o.validation_status}),o.quality_score!==void 0&&e.jsxs("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:J(o.quality_score)+"20",color:J(o.quality_score),border:`1px solid ${J(o.quality_score)}`,marginRight:4},children:[o.quality_score,"%"]}),e.jsxs("span",{style:{marginLeft:"auto",color:t.muted,fontSize:11,fontFamily:"Consolas"},children:[z(o.total_rows)," rows ",a.bullet," ",D(o.check_timestamp)]})]},o.id);return E.length===0?e.jsx(oe,{children:e.jsxs(Le,{children:[e.jsx(Te,{children:a.blockFull}),e.jsx(Ee,{children:"No quality data available"}),e.jsx(ze,{children:"Data will appear here once collected."})]})}):e.jsx(oe,{children:E.map(o=>n(o,0))})};ce.register(de,ue,ge,me,fe,pe);const Ie=({data:s,color:S,height:M=4,width:C=30,labels:E})=>{const[b,T]=d.useState(null),[z,D]=d.useState(null),n=d.useRef(null);if(!s||s.length===0)return e.jsx("span",{style:{color:t.muted},children:a.dot.repeat(C)});const B=s.slice(-C),o=E?E.slice(-C):[],g=Math.min(...B),j=Math.max(...B)-g||1,_=["▁","▂","▃","▄","▅","▆","▇","█"],w=A=>{if(j===0)return _[0];const y=(A-g)/j,k=Math.floor(y*(_.length-1));return _[Math.max(0,Math.min(_.length-1,k))]},m=(A,y)=>{if(n.current){const k=n.current.getBoundingClientRect();D({x:A.clientX-k.left,y:A.clientY-k.top-30}),T(y)}},I=()=>{T(null),D(null)};return e.jsxs("div",{ref:n,style:{position:"relative",display:"inline-block"},onMouseLeave:I,children:[e.jsx("span",{style:{color:S,fontFamily:"Consolas",fontSize:11,letterSpacing:0,lineHeight:1,display:"inline-block"},children:B.map((A,y)=>e.jsx("span",{onMouseMove:k=>m(k,y),style:{cursor:"pointer",transition:"all 0.2s ease",transform:b===y?"scale(1.2)":"scale(1)",display:"inline-block",position:"relative"},children:w(A)},y))}),b!==null&&z&&e.jsxs("div",{style:{position:"absolute",left:`${z.x}px`,top:`${z.y}px`,transform:"translateX(-50%)",backgroundColor:t.background,border:`1px solid ${t.border}`,borderRadius:2,padding:"6px 10px",fontSize:10,fontFamily:"Consolas",color:t.foreground,whiteSpace:"nowrap",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",pointerEvents:"none"},children:[e.jsx("div",{style:{color:t.accent,fontWeight:600,marginBottom:2},children:B[b].toFixed(2)}),o[b]&&e.jsx("div",{style:{color:t.muted,fontSize:9},children:new Date(o[b]).toLocaleTimeString()})]})]})},Ae=({selectedTable:s})=>{const[S,M]=d.useState(30),[C,E]=d.useState(!1),[b,T]=d.useState(null),[z,D]=d.useState([]),[n,B]=d.useState(null),o=d.useRef(null),g=d.useCallback(async()=>{var h,p,l;o.current&&o.current.abort(),o.current=new AbortController;const r=o.current;E(!0),T(null);try{const i={days:S,limit:1e4};s&&(i.schema=s.schema_name,i.table=s.table_name,i.engine=s.source_db_engine);const[u,x]=await Promise.all([ee.getQualityHistory(i,r.signal),ee.getQualityStats({days:S},r.signal)]);!r.signal.aborted&&o.current===r&&(D(u.data||[]),B(x))}catch(i){const u=i.name==="CanceledError"||i.name==="AbortError"||((h=i.message)==null?void 0:h.includes("canceled"))||((p=i.message)==null?void 0:p.includes("aborted"))||((l=i.message)==null?void 0:l.includes("Request cancelled"));if(!u&&o.current===r){const x=se(i);T(x),console.error("Error fetching quality charts data:",i)}else if(u)return}finally{o.current===r&&E(!1)}},[S,s]);d.useEffect(()=>(g(),()=>{o.current&&o.current.abort()}),[S,s]);const c=()=>{if(!z.length)return null;const r=[...z].sort((p,l)=>new Date(p.check_timestamp).getTime()-new Date(l.check_timestamp).getTime());let h;if(s)h=r;else{const p=new Map;r.forEach(l=>{const i=new Date(l.check_timestamp).toISOString();p.has(i)||p.set(i,{quality_score:0,null_count:0,duplicate_count:0,invalid_type_count:0,count:0,timestamp:i});const u=p.get(i);u.quality_score+=l.quality_score||0,u.null_count+=l.null_count||0,u.duplicate_count+=l.duplicate_count||0,u.invalid_type_count+=l.invalid_type_count||0,u.count+=1}),h=Array.from(p.values()).map(l=>({check_timestamp:l.timestamp,quality_score:l.count>0?l.quality_score/l.count:0,null_count:l.null_count,duplicate_count:l.duplicate_count,invalid_type_count:l.invalid_type_count})).sort((l,i)=>new Date(l.check_timestamp).getTime()-new Date(i.check_timestamp).getTime())}return h},j=(r,h,p,l,i,u,x,v)=>{const q=l.length>0&&Number(l[l.length-1])||0,R=Number(h)||q||0,V=l.length>1,re=V?Math.min(...l.map(N=>Number(N)||0)):0,G=V?Math.max(...l.map(N=>Number(N)||0)):0,ne=x||(G>0?G:100),ie=ne>0?R/ne*100:0,le=Math.min(100,Math.max(0,ie));return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:"12px",backgroundColor:t.background,borderRadius:2,border:`1px solid ${t.border}`,transition:"all 0.2s ease"},onMouseEnter:N=>{N.currentTarget.style.borderColor=i,N.currentTarget.style.backgroundColor=t.backgroundSoft},onMouseLeave:N=>{N.currentTarget.style.borderColor=t.border,N.currentTarget.style.backgroundColor=t.background},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[e.jsxs("div",{style:{fontSize:11,color:t.accent,fontWeight:500,display:"flex",alignItems:"center",gap:6,fontFamily:"Consolas"},children:[e.jsx("span",{children:u}),e.jsx("span",{children:r})]}),e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:i,fontFamily:"Consolas"},children:[typeof R=="number"?R.toFixed(1):Number(R||0).toFixed(1),p]})]}),e.jsx("div",{style:{width:"100%",height:6,backgroundColor:t.backgroundSoft,borderRadius:1,overflow:"hidden",border:`1px solid ${t.border}`},children:e.jsx("div",{style:{width:`${le}%`,height:"100%",backgroundColor:i,transition:"width 0.3s ease",borderRadius:1}})}),e.jsx(Ie,{data:l,color:i,width:40,labels:v}),V&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:t.muted,marginTop:2,fontFamily:"Consolas"},children:[e.jsxs("span",{children:["Min: ",re.toFixed(1),p]}),e.jsxs("span",{children:["Max: ",G.toFixed(1),p]})]})]})},_=()=>n!=null&&n.summary?{labels:["PASSED","WARNING","FAILED"],datasets:[{data:[parseInt(n.summary.passed_count||0),parseInt(n.summary.warning_count||0),parseInt(n.summary.failed_count||0)],backgroundColor:[t.success+"80",t.warning+"80",t.danger+"80"],borderColor:[t.success,t.warning,t.danger],borderWidth:2}]}:null,w=()=>!(n!=null&&n.byEngine)||!n.byEngine.length?null:{labels:n.byEngine.map(r=>r.source_db_engine),datasets:[{label:"Tables",data:n.byEngine.map(r=>parseInt(r.table_count||0)),backgroundColor:[t.accent+"80",t.success+"80",t.warning+"80",t.danger+"80","#9b59b680"],borderColor:[t.accent,t.success,t.warning,t.danger,"#9b59b6"],borderWidth:2}]},m=c(),I=_(),A=w(),y=m?m.map(r=>Number(r.quality_score)||0):[],k=m?m.map(r=>r.check_timestamp):[],$=m?m.map(r=>Number(r.null_count)||0):[],W=m?m.map(r=>Number(r.duplicate_count)||0):[],Q=m?m.map(r=>Number(r.invalid_type_count)||0):[],f=y.length>0&&Number(y[y.length-1])||0,F=$.length>0&&Number($[$.length-1])||0,Y=W.length>0&&Number(W[W.length-1])||0,H=Q.length>0&&Number(Q[Q.length-1])||0;return e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{color:t.muted,fontSize:11},children:"Time Range:"}),e.jsxs("select",{value:S,onChange:r=>M(Number(r.target.value)),style:{padding:"4px 8px",border:`1px solid ${t.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:11,backgroundColor:t.background,color:t.foreground},children:[e.jsx("option",{value:1,children:"Last 24 hours"}),e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"}),e.jsx("option",{value:180,children:"Last 6 months"}),e.jsx("option",{value:240,children:"Last 8 months"})]})]}),e.jsx(O,{label:"Refresh",onClick:g,variant:"ghost",disabled:C})]}),b&&e.jsx(P,{title:"ERROR",children:e.jsx("div",{style:{padding:"12px",color:t.danger,fontSize:11,fontFamily:"Consolas"},children:b})}),C&&e.jsx("div",{style:{padding:20,textAlign:"center",color:t.muted},children:"Loading charts..."}),!C&&!b&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[I&&(()=>{const r=I.datasets[0].data.reduce((q,R)=>q+R,0),h=I.datasets[0].data[0]||0,p=I.datasets[0].data[1]||0,l=I.datasets[0].data[2]||0,i=r>0?h/r*100:0,u=r>0?p/r*100:0,x=r>0?l/r*100:0,v=40;return e.jsx(P,{title:"STATUS DISTRIBUTION",children:e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:11,padding:"12px",lineHeight:1.8},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"├─ PASSED:"}),e.jsxs("span",{style:{color:t.success,fontWeight:600},children:[h," (",i.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.success},children:[a.blockFull.repeat(Math.round(i/100*v)),a.blockLight.repeat(v-Math.round(i/100*v))]})})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"├─ WARNING:"}),e.jsxs("span",{style:{color:t.warning,fontWeight:600},children:[p," (",u.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.warning},children:[a.blockFull.repeat(Math.round(u/100*v)),a.blockLight.repeat(v-Math.round(u/100*v))]})})]}),e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{color:t.muted},children:"└─ FAILED:"}),e.jsxs("span",{style:{color:t.danger,fontWeight:600},children:[l," (",x.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.danger},children:[a.blockFull.repeat(Math.round(x/100*v)),a.blockLight.repeat(v-Math.round(x/100*v))]})})]}),e.jsxs("div",{style:{marginTop:16,paddingTop:12,borderTop:`1px solid ${t.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:t.muted,fontSize:10},children:"Total:"}),e.jsxs("span",{style:{color:t.foreground,fontWeight:600,fontSize:10},children:[r," tables"]})]})]})})})(),A&&(n==null?void 0:n.byEngine)&&(()=>{const r=n.byEngine,h=r.reduce((l,i)=>l+parseInt(i.table_count||0),0),p=40;return e.jsx(P,{title:"ENGINE DISTRIBUTION",children:e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:11,padding:"12px",lineHeight:1.8},children:[r.map((l,i)=>{const u=parseInt(l.table_count||0),x=h>0?u/h*100:0,v=i===r.length-1,q=v?"└─":"├─",R=l.source_db_engine||"Unknown";return e.jsxs("div",{style:{marginBottom:v?4:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsxs("span",{style:{color:t.muted},children:[q," ",R,":"]}),e.jsxs("span",{style:{color:t.accent,fontWeight:600},children:[u," (",x.toFixed(1),"%)"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:12},children:e.jsxs("span",{style:{color:t.accent},children:[a.blockFull.repeat(Math.round(x/100*p)),a.blockLight.repeat(p-Math.round(x/100*p))]})})]},i)}),e.jsxs("div",{style:{marginTop:16,paddingTop:12,borderTop:`1px solid ${t.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:t.muted,fontSize:10},children:"Total:"}),e.jsxs("span",{style:{color:t.foreground,fontWeight:600,fontSize:10},children:[h," tables"]})]})]})})})()]}),!C&&!b&&m&&e.jsxs("div",{style:{border:`1px solid ${t.border}`,borderRadius:2,padding:16,backgroundColor:t.backgroundSoft,marginBottom:16},children:[e.jsxs("h2",{style:{fontSize:14,fontFamily:"Consolas",fontWeight:600,color:t.accent,margin:0,marginBottom:16,paddingBottom:8,borderBottom:`1px solid ${t.border}`},children:[a.blockFull," QUALITY METRICS"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[j("Quality Score",f,"%",y,f>=90?t.success:f>=70?t.warning:t.danger,a.blockFull,100,k),j("Null Count",F,"",$,t.warning,a.blockSemi,void 0,k),j("Duplicate Count",Y,"",W,t.danger,a.blockLight,void 0,k),j("Invalid Type Count",H,"",Q,"#ff6b6b",a.dot,void 0,k)]})]}),!C&&!b&&(n==null?void 0:n.summary)&&e.jsxs("div",{style:{border:`1px solid ${t.border}`,borderRadius:2,padding:16,backgroundColor:t.backgroundSoft,marginBottom:16},children:[e.jsxs("h2",{style:{fontSize:14,fontFamily:"Consolas",fontWeight:600,color:t.accent,margin:0,marginBottom:16,paddingBottom:8,borderBottom:`1px solid ${t.border}`},children:[a.blockFull," QUALITY SUMMARY"]}),e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:11,lineHeight:1.8,color:t.foreground},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Total Tables:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px"},children:n.summary.total_tables||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Passed:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px",color:t.success},children:n.summary.passed_count||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Warning:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px",color:t.warning},children:n.summary.warning_count||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Failed:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px",color:t.danger},children:n.summary.failed_count||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Avg Quality Score:"}),e.jsxs("span",{style:{fontWeight:500,marginLeft:"20px",color:parseFloat(n.summary.avg_score||0)>=90?t.success:parseFloat(n.summary.avg_score||0)>=70?t.warning:t.danger},children:[parseFloat(n.summary.avg_score||0).toFixed(2),"%"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:t.muted},children:"├─ Engines:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px"},children:n.summary.engine_count||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:t.muted},children:"└─ Schemas:"}),e.jsx("span",{style:{fontWeight:500,marginLeft:"20px"},children:n.summary.schema_count||0})]})]})]}),!C&&!b&&(n==null?void 0:n.byEngine)&&n.byEngine.length>0&&e.jsxs("div",{style:{border:`1px solid ${t.border}`,borderRadius:2,padding:16,backgroundColor:t.backgroundSoft,marginBottom:16},children:[e.jsxs("h2",{style:{fontSize:14,fontFamily:"Consolas",fontWeight:600,color:t.accent,margin:0,marginBottom:16,paddingBottom:8,borderBottom:`1px solid ${t.border}`},children:[a.blockFull," STATUS BY ENGINE"]}),e.jsx("div",{style:{fontFamily:"Consolas",fontSize:11,lineHeight:1.8,color:t.foreground},children:n.byEngine.map((r,h)=>e.jsxs("div",{style:{marginBottom:h<n.byEngine.length-1?8:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px",fontWeight:500,color:t.accent},children:[e.jsxs("span",{children:[r.source_db_engine,":"]}),e.jsxs("span",{children:[r.table_count||0," tables"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px",marginLeft:12},children:[e.jsx("span",{style:{color:t.muted,fontSize:10},children:"├─ Passed:"}),e.jsx("span",{style:{color:t.success,fontSize:10},children:r.passed||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px",marginLeft:12},children:[e.jsx("span",{style:{color:t.muted,fontSize:10},children:"├─ Warning:"}),e.jsx("span",{style:{color:t.warning,fontSize:10},children:r.warning||0})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px",marginLeft:12},children:[e.jsx("span",{style:{color:t.muted,fontSize:10},children:"└─ Failed:"}),e.jsx("span",{style:{color:t.danger,fontSize:10},children:r.failed||0})]}),h<n.byEngine.length-1&&e.jsx("div",{style:{borderBottom:`1px solid ${t.border}`,marginTop:8,marginBottom:8}})]},h))})]})]})},K=s=>{if(!s)return t.muted;switch(s){case"PASSED":return t.success;case"WARNING":return t.warning;case"FAILED":return t.danger;default:return t.muted}},Z=s=>s>=90?t.success:s>=70?t.success:s>=50?t.warning:t.danger,qe=()=>{const s=d.useRef(!0),[S,M]=d.useState(!0),[C,E]=d.useState(!1),[b,T]=d.useState(null),[z,D]=d.useState([]),[n,B]=d.useState(null),[o,g]=d.useState(!1),[c,j]=d.useState("list"),_=d.useRef(!1),w=d.useRef(null),{filters:m,setFilter:I,clearFilters:A}=ae({engine:"",status:""}),y=d.useCallback(f=>f.toLocaleString(),[]),k=d.useCallback(f=>f?new Date(f).toLocaleString():"-",[]),$=d.useRef(!0),W=d.useCallback(async(f=!1)=>{var r,h,p,l;if(!s.current)return;const F=$.current&&!f;if(_.current){if(f)return;w.current&&w.current.abort()}w.current=new AbortController,_.current=!0;const Y=Date.now(),H=300;try{F?(T(null),M(!0)):f&&E(!0);const i={page:1,limit:1e3};m.engine&&(i.engine=m.engine),m.status&&(i.status=m.status);const u=await ee.getQualityMetrics(i,w.current.signal);if(s.current&&!w.current.signal.aborted){const x=((r=u==null?void 0:u.data)==null?void 0:r.data)||(u==null?void 0:u.data)||u||[];if(D(Array.isArray(x)?x:[]),$.current=!1,T(null),F){const v=Date.now()-Y,q=Math.max(0,H-v);await new Promise(R=>setTimeout(R,q))}}}catch(i){if(s.current&&!((h=w.current)!=null&&h.signal.aborted)){if(i.name==="CanceledError"||i.name==="AbortError"||i.code==="ERR_CANCELED"||((p=i.message)==null?void 0:p.includes("aborted"))||((l=i.message)==null?void 0:l.includes("canceled")))return;const x=se(i);T(x),x&&!x.includes("cancelled")&&!x.includes("canceled")&&console.error("Error fetching quality data:",i)}}finally{s.current&&(_.current=!1,F&&M(!1),f&&E(!1))}},[m.engine,m.status]);d.useEffect(()=>(s.current=!0,$.current=!0,W(),()=>{s.current=!1,w.current&&w.current.abort()}),[m.engine,m.status]),d.useEffect(()=>{if($.current||S)return;const f=setInterval(()=>{s.current&&!_.current&&!$.current&&W(!0)},3e4);return()=>{clearInterval(f)}},[S]);const Q=d.useCallback(f=>{B(F=>(F==null?void 0:F.id)===f.id?null:f)},[]);return S&&z.length===0?e.jsx(he,{variant:"table"}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:t.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:t.accent,marginRight:8},children:a.blockFull}),"DATA QUALITY MONITOR"]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[C&&e.jsx("span",{style:{fontSize:11,color:t.muted,fontFamily:"Consolas"},children:"Refreshing..."}),e.jsx(O,{label:c==="list"?"Show Charts":"Show List",onClick:()=>j(c==="list"?"charts":"list"),variant:c==="charts"?"primary":"ghost"}),e.jsx(O,{label:"Quality Info",onClick:()=>g(!0),variant:"ghost"}),e.jsx(O,{label:"Refresh",onClick:()=>W(!0),variant:"ghost",disabled:_.current})]})]}),b&&e.jsx("div",{style:{marginBottom:20},children:e.jsx(P,{title:"ERROR",children:e.jsx("div",{style:{padding:"12px",color:t.danger,fontSize:12,fontFamily:"Consolas"},children:b})})}),e.jsx(P,{title:"FILTERS",children:e.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("select",{value:m.engine,onChange:f=>{I("engine",f.target.value)},style:{padding:"4px 8px",border:`1px solid ${t.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:t.background,color:t.foreground},children:[e.jsx("option",{value:"",children:"All Engines"}),e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"MongoDB",children:"MongoDB"}),e.jsx("option",{value:"MSSQL",children:"MSSQL"}),e.jsx("option",{value:"MariaDB",children:"MariaDB"}),e.jsx("option",{value:"Oracle",children:"Oracle"})]}),e.jsxs("select",{value:m.status,onChange:f=>{I("status",f.target.value)},style:{padding:"4px 8px",border:`1px solid ${t.border}`,borderRadius:2,fontFamily:"Consolas",fontSize:12,backgroundColor:t.background,color:t.foreground},children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"PASSED",children:"Passed"}),e.jsx("option",{value:"WARNING",children:"Warning"}),e.jsx("option",{value:"FAILED",children:"Failed"})]}),e.jsx(O,{label:"Reset All",onClick:()=>{A()},variant:"ghost"})]})}),o&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>g(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:f=>f.stopPropagation(),children:e.jsx(P,{title:"DATA QUALITY PLAYBOOK",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Data Quality monitoring validates tables by collecting comprehensive quality metrics including data types, null counts, duplicates, and constraint violations. The system automatically calculates a quality score (0-100) and determines validation status (PASSED, WARNING, FAILED) based on the collected metrics."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," QUALITY CHECKS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:t.success,marginBottom:6},children:[a.blockSemi," DATA TYPE VALIDATION"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Checks if actual data types match expected types from information_schema. Uses PostgreSQL system catalogs (pg_attribute, pg_class, pg_type) to verify type consistency. For large tables (>1M rows), uses 5% TABLESAMPLE for performance. Updates invalid_type_count and type_mismatch_details JSON with column-level issues."})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:t.success,marginBottom:6},children:[a.blockSemi," NULL COUNT CHECK"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Efficiently counts NULL values across all columns using FILTER clauses in a single query (instead of N+1 queries). Processes columns in batches of 50 for tables with many columns. Updates total_rows and null_count metrics."})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:t.success,marginBottom:6},children:[a.blockSemi," DUPLICATE DETECTION"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Detects duplicate rows by comparing total row count with distinct ctid count. For large tables (>1M rows), uses 10% TABLESAMPLE and adjusts the count by multiplying by 10. Updates duplicate_count metric."})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:t.success,marginBottom:6},children:[a.blockSemi," CONSTRAINT VALIDATION"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Checks foreign key constraints for violations by identifying orphaned rows (rows with foreign key values that don't exist in referenced tables). Queries information_schema.referential_constraints to find all foreign keys, then validates each one. Updates referential_integrity_errors and integrity_check_details JSON with violation details."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," QUALITY SCORE CALCULATION"]}),e.jsx("div",{style:{marginLeft:16},children:e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Score Formula (0-100)"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Starts at 100.0 and applies weighted deductions:"}),e.jsxs("div",{style:{color:t.foreground,marginLeft:32,fontSize:11,marginTop:4},children:["• Null percentage: -20 points (proportional to total rows)",e.jsx("br",{}),"• Duplicate percentage: -20 points (proportional to total rows)",e.jsx("br",{}),"• Invalid type count: -30 points (proportional to total rows)",e.jsx("br",{}),"• Referential integrity errors: -30 points (proportional to total rows)"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11,marginTop:8},children:"Final score is clamped between 0.0 and 100.0. Higher scores indicate better data quality."})]})})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," VALIDATION STATUS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.success,fontWeight:600},children:"PASSED"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8},children:"Quality score >= 90.0 - Excellent data quality"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.warning,fontWeight:600},children:"WARNING"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8},children:"Quality score >= 70.0 and < 90.0 - Acceptable but needs attention"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.danger,fontWeight:600},children:"FAILED"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8},children:"Quality score < 70.0 - Poor data quality, requires immediate action"})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[a.blockFull," METRICS EXPLAINED"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Total Rows"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Total number of rows in the table. Used as denominator for calculating percentages in quality score."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Null Count"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Total number of NULL values across all columns. High null counts indicate data completeness issues."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Duplicate Count"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of duplicate rows detected. Duplicates can cause data integrity and analysis issues."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Invalid Type Count"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of columns with type mismatches. Type_mismatch_details JSON contains column-level information."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Referential Integrity Errors"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of foreign key constraint violations (orphaned rows). Integrity_check_details JSON contains constraint-level details."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Check Duration (ms)"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Time taken to complete the quality check in milliseconds. Includes all validation steps."})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.muted,marginBottom:4},children:[a.blockSemi," Note"]}),e.jsx("div",{style:{fontSize:11,color:t.foreground},children:"Quality checks use sampling for large tables (>1M rows) to improve performance. The system stores metrics in metadata.data_quality table and retrieves the latest check for each schema/table/engine combination using DISTINCT ON with ORDER BY check_timestamp DESC."})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(O,{label:"Close",onClick:()=>g(!1),variant:"ghost"})})]})})})}),c==="list"?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:n?"1fr 400px":"1fr",gap:16},children:[e.jsx(Be,{items:z,onItemClick:Q}),n&&e.jsx(P,{title:"QUALITY DETAILS",children:e.jsx("div",{style:{position:"sticky",top:8,maxHeight:"calc(100vh - 200px)",overflowY:"auto",fontFamily:"Consolas",fontSize:12},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:t.muted,fontSize:11,marginBottom:4},children:"Schema:"}),e.jsx("div",{style:{color:t.foreground},children:n.schema_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.muted,fontSize:11,marginBottom:4},children:"Table:"}),e.jsx("div",{style:{color:t.foreground},children:n.table_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.muted,fontSize:11,marginBottom:4},children:"Total Rows:"}),e.jsx("div",{style:{color:t.foreground},children:y(n.total_rows||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.muted,fontSize:11,marginBottom:4},children:"Status:"}),e.jsx("div",{children:e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:K(n.validation_status)+"20",color:K(n.validation_status),border:`1px solid ${K(n.validation_status)}`},children:n.validation_status||"N/A"})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.muted,fontSize:11,marginBottom:4},children:"Quality Score:"}),e.jsx("div",{children:e.jsxs("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:Z(n.quality_score||0)+"20",color:Z(n.quality_score||0),border:`1px solid ${Z(n.quality_score||0)}`},children:[n.quality_score||0,"%"]})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.muted,fontSize:11,marginBottom:4},children:"Last Check:"}),e.jsx("div",{style:{color:t.foreground,fontSize:11},children:k(n.check_timestamp)})]}),e.jsxs("div",{style:{borderTop:`1px solid ${t.border}`,paddingTop:12,marginTop:8},children:[e.jsx("div",{style:{color:t.muted,fontSize:11,marginBottom:8,fontWeight:600},children:"Metrics:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:t.muted},children:"Missing Values"}),e.jsx("div",{style:{fontWeight:600,color:t.foreground},children:y(n.null_count||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:t.muted},children:"Duplicates"}),e.jsx("div",{style:{fontWeight:600,color:t.foreground},children:y(n.duplicate_count||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:t.muted},children:"Type Mismatches"}),e.jsx("div",{style:{fontWeight:600,color:t.foreground},children:y(n.invalid_type_count||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:t.muted},children:"Range Violations"}),e.jsx("div",{style:{fontWeight:600,color:t.foreground},children:y(n.out_of_range_count||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:t.muted},children:"Referential Issues"}),e.jsx("div",{style:{fontWeight:600,color:t.foreground},children:y(n.referential_integrity_errors||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,color:t.muted},children:"Constraint Issues"}),e.jsx("div",{style:{fontWeight:600,color:t.foreground},children:y(n.constraint_violation_count||0)})]})]})]})]})})})]}):e.jsx(Ae,{selectedTable:n?{schema_name:n.schema_name,table_name:n.table_name,source_db_engine:n.source_db_engine}:null})]})};export{qe as default};
