import{j as e,b as t,e as K,r as o,O as I,K as Q,M as Z,N as ee}from"./index-75d7470b.js";import{A as O}from"./AsciiPanel-9f053981.js";import{A as _}from"./AsciiButton-446d8430.js";import{u as te}from"./usePagination-b946ac42.js";import{u as ne}from"./useTableFilters-0b8dd77f.js";import{e as N}from"./errorHandler-5ea9ae85.js";import{s as re}from"./validation-24839588.js";import{S as oe}from"./SkeletonLoader-530eacc4.js";const se=({workflows:x,onWorkflowClick:a,onDelete:s,onEdit:l,onToggleActive:b,onToggleEnabled:g,onExecute:u,selectedWorkflow:f})=>e.jsx("div",{style:{fontFamily:"Consolas",fontSize:12},children:x.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:t.muted},children:"No workflows found"}):x.map(c=>{const j=(f==null?void 0:f.workflow_name)===c.workflow_name;return e.jsxs("div",{onClick:()=>a(c),style:{padding:"8px 12px",marginBottom:4,cursor:"pointer",backgroundColor:j?t.accent+"20":"transparent",border:`1px solid ${j?t.accent:t.border}`,borderRadius:2,color:j?t.accent:t.foreground,display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseEnter:i=>{j||(i.currentTarget.style.backgroundColor=t.accent+"10")},onMouseLeave:i=>{j||(i.currentTarget.style.backgroundColor="transparent")},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:c.workflow_name}),e.jsxs("div",{style:{fontSize:10,color:t.muted,display:"flex",gap:8},children:[e.jsx("span",{children:c.active?e.jsx("span",{style:{color:t.success},children:"â— Active"}):e.jsx("span",{style:{color:t.danger},children:"â—‹ Inactive"})}),e.jsx("span",{children:c.enabled?e.jsx("span",{style:{color:t.success},children:"âœ“ Enabled"}):e.jsx("span",{style:{color:t.danger},children:"âœ— Disabled"})}),c.schedule_cron&&e.jsxs("span",{style:{color:t.muted},children:[K.blockHalf," Scheduled"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},onClick:i=>i.stopPropagation(),children:[e.jsx("button",{onClick:()=>u(c.workflow_name),style:{padding:"4px 8px",fontSize:10,backgroundColor:t.accent,color:t.background,border:"none",borderRadius:2,cursor:"pointer",fontFamily:"Consolas"},title:"Execute",children:"â–¶"}),e.jsx("button",{onClick:()=>l(c),style:{padding:"4px 8px",fontSize:10,backgroundColor:t.foreground+"20",color:t.foreground,border:`1px solid ${t.border}`,borderRadius:2,cursor:"pointer",fontFamily:"Consolas"},title:"Edit",children:"âœŽ"}),e.jsx("button",{onClick:()=>s(c.workflow_name),style:{padding:"4px 8px",fontSize:10,backgroundColor:t.danger+"20",color:t.danger,border:`1px solid ${t.danger}`,borderRadius:2,cursor:"pointer",fontFamily:"Consolas"},title:"Delete",children:"âœ•"})]})]},c.workflow_name)})}),ae=({tasks:x,dependencies:a,onUpdate:s,availableCustomJobs:l,availableWarehouses:b,availableVaults:g})=>{const[u,f]=o.useState([]),[c,j]=o.useState(null),[i,S]=o.useState(!1),[T,F]=o.useState({x:0,y:0}),[L,A]=o.useState(!1),[R,n]=o.useState(null),D=o.useRef(null);o.useEffect(()=>{const r=x.map((h,m)=>({id:h.task_name,task:h,x:h.position_x||m%4*200+100,y:h.position_y||Math.floor(m/4)*150+100}));f(r)},[x]);const E=o.useCallback(()=>{const r={workflow_name:"",task_name:`task_${Date.now()}`,task_type:"CUSTOM_JOB",task_reference:"",description:"",task_config:{},retry_policy:{max_retries:3,retry_delay_seconds:60},position_x:100,position_y:100,metadata:{},priority:0,condition_type:"ALWAYS",condition_expression:"",parent_condition_task_name:"",loop_type:null,loop_config:{}};n(r),A(!0)},[]),P=o.useCallback(r=>{const h=[...x],m=h.findIndex(y=>y.task_name===r.task_name);m>=0?h[m]=r:h.push(r),s(h,a),A(!1),n(null)},[x,a,s]),C=o.useCallback(r=>{if(!confirm(`Delete task "${r}"?`))return;const h=x.filter(y=>y.task_name!==r),m=a.filter(y=>y.upstream_task_name!==r&&y.downstream_task_name!==r);s(h,m)},[x,a,s]),v=o.useCallback((r,h)=>{h.stopPropagation(),j(r);const m=u.find(y=>y.id===r);m&&(S(!0),F({x:h.clientX-m.x,y:h.clientY-m.y}))},[u]),M=o.useCallback(r=>{if(i&&c&&u.find(m=>m.id===c)){const m=r.clientX-T.x,y=r.clientY-T.y,H=u.map(k=>k.id===c?{...k,x:m,y}:k);f(H);const B=x.map(k=>k.task_name===c?{...k,position_x:m,position_y:y}:k);s(B,a)}},[i,c,T,u,x,a,s]),U=o.useCallback(()=>{S(!1)},[]),p=r=>{switch(r){case"CUSTOM_JOB":return t.accent;case"DATA_WAREHOUSE":return t.success;case"DATA_VAULT":return t.warning;default:return t.foreground}},$=r=>{switch(r){case"CUSTOM_JOB":return"JOB";case"DATA_WAREHOUSE":return"DW";case"DATA_VAULT":return"DV";default:return r}},W=r=>r.condition_type==="IF"?"IF":r.condition_type==="ELSE_IF"?"ELSE IF":r.condition_type==="ELSE"?"ELSE":"",w=r=>r.priority&&r.priority>0?`P${r.priority}`:"";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:t.accent},children:"Tasks:"})," ",x.length," |"," ",e.jsx("strong",{style:{color:t.accent},children:"Dependencies:"})," ",a.length]}),e.jsx(_,{label:"+ Add Task",onClick:E,variant:"primary"})]}),e.jsxs("div",{ref:D,style:{position:"relative",width:"100%",height:"600px",border:`2px solid ${t.border}`,borderRadius:4,backgroundColor:t.background,overflow:"auto",cursor:i?"grabbing":"default"},onMouseMove:M,onMouseUp:U,onMouseLeave:U,children:[u.map(r=>{const h=a.filter(y=>y.downstream_task_name===r.id),m=a.filter(y=>y.upstream_task_name===r.id);return e.jsxs("div",{children:[h.map((y,H)=>{const B=u.find(V=>V.id===y.upstream_task_name);if(!B)return null;const k=r.x-B.x,d=r.y-B.y,z=Math.sqrt(k*k+d*d),J=Math.atan2(d,k)*180/Math.PI;return e.jsx("div",{style:{position:"absolute",left:B.x+60,top:B.y+30,width:z-120,height:2,backgroundColor:t.border,transformOrigin:"0 50%",transform:`rotate(${J}deg)`,zIndex:1}},`${y.upstream_task_name}-${r.id}-${H}`)}),e.jsxs("div",{style:{position:"absolute",left:r.x,top:r.y,width:120,minHeight:60,padding:12,backgroundColor:c===r.id?t.accent+"20":t.background,border:`2px solid ${c===r.id?t.accent:p(r.task.task_type)}`,borderRadius:4,cursor:"grab",zIndex:2,fontFamily:"Consolas",fontSize:11},onMouseDown:y=>v(r.id,y),onDoubleClick:()=>{n(r.task),A(!0)},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsx("div",{style:{padding:"2px 6px",backgroundColor:p(r.task.task_type),color:t.background,borderRadius:2,fontSize:9,fontWeight:600},children:$(r.task.task_type)}),e.jsx("button",{onClick:y=>{y.stopPropagation(),C(r.task.task_name)},style:{background:"none",border:"none",color:t.danger,cursor:"pointer",fontSize:12,padding:0,width:16,height:16},children:"âœ•"})]}),e.jsx("div",{style:{fontWeight:600,color:t.foreground,marginBottom:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.task.task_name}),e.jsx("div",{style:{fontSize:10,color:t.muted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.task.task_reference||"No reference"}),(W(r.task)||w(r.task))&&e.jsxs("div",{style:{marginTop:4,fontSize:8,color:t.accent,display:"flex",gap:4},children:[W(r.task)&&e.jsx("span",{style:{padding:"1px 4px",backgroundColor:t.accentLight,borderRadius:2},children:W(r.task)}),w(r.task)&&e.jsx("span",{style:{padding:"1px 4px",backgroundColor:t.warning,borderRadius:2},children:w(r.task)})]}),e.jsxs("div",{style:{marginTop:6,fontSize:9,color:t.muted},children:["â†‘ ",h.length," | â†“ ",m.length]})]})]},r.id)}),u.length===0&&e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",color:t.muted},children:[e.jsx("div",{style:{fontSize:48,marginBottom:12,opacity:.4},children:K.blockFull}),e.jsx("div",{children:'No tasks yet. Click "Add Task" to get started.'})]})]}),L&&R&&e.jsx(le,{task:R,onSave:P,onClose:()=>{A(!1),n(null)},availableCustomJobs:l,availableWarehouses:b,availableVaults:g})]})},le=({task:x,onSave:a,onClose:s,availableCustomJobs:l,availableWarehouses:b,availableVaults:g})=>{const[u,f]=o.useState(x),c=()=>{if(!u.task_name.trim()){alert("Task name is required");return}if(!u.task_reference.trim()){alert("Task reference is required");return}a(u)},j=()=>{switch(u.task_type){case"CUSTOM_JOB":return l.map(i=>i.job_name);case"DATA_WAREHOUSE":return b.map(i=>i.warehouse_name);case"DATA_VAULT":return g.map(i=>i.vault_name);default:return[]}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:t.background,border:`2px solid ${t.border}`,borderRadius:4,padding:24,width:"500px",maxWidth:"90vw",maxHeight:"90vh",overflow:"auto"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:16,color:t.accent},children:x.task_name?"Edit Task":"Add Task"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Task Name *"}),e.jsx("input",{type:"text",value:u.task_name,onChange:i=>f({...u,task_name:i.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Task Type *"}),e.jsxs("select",{value:u.task_type,onChange:i=>f({...u,task_type:i.target.value,task_reference:""}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none",cursor:"pointer"},children:[e.jsx("option",{value:"CUSTOM_JOB",children:"Custom Job"}),e.jsx("option",{value:"DATA_WAREHOUSE",children:"Data Warehouse"}),e.jsx("option",{value:"DATA_VAULT",children:"Data Vault"}),e.jsx("option",{value:"SYNC",children:"Sync"}),e.jsx("option",{value:"API_CALL",children:"API Call"}),e.jsx("option",{value:"SCRIPT",children:"Script"}),e.jsx("option",{value:"SUB_WORKFLOW",children:"Sub-Workflow"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Reference *"}),j().length>0?e.jsxs("select",{value:u.task_reference,onChange:i=>f({...u,task_reference:i.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"Select..."}),j().map(i=>e.jsx("option",{value:i,children:i},i))]}):e.jsx("input",{type:"text",value:u.task_reference,onChange:i=>f({...u,task_reference:i.target.value}),placeholder:"Enter reference name",style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Description"}),e.jsx("textarea",{value:u.description||"",onChange:i=>f({...u,description:i.target.value}),rows:2,style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none",resize:"vertical"}})]})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx(_,{label:"Cancel",onClick:s,variant:"ghost"}),e.jsx(_,{label:"Save",onClick:c,variant:"primary"})]})]})})},ie=({onClose:x,onSave:a,workflow:s})=>{const[l,b]=o.useState({workflow_name:(s==null?void 0:s.workflow_name)||"",description:(s==null?void 0:s.description)||"",schedule_cron:(s==null?void 0:s.schedule_cron)||"",active:(s==null?void 0:s.active)!==void 0?s.active:!0,enabled:(s==null?void 0:s.enabled)!==void 0?s.enabled:!0,retry_policy:(s==null?void 0:s.retry_policy)||{max_retries:3,retry_delay_seconds:60,retry_backoff_multiplier:2},sla_config:(s==null?void 0:s.sla_config)||{max_execution_time_seconds:3600,alert_on_sla_breach:!0},metadata:(s==null?void 0:s.metadata)||{}}),[g,u]=o.useState((s==null?void 0:s.tasks)||[]),[f,c]=o.useState((s==null?void 0:s.dependencies)||[]),[j,i]=o.useState(null),[S,T]=o.useState(!1),[F,L]=o.useState("basic"),[A,R]=o.useState([]),[n,D]=o.useState([]),[E,P]=o.useState([]),[C,v]=o.useState([]);o.useEffect(()=>{(async()=>{var $;try{const[W,w,r,h]=await Promise.all([Q.getJobs({page:1,limit:1e3}),Z.getWarehouses({page:1,limit:1e3}),ee.getVaults({page:1,limit:1e3}),I.getWorkflows({page:1,limit:1e3})]);R(W.data||[]),D(w.data||[]),P(r.data||[]),v((($=h.data)==null?void 0:$.filter(m=>m.workflow_name!==(s==null?void 0:s.workflow_name)))||[])}catch(W){console.error("Error loading references:",W)}})()},[s]);const M=o.useCallback(async()=>{if(!l.workflow_name.trim()){i("Workflow name is required");return}if(g.length===0){i("At least one task is required");return}T(!0),i(null);try{const p={...l,tasks:g,dependencies:f};s?await I.updateWorkflow(s.workflow_name,p):await I.createWorkflow(p),a()}catch(p){i(N(p))}finally{T(!1)}},[l,g,f,s,a]),U=o.useCallback((p,$)=>{u(p),c($)},[]);return e.jsx(O,{title:s?`EDIT WORKFLOW: ${s.workflow_name}`:"ADD WORKFLOW",onClose:x,style:{width:"90vw",maxWidth:"1400px",maxHeight:"90vh",overflow:"auto"},children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[j&&e.jsx("div",{style:{padding:12,marginBottom:16,backgroundColor:t.danger+"20",border:`1px solid ${t.danger}`,color:t.danger,borderRadius:2},children:j}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,borderBottom:`1px solid ${t.border}`,paddingBottom:8},children:[e.jsx(_,{label:"Basic Info",onClick:()=>L("basic"),variant:F==="basic"?"primary":"ghost"}),e.jsx(_,{label:"DAG Builder",onClick:()=>L("dag"),variant:F==="dag"?"primary":"ghost"})]}),F==="basic"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,color:t.foreground,fontWeight:600},children:"Workflow Name *"}),e.jsx("input",{type:"text",value:l.workflow_name,onChange:p=>b({...l,workflow_name:p.target.value}),disabled:!!s,style:{width:"100%",padding:"8px 12px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:s?t.backgroundSoft:t.background,color:t.foreground,outline:"none"},placeholder:"my_workflow"})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,color:t.foreground,fontWeight:600},children:"Description"}),e.jsx("textarea",{value:l.description,onChange:p=>b({...l,description:p.target.value}),rows:3,style:{width:"100%",padding:"8px 12px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none",resize:"vertical"},placeholder:"Workflow description..."})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,color:t.foreground,fontWeight:600},children:"Schedule (Cron)"}),e.jsx("input",{type:"text",value:l.schedule_cron,onChange:p=>b({...l,schedule_cron:p.target.value}),style:{width:"100%",padding:"8px 12px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"},placeholder:"0 0 * * * (leave empty for manual execution)"}),e.jsx("div",{style:{fontSize:10,color:t.muted,marginTop:4},children:'Format: minute hour day month day-of-week (e.g., "0 0 * * *" for daily at midnight)'})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:p=>b({...l,active:p.target.checked}),style:{cursor:"pointer"}}),e.jsx("span",{style:{color:t.foreground},children:"Active"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:l.enabled,onChange:p=>b({...l,enabled:p.target.checked}),style:{cursor:"pointer"}}),e.jsx("span",{style:{color:t.foreground},children:"Enabled"})]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${t.border}`,paddingTop:16},children:[e.jsx("h3",{style:{fontSize:13,marginBottom:12,color:t.accent},children:"Retry Policy"}),e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Max Retries"}),e.jsx("input",{type:"number",value:l.retry_policy.max_retries,onChange:p=>b({...l,retry_policy:{...l.retry_policy,max_retries:parseInt(p.target.value)||3}}),min:0,max:10,style:{width:100,padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Retry Delay (seconds)"}),e.jsx("input",{type:"number",value:l.retry_policy.retry_delay_seconds,onChange:p=>b({...l,retry_policy:{...l.retry_policy,retry_delay_seconds:parseInt(p.target.value)||60}}),min:1,style:{width:100,padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Backoff Multiplier"}),e.jsx("input",{type:"number",step:"0.1",value:l.retry_policy.retry_backoff_multiplier,onChange:p=>b({...l,retry_policy:{...l.retry_policy,retry_backoff_multiplier:parseFloat(p.target.value)||2}}),min:1,max:10,style:{width:100,padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]})]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${t.border}`,paddingTop:16},children:[e.jsx("h3",{style:{fontSize:13,marginBottom:12,color:t.accent},children:"SLA Configuration"}),e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:6,fontSize:11,color:t.muted},children:"Max Execution Time (seconds)"}),e.jsx("input",{type:"number",value:l.sla_config.max_execution_time_seconds,onChange:p=>b({...l,sla_config:{...l.sla_config,max_execution_time_seconds:parseInt(p.target.value)||3600}}),min:1,style:{width:150,padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginTop:24},children:[e.jsx("input",{type:"checkbox",checked:l.sla_config.alert_on_sla_breach,onChange:p=>b({...l,sla_config:{...l.sla_config,alert_on_sla_breach:p.target.checked}}),style:{cursor:"pointer"}}),e.jsx("span",{style:{color:t.foreground},children:"Alert on SLA Breach"})]})]})]})]}),F==="dag"&&e.jsx(ae,{tasks:g,dependencies:f,onUpdate:U,availableCustomJobs:A,availableWarehouses:n,availableVaults:E}),e.jsxs("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:8,borderTop:`1px solid ${t.border}`,paddingTop:16},children:[e.jsx(_,{label:"Cancel",onClick:x,variant:"ghost",disabled:S}),e.jsx(_,{label:S?"Saving...":"Save",onClick:M,variant:"primary",disabled:S})]})]})})},de=({workflows:x})=>{const[a,s]=o.useState(null),[l,b]=o.useState([]),[g,u]=o.useState(null),[f,c]=o.useState([]),[j,i]=o.useState(!1),[S,T]=o.useState(null);o.useEffect(()=>{a&&F(a.workflow_name)},[a]),o.useEffect(()=>{g&&L(g.workflow_name,g.execution_id)},[g]);const F=o.useCallback(async n=>{i(!0),T(null);try{const D=await I.getExecutions(n,50);b(D)}catch(D){T(N(D))}finally{i(!1)}},[]),L=o.useCallback(async(n,D)=>{try{const E=await I.getTaskExecutions(n,D);c(E)}catch(E){console.error("Error loading task executions:",E)}},[]),A=n=>{switch(n){case"SUCCESS":return t.success;case"FAILED":return t.danger;case"RUNNING":return t.warning;case"PENDING":return t.muted;default:return t.foreground}},R=n=>n?n<60?`${n}s`:n<3600?`${Math.floor(n/60)}m ${n%60}s`:`${Math.floor(n/3600)}h ${Math.floor(n%3600/60)}m`:"N/A";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[e.jsx(O,{title:"SELECT WORKFLOW",children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:x.map(n=>e.jsx("button",{onClick:()=>s(n),style:{padding:"8px 16px",border:`2px solid ${(a==null?void 0:a.workflow_name)===n.workflow_name?t.accent:t.border}`,borderRadius:4,backgroundColor:(a==null?void 0:a.workflow_name)===n.workflow_name?t.accent+"20":t.background,color:t.foreground,cursor:"pointer",fontFamily:"Consolas",fontSize:12,fontWeight:(a==null?void 0:a.workflow_name)===n.workflow_name?600:400},children:n.workflow_name},n.workflow_name))})}),a&&e.jsxs(e.Fragment,{children:[S&&e.jsx(O,{title:"ERROR",children:e.jsx("div",{style:{padding:12,color:t.danger},children:S})}),e.jsx(O,{title:`EXECUTIONS: ${a.workflow_name}`,children:j?e.jsx("div",{style:{padding:20,textAlign:"center",color:t.muted},children:"Loading..."}):l.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:t.muted},children:"No executions found"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:l.map(n=>e.jsxs("div",{onClick:()=>u(n),style:{padding:12,border:`1px solid ${(g==null?void 0:g.execution_id)===n.execution_id?t.accent:t.border}`,borderRadius:4,backgroundColor:(g==null?void 0:g.execution_id)===n.execution_id?t.accent+"10":t.background,cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:t.accent},children:n.execution_id}),e.jsx("span",{style:{marginLeft:12,color:A(n.status),fontWeight:600},children:n.status})]}),e.jsx("div",{style:{fontSize:11,color:t.muted},children:n.start_time?new Date(n.start_time).toLocaleString():"N/A"})]}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:11,color:t.muted},children:[e.jsxs("span",{children:["Duration: ",R(n.duration_seconds)]}),e.jsxs("span",{children:["Tasks: ",n.completed_tasks,"/",n.total_tasks]}),e.jsxs("span",{children:["Failed: ",n.failed_tasks]}),e.jsxs("span",{children:["Trigger: ",n.trigger_type]})]}),n.error_message&&e.jsx("div",{style:{marginTop:8,padding:8,backgroundColor:t.danger+"20",borderRadius:2,fontSize:11,color:t.danger},children:n.error_message})]},n.execution_id))})}),g&&e.jsx(O,{title:`TASK EXECUTIONS: ${g.execution_id}`,children:f.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:t.muted},children:"No task executions found"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:f.map(n=>e.jsxs("div",{style:{padding:12,border:`1px solid ${t.border}`,borderRadius:4,backgroundColor:t.background},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:t.foreground},children:n.task_name}),e.jsx("span",{style:{marginLeft:12,color:A(n.status),fontWeight:600},children:n.status})]}),e.jsx("div",{style:{fontSize:11,color:t.muted},children:n.start_time?new Date(n.start_time).toLocaleString():"N/A"})]}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:11,color:t.muted},children:[e.jsxs("span",{children:["Duration: ",R(n.duration_seconds)]}),e.jsxs("span",{children:["Retries: ",n.retry_count]})]}),n.error_message&&e.jsx("div",{style:{marginTop:8,padding:8,backgroundColor:t.danger+"20",borderRadius:2,fontSize:11,color:t.danger},children:n.error_message})]},n.id))})})]})]})},fe=()=>{var B,k;const{setPage:x}=te(1,20),{filters:a,setFilter:s}=ne({active:"",enabled:""}),[l,b]=o.useState(""),[g,u]=o.useState(""),[f,c]=o.useState(null),[j,i]=o.useState([]),[S,T]=o.useState(!0),[F,L]=o.useState(!1),[A,R]=o.useState(null),[n,D]=o.useState(null),[E,P]=o.useState("list"),C=o.useRef(!0),v=o.useCallback(async()=>{if(!C.current)return;const d=Date.now(),z=300;try{T(!0),c(null);const V={page:1,limit:1e4,search:re(g,100)};a.active&&(V.active=a.active),a.enabled&&(V.enabled=a.enabled);const G=await I.getWorkflows(V),q=Date.now()-d,X=Math.max(0,z-q);await new Promise(Y=>setTimeout(Y,X)),C.current&&i(G.data||[])}catch(J){C.current&&c(N(J))}finally{C.current&&T(!1)}},[g,a]);o.useEffect(()=>(C.current=!0,v(),()=>{C.current=!1}),[v]);const M=o.useCallback(()=>{u(l),x(1)},[l,x]),U=o.useCallback(d=>{d.key==="Enter"&&M()},[M]),p=o.useCallback(async d=>{if(confirm(`Are you sure you want to delete workflow "${d}"?`))try{await I.deleteWorkflow(d),v()}catch(z){C.current&&c(N(z))}},[v]),$=o.useCallback(d=>{R(d||null),L(!0)},[]),W=o.useCallback(()=>{L(!1),R(null)},[]),w=o.useCallback(()=>{v(),W()},[v,W]),r=o.useCallback(async d=>{try{await I.toggleActive(d),v()}catch(z){C.current&&c(N(z))}},[v]),h=o.useCallback(async d=>{try{await I.toggleEnabled(d),v()}catch(z){C.current&&c(N(z))}},[v]),m=o.useCallback(async d=>{try{c(null),await I.executeWorkflow(d),v(),setTimeout(()=>{v()},2e3)}catch(z){C.current&&c(N(z))}},[v]),y=o.useCallback(async d=>{D(d),c(null)},[]),H=j.filter(d=>!(a.active&&String(d.active)!==a.active||a.enabled&&String(d.enabled)!==a.enabled));return S&&j.length===0?e.jsx(oe,{variant:"table"}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:t.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:t.accent,marginRight:8},children:K.blockFull}),"WORKFLOW ORCHESTRATION (DAGs)"]}),e.jsx("div",{style:{display:"flex",gap:8},children:e.jsx(_,{label:E==="list"?"ðŸ“Š Monitor":"ðŸ“‹ List",onClick:()=>P(E==="list"?"monitor":"list"),variant:"ghost"})})]}),f&&e.jsx("div",{style:{marginBottom:20},children:e.jsx(O,{title:"ERROR",children:e.jsx("div",{style:{padding:"12px",color:t.danger,fontSize:12,fontFamily:"Consolas"},children:f})})}),E==="list"?e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"SEARCH",children:e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"8px 0"},children:[e.jsx("input",{type:"text",placeholder:"Search by workflow name or description...",value:l,onChange:d=>b(d.target.value),onKeyPress:U,style:{flex:1,padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"},onFocus:d=>{d.currentTarget.style.borderColor=t.accent},onBlur:d=>{d.currentTarget.style.borderColor=t.border}}),e.jsx(_,{label:"Search",onClick:M,variant:"primary"}),g&&e.jsx(_,{label:"Clear",onClick:()=>{b(""),u(""),x(1)},variant:"ghost"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsx(O,{title:"FILTERS",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12,padding:"8px 0"},children:[e.jsx(_,{label:"Add Workflow",onClick:()=>$(),variant:"primary"}),e.jsxs("select",{value:a.active,onChange:d=>s("active",d.target.value),style:{padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]}),e.jsxs("select",{value:a.enabled,onChange:d=>s("enabled",d.target.value),style:{padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"",children:"All Enabled"}),e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]})})}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:20},children:[e.jsx("div",{style:{flex:"0 0 300px"},children:e.jsx(O,{title:"WORKFLOWS",style:{minHeight:"400px"},children:S?e.jsx("div",{style:{padding:20,textAlign:"center",color:t.muted},children:"Loading..."}):e.jsx(se,{workflows:H,onWorkflowClick:y,onDelete:p,onEdit:$,onToggleActive:r,onToggleEnabled:h,onExecute:m,selectedWorkflow:n})})}),n&&e.jsx("div",{style:{flex:1},children:e.jsx(O,{title:`WORKFLOW: ${n.workflow_name}`,children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Description:"})," ",e.jsx("span",{style:{color:t.foreground},children:n.description||"No description"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Schedule:"})," ",e.jsx("span",{style:{color:t.foreground},children:n.schedule_cron||"Manual"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Status:"})," ",e.jsx("span",{style:{color:n.active?t.success:t.danger},children:n.active?"Active":"Inactive"})," / ",e.jsx("span",{style:{color:n.enabled?t.success:t.danger},children:n.enabled?"Enabled":"Disabled"})]}),n.last_execution_time&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Last Execution:"})," ",e.jsx("span",{style:{color:t.foreground},children:new Date(n.last_execution_time).toLocaleString()})," - ",e.jsx("span",{style:{color:n.last_execution_status==="SUCCESS"?t.success:n.last_execution_status==="FAILED"?t.danger:t.warning},children:n.last_execution_status||"Unknown"})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx("strong",{style:{color:t.accent},children:"Tasks:"})," ",e.jsx("span",{style:{color:t.foreground},children:((B=n.tasks)==null?void 0:B.length)||0})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("strong",{style:{color:t.accent},children:"Dependencies:"})," ",e.jsx("span",{style:{color:t.foreground},children:((k=n.dependencies)==null?void 0:k.length)||0})]}),e.jsxs("div",{style:{marginTop:24,display:"flex",gap:8},children:[e.jsx(_,{label:"Edit",onClick:()=>$(n),variant:"primary"}),e.jsx(_,{label:"Execute",onClick:()=>m(n.workflow_name),variant:"primary"}),e.jsx(_,{label:n.active?"Deactivate":"Activate",onClick:()=>r(n.workflow_name),variant:"ghost"}),e.jsx(_,{label:n.enabled?"Disable":"Enable",onClick:()=>h(n.workflow_name),variant:"ghost"})]})]})})})]})]}):e.jsx(de,{workflows:j}),F&&e.jsx(ie,{workflow:A,onClose:W,onSave:w})]})};export{fe as default};
