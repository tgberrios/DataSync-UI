import{r as l,j as e,b as t,e as O,a6 as C}from"./index-b1fa964d.js";import{A as N}from"./AsciiPanel-3399d5be.js";import{A as m}from"./AsciiButton-3fcfdd9b.js";import{e as $}from"./errorHandler-5ea9ae85.js";import{s as z}from"./validation-24839588.js";import{S as L}from"./SkeletonLoader-09c12074.js";const J=({source:o,onClose:u})=>{const[r,y]=l.useState({source_name:"",source_type:"table",database_name:"",schema_name:"",table_name:"",connection_string:"",description:"",columns:[],freshness_config:{},metadata:{},active:!0}),[g,d]=l.useState(null),[p,b]=l.useState(!1);l.useEffect(()=>{o&&y({source_name:o.source_name||"",source_type:o.source_type||"table",database_name:o.database_name||"",schema_name:o.schema_name||"",table_name:o.table_name||"",connection_string:o.connection_string||"",description:o.description||"",columns:o.columns||[],freshness_config:o.freshness_config||{},metadata:o.metadata||{},active:o.active!==void 0?o.active:!0})},[o]);const s=(n,i)=>{y(S=>({...S,[n]:i}))},f=async()=>{if(!r.source_name||!r.source_type||!r.schema_name||!r.table_name){d("Source name, type, schema name, and table name are required");return}try{b(!0),d(null),o?await C.updateSource(o.source_name,o.schema_name,o.table_name,r):await C.createOrUpdateSource(r),u()}catch(n){d($(n))}finally{b(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},onClick:n=>{n.target===n.currentTarget&&u()},children:e.jsx(N,{style:{width:"90%",maxWidth:"1000px",maxHeight:"90vh",overflow:"auto"},children:e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("h2",{style:{color:t.cyan,margin:0},children:o?"Edit Source":"New Source"}),e.jsx(m,{label:"Close",onClick:u,variant:"ghost"})]}),g&&e.jsx("div",{style:{color:t.red,marginBottom:"15px",padding:"10px",border:`1px solid ${t.red}`},children:g}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Source Name *"}),e.jsx("input",{type:"text",value:r.source_name,onChange:n=>s("source_name",n.target.value),disabled:!!o,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Source Type *"}),e.jsxs("select",{value:r.source_type,onChange:n=>s("source_type",n.target.value),style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"},children:[e.jsx("option",{value:"table",children:"Table"}),e.jsx("option",{value:"view",children:"View"}),e.jsx("option",{value:"query",children:"Query"}),e.jsx("option",{value:"api",children:"API"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Schema Name *"}),e.jsx("input",{type:"text",value:r.schema_name,onChange:n=>s("schema_name",n.target.value),disabled:!!o,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Table Name *"}),e.jsx("input",{type:"text",value:r.table_name,onChange:n=>s("table_name",n.target.value),disabled:!!o,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Database Name"}),e.jsx("input",{type:"text",value:r.database_name||"",onChange:n=>s("database_name",n.target.value),style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Connection String"}),e.jsx("input",{type:"text",value:r.connection_string||"",onChange:n=>s("connection_string",n.target.value),placeholder:"postgresql://user:pass@host:port/db",style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Description"}),e.jsx("textarea",{value:r.description||"",onChange:n=>s("description",n.target.value),rows:2,style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",resize:"vertical"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Columns (JSON array)"}),e.jsx("textarea",{value:JSON.stringify(r.columns||[],null,2),onChange:n=>{try{const i=JSON.parse(n.target.value||"[]");s("columns",Array.isArray(i)?i:[])}catch{s("columns",[])}},rows:5,placeholder:'[{"name": "column1", "type": "VARCHAR", "description": "..."}]',style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",resize:"vertical"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{color:t.text,display:"block",marginBottom:"5px"},children:"Freshness Config (JSON object)"}),e.jsx("textarea",{value:JSON.stringify(r.freshness_config||{},null,2),onChange:n=>{try{const i=JSON.parse(n.target.value||"{}");s("freshness_config",typeof i=="object"?i:{})}catch{s("freshness_config",{})}},rows:3,placeholder:'{"warn_after": {"count": 12, "period": "hour"}, "error_after": {"count": 24, "period": "hour"}}',style:{width:"100%",padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace",resize:"vertical"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"10px",alignItems:"center"},children:e.jsxs("label",{style:{color:t.text,display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:n=>s("active",n.target.checked)}),"Active"]})})]}),e.jsx("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:e.jsx(m,{label:p?O.loading:"Save",onClick:f,disabled:p})})]})})})},U=()=>{const[o,u]=l.useState(""),[r,y]=l.useState(""),[g,d]=l.useState(null),[p,b]=l.useState([]),[s,f]=l.useState(!0),[n,i]=l.useState(!1),[S,k]=l.useState(null),c=l.useRef(!0),x=l.useCallback(async()=>{if(!c.current)return;const a=Date.now(),B=300;try{f(!0),d(null);const j=await C.getSources(),F=Date.now()-a,I=Math.max(0,B-F);if(await new Promise(v=>setTimeout(v,I)),c.current){let v=j;if(r){const _=z(r,100).toLowerCase();v=j.filter(h=>h.source_name.toLowerCase().includes(_)||h.schema_name.toLowerCase().includes(_)||h.table_name.toLowerCase().includes(_)||h.description&&h.description.toLowerCase().includes(_))}b(v)}}catch(j){c.current&&d($(j))}finally{c.current&&f(!1)}},[r]);l.useEffect(()=>(c.current=!0,x(),()=>{c.current=!1}),[x]);const w=l.useCallback(()=>{y(o)},[o]),D=l.useCallback(a=>{a.key==="Enter"&&w()},[w]),E=l.useCallback(async a=>{if(confirm(`Are you sure you want to delete source "${a.source_name}" (${a.schema_name}.${a.table_name})?`))try{await C.deleteSource(a.source_name,a.schema_name,a.table_name),x()}catch(B){c.current&&d($(B))}},[x]),A=l.useCallback(a=>{k(a||null),i(!0)},[]),T=l.useCallback(()=>{i(!1),k(null),x()},[x]);return s&&p.length===0?e.jsx(L,{variant:"table"}):e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs(N,{children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("h2",{style:{color:t.cyan,margin:0},children:"DBT SOURCES"}),e.jsx(m,{label:"New Source",onClick:()=>A()})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px"},children:[e.jsx("input",{type:"text",placeholder:"Search sources...",value:o,onChange:a=>u(a.target.value),onKeyPress:D,style:{flex:1,padding:"8px",backgroundColor:t.bg,color:t.text,border:`1px solid ${t.border}`,fontFamily:"monospace"}}),e.jsx(m,{label:"Search",onClick:w})]}),g&&e.jsx("div",{style:{color:t.red,marginBottom:"15px",padding:"10px",border:`1px solid ${t.red}`},children:g})]}),p.length===0?e.jsx("div",{style:{color:t.muted,textAlign:"center",padding:"40px"},children:r?"No sources found matching your search.":"No sources found. Create your first source!"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:p.map(a=>e.jsxs("div",{style:{padding:"15px",border:`1px solid ${t.border}`,backgroundColor:t.bg,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"5px"},children:[e.jsx("span",{style:{color:t.cyan,fontWeight:"bold"},children:a.source_name}),e.jsxs("span",{style:{color:t.muted},children:[a.schema_name,".",a.table_name]}),e.jsx("span",{style:{padding:"1px 6px",fontSize:"10px",border:`1px solid ${t.border}`,color:t.muted,backgroundColor:"transparent"},children:a.source_type}),a.active&&e.jsx("span",{style:{padding:"1px 6px",fontSize:"10px",border:`1px solid ${t.border}`,color:t.muted,backgroundColor:"transparent"},children:"Active"})]}),a.description&&e.jsx("div",{style:{color:t.text,fontSize:"12px",marginTop:"5px"},children:a.description}),a.database_name&&e.jsxs("div",{style:{color:t.muted,fontSize:"11px",marginTop:"5px"},children:["Database: ",a.database_name]})]}),e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[e.jsx(m,{label:"Edit",onClick:()=>A(a),variant:"ghost"}),e.jsx(m,{label:"Delete",onClick:()=>E(a),variant:"ghost"})]})]},`${a.source_name}-${a.schema_name}-${a.table_name}`))})]}),n&&e.jsx(J,{source:S,onClose:T})]})};export{U as default};
