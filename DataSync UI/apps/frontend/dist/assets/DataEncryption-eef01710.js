import{f as w,t as u,b as o,r as l,a2 as p,j as e,a3 as te,a4 as oe,e as E}from"./index-75d7470b.js";import{S as ne}from"./SkeletonLoader-530eacc4.js";import{e as f}from"./errorHandler-5ea9ae85.js";import{A as R}from"./AsciiPanel-9f053981.js";import{A as d}from"./AsciiButton-446d8430.js";const F=w.table`
  width: 100%;
  border-collapse: collapse;
  margin-top: ${u.spacing.lg};
  background: ${u.colors.background.main};
  box-shadow: ${u.shadows.md};
  border-radius: ${u.borderRadius.md};
  overflow: hidden;
`,c=w.th`
  padding: ${u.spacing.sm};
  text-align: left;
  border-bottom: 2px solid ${o.border};
  background: ${o.backgroundSoft};
  font-weight: bold;
  font-family: "Consolas";
  font-size: 13px;
  color: ${o.accent};
  position: sticky;
  top: 0;
  z-index: 10;
`,i=w.td`
  padding: ${u.spacing.sm};
  border-bottom: 1px solid ${o.border};
  font-family: "Consolas";
  font-size: 12px;
  transition: all ${u.transitions.normal};
`,N=w.tr`
  transition: all ${u.transitions.normal};
  
  &:hover {
    background: linear-gradient(90deg, ${u.colors.background.main} 0%, ${u.colors.background.tertiary} 100%);
    transform: scale(1.001);
    box-shadow: ${u.shadows.sm};
    
    ${i} {
      border-bottom-color: rgba(10, 25, 41, 0.1);
    }
  }
`,T=r=>r?new Date(r).toLocaleString():"-",de=()=>{const r=l.useRef(!0),[D,B]=l.useState(!0),[I,s]=l.useState(null),[A,M]=l.useState([]),[W,j]=l.useState(!1),[a,m]=l.useState(null),[h,$]=l.useState({schema_name:"",table_name:"",active:""}),[k,K]=l.useState(1),[C,Y]=l.useState(0),v=20,[z,L]=l.useState([]),[O,_]=l.useState(!1),[y,S]=l.useState({key_id:"",key_value:"",algorithm:"AES256"}),x=l.useCallback(async()=>{if(!r.current)return;const t=Date.now(),n=300;try{B(!0),s(null);const g={page:k,limit:v};h.schema_name&&(g.schema_name=h.schema_name),h.table_name&&(g.table_name=h.table_name),h.active!==""&&(g.active=h.active==="true");const P=await p.getAll(g),Q=Date.now()-t,Z=Math.max(0,n-Q);await new Promise(ee=>setTimeout(ee,Z)),r.current&&(M(P.policies||[]),Y(P.total||0))}catch(g){r.current&&s(f(g))}finally{r.current&&B(!1)}},[k,h]),b=l.useCallback(async()=>{try{const t=await p.getKeys();L(t.keys||[])}catch(t){console.error("Error fetching encryption keys:",t)}},[]);l.useEffect(()=>(r.current=!0,x(),b(),()=>{r.current=!1}),[x,b]);const V=l.useCallback(()=>{m({policy_name:"",schema_name:"",table_name:"",column_name:"",encryption_algorithm:"AES256",key_id:"",key_rotation_interval_days:90,active:!0}),j(!0)},[]),H=l.useCallback(t=>{m({...t}),j(!0)},[]),q=l.useCallback(async t=>{if(confirm("Are you sure you want to delete this encryption policy?"))try{await p.delete(t),x()}catch(n){r.current&&s(f(n))}},[x]),G=l.useCallback(async()=>{if(a)try{s(null),a.policy_id?await p.update(a.policy_id,a):await p.create(a),j(!1),x()}catch(t){r.current&&s(f(t))}},[a,x]),U=l.useCallback(async t=>{if(confirm(`Are you sure you want to encrypt all data in ${t.schema_name}.${t.table_name}.${t.column_name}? This action cannot be undone.`))try{s(null),await p.encryptColumn(t.schema_name,t.table_name,t.column_name,t.key_id),alert("Column encrypted successfully"),x()}catch(n){r.current&&s(f(n))}},[x]),X=l.useCallback(async t=>{const n=prompt(`Enter new key ID for policy "${t.policy_name}":`);if(n)try{s(null),await p.rotateKey(t.policy_id,n),alert("Encryption key rotated successfully"),x(),b()}catch(g){r.current&&s(f(g))}},[x,b]),J=l.useCallback(async()=>{if(!y.key_id||!y.key_value){alert("Key ID and Key Value are required");return}try{s(null),await p.createKey(y.key_id,y.key_value,y.algorithm),_(!1),S({key_id:"",key_value:"",algorithm:"AES256"}),b()}catch(t){r.current&&s(f(t))}},[y,b]);return D&&A.length===0?e.jsx(ne,{variant:"table"}):e.jsxs(te,{children:[I&&e.jsx(oe,{message:I,onClose:()=>s(null)}),e.jsx("div",{style:{marginBottom:20},children:e.jsx(R,{title:"DATA ENCRYPTION",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16,flexWrap:"wrap"},children:[e.jsx(d,{label:`${E.blockFull} Create Encryption Policy`,onClick:V}),e.jsx(d,{label:`${E.blockFull} Manage Keys`,onClick:()=>_(!0),variant:"ghost"})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",gap:12,flexWrap:"wrap"},children:[e.jsx("input",{type:"text",placeholder:"Schema name",value:h.schema_name,onChange:t=>$(n=>({...n,schema_name:t.target.value})),style:{padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,flex:1,minWidth:150}}),e.jsx("input",{type:"text",placeholder:"Table name",value:h.table_name,onChange:t=>$(n=>({...n,table_name:t.target.value})),style:{padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,flex:1,minWidth:150}}),e.jsxs("select",{value:h.active,onChange:t=>$(n=>({...n,active:t.target.value})),style:{padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2,minWidth:120},children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs("div",{style:{marginBottom:12,fontSize:11,color:o.muted},children:["Encryption Policies (",C,")"]}),e.jsxs(F,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Policy Name"}),e.jsx(c,{children:"Schema.Table.Column"}),e.jsx(c,{children:"Algorithm"}),e.jsx(c,{children:"Key ID"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Last Rotated"}),e.jsx(c,{children:"Actions"})]})}),e.jsx("tbody",{children:A.length===0?e.jsx("tr",{children:e.jsx(i,{colSpan:7,style:{textAlign:"center",padding:20,color:o.muted},children:"No encryption policies found. Create one to get started."})}):A.map(t=>e.jsxs(N,{children:[e.jsx(i,{children:t.policy_name}),e.jsx(i,{children:e.jsxs("code",{style:{color:o.accent},children:[t.schema_name,".",t.table_name,".",t.column_name]})}),e.jsx(i,{children:t.encryption_algorithm}),e.jsx(i,{children:e.jsx("code",{style:{color:o.muted},children:t.key_id})}),e.jsx(i,{children:e.jsx("span",{style:{color:t.active?o.success:o.danger,fontWeight:600},children:t.active?"ACTIVE":"INACTIVE"})}),e.jsx(i,{children:T(t.last_rotated_at||"")}),e.jsx(i,{children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(d,{label:"âœŽ",onClick:()=>H(t),variant:"ghost"}),e.jsx(d,{label:"ðŸ”’",onClick:()=>U(t),variant:"ghost",title:"Encrypt Column Data"}),e.jsx(d,{label:"ðŸ”„",onClick:()=>X(t),variant:"ghost",title:"Rotate Key"}),e.jsx(d,{label:"ðŸ—‘ï¸",onClick:()=>q(t.policy_id),variant:"ghost"})]})})]},t.policy_id))})]}),C>v&&e.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:o.muted},children:["Page ",k," of ",Math.ceil(C/v)]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(d,{label:"â—€ Previous",onClick:()=>K(t=>Math.max(1,t-1)),disabled:k===1,variant:"ghost"}),e.jsx(d,{label:"Next â–¶",onClick:()=>K(t=>Math.min(Math.ceil(C/v),t+1)),disabled:k>=Math.ceil(C/v),variant:"ghost"})]})]})]})})}),W&&a&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:t=>{t.target===t.currentTarget&&j(!1)},children:e.jsx("div",{style:{backgroundColor:o.background,border:`2px solid ${o.border}`,borderRadius:2,width:"90%",maxWidth:600,maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:e.jsx(R,{title:a.policy_id?"EDIT ENCRYPTION POLICY":"CREATE ENCRYPTION POLICY",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Policy Name *"}),e.jsx("input",{type:"text",value:a.policy_name,onChange:t=>m(n=>n?{...n,policy_name:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Schema Name *"}),e.jsx("input",{type:"text",value:a.schema_name,onChange:t=>m(n=>n?{...n,schema_name:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Table Name *"}),e.jsx("input",{type:"text",value:a.table_name,onChange:t=>m(n=>n?{...n,table_name:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Column Name *"}),e.jsx("input",{type:"text",value:a.column_name,onChange:t=>m(n=>n?{...n,column_name:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Encryption Algorithm *"}),e.jsxs("select",{value:a.encryption_algorithm,onChange:t=>m(n=>n?{...n,encryption_algorithm:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"AES128",children:"AES128"}),e.jsx("option",{value:"AES192",children:"AES192"}),e.jsx("option",{value:"AES256",children:"AES256"})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Key ID *"}),e.jsxs("select",{value:a.key_id,onChange:t=>m(n=>n?{...n,key_id:t.target.value}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"",children:"Select Key"}),z.map(t=>e.jsxs("option",{value:t.key_id,children:[t.key_id," (",t.algorithm,")"]},t.key_id))]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Key Rotation Interval (days)"}),e.jsx("input",{type:"number",value:a.key_rotation_interval_days||90,onChange:t=>m(n=>n?{...n,key_rotation_interval_days:parseInt(t.target.value)||90}:null),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:t=>m(n=>n?{...n,active:t.target.checked}:null),style:{cursor:"pointer"}}),e.jsx("span",{style:{color:o.foreground,fontSize:12},children:"Active"})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:20},children:[e.jsx(d,{label:"Cancel",onClick:()=>j(!1),variant:"ghost"}),e.jsx(d,{label:"Save",onClick:G})]})]})})})}),O&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:t=>{t.target===t.currentTarget&&_(!1)},children:e.jsx("div",{style:{backgroundColor:o.background,border:`2px solid ${o.border}`,borderRadius:2,width:"90%",maxWidth:500,maxHeight:"90vh",overflowY:"auto"},onClick:t=>t.stopPropagation(),children:e.jsx(R,{title:"ENCRYPTION KEYS",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:o.accent,marginBottom:12},children:[E.blockFull," CREATE NEW KEY"]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Key ID *"}),e.jsx("input",{type:"text",value:y.key_id,onChange:t=>S(n=>({...n,key_id:t.target.value})),placeholder:"e.g., key_2024_01",style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Key Value *"}),e.jsx("input",{type:"password",value:y.key_value,onChange:t=>S(n=>({...n,key_value:t.target.value})),placeholder:"Enter encryption key",style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2}})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:o.muted,fontSize:11},children:"Algorithm"}),e.jsxs("select",{value:y.algorithm,onChange:t=>S(n=>({...n,algorithm:t.target.value})),style:{width:"100%",padding:"8px 12px",border:`1px solid ${o.border}`,backgroundColor:o.background,color:o.foreground,fontFamily:"Consolas",fontSize:12,borderRadius:2},children:[e.jsx("option",{value:"AES128",children:"AES128"}),e.jsx("option",{value:"AES192",children:"AES192"}),e.jsx("option",{value:"AES256",children:"AES256"})]})]}),e.jsx(d,{label:"Create Key",onClick:J})]}),e.jsxs("div",{style:{marginTop:24,paddingTop:16,borderTop:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:o.accent,marginBottom:12},children:[E.blockFull," EXISTING KEYS"]}),z.length===0?e.jsx("div",{style:{color:o.muted,fontSize:11,padding:12},children:"No encryption keys found. Create one above."}):e.jsxs(F,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Key ID"}),e.jsx(c,{children:"Algorithm"}),e.jsx(c,{children:"Created"}),e.jsx(c,{children:"Last Used"}),e.jsx(c,{children:"Rotations"})]})}),e.jsx("tbody",{children:z.map(t=>e.jsxs(N,{children:[e.jsx(i,{children:e.jsx("code",{style:{color:o.accent},children:t.key_id})}),e.jsx(i,{children:t.algorithm}),e.jsx(i,{children:T(t.created_at)}),e.jsx(i,{children:T(t.last_used_at||"")}),e.jsx(i,{children:t.rotation_count})]},t.key_id))})]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:20},children:e.jsx(d,{label:"Close",onClick:()=>_(!1),variant:"ghost"})})]})})})})]})};export{de as default};
