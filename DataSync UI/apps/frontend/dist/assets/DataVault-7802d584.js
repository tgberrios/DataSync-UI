import{r as a,j as e,b as t,e as Z,N as Q}from"./index-75d7470b.js";import{A as w}from"./AsciiPanel-9f053981.js";import{A as b}from"./AsciiButton-446d8430.js";import{u as te}from"./usePagination-b946ac42.js";import{u as ne}from"./useTableFilters-0b8dd77f.js";import{e as K}from"./errorHandler-5ea9ae85.js";import{s as se}from"./validation-24839588.js";import{S as oe}from"./SkeletonLoader-530eacc4.js";import{C as ee}from"./ConnectionStringSelector-c1083be0.js";const re=({vaults:z,onVaultClick:u,onEdit:r,onDelete:L,onBuild:$,selectedVault:i})=>{const[f,C]=a.useState(new Set),j=a.useMemo(()=>{const m=new Map;return z.forEach(g=>{const d=g.target_schema||"Other";m.has(d)||m.set(d,{name:d,vaults:[]}),m.get(d).vaults.push(g)}),Array.from(m.values()).sort((g,d)=>g.name.localeCompare(d.name))},[z]),v=m=>{C(g=>{const d=new Set(g);return d.has(m)?d.delete(m):d.add(m),d})};return z.length===0?e.jsxs("div",{style:{padding:40,textAlign:"center",color:t.muted,fontFamily:"Consolas"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:12,opacity:.4,fontFamily:"Consolas"},children:Z.blockFull}),e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",marginBottom:4},children:"No vaults found"}),e.jsx("div",{style:{fontSize:11,fontFamily:"Consolas",color:t.muted,opacity:.7},children:"Try adjusting your filters"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:j.map(m=>{const g=f.has(m.name);return e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 14px",cursor:"pointer",backgroundColor:g?t.backgroundSoft:"transparent",borderRadius:2,userSelect:"none",transition:"all 0.2s",border:g?`1px solid ${t.border}`:"1px solid transparent",marginBottom:4},onClick:()=>v(m.name),onMouseEnter:d=>{g||(d.currentTarget.style.backgroundColor=t.backgroundSoft,d.currentTarget.style.borderColor=t.border)},onMouseLeave:d=>{g||(d.currentTarget.style.backgroundColor="transparent",d.currentTarget.style.borderColor="transparent")},children:[e.jsx("span",{style:{marginRight:10,fontSize:12,fontFamily:"Consolas",transition:"transform 0.2s",transform:g?"rotate(90deg)":"rotate(0deg)",color:g?t.accent:t.muted},children:Z.arrowRight}),e.jsx("h3",{style:{margin:0,fontSize:13,fontFamily:"Consolas",fontWeight:600,color:g?t.accent:t.foreground,flex:1,transition:"color 0.2s"},children:m.name}),e.jsx("span",{style:{fontSize:11,color:t.muted,fontFamily:"Consolas",padding:"4px 8px",backgroundColor:g?t.accent+"20":t.background,borderRadius:2,fontWeight:500,transition:"all 0.2s",border:`1px solid ${g?t.accent:t.border}`},children:m.vaults.length})]}),g&&e.jsx("div",{style:{marginLeft:24,marginTop:6,marginBottom:8,display:"flex",flexDirection:"column",gap:6,paddingLeft:12,borderLeft:`2px solid ${t.border}`},children:m.vaults.map(d=>{var R,k,F,p,E;const _=(i==null?void 0:i.vault_name)===d.vault_name;return e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"10px 12px",cursor:"pointer",borderRadius:2,border:`1px solid ${_?t.accent:t.border}`,backgroundColor:_?t.accent+"10":t.background,transition:"all 0.2s",position:"relative"},onMouseEnter:h=>{_||(h.currentTarget.style.backgroundColor=t.backgroundSoft,h.currentTarget.style.borderColor=t.accent,h.currentTarget.style.transform="translateX(4px)",h.currentTarget.style.boxShadow=`0 2px 8px ${t.accent}20`)},onMouseLeave:h=>{_||(h.currentTarget.style.backgroundColor=t.background,h.currentTarget.style.borderColor=t.border,h.currentTarget.style.transform="translateX(0)",h.currentTarget.style.boxShadow="none")},onClick:()=>u==null?void 0:u(d),children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontFamily:"Consolas",color:_?t.accent:t.foreground,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginBottom:4},children:d.vault_name}),e.jsxs("div",{style:{fontSize:11,color:t.muted,fontFamily:"Consolas",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{children:[((R=d.hubs)==null?void 0:R.length)||0,"H"]}),e.jsx("span",{style:{color:t.border},children:"•"}),e.jsxs("span",{children:[((k=d.links)==null?void 0:k.length)||0,"L"]}),e.jsx("span",{style:{color:t.border},children:"•"}),e.jsxs("span",{children:[((F=d.satellites)==null?void 0:F.length)||0,"S"]}),e.jsx("span",{style:{color:t.border},children:"•"}),e.jsxs("span",{children:[((p=d.point_in_time_tables)==null?void 0:p.length)||0,"PIT"]}),e.jsx("span",{style:{color:t.border},children:"•"}),e.jsxs("span",{children:[((E=d.bridge_tables)==null?void 0:E.length)||0,"B"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginLeft:12,paddingLeft:12,borderLeft:`1px solid ${t.border}`},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",backgroundColor:d.active&&d.enabled?t.success:t.muted,boxShadow:d.active&&d.enabled?`0 0 6px ${t.success}40`:"none",transition:"all 0.2s"},title:d.active&&d.enabled?"Active":"Inactive"}),d.last_build_status==="SUCCESS"&&e.jsx("span",{style:{fontSize:14,color:t.success,fontFamily:"Consolas",lineHeight:1},title:"Last build successful",children:"✓"}),d.last_build_status==="ERROR"&&e.jsx("span",{style:{fontSize:14,color:t.danger,fontFamily:"Consolas",lineHeight:1},title:"Last build failed",children:"✗"})]})]},d.vault_name)})})]},m.name)})})},q={MariaDB:"host=localhost;user=myuser;password=mypassword;db=mydatabase;port=3306",MSSQL:"DRIVER={ODBC Driver 17 for SQL Server};SERVER=localhost,1433;DATABASE=mydatabase;UID=myuser;PWD=mypassword",Oracle:"host=localhost;user=myuser;password=mypassword;db=mydatabase;port=1521",PostgreSQL:"postgresql://myuser:mypassword@localhost:5432/mydatabase",MongoDB:"mongodb://myuser:mypassword@localhost:27017/mydatabase",Snowflake:"DRIVER={Snowflake Driver};SERVER=myaccount.snowflakecomputing.com;UID=myuser;PWD=mypassword;WAREHOUSE=mywarehouse;DATABASE=mydatabase;SCHEMA=myschema",BigQuery:JSON.stringify({project_id:"my-project-id",dataset_id:"my_dataset",access_token:"ya29.xxx..."},null,2),Redshift:"postgresql://myuser:mypassword@mycluster.region.redshift.amazonaws.com:5439/mydatabase"},ae=({onClose:z,onSave:u,vault:r})=>{const L=(r==null?void 0:r.source_db_engine)||"PostgreSQL",$=(r==null?void 0:r.target_db_engine)||"PostgreSQL",[i,f]=a.useState({vault_name:(r==null?void 0:r.vault_name)||"",description:(r==null?void 0:r.description)||"",source_db_engine:L,source_connection_string:(r==null?void 0:r.source_connection_string)||q[L]||"",target_db_engine:$,target_connection_string:(r==null?void 0:r.target_connection_string)||q[$]||"",target_schema:(r==null?void 0:r.target_schema)||"",schedule_cron:(r==null?void 0:r.schedule_cron)||"",active:(r==null?void 0:r.active)!==void 0?r.active:!0,enabled:(r==null?void 0:r.enabled)!==void 0?r.enabled:!0,metadata:(r==null?void 0:r.metadata)||{}}),[C,j]=a.useState((r==null?void 0:r.hubs)||[]),[v,m]=a.useState((r==null?void 0:r.links)||[]),[g,d]=a.useState((r==null?void 0:r.satellites)||[]),[_,R]=a.useState((r==null?void 0:r.point_in_time_tables)||[]),[k,F]=a.useState((r==null?void 0:r.bridge_tables)||[]),[p,E]=a.useState(null),[h,S]=a.useState(!1),[T,X]=a.useState("basic"),J=a.useCallback(()=>{const n={hub_name:"",target_schema:i.target_schema||"",target_table:"",source_query:"",business_keys:[],hub_key_column:"hub_key",load_date_column:"load_date",record_source_column:"record_source",index_columns:[]};j([...C,n])},[C,i.target_schema]),B=a.useCallback((n,s,o)=>{j(y=>{const c=[...y];return s==="business_keys"||s==="index_columns"?c[n]={...c[n],[s]:typeof o=="string"?o.split(",").map(x=>x.trim()).filter(x=>x):o}:c[n]={...c[n],[s]:o},c})},[]),H=a.useCallback(n=>{j(s=>s.filter((o,y)=>y!==n))},[]),G=a.useCallback(()=>{const n={link_name:"",target_schema:i.target_schema||"",target_table:"",source_query:"",hub_references:[],link_key_column:"link_key",load_date_column:"load_date",record_source_column:"record_source",index_columns:[]};m([...v,n])},[v,i.target_schema]),I=a.useCallback((n,s,o)=>{m(y=>{const c=[...y];return s==="hub_references"||s==="index_columns"?c[n]={...c[n],[s]:typeof o=="string"?o.split(",").map(x=>x.trim()).filter(x=>x):o}:c[n]={...c[n],[s]:o},c})},[]),Y=a.useCallback(n=>{m(s=>s.filter((o,y)=>y!==n))},[]),V=a.useCallback(()=>{const n={satellite_name:"",target_schema:i.target_schema||"",target_table:"",parent_hub_name:"",parent_link_name:"",source_query:"",parent_key_column:"parent_key",load_date_column:"load_date",load_end_date_column:"load_end_date",record_source_column:"record_source",descriptive_attributes:[],index_columns:[],is_historized:!0};d([...g,n])},[g,i.target_schema]),D=a.useCallback((n,s,o)=>{d(y=>{const c=[...y];return s==="descriptive_attributes"||s==="index_columns"?c[n]={...c[n],[s]:typeof o=="string"?o.split(",").map(x=>x.trim()).filter(x=>x):o}:c[n]={...c[n],[s]:o},c})},[]),U=a.useCallback(n=>{d(s=>s.filter((o,y)=>y!==n))},[]),W=a.useCallback(()=>{const n={pit_name:"",target_schema:i.target_schema||"",target_table:"",hub_name:"",satellite_names:[],snapshot_date_column:"snapshot_date",index_columns:[]};R([..._,n])},[_,i.target_schema]),P=a.useCallback((n,s,o)=>{R(y=>{const c=[...y];return s==="satellite_names"||s==="index_columns"?c[n]={...c[n],[s]:typeof o=="string"?o.split(",").map(x=>x.trim()).filter(x=>x):o}:c[n]={...c[n],[s]:o},c})},[]),N=a.useCallback(n=>{R(s=>s.filter((o,y)=>y!==n))},[]),l=a.useCallback(()=>{const n={bridge_name:"",target_schema:i.target_schema||"",target_table:"",hub_name:"",link_names:[],snapshot_date_column:"snapshot_date",index_columns:[]};F([...k,n])},[k,i.target_schema]),A=a.useCallback((n,s,o)=>{F(y=>{const c=[...y];return s==="link_names"||s==="index_columns"?c[n]={...c[n],[s]:typeof o=="string"?o.split(",").map(x=>x.trim()).filter(x=>x):o}:c[n]={...c[n],[s]:o},c})},[]),O=a.useCallback(n=>{F(s=>s.filter((o,y)=>y!==n))},[]),M=a.useCallback(async()=>{E(null),S(!0);try{const n={vault_name:i.vault_name,description:i.description||null,source_db_engine:i.source_db_engine,source_connection_string:i.source_connection_string,target_db_engine:i.target_db_engine,target_connection_string:i.target_connection_string,target_schema:i.target_schema,hubs:C,links:v,satellites:g,point_in_time_tables:_,bridge_tables:k,schedule_cron:i.schedule_cron||null,active:i.active,enabled:i.enabled,metadata:i.metadata};r?await Q.updateVault(r.vault_name,n):await Q.createVault(n),u()}catch(n){E(K(n))}finally{S(!1)}},[i,C,v,g,_,k,r,u]);return e.jsx(w,{title:r?`EDIT VAULT: ${r.vault_name}`:"ADD DATA VAULT",onClose:z,style:{width:"90vw",maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12},children:[p&&e.jsx("div",{style:{padding:12,marginBottom:16,backgroundColor:t.danger+"20",border:`1px solid ${t.danger}`,borderRadius:2,color:t.danger},children:p}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:16,borderBottom:`1px solid ${t.border}`,paddingBottom:8},children:["basic","hubs","links","satellites","pit","bridge"].map(n=>e.jsx(b,{label:n.charAt(0).toUpperCase()+n.slice(1),onClick:()=>X(n),variant:T===n?"primary":"ghost"},n))}),T==="basic"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:t.foreground,fontWeight:600},children:"Vault Name *"}),e.jsx("input",{type:"text",value:i.vault_name,onChange:n=>f(s=>({...s,vault_name:n.target.value})),disabled:!!r,style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:r?t.backgroundSoft:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:t.foreground,fontWeight:600},children:"Description"}),e.jsx("textarea",{value:i.description,onChange:n=>f(s=>({...s,description:n.target.value})),rows:3,style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none",resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:t.foreground,fontWeight:600},children:"Source DB Engine *"}),e.jsxs("select",{value:i.source_db_engine,onChange:n=>{const s=n.target.value;f(o=>({...o,source_db_engine:s,source_connection_string:q[s]||o.source_connection_string}))},style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"MariaDB",children:"MariaDB"}),e.jsx("option",{value:"MSSQL",children:"MSSQL"}),e.jsx("option",{value:"MongoDB",children:"MongoDB"}),e.jsx("option",{value:"Oracle",children:"Oracle"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:t.foreground,fontWeight:600},children:"Target DB Engine *"}),e.jsxs("select",{value:i.target_db_engine,onChange:n=>{const s=n.target.value;f(o=>({...o,target_db_engine:s,target_connection_string:q[s]||o.target_connection_string}))},style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,cursor:"pointer",outline:"none"},children:[e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"Snowflake",children:"Snowflake"}),e.jsx("option",{value:"BigQuery",children:"BigQuery"}),e.jsx("option",{value:"Redshift",children:"Redshift"})]})]})]}),e.jsx("div",{children:e.jsx(ee,{value:i.source_connection_string,onChange:n=>f(s=>({...s,source_connection_string:n})),dbEngine:i.source_db_engine,label:"Source Connection String",required:!0})}),e.jsx("div",{children:e.jsx(ee,{value:i.target_connection_string,onChange:n=>f(s=>({...s,target_connection_string:n})),dbEngine:i.target_db_engine,label:"Target Connection String",required:!0})}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:t.foreground,fontWeight:600},children:"Target Schema *"}),e.jsx("input",{type:"text",value:i.target_schema,onChange:n=>f(s=>({...s,target_schema:n.target.value})),style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,color:t.foreground,fontWeight:600},children:"Schedule Cron (optional)"}),e.jsx("input",{type:"text",value:i.schedule_cron,onChange:n=>f(s=>({...s,schedule_cron:n.target.value})),placeholder:"0 0 * * * (daily at midnight)",style:{width:"100%",padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"}})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:n=>f(s=>({...s,active:n.target.checked}))}),e.jsx("span",{style:{color:t.foreground},children:"Active"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.enabled,onChange:n=>f(s=>({...s,enabled:n.target.checked}))}),e.jsx("span",{style:{color:t.foreground},children:"Enabled"})]})]})]}),T==="hubs"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,color:t.foreground},children:["Hub Tables (",C.length,")"]}),e.jsx(b,{label:"Add Hub",onClick:J,variant:"primary"})]}),C.map((n,s)=>e.jsx(w,{title:`Hub ${s+1}: ${n.hub_name||"Unnamed"}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Hub Name *"}),e.jsx("input",{type:"text",value:n.hub_name,onChange:o=>B(s,"hub_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Target Table *"}),e.jsx("input",{type:"text",value:n.target_table,onChange:o=>B(s,"target_table",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Source Query *"}),e.jsx("textarea",{value:n.source_query,onChange:o=>B(s,"source_query",o.target.value),rows:3,style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Business Keys (comma-separated) *"}),e.jsx("input",{type:"text",value:n.business_keys.join(", "),onChange:o=>B(s,"business_keys",o.target.value),placeholder:"customer_id, order_id",style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Hub Key Column"}),e.jsx("input",{type:"text",value:n.hub_key_column,onChange:o=>B(s,"hub_key_column",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Load Date Column"}),e.jsx("input",{type:"text",value:n.load_date_column,onChange:o=>B(s,"load_date_column",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Record Source Column"}),e.jsx("input",{type:"text",value:n.record_source_column,onChange:o=>B(s,"record_source_column",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]})]}),e.jsx(b,{label:"Remove",onClick:()=>H(s),variant:"danger"})]})},s))]}),T==="links"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,color:t.foreground},children:["Link Tables (",v.length,")"]}),e.jsx(b,{label:"Add Link",onClick:G,variant:"primary"})]}),v.map((n,s)=>e.jsx(w,{title:`Link ${s+1}: ${n.link_name||"Unnamed"}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Link Name *"}),e.jsx("input",{type:"text",value:n.link_name,onChange:o=>I(s,"link_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Target Table *"}),e.jsx("input",{type:"text",value:n.target_table,onChange:o=>I(s,"target_table",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Source Query *"}),e.jsx("textarea",{value:n.source_query,onChange:o=>I(s,"source_query",o.target.value),rows:3,style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Hub References (comma-separated) *"}),e.jsx("input",{type:"text",value:n.hub_references.join(", "),onChange:o=>I(s,"hub_references",o.target.value),placeholder:"customer_hub, order_hub",style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsx(b,{label:"Remove",onClick:()=>Y(s),variant:"danger"})]})},s))]}),T==="satellites"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,color:t.foreground},children:["Satellite Tables (",g.length,")"]}),e.jsx(b,{label:"Add Satellite",onClick:V,variant:"primary"})]}),g.map((n,s)=>e.jsx(w,{title:`Satellite ${s+1}: ${n.satellite_name||"Unnamed"}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Satellite Name *"}),e.jsx("input",{type:"text",value:n.satellite_name,onChange:o=>D(s,"satellite_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Target Table *"}),e.jsx("input",{type:"text",value:n.target_table,onChange:o=>D(s,"target_table",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Parent Hub Name"}),e.jsx("input",{type:"text",value:n.parent_hub_name,onChange:o=>D(s,"parent_hub_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Parent Link Name"}),e.jsx("input",{type:"text",value:n.parent_link_name,onChange:o=>D(s,"parent_link_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Source Query *"}),e.jsx("textarea",{value:n.source_query,onChange:o=>D(s,"source_query",o.target.value),rows:3,style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Descriptive Attributes (comma-separated)"}),e.jsx("input",{type:"text",value:n.descriptive_attributes.join(", "),onChange:o=>D(s,"descriptive_attributes",o.target.value),placeholder:"name, email, address",style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n.is_historized,onChange:o=>D(s,"is_historized",o.target.checked)}),e.jsx("span",{style:{fontSize:11},children:"Historized (track history)"})]}),e.jsx(b,{label:"Remove",onClick:()=>U(s),variant:"danger"})]})},s))]}),T==="pit"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,color:t.foreground},children:["Point-in-Time Tables (",_.length,")"]}),e.jsx(b,{label:"Add PIT",onClick:W,variant:"primary"})]}),_.map((n,s)=>e.jsx(w,{title:`PIT ${s+1}: ${n.pit_name||"Unnamed"}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"PIT Name *"}),e.jsx("input",{type:"text",value:n.pit_name,onChange:o=>P(s,"pit_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Target Table *"}),e.jsx("input",{type:"text",value:n.target_table,onChange:o=>P(s,"target_table",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Hub Name *"}),e.jsx("input",{type:"text",value:n.hub_name,onChange:o=>P(s,"hub_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Satellite Names (comma-separated) *"}),e.jsx("input",{type:"text",value:n.satellite_names.join(", "),onChange:o=>P(s,"satellite_names",o.target.value),placeholder:"customer_sat, order_sat",style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsx(b,{label:"Remove",onClick:()=>N(s),variant:"danger"})]})},s))]}),T==="bridge"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{margin:0,color:t.foreground},children:["Bridge Tables (",k.length,")"]}),e.jsx(b,{label:"Add Bridge",onClick:l,variant:"primary"})]}),k.map((n,s)=>e.jsx(w,{title:`Bridge ${s+1}: ${n.bridge_name||"Unnamed"}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Bridge Name *"}),e.jsx("input",{type:"text",value:n.bridge_name,onChange:o=>A(s,"bridge_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Target Table *"}),e.jsx("input",{type:"text",value:n.target_table,onChange:o=>A(s,"target_table",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Hub Name *"}),e.jsx("input",{type:"text",value:n.hub_name,onChange:o=>A(s,"hub_name",o.target.value),style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:4,fontSize:11},children:"Link Names (comma-separated) *"}),e.jsx("input",{type:"text",value:n.link_names.join(", "),onChange:o=>A(s,"link_names",o.target.value),placeholder:"customer_order_link, order_item_link",style:{width:"100%",padding:"4px 8px",fontSize:11,fontFamily:"Consolas"}})]}),e.jsx(b,{label:"Remove",onClick:()=>O(s),variant:"danger"})]})},s))]}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx(b,{label:"Cancel",onClick:z,variant:"ghost"}),e.jsx(b,{label:h?"Saving...":r?"Update":"Create",onClick:M,variant:"primary",disabled:h})]})]})})},ye=()=>{var D,U,W,P,N;const{setPage:z}=te(1,20),{filters:u,setFilter:r}=ne({source_db_engine:"",target_db_engine:"",active:""}),[L,$]=a.useState(""),[i,f]=a.useState(""),[C,j]=a.useState(null),[v,m]=a.useState([]),[g,d]=a.useState(!0),[_,R]=a.useState(!1),[k,F]=a.useState(null),[p,E]=a.useState(null),h=a.useRef(!0),S=a.useCallback(async()=>{if(!h.current)return;const l=Date.now(),A=300;try{d(!0),j(null);const M={page:1,limit:1e4,search:se(i,100)};u.source_db_engine&&(M.source_db_engine=u.source_db_engine),u.target_db_engine&&(M.target_db_engine=u.target_db_engine),u.active&&(M.active=u.active);const n=await Q.getVaults(M),s=Date.now()-l,o=Math.max(0,A-s);await new Promise(y=>setTimeout(y,o)),h.current&&m(n.data||[])}catch(O){h.current&&j(K(O))}finally{h.current&&d(!1)}},[i,u]);a.useEffect(()=>(h.current=!0,S(),()=>{h.current=!1}),[S]);const T=a.useCallback(()=>{f(L),z(1)},[L,z]),X=a.useCallback(l=>{l.key==="Enter"&&T()},[T]),J=a.useCallback(async l=>{if(confirm(`Are you sure you want to delete vault "${l}"?`))try{await Q.deleteVault(l),S()}catch(A){h.current&&j(K(A))}},[S]),B=a.useCallback(l=>{F(l||null),R(!0)},[]),H=a.useCallback(()=>{R(!1),F(null)},[]),G=a.useCallback(()=>{S(),H()},[S,H]),I=a.useCallback(async l=>{try{j(null),await Q.buildVault(l),S(),setTimeout(()=>{S()},2e3)}catch(A){h.current&&j(K(A))}},[S]),Y=a.useCallback(async l=>{E(l),j(null)},[]),V=v.filter(l=>!(u.source_db_engine&&l.source_db_engine!==u.source_db_engine||u.target_db_engine&&l.target_db_engine!==u.target_db_engine||u.active&&String(l.active)!==u.active));return g&&v.length===0?e.jsx(oe,{variant:"table"}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:0,color:t.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:t.accent,marginRight:8},children:Z.blockFull}),"DATA VAULT 2.0"]})}),C&&e.jsx("div",{style:{marginBottom:20},children:e.jsx(w,{title:"ERROR",children:e.jsx("div",{style:{padding:"12px",color:t.danger,fontSize:12,fontFamily:"Consolas"},children:C})})}),e.jsx(w,{title:"SEARCH",children:e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"8px 0"},children:[e.jsx("input",{type:"text",placeholder:"Search by vault name, schema, or target...",value:L,onChange:l=>$(l.target.value),onKeyPress:X,style:{flex:1,padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,outline:"none"},onFocus:l=>{l.currentTarget.style.borderColor=t.accent},onBlur:l=>{l.currentTarget.style.borderColor=t.border}}),e.jsx(b,{label:"Search",onClick:T,variant:"primary"}),i&&e.jsx(b,{label:"Clear",onClick:()=>{$(""),f(""),z(1)},variant:"ghost"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsx(w,{title:"FILTERS",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:12,padding:"8px 0"},children:[e.jsx(b,{label:"Add Vault",onClick:()=>B(),variant:"primary"}),e.jsxs("select",{value:u.source_db_engine,onChange:l=>r("source_db_engine",l.target.value),style:{padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,cursor:"pointer",outline:"none"},onFocus:l=>{l.currentTarget.style.borderColor=t.accent},onBlur:l=>{l.currentTarget.style.borderColor=t.border},children:[e.jsx("option",{value:"",children:"All Source Engines"}),e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"MariaDB",children:"MariaDB"}),e.jsx("option",{value:"MSSQL",children:"MSSQL"}),e.jsx("option",{value:"MongoDB",children:"MongoDB"}),e.jsx("option",{value:"Oracle",children:"Oracle"})]}),e.jsxs("select",{value:u.target_db_engine,onChange:l=>r("target_db_engine",l.target.value),style:{padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,cursor:"pointer",outline:"none"},onFocus:l=>{l.currentTarget.style.borderColor=t.accent},onBlur:l=>{l.currentTarget.style.borderColor=t.border},children:[e.jsx("option",{value:"",children:"All Target Engines"}),e.jsx("option",{value:"PostgreSQL",children:"PostgreSQL"}),e.jsx("option",{value:"Snowflake",children:"Snowflake"}),e.jsx("option",{value:"BigQuery",children:"BigQuery"}),e.jsx("option",{value:"Redshift",children:"Redshift"})]}),e.jsxs("select",{value:u.active,onChange:l=>r("active",l.target.value),style:{padding:"6px 10px",border:`1px solid ${t.border}`,borderRadius:2,fontSize:12,fontFamily:"Consolas",backgroundColor:t.background,color:t.foreground,cursor:"pointer",outline:"none"},onFocus:l=>{l.currentTarget.style.borderColor=t.accent},onBlur:l=>{l.currentTarget.style.borderColor=t.border},children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})})}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:20},children:[e.jsx("div",{style:{flex:1},children:e.jsx(w,{title:"VAULTS",style:{minHeight:400},children:g?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:t.muted,fontSize:12},children:"Loading vaults..."}):V.length===0?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:t.muted,fontSize:12},children:"No vaults found"}):e.jsx(re,{vaults:V,onVaultClick:Y,onEdit:B,onDelete:J,onBuild:I,selectedVault:p})})}),p&&e.jsx("div",{style:{flex:1},children:e.jsx(w,{title:`VAULT: ${p.vault_name}`,children:e.jsxs("div",{style:{padding:"12px",fontSize:11,fontFamily:"Consolas",lineHeight:1.6,color:t.foreground},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Description:"})," ",p.description||"N/A"]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Source Engine:"})," ",p.source_db_engine]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Target Engine:"})," ",p.target_db_engine]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Target Schema:"})," ",p.target_schema]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Hubs:"})," ",((D=p.hubs)==null?void 0:D.length)||0]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Links:"})," ",((U=p.links)==null?void 0:U.length)||0]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Satellites:"})," ",((W=p.satellites)==null?void 0:W.length)||0]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Point-in-Time Tables:"})," ",((P=p.point_in_time_tables)==null?void 0:P.length)||0]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Bridge Tables:"})," ",((N=p.bridge_tables)==null?void 0:N.length)||0]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Status:"})," ",e.jsx("span",{style:{color:p.active?t.success:t.danger,fontWeight:600},children:p.active?"ACTIVE":"INACTIVE"}),p.last_build_status&&e.jsxs(e.Fragment,{children:[" | ",e.jsx("strong",{style:{color:t.accent},children:"Last Build:"})," ",e.jsx("span",{style:{color:p.last_build_status==="SUCCESS"?t.success:t.danger,fontWeight:600},children:p.last_build_status})]})]}),p.last_build_time&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("strong",{style:{color:t.accent},children:"Last Build Time:"})," ",new Date(p.last_build_time).toLocaleString()]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:8},children:[e.jsx(b,{label:"Edit",onClick:()=>B(p),variant:"primary"}),e.jsx(b,{label:"Build",onClick:()=>I(p.vault_name),variant:"primary"})]})]})})})]}),_&&e.jsx(ae,{vault:k,onClose:H,onSave:G})]})};export{ye as default};
