import{r as c,s as I,j as e,b as t,e as h,R as U}from"./index-75d7470b.js";import{e as N}from"./errorHandler-5ea9ae85.js";import{A as n}from"./AsciiPanel-9f053981.js";import{A as W}from"./AsciiButton-446d8430.js";import{S as O}from"./SkeletonLoader-530eacc4.js";const m=d=>{switch(d){case"SUPERUSER":return t.danger;case"CREATEDB":return t.accent;case"CREATEROLE":return"#6a1b9a";case"LOGIN":return t.success;case"ACTIVE":return t.success;case"INACTIVE":return t.danger;case"SELECT":return t.success;case"INSERT":return t.accent;case"UPDATE":return t.warning;case"DELETE":return t.danger;case"ALL":return t.success;default:return t.muted}},C=d=>d?new Date(d).toLocaleString():"-",D=d=>{const u=d.reduce((f,r)=>{const g=r.username;return f[g]||(f[g]={username:g,role_type:r.role_type,connections:[],mostRecentActivity:r.last_activity,statusCounts:{},expanded:!1}),f[g].connections.push({status:r.status,last_activity:r.last_activity,client_addr:r.client_addr,application_name:r.application_name,database:r.database,backend_start:r.backend_start,query_duration:r.query_duration,wait_event_type:r.wait_event_type,wait_event:r.wait_event,query:r.query}),r.last_activity&&(!f[g].mostRecentActivity||new Date(r.last_activity)>new Date(f[g].mostRecentActivity))&&(f[g].mostRecentActivity=r.last_activity),f[g].statusCounts[r.status]=(f[g].statusCounts[r.status]||0)+1,f},{});return Object.values(u)},Y=()=>{const d=c.useRef(!0),[u,f]=c.useState(!0),[r,g]=c.useState(null),[s,B]=c.useState({users:{total:0,active:0,superusers:0,withLogin:0},connections:{current:0,max:0,idle:0,active:0},permissions:{totalGrants:0,schemasWithAccess:0,tablesWithAccess:0}}),[T,k]=c.useState([]),[A,R]=c.useState(new Set),[w,v]=c.useState(!1),[$,L]=c.useState(null),[z,F]=c.useState({}),_=c.useCallback(i=>{R(x=>{const l=new Set(x);return l.has(i)?l.delete(i):l.add(i),l})},[]),S=c.useCallback(async()=>{var l,o;if(!d.current)return;const i=Date.now(),x=300;try{f(!0),g(null);const a=await I.getSecurityData(),y=Date.now()-i,p=Math.max(0,x-y);await new Promise(j=>setTimeout(j,p)),d.current&&(B(a.summary||((l=a.postgres)==null?void 0:l.summary)||a),k(a.activeUsers||((o=a.postgres)==null?void 0:o.activeUsers)||[]),L(a.postgres||null),F(a.otherDatabases||{}))}catch(a){d.current&&g(N(a))}finally{d.current&&f(!1)}},[]);c.useEffect(()=>{d.current=!0,S();const i=setInterval(S,3e4);return()=>{d.current=!1,clearInterval(i)}},[S]);const b=c.useMemo(()=>!s.connections.max||s.connections.max===0?0:(s.connections.current/s.connections.max*100).toFixed(1),[s.connections]);return u&&(!s||Object.keys(s).length===0)?e.jsx(O,{variant:"table"}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Consolas",fontSize:12},children:[e.jsxs("h1",{style:{fontSize:14,fontWeight:600,margin:"0 0 20px 0",color:t.foreground,textTransform:"uppercase",fontFamily:"Consolas"},children:[e.jsx("span",{style:{color:t.accent,marginRight:8},children:h.blockFull}),"SECURITY & COMPLIANCE MONITOR"]}),r&&e.jsx("div",{style:{marginBottom:20},children:e.jsx(n,{title:"ERROR",children:e.jsx("div",{style:{padding:"12px",color:t.danger,fontSize:12,fontFamily:"Consolas"},children:r})})}),!u&&!r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:16,display:"flex",justifyContent:"flex-end"},children:e.jsx(W,{label:"Security Info",onClick:()=>v(!0),variant:"ghost"})}),w&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>v(!1),children:e.jsx("div",{style:{width:"90%",maxWidth:1e3,maxHeight:"90vh",overflowY:"auto"},onClick:i=>i.stopPropagation(),children:e.jsx(n,{title:"SECURITY & COMPLIANCE PLAYBOOK",children:e.jsxs("div",{style:{padding:16,fontFamily:"Consolas",fontSize:12,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[h.blockFull," OVERVIEW"]}),e.jsx("div",{style:{color:t.foreground,marginLeft:16},children:"Security & Compliance Monitor provides real-time visibility into database security posture, user access patterns, connection management, and permission structures. This dashboard helps identify security risks, monitor compliance, and ensure proper access controls."})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[h.blockFull," USER MANAGEMENT METRICS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Total Users"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Total number of database roles/users defined in the system. Includes both login and non-login roles."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.success,marginBottom:4},children:"Active Users"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of distinct users with current active database connections. Monitors who is currently accessing the database."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.danger,marginBottom:4},children:"Superusers"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Users with SUPERUSER privileges. Superusers have unrestricted access to all database objects and can bypass all permission checks. Should be limited to administrative accounts only."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.accent,marginBottom:4},children:"With Login"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of roles that have LOGIN privilege, allowing them to connect to the database. Non-login roles are typically used for group permissions."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[h.blockFull," CONNECTION STATUS METRICS"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Current Connections"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of active database connections currently established. Each connection consumes server resources."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Max Allowed"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Maximum number of concurrent connections allowed by the database server configuration. Exceeding this limit will reject new connection attempts."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.warning,marginBottom:4},children:"Idle Connections"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Connections that are established but not currently executing queries. High idle connection counts may indicate connection pool inefficiencies or application issues."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.success,marginBottom:4},children:"Active Connections"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Connections currently executing queries or transactions. Active connections indicate database workload."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[h.blockFull," PERMISSIONS OVERVIEW"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Total Grants"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Total number of privilege grants (SELECT, INSERT, UPDATE, DELETE, etc.) across all tables and schemas. Represents the complexity of the permission structure."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Schemas With Access"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of distinct database schemas where users have been granted permissions. Helps identify scope of access across the database."})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:t.foreground,marginBottom:4},children:"Tables With Access"}),e.jsx("div",{style:{color:t.foreground,marginLeft:16,fontSize:11},children:"Number of distinct tables where users have been granted permissions. Indicates the breadth of data access across the database."})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[h.blockFull," ROLE TYPES"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.danger,fontWeight:600},children:"SUPERUSER"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Unrestricted access to all database objects, can bypass all permission checks"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.accent,fontWeight:600},children:"CREATEDB"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Can create new databases"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:"#6a1b9a",fontWeight:600},children:"CREATEROLE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Can create new roles and manage role memberships"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.success,fontWeight:600},children:"LOGIN"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Can connect to the database"})]})]})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{fontSize:14,fontWeight:600,color:t.accent,marginBottom:12},children:[h.blockFull," CONNECTION STATUSES"]}),e.jsxs("div",{style:{marginLeft:16},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.success,fontWeight:600},children:"ACTIVE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Connection is currently executing a query or transaction"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.warning,fontWeight:600},children:"IDLE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Connection is established but not executing any query"})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{color:t.danger,fontWeight:600},children:"INACTIVE"}),e.jsx("span",{style:{color:t.foreground,marginLeft:8,fontSize:11},children:"Connection is not active or has been terminated"})]})]})]}),e.jsxs("div",{style:{marginTop:16,padding:12,background:t.backgroundSoft,borderRadius:2,border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:t.muted,marginBottom:4},children:[h.blockSemi," Security Best Practices"]}),e.jsxs("div",{style:{fontSize:11,color:t.foreground},children:["• Limit SUPERUSER accounts to essential administrative roles only",e.jsx("br",{}),"• Monitor connection usage to prevent resource exhaustion",e.jsx("br",{}),"• Regularly audit permissions to ensure least-privilege access",e.jsx("br",{}),"• Review active connections for suspicious activity",e.jsx("br",{}),"• Use connection pooling to manage database connections efficiently"]})]}),e.jsx("div",{style:{marginTop:16,textAlign:"right"},children:e.jsx(W,{label:"Close",onClick:()=>v(!1),variant:"ghost"})})]})})})}),e.jsx(n,{title:"USER MANAGEMENT",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12,marginTop:8},children:[e.jsx(n,{title:"Total Users",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.foreground},children:s.users.total||0})}),e.jsx(n,{title:"Active Users",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.success},children:s.users.active||0})}),e.jsx(n,{title:"Superusers",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.danger},children:s.users.superusers||0})}),e.jsx(n,{title:"With Login",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.accent},children:s.users.withLogin||0})}),e.jsx(n,{title:"Inactive Users",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.muted},children:(s.users.total||0)-(s.users.active||0)})}),e.jsx(n,{title:"Non-Login Roles",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.muted},children:(s.users.total||0)-(s.users.withLogin||0)})})]})}),e.jsx(n,{title:"CONNECTION STATUS",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12,marginTop:8},children:[e.jsx(n,{title:"Current",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.foreground},children:s.connections.current||0})}),e.jsx(n,{title:"Max Allowed",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.foreground},children:s.connections.max||0})}),e.jsx(n,{title:"Usage",children:e.jsxs("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:Number(b)>80?t.danger:Number(b)>60?t.warning:t.success},children:[b,"%"]})}),e.jsx(n,{title:"Idle",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.warning},children:s.connections.idle||0})}),e.jsx(n,{title:"Active",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.success},children:s.connections.active||0})}),e.jsx(n,{title:"Available",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.accent},children:(s.connections.max||0)-(s.connections.current||0)})})]})}),e.jsx(n,{title:"PERMISSIONS OVERVIEW",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12,marginTop:8},children:[e.jsx(n,{title:"Total Grants",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.foreground},children:s.permissions.totalGrants||0})}),e.jsx(n,{title:"Schemas",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.accent},children:s.permissions.schemasWithAccess||0})}),e.jsx(n,{title:"Tables",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.accent},children:s.permissions.tablesWithAccess||0})}),e.jsx(n,{title:"Avg Grants/Table",children:e.jsx("div",{style:{fontFamily:"Consolas",fontSize:14,fontWeight:600,color:t.foreground},children:s.permissions.tablesWithAccess>0?((s.permissions.totalGrants||0)/s.permissions.tablesWithAccess).toFixed(1):"0"})})]})}),Object.keys(z).length>0&&e.jsx(n,{title:"OTHER DATABASES SECURITY",children:e.jsx("div",{style:{marginTop:8},children:Object.entries(z).map(([i,x])=>e.jsxs("div",{style:{marginBottom:16,padding:12,border:`1px solid ${t.border}`,borderRadius:2},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:t.accent,marginBottom:8},children:[h.blockFull," ",i]}),Array.isArray(x)&&x.map((l,o)=>{var a,y,p,j,E;return e.jsxs("div",{style:{marginBottom:12,padding:8,background:t.backgroundSoft,borderRadius:2},children:[e.jsxs("div",{style:{fontSize:11,color:t.muted,marginBottom:4},children:["Connection: ",l.connection||"N/A"]}),l.security&&!l.security.error?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:8,marginTop:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted},children:"Users"}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:t.foreground},children:((a=l.security.users)==null?void 0:a.length)||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted},children:"Active Connections"}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:t.foreground},children:l.security.activeConnections||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted},children:"Total Grants"}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:t.foreground},children:((y=l.security.permissions)==null?void 0:y.total_grants)||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted},children:"Schemas"}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:t.foreground},children:((p=l.security.permissions)==null?void 0:p.schemas_with_access)||0})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:t.muted},children:"Tables"}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:t.foreground},children:((j=l.security.permissions)==null?void 0:j.tables_with_access)||0})]})]}):e.jsx("div",{style:{fontSize:11,color:t.danger},children:((E=l.security)==null?void 0:E.error)||"Unable to retrieve security information"})]},o)})]},i))})}),e.jsx(n,{title:"ACTIVE USERS",children:e.jsx("div",{style:{marginTop:8,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Consolas",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",borderBottom:`2px solid ${t.borderStrong}`,backgroundColor:t.backgroundSoft,fontFamily:"Consolas",fontSize:13,fontWeight:600,position:"sticky",top:0,zIndex:10},children:"Username"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",borderBottom:`2px solid ${t.borderStrong}`,backgroundColor:t.backgroundSoft,fontFamily:"Consolas",fontSize:13,fontWeight:600,position:"sticky",top:0,zIndex:10},children:"Role"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",borderBottom:`2px solid ${t.borderStrong}`,backgroundColor:t.backgroundSoft,fontFamily:"Consolas",fontSize:13,fontWeight:600,position:"sticky",top:0,zIndex:10},children:"Status"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",borderBottom:`2px solid ${t.borderStrong}`,backgroundColor:t.backgroundSoft,fontFamily:"Consolas",fontSize:13,fontWeight:600,position:"sticky",top:0,zIndex:10},children:"Last Activity"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",borderBottom:`2px solid ${t.borderStrong}`,backgroundColor:t.backgroundSoft,fontFamily:"Consolas",fontSize:13,fontWeight:600,position:"sticky",top:0,zIndex:10},children:"Client IP"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",borderBottom:`2px solid ${t.borderStrong}`,backgroundColor:t.backgroundSoft,fontFamily:"Consolas",fontSize:13,fontWeight:600,position:"sticky",top:0,zIndex:10},children:"Application"})]})}),e.jsx("tbody",{children:D(T).map((i,x)=>{const l=A.has(i.username);return e.jsxs(U.Fragment,{children:[e.jsxs("tr",{style:{cursor:"pointer",backgroundColor:l?t.backgroundSoft:t.background,transition:"all 0.2s ease"},onClick:()=>_(i.username),onMouseEnter:o=>{o.currentTarget.style.backgroundColor=t.backgroundSoft},onMouseLeave:o=>{l||(o.currentTarget.style.backgroundColor=t.background)},children:[e.jsxs("td",{style:{padding:"8px 12px",borderBottom:`1px solid ${t.border}`,fontFamily:"Consolas",fontSize:12},children:[i.username,e.jsx("span",{style:{backgroundColor:t.accent,color:"#ffffff",padding:"2px 8px",borderRadius:12,fontSize:11,fontFamily:"Consolas",marginLeft:8},children:i.connections.length})]}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:`1px solid ${t.border}`,fontFamily:"Consolas",fontSize:12},children:e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:m(i.role_type)+"20",color:m(i.role_type),border:`1px solid ${m(i.role_type)}`},children:i.role_type})}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:`1px solid ${t.border}`,fontFamily:"Consolas",fontSize:12},children:e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:4},children:Object.entries(i.statusCounts).map(([o,a])=>e.jsxs("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:m(o)+"20",color:m(o),border:`1px solid ${m(o)}`},children:[o,": ",a]},o))})}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:`1px solid ${t.border}`,fontFamily:"Consolas",fontSize:12},children:C(i.mostRecentActivity)}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:`1px solid ${t.border}`,fontFamily:"Consolas",fontSize:12},children:i.connections.length>0&&i.connections[0].client_addr||"-"}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:`1px solid ${t.border}`,fontFamily:"Consolas",fontSize:12},children:i.connections.length>0&&i.connections[0].application_name||"-"})]}),l&&e.jsx("tr",{style:{backgroundColor:t.backgroundSoft},children:e.jsx("td",{colSpan:6,style:{padding:0,borderBottom:`1px solid ${t.border}`},children:e.jsxs("div",{style:{padding:"12px 16px",borderLeft:`3px solid ${t.accent}`,marginLeft:16,fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{marginBottom:12,fontWeight:600,color:t.foreground},children:["All Connections for ",i.username]}),i.connections.map((o,a)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,padding:"8px 0",borderBottom:a<i.connections.length-1?`1px solid ${t.border}`:"none",fontFamily:"Consolas",fontSize:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"Status:"}),e.jsx("div",{children:e.jsx("span",{style:{padding:"2px 8px",borderRadius:2,fontSize:11,fontFamily:"Consolas",backgroundColor:m(o.status)+"20",color:m(o.status),border:`1px solid ${m(o.status)}`},children:o.status})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"IP:"}),e.jsx("div",{style:{color:t.foreground,fontSize:11},children:o.client_addr||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"App:"}),e.jsx("div",{style:{color:t.foreground,fontSize:11},children:o.application_name||"-"})]}),o.database&&e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"Database:"}),e.jsx("div",{style:{color:t.foreground,fontSize:11},children:o.database})]}),o.backend_start&&e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"Backend Start:"}),e.jsx("div",{style:{color:t.foreground,fontSize:11},children:C(o.backend_start)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"Activity:"}),e.jsx("div",{style:{color:t.foreground,fontSize:11},children:C(o.last_activity)})]})]}),(o.query_duration||o.wait_event_type||o.query)&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:4},children:[o.query_duration&&e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"Query Duration:"}),e.jsx("div",{style:{color:t.foreground,fontSize:11},children:Number(o.query_duration)>1e3?`${(Number(o.query_duration)/1e3).toFixed(2)}s`:`${Number(o.query_duration).toFixed(0)}ms`})]}),o.wait_event_type&&e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11},children:"Wait Event:"}),e.jsxs("div",{style:{color:t.foreground,fontSize:11},children:[o.wait_event_type,o.wait_event&&` (${o.wait_event})`]})]})]}),o.query&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{fontWeight:500,color:t.muted,fontSize:11,marginBottom:4},children:"Query:"}),e.jsx("div",{style:{padding:8,background:t.background,borderRadius:2,border:`1px solid ${t.border}`,fontSize:11,color:t.foreground,fontFamily:"Consolas",maxHeight:150,overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:o.query.length>500?o.query.substring(0,500)+"...":o.query})]})]},a))]})})})]},x)})})]})})})]})]})};export{Y as default};
